<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Doxygen Fortran Example: unary_mod.f90 Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="namespaces.html"><span>Modules</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
<h1>unary_mod.f90</h1><a href="unary__mod_8f90.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a><a class="code" href="namespaceunary__mod.html">00001</a> <span class="keyword">module</span> unary_mod 
<a name="l00002"></a>00002 
<a name="l00003"></a>00003   use <span class="keywordflow">precision_vars</span>, only : wp
<a name="l00004"></a>00004 
<a name="l00005"></a>00005   <span class="keywordtype">private</span> 
<a name="l00006"></a>00006   <span class="keywordtype">public</span>  :: <a class="code" href="namespaceunary__mod.html#a94eff567ff346c4ab17791a55d513945">amubdg</a> , <a class="code" href="namespaceunary__mod.html#a7125e985b907bc5ba0787bdf69cea281">aplbdg</a>, <a class="code" href="namespaceunary__mod.html#a0b2722e1ac3c64f3c952ea05ca313a51">amub</a>, <a class="code" href="namespaceunary__mod.html#ad0d8a19e91684be702bb07ef7fe3a59c">aplb</a>, <a class="code" href="namespaceunary__mod.html#a2e235041e13f858f57a874a2c00fa767">aplb1</a>, <a class="code" href="namespaceunary__mod.html#ad981e96208abed6b51f14cda0410b0f5">csort</a>, <a class="code" href="namespaceunary__mod.html#ae02751d696fa87052f8e17891ef1f010">qsorti</a>, <a class="code" href="namespaceunary__mod.html#a5b877deded46fda45f8822143bea7d7b">qsortd</a>, <a class="code" href="namespaceunary__mod.html#a112ecdbf3d1dd5a1aef7aa9e75328ba1">transp</a>,  &amp;
<a name="l00007"></a>00007             &amp; <a class="code" href="namespaceunary__mod.html#aed31e503e8bd81c771b97208a362d988">csrcsc</a>, <a class="code" href="namespaceunary__mod.html#a410d2156084d51de8142c0adeeb8b86f">clncsr</a>, <a class="code" href="namespaceunary__mod.html#a6cc85f63470c7997e46581e91f0a21df">csort_block</a>, <a class="code" href="namespaceunary__mod.html#a84c57981ee762e2390488373d9c22f12">clean_CSR</a>, <a class="code" href="namespaceunary__mod.html#a74f52765deb59280ca3f1b308a7a3bfb">aplsca</a>, <a class="code" href="namespaceunary__mod.html#a1fd7556350f3910e37b411bb32adcb26">amudia</a>, <a class="code" href="namespaceunary__mod.html#a428ee1d4e4ab14a12be914c401b90158">diamua</a>,    &amp;
<a name="l00008"></a>00008             &amp; <a class="code" href="namespaceunary__mod.html#ad6619f9de5d3db24b25e89901c2adda7">apldia</a>, <a class="code" href="namespaceunary__mod.html#a3911ae3b59ca413043b651034c4faa94">cperm</a>, <a class="code" href="namespaceunary__mod.html#a8247fa4ab43954b9f840fc56fd441c23">dperm</a>, <a class="code" href="namespaceunary__mod.html#ac8cbdc4380307b940c0153271f95bf22">rperm</a>,                                       &amp;
<a name="l00009"></a>00009             &amp; <a class="code" href="namespaceunary__mod.html#a567f589fa5c03090c85884b98e93e19d">a_bl_mu_b_bl</a>, <a class="code" href="namespaceunary__mod.html#aa13625ff5a681041e10a45dc75e46dcc">a_sc_mu_b_bl</a>, <a class="code" href="namespaceunary__mod.html#a14f70b4fba629443e7b35cfe21e3b76d">a_bl_mu_b_sc</a>, <a class="code" href="namespaceunary__mod.html#aa6c4c1ef7fe51cabc14fbc76c53a9d73">a_bl_pl_b_bl1</a>, <a class="code" href="namespaceunary__mod.html#a6b2c0545bcff15945e07b7d8cd2e6dc8">a_bl_mu_x</a>,&amp;
<a name="l00010"></a>00010             &amp; <a class="code" href="namespaceunary__mod.html#a9537a8dc0e600452caabc4812555c9fc">a_bl_pl_b_bl_scal</a>, <a class="code" href="namespaceunary__mod.html#a8fb4d6fe6b909291d09e5633e46efba4">a_bl_pl_b_bl_diag</a>
<a name="l00011"></a>00011 
<a name="l00012"></a>00012 <span class="keyword">contains</span>
<a name="l00013"></a>00013 
<a name="l00014"></a>00014   <span class="comment">!                          S P A R S K I T                             c</span>
<a name="l00015"></a>00015   <span class="comment">!----------------------------------------------------------------------c</span>
<a name="l00016"></a>00016   <span class="comment">!                     UNARY SUBROUTINES MODULE                         c</span>
<a name="l00017"></a>00017   <span class="comment">!----------------------------------------------------------------------c</span>
<a name="l00018"></a>00018   <span class="comment">! contents:                                                            c</span>
<a name="l00019"></a>00019   <span class="comment">!----------                                                            c</span>
<a name="l00020"></a>00020   <span class="comment">! submat : extracts a submatrix from a sparse matrix.                  c</span>
<a name="l00021"></a>00021   <span class="comment">! filter : filters elements from a matrix according to their magnitude.c</span>
<a name="l00022"></a>00022   <span class="comment">! filterm: same as above, but for the MSR format                       c</span>
<a name="l00023"></a>00023   <span class="comment">! csort  : sorts the elements in increasing order of columns           c</span>
<a name="l00024"></a>00024   <span class="comment">! clncsr : clean up the CSR format matrix, remove duplicate entry, etc c</span>
<a name="l00025"></a>00025   <span class="comment">! transp : in-place transposition routine (see also csrcsc in formats) c</span>
<a name="l00026"></a>00026   <span class="comment">! copmat : copy of a matrix into another matrix (both stored csr)      c</span>
<a name="l00027"></a>00027   <span class="comment">! msrcop : copies a matrix in MSR format into a matrix in MSR format   c</span>
<a name="l00028"></a>00028   <span class="comment">! getelm : returns a(i,j) for any (i,j) from a CSR-stored matrix.      c</span>
<a name="l00029"></a>00029   <span class="comment">! getdia : extracts a specified diagonal from a matrix.                c</span>
<a name="l00030"></a>00030   <span class="comment">! getl   : extracts lower triangular part                              c</span>
<a name="l00031"></a>00031   <span class="comment">! getu   : extracts upper triangular part                              c</span>
<a name="l00032"></a>00032   <span class="comment">! levels : gets the level scheduling structure for lower triangular    c</span>
<a name="l00033"></a>00033   <span class="comment">!          matrices.                                                   c</span>
<a name="l00034"></a>00034   <span class="comment">! amask  : extracts     C = A mask M                                   c</span>
<a name="l00035"></a>00035   <span class="comment">! rperm  : permutes the rows of a matrix (B = P A)                     c</span>
<a name="l00036"></a>00036   <span class="comment">! cperm  : permutes the columns of a matrix (B = A Q)                  c</span>
<a name="l00037"></a>00037   <span class="comment">! dperm  : permutes both the rows and columns of a matrix (B = P A Q ) c</span>
<a name="l00038"></a>00038   <span class="comment">! dperm1 : general extractiob routine (extracts arbitrary rows)        c</span>
<a name="l00039"></a>00039   <span class="comment">! dperm2 : general submatrix permutation/extraction routine            c</span>
<a name="l00040"></a>00040   <span class="comment">! dmperm : symmetric permutation of row and column (B=PAP&apos;) in MSR fmt c</span>
<a name="l00041"></a>00041   <span class="comment">! dvperm : permutes a real vector (in-place)                           c</span>
<a name="l00042"></a>00042   <span class="comment">! ivperm : permutes an integer vector (in-place)                       c</span>
<a name="l00043"></a>00043   <span class="comment">! retmx  : returns the max absolute value in each row of the matrix    c</span>
<a name="l00044"></a>00044   <span class="comment">! diapos : returns the positions of the diagonal elements in A.        c</span>
<a name="l00045"></a>00045   <span class="comment">! extbdg : extracts the main diagonal blocks of a matrix.              c</span>
<a name="l00046"></a>00046   <span class="comment">! getbwd : returns the bandwidth information on a matrix.              c</span>
<a name="l00047"></a>00047   <span class="comment">! blkfnd : finds the block-size of a matrix.                           c</span>
<a name="l00048"></a>00048   <span class="comment">! blkchk : checks whether a given integer is the block size of A.      c</span>
<a name="l00049"></a>00049   <span class="comment">! infdia : obtains information on the diagonals of A.                  c</span>
<a name="l00050"></a>00050   <span class="comment">! amubdg : gets number of nonzeros in each row of A*B (as well as NNZ) c</span>
<a name="l00051"></a>00051   <span class="comment">! aplbdg : gets number of nonzeros in each row of A+B (as well as NNZ) c</span>
<a name="l00052"></a>00052   <span class="comment">! rnrms  : computes the norms of the rows of A                         c</span>
<a name="l00053"></a>00053   <span class="comment">! cnrms  : computes the norms of the columns of A                      c</span>
<a name="l00054"></a>00054   <span class="comment">! roscal : scales the rows of a matrix by their norms.                 c</span>
<a name="l00055"></a>00055   <span class="comment">! coscal : scales the columns of a matrix by their norms.              c</span>
<a name="l00056"></a>00056   <span class="comment">! addblk : Adds a matrix B into a block of A.                          c</span>
<a name="l00057"></a>00057   <span class="comment">! get1up : Collects the first elements of each row of the upper        c</span>
<a name="l00058"></a>00058   <span class="comment">!          triangular portion of the matrix.                           c</span>
<a name="l00059"></a>00059   <span class="comment">! xtrows : extracts given rows from a matrix in CSR format.            c</span>
<a name="l00060"></a>00060   <span class="comment">! csrkvstr:  Finds block row partitioning of matrix in CSR format      c</span>
<a name="l00061"></a>00061   <span class="comment">! csrkvstc:  Finds block column partitioning of matrix in CSR format   c</span>
<a name="l00062"></a>00062   <span class="comment">! kvstmerge: Merges block partitionings, for conformal row/col pattern c</span>
<a name="l00063"></a>00063   <span class="comment">! qsortd : Quicksort:REAL    algrm. Sorts number array. Accending orderc</span>
<a name="l00064"></a>00064   <span class="comment">! qsorti : Quicksort:Integer algrm. Sorts number array. Accending orderc</span>
<a name="l00065"></a>00065   <span class="comment">!----------------------------------------------------------------------c</span>
<a name="l00066"></a>00066 
<a name="l00067"></a>00067   <span class="comment">!=============================================================================80</span>
<a name="l00068"></a>00068 
<a name="l00069"></a>00069   <span class="comment">!----------------------------------------------------------------------c</span>
<a name="l00070"></a>00070   <span class="comment">!                          S P A R S K I T                             c</span>
<a name="l00071"></a>00071   <span class="comment">!----------------------------------------------------------------------c</span>
<a name="l00072"></a>00072   <span class="comment">!        BASIC LINEAR ALGEBRA FOR SPARSE MATRICES. BLASSM MODULE       c</span>
<a name="l00073"></a>00073   <span class="comment">!----------------------------------------------------------------------c</span>
<a name="l00074"></a>00074   <span class="comment">! amub   :   computes     C = A*B                                      c</span>
<a name="l00075"></a>00075   <span class="comment">! aplb   :   computes     C = A+B                                      c</span>
<a name="l00076"></a>00076   <span class="comment">! aplb1  :   computes     C = A+B  [Sorted version: A, B, C sorted]    c</span>
<a name="l00077"></a>00077   <span class="comment">! aplsb  :   computes     C = A + s B                                  c</span>
<a name="l00078"></a>00078   <span class="comment">! aplsb1 :   computes     C = A+sB  [Sorted version: A, B, C sorted]   c</span>
<a name="l00079"></a>00079   <span class="comment">! apmbt  :   Computes     C = A +/- transp(B)                          c</span>
<a name="l00080"></a>00080   <span class="comment">! aplsbt :   Computes     C = A + s * transp(B)                        c</span>
<a name="l00081"></a>00081   <span class="comment">! diamua :   Computes     C = Diag * A                                 c</span>
<a name="l00082"></a>00082   <span class="comment">! amudia :   Computes     C = A* Diag                                  c</span>
<a name="l00083"></a>00083   <span class="comment">! aplsca :   Computes     A:= A + s I    (s = scalar)                  c</span>
<a name="l00084"></a>00084   <span class="comment">! apldia :   Computes     C = A + Diag.                                c</span>
<a name="l00085"></a>00085   <span class="comment">!----------------------------------------------------------------------c</span>
<a name="l00086"></a>00086   <span class="comment">!----------------------------------------------------------------------c</span>
<a name="l00087"></a>00087 
<a name="l00088"></a>00088   <span class="comment">!=============================================================================80</span>
<a name="l00089"></a>00089   <span class="comment">!                 S P A R S K I T _ B L O C K                          c</span>
<a name="l00090"></a>00090   <span class="comment">!----------------------------------------------------------------------c</span>
<a name="l00091"></a>00091   <span class="comment">!        BASIC LINEAR ALGEBRA FOR BLOCK SPARSE MATRICES.               c</span>
<a name="l00092"></a>00092   <span class="comment">!----------------------------------------------------------------------c</span>
<a name="l00093"></a>00093   <span class="comment">!                                                                      c</span>
<a name="l00094"></a>00094   <span class="comment">! amub   :   computes     C = A*B                                      c</span>
<a name="l00095"></a>00095   <span class="comment">! aplb1  :   computes     C = A+B  [Sorted version: A, B, C sorted]    c</span>
<a name="l00096"></a>00096   <span class="comment">! diamua :   Computes     C = Diag * A                                 c</span>
<a name="l00097"></a>00097   <span class="comment">! apldia :   Computes     C = A + Diag.                                c</span>
<a name="l00098"></a>00098   <span class="comment">! aplsca :   Computes     A:= A + s I    (s = scalar)                  c</span>
<a name="l00099"></a>00099   <span class="comment">! amub   :   computes     C = sc(A)*B                                  c</span>
<a name="l00100"></a>00100 
<a name="l00101"></a>00101 
<a name="l00102"></a><a class="code" href="namespaceunary__mod.html#acb1299c539dfe3a92811bf7e06599bfb">00102</a>   <span class="keyword">subroutine </span><a class="code" href="namespaceunary__mod.html#acb1299c539dfe3a92811bf7e06599bfb">submat</a> (n,job,i1,i2,j1,j2,a,ja,ia,nr,nc,ao,jao,iao) 
<a name="l00103"></a>00103   
<a name="l00104"></a>00104     <span class="keywordtype">integer</span> n,job,i1,i2,j1,j2,nr,nc,ia(*),ja(*),jao(*),iao(*) 
<a name="l00105"></a>00105     <span class="keywordtype">real(wp)</span> a(*),ao(*) 
<a name="l00106"></a>00106     <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l00107"></a>00107     <span class="comment">! This routine extracts the submatrix A(i1:i2,j1:j2) and puts the result in          </span>
<a name="l00108"></a>00108     <span class="comment">! matrix ao,iao,jao</span>
<a name="l00109"></a>00109     <span class="comment">!</span>
<a name="l00110"></a>00110     <span class="comment">! In place: ao,jao,iao may be the same as a,ja,ia.                  </span>
<a name="l00111"></a>00111     <span class="comment">!</span>
<a name="l00112"></a>00112     <span class="comment">!--------------                                                         </span>
<a name="l00113"></a>00113     <span class="comment">! On input                                                              </span>
<a name="l00114"></a>00114     <span class="comment">!---------                                                              </span>
<a name="l00115"></a>00115     <span class="comment">! n     = row dimension of the matrix                                </span>
<a name="l00116"></a>00116     <span class="comment">! i1,i2 = two integers with i2  &gt;=  i1 indicating the range of rows to b</span>
<a name="l00117"></a>00117     <span class="comment">!          extracted.                                                   </span>
<a name="l00118"></a>00118     <span class="comment">! j1,j2 = two integers with j2  &gt;=  j1 indicating the range of columns  </span>
<a name="l00119"></a>00119     <span class="comment">!         to be extracted.                                              </span>
<a name="l00120"></a>00120     <span class="comment">!         * There is no checking whether the input values for i1, i2, j1</span>
<a name="l00121"></a>00121     <span class="comment">!           j2 are between 1 and n.                                     </span>
<a name="l00122"></a>00122     <span class="comment">! a,                                                                    </span>
<a name="l00123"></a>00123     <span class="comment">! ja,                                                                   </span>
<a name="l00124"></a>00124     <span class="comment">! ia    = matrix in compressed sparse row format.                       </span>
<a name="l00125"></a>00125     <span class="comment">!                                                                       </span>
<a name="l00126"></a>00126     <span class="comment">! job   = job indicator: if job  /=  1 then the real values in a ar</span>
<a name="l00127"></a>00127     <span class="comment">!         extracted, only the column indices (i.e. data structure) are. </span>
<a name="l00128"></a>00128     <span class="comment">!         otherwise values as well as column indices are extracted...   </span>
<a name="l00129"></a>00129     <span class="comment">!                                                                       </span>
<a name="l00130"></a>00130     <span class="comment">! On output                                                             </span>
<a name="l00131"></a>00131     <span class="comment">!--------------                                                         </span>
<a name="l00132"></a>00132     <span class="comment">! nr      = number of rows of submatrix                               </span>
<a name="l00133"></a>00133     <span class="comment">! nc      = number of columns of submatrix                            </span>
<a name="l00134"></a>00134     <span class="comment">!          * if either of nr or nc is nonpositive the code will quit.   </span>
<a name="l00135"></a>00135     <span class="comment">!                                                                       </span>
<a name="l00136"></a>00136     <span class="comment">! ao,                                                                   </span>
<a name="l00137"></a>00137     <span class="comment">! jao,iao = extracted matrix in general sparse format with jao containin</span>
<a name="l00138"></a>00138     <span class="comment">!           the column indices,and iao being the pointer to the beginning  </span>
<a name="l00139"></a>00139     <span class="comment">!           of the row,in arrays a,ja.                                     </span>
<a name="l00140"></a>00140     <span class="comment">!----------------------------------------------------------------------c</span>
<a name="l00141"></a>00141     <span class="comment">!           Y. Saad, Sep. 21 1989                                      c</span>
<a name="l00142"></a>00142     <span class="comment">!----------------------------------------------------------------------c</span>
<a name="l00143"></a>00143     <span class="keywordtype">integer</span> i, ii, j, k, k1, k2, klen
<a name="l00144"></a>00144 
<a name="l00145"></a>00145     nr = i2-i1+1 
<a name="l00146"></a>00146     nc = j2-j1+1 
<a name="l00147"></a>00147                                                                        
<a name="l00148"></a>00148     <span class="keyword">if</span> ( nr  &lt;=  0 .or. nc  &lt;=  0) return 
<a name="l00149"></a>00149                                                                        
<a name="l00150"></a>00150     klen = 0 
<a name="l00151"></a>00151                                                                        
<a name="l00152"></a>00152     <span class="comment">! Simple procedure. proceeds row-wise...                            </span>
<a name="l00153"></a>00153                                                                        
<a name="l00154"></a>00154     <span class="keyword">do</span> 100 i = 1,nr 
<a name="l00155"></a>00155       ii = i1+i-1 
<a name="l00156"></a>00156       k1 = ia(ii) 
<a name="l00157"></a>00157       k2 = ia(ii+1)-1 
<a name="l00158"></a>00158       iao(i) = klen+1 
<a name="l00159"></a>00159 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l00160"></a>00160         <span class="keyword">do</span> 60 k=k1,k2 
<a name="l00161"></a>00161           j = ja(k) 
<a name="l00162"></a>00162           <span class="keyword">if</span> (j  &gt;=  j1 .and. j  &lt;=  j2) <span class="keyword">then</span> 
<a name="l00163"></a>00163             klen = klen+1 
<a name="l00164"></a>00164             <span class="keyword">if</span> (job  ==  1) ao(klen) = a(k) 
<a name="l00165"></a>00165               jao(klen) = j - j1+1 
<a name="l00166"></a>00166             <span class="keyword">endif</span> 
<a name="l00167"></a>00167         60 continue 
<a name="l00168"></a>00168     100 continue 
<a name="l00169"></a>00169     iao(nr+1) = klen+1 
<a name="l00170"></a>00170     return 
<a name="l00171"></a>00171     
<a name="l00172"></a>00172 <span class="keyword">  end subroutine submat </span>
<a name="l00173"></a>00173 
<a name="l00174"></a>00174 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l00175"></a>00175 
<a name="l00176"></a><a class="code" href="namespaceunary__mod.html#a66670e47ec2f802655499b5d4e46fbdd">00176</a>       <span class="keyword">subroutine </span><a class="code" href="namespaceunary__mod.html#a66670e47ec2f802655499b5d4e46fbdd">filter</a>(n,job,drptol,a,ja,ia,b,jb,ib,len,ierr) 
<a name="l00177"></a>00177       <span class="keywordtype">real(wp)</span> a(*),b(*),drptol 
<a name="l00178"></a>00178       <span class="keywordtype">integer</span> ja(*),jb(*),ia(*),ib(*),n,job,len,ierr 
<a name="l00179"></a>00179 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l00180"></a>00180 <span class="comment">!     This module removes any elements whose absolute value             </span>
<a name="l00181"></a>00181 <span class="comment">!     is small from an input matrix A and puts the resulting            </span>
<a name="l00182"></a>00182 <span class="comment">!     matrix in B.  The input parameter job selects a definition        </span>
<a name="l00183"></a>00183 <span class="comment">!     of small.                                                         </span>
<a name="l00184"></a>00184 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l00185"></a>00185 <span class="comment">! on entry:                                                             </span>
<a name="l00186"></a>00186 <span class="comment">!---------                                                              </span>
<a name="l00187"></a>00187 <span class="comment">!  n         = integer. row dimension of matrix                         </span>
<a name="l00188"></a>00188 <span class="comment">!  job   = integer. used to determine strategy chosen by caller to      </span>
<a name="l00189"></a>00189 <span class="comment">!         drop elements from matrix A.                                  </span>
<a name="l00190"></a>00190 <span class="comment">!          job = 1                                                      </span>
<a name="l00191"></a>00191 <span class="comment">!              Elements whose absolute value is less than the           </span>
<a name="l00192"></a>00192 <span class="comment">!              drop tolerance are removed.                              </span>
<a name="l00193"></a>00193 <span class="comment">!          job = 2                                                      </span>
<a name="l00194"></a>00194 <span class="comment">!              Elements whose absolute value is less than the           </span>
<a name="l00195"></a>00195 <span class="comment">!              product of the drop tolerance and the Euclidean          </span>
<a name="l00196"></a>00196 <span class="comment">!              norm of the row are removed.                             </span>
<a name="l00197"></a>00197 <span class="comment">!          job = 3                                                      </span>
<a name="l00198"></a>00198 <span class="comment">!              Elements whose absolute value is less that the           </span>
<a name="l00199"></a>00199 <span class="comment">!              product of the drop tolerance and the largest            </span>
<a name="l00200"></a>00200 <span class="comment">!              element in the row are removed.                          </span>
<a name="l00201"></a>00201 <span class="comment">!                                                                       </span>
<a name="l00202"></a>00202 <span class="comment">! drptol = real. drop tolerance used for dropping strategy.             </span>
<a name="l00203"></a>00203 <span class="comment">! a                                                                     </span>
<a name="l00204"></a>00204 <span class="comment">! ja                                                                    </span>
<a name="l00205"></a>00205 <span class="comment">! ia     = input matrix in compressed sparse format                     </span>
<a name="l00206"></a>00206 <span class="comment">! len         = integer. the amount of space available in arrays b and j</span>
<a name="l00207"></a>00207 <span class="comment">!                                                                       </span>
<a name="l00208"></a>00208 <span class="comment">! on return:                                                            </span>
<a name="l00209"></a>00209 <span class="comment">!----------                                                             </span>
<a name="l00210"></a>00210 <span class="comment">! b                                                                     </span>
<a name="l00211"></a>00211 <span class="comment">! jb                                                                    </span>
<a name="l00212"></a>00212 <span class="comment">! ib    = resulting matrix in compressed sparse format.                 </span>
<a name="l00213"></a>00213 <span class="comment">!                                                                       </span>
<a name="l00214"></a>00214 <span class="comment">! ierr        = integer. containing error message.                      </span>
<a name="l00215"></a>00215 <span class="comment">!         ierr  ==  0 indicates normal return                           </span>
<a name="l00216"></a>00216 <span class="comment">!         ierr  &gt;  0 indicates that there is&apos;nt enough                 </span>
<a name="l00217"></a>00217 <span class="comment">!         space is a and ja to store the resulting matrix.              </span>
<a name="l00218"></a>00218 <span class="comment">!         ierr then contains the row number where filter stopped.       </span>
<a name="l00219"></a>00219 <span class="comment">! note:                                                                 </span>
<a name="l00220"></a>00220 <span class="comment">!------ This module is in place. (b,jb,ib can ne the same as            </span>
<a name="l00221"></a>00221 <span class="comment">!       a, ja, ia in which case the result will be overwritten).        </span>
<a name="l00222"></a>00222 <span class="comment">!----------------------------------------------------------------------c</span>
<a name="l00223"></a>00223 <span class="comment">!           contributed by David Day,  Sep 19, 1989.                   c</span>
<a name="l00224"></a>00224 <span class="comment">!----------------------------------------------------------------------c</span>
<a name="l00225"></a>00225 <span class="comment">! local variables                                                       </span>
<a name="l00226"></a>00226       <span class="keywordtype">real(wp)</span> norm,loctol 
<a name="l00227"></a>00227       <span class="keywordtype">integer</span> index,row,k,k1,k2 
<a name="l00228"></a>00228 <span class="comment">!                                                                       </span>
<a name="l00229"></a>00229       index = 1 
<a name="l00230"></a>00230       <span class="keyword">do</span> 10 row= 1,n 
<a name="l00231"></a>00231          k1 = ia(row) 
<a name="l00232"></a>00232          k2 = ia(row+1) - 1 
<a name="l00233"></a>00233          ib(row) = index 
<a name="l00234"></a>00234          goto (100,200,300) job 
<a name="l00235"></a>00235   100    norm = 1.0d0 
<a name="l00236"></a>00236          goto 400 
<a name="l00237"></a>00237   200    norm = 0.0d0 
<a name="l00238"></a>00238          <span class="keyword">do</span> 22 k = k1,k2 
<a name="l00239"></a>00239             norm = norm + a(k) * a(k) 
<a name="l00240"></a>00240    22    continue 
<a name="l00241"></a>00241          norm = sqrt(norm) 
<a name="l00242"></a>00242          goto 400 
<a name="l00243"></a>00243   300    norm = 0.0d0 
<a name="l00244"></a>00244          <span class="keyword">do</span> 23 k = k1,k2 
<a name="l00245"></a>00245             <span class="keyword">if</span>( abs(a(k))   &gt;  norm) <span class="keyword">then</span> 
<a name="l00246"></a>00246                norm = abs(a(k)) 
<a name="l00247"></a>00247             <span class="keyword">endif</span> 
<a name="l00248"></a>00248    23    continue 
<a name="l00249"></a>00249   400    loctol = drptol * norm 
<a name="l00250"></a>00250          <span class="keyword">do</span> 30 k = k1,k2 
<a name="l00251"></a>00251             <span class="keyword">if</span>( abs(a(k))  &gt;  loctol)<span class="keyword">then</span> 
<a name="l00252"></a>00252                <span class="keyword">if</span> (index  &gt;  len) <span class="keyword">then</span> 
<a name="l00253"></a>00253                ierr = row 
<a name="l00254"></a>00254                return 
<a name="l00255"></a>00255             <span class="keyword">endif</span> 
<a name="l00256"></a>00256             b(index) =  a(k) 
<a name="l00257"></a>00257             jb(index) = ja(k) 
<a name="l00258"></a>00258             index = index + 1 
<a name="l00259"></a>00259          <span class="keyword">endif</span> 
<a name="l00260"></a>00260    30 continue 
<a name="l00261"></a>00261    10 continue 
<a name="l00262"></a>00262       ib(n+1) = index 
<a name="l00263"></a>00263       return 
<a name="l00264"></a>00264 <span class="keyword">      end subroutine  filter</span>
<a name="l00265"></a>00265 
<a name="l00266"></a>00266 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l00267"></a>00267 
<a name="l00268"></a><a class="code" href="namespaceunary__mod.html#a0f1471bf10c764571c61d35e00b0a37e">00268</a>       <span class="keyword">subroutine </span><a class="code" href="namespaceunary__mod.html#a0f1471bf10c764571c61d35e00b0a37e">filterm</a> (n,job,drop,a,ja,b,jb,len,ierr) 
<a name="l00269"></a>00269       <span class="keywordtype">real(wp)</span> a(*),b(*),drop 
<a name="l00270"></a>00270       <span class="keywordtype">integer</span> ja(*),jb(*),n,job,len,ierr 
<a name="l00271"></a>00271 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l00272"></a>00272 <span class="comment">!     This subroutine removes any elements whose absolute value         </span>
<a name="l00273"></a>00273 <span class="comment">!     is small from an input matrix A. Same as filter but               </span>
<a name="l00274"></a>00274 <span class="comment">!     uses the MSR format.                                              </span>
<a name="l00275"></a>00275 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l00276"></a>00276 <span class="comment">! on entry:                                                             </span>
<a name="l00277"></a>00277 <span class="comment">!---------                                                              </span>
<a name="l00278"></a>00278 <span class="comment">!  n         = integer. row dimension of matrix                         </span>
<a name="l00279"></a>00279 <span class="comment">!  job   = integer. used to determine strategy chosen by caller to      </span>
<a name="l00280"></a>00280 <span class="comment">!         drop elements from matrix A.                                  </span>
<a name="l00281"></a>00281 <span class="comment">!          job = 1                                                      </span>
<a name="l00282"></a>00282 <span class="comment">!              Elements whose absolute value is less than the           </span>
<a name="l00283"></a>00283 <span class="comment">!              drop tolerance are removed.                              </span>
<a name="l00284"></a>00284 <span class="comment">!          job = 2                                                      </span>
<a name="l00285"></a>00285 <span class="comment">!              Elements whose absolute value is less than the           </span>
<a name="l00286"></a>00286 <span class="comment">!              product of the drop tolerance and the Euclidean          </span>
<a name="l00287"></a>00287 <span class="comment">!              norm of the row are removed.                             </span>
<a name="l00288"></a>00288 <span class="comment">!          job = 3                                                      </span>
<a name="l00289"></a>00289 <span class="comment">!              Elements whose absolute value is less that the           </span>
<a name="l00290"></a>00290 <span class="comment">!              product of the drop tolerance and the largest            </span>
<a name="l00291"></a>00291 <span class="comment">!              element in the row are removed.                          </span>
<a name="l00292"></a>00292 <span class="comment">!                                                                       </span>
<a name="l00293"></a>00293 <span class="comment">! drop = real. drop tolerance used for dropping strategy.               </span>
<a name="l00294"></a>00294 <span class="comment">! a                                                                     </span>
<a name="l00295"></a>00295 <span class="comment">! ja     = input matrix in Modifief Sparse Row format                   </span>
<a name="l00296"></a>00296 <span class="comment">! len         = integer. the amount of space in arrays b and jb.        </span>
<a name="l00297"></a>00297 <span class="comment">!                                                                       </span>
<a name="l00298"></a>00298 <span class="comment">! on return:                                                            </span>
<a name="l00299"></a>00299 <span class="comment">!----------                                                             </span>
<a name="l00300"></a>00300 <span class="comment">!                                                                       </span>
<a name="l00301"></a>00301 <span class="comment">! b, jb = resulting matrix in Modifief Sparse Row format                </span>
<a name="l00302"></a>00302 <span class="comment">!                                                                       </span>
<a name="l00303"></a>00303 <span class="comment">! ierr        = integer. containing error message.                      </span>
<a name="l00304"></a>00304 <span class="comment">!         ierr  ==  0 indicates normal return                           </span>
<a name="l00305"></a>00305 <span class="comment">!         ierr  &gt;  0 indicates that there is&apos;nt enough                 </span>
<a name="l00306"></a>00306 <span class="comment">!         space is a and ja to store the resulting matrix.              </span>
<a name="l00307"></a>00307 <span class="comment">!         ierr then contains the row number where filter stopped.       </span>
<a name="l00308"></a>00308 <span class="comment">! note:                                                                 </span>
<a name="l00309"></a>00309 <span class="comment">!------ This module is in place. (b,jb can ne the same as               </span>
<a name="l00310"></a>00310 <span class="comment">!       a, ja in which case the result will be overwritten).            </span>
<a name="l00311"></a>00311 <span class="comment">!----------------------------------------------------------------------c</span>
<a name="l00312"></a>00312 <span class="comment">!           contributed by David Day,  Sep 19, 1989.                   c</span>
<a name="l00313"></a>00313 <span class="comment">!----------------------------------------------------------------------c</span>
<a name="l00314"></a>00314 <span class="comment">! local variables                                                       </span>
<a name="l00315"></a>00315 <span class="comment">!                                                                       </span>
<a name="l00316"></a>00316       <span class="keywordtype">real(wp)</span> norm,loctol 
<a name="l00317"></a>00317       <span class="keywordtype">integer</span> index,row,k,k1,k2 
<a name="l00318"></a>00318 <span class="comment">!                                                                       </span>
<a name="l00319"></a>00319       index = n+2 
<a name="l00320"></a>00320       <span class="keyword">do</span> 10 row= 1,n 
<a name="l00321"></a>00321          k1 = ja(row) 
<a name="l00322"></a>00322          k2 = ja(row+1) - 1 
<a name="l00323"></a>00323          jb(row) = index 
<a name="l00324"></a>00324          goto (100,200,300) job 
<a name="l00325"></a>00325   100    norm = 1.0d0 
<a name="l00326"></a>00326          goto 400 
<a name="l00327"></a>00327   200    norm = a(row)**2 
<a name="l00328"></a>00328          <span class="keyword">do</span> 22 k = k1,k2 
<a name="l00329"></a>00329             norm = norm + a(k) * a(k) 
<a name="l00330"></a>00330    22    continue 
<a name="l00331"></a>00331          norm = sqrt(norm) 
<a name="l00332"></a>00332          goto 400 
<a name="l00333"></a>00333   300    norm = abs(a(row)) 
<a name="l00334"></a>00334          <span class="keyword">do</span> 23 k = k1,k2 
<a name="l00335"></a>00335             norm = max(abs(a(k)),norm) 
<a name="l00336"></a>00336    23    continue 
<a name="l00337"></a>00337   400    loctol = drop * norm 
<a name="l00338"></a>00338          <span class="keyword">do</span> 30 k = k1,k2 
<a name="l00339"></a>00339             <span class="keyword">if</span>( abs(a(k))  &gt;  loctol)<span class="keyword">then</span> 
<a name="l00340"></a>00340                <span class="keyword">if</span> (index  &gt;  len) <span class="keyword">then</span> 
<a name="l00341"></a>00341                   ierr = row 
<a name="l00342"></a>00342                   return 
<a name="l00343"></a>00343                <span class="keyword">endif</span> 
<a name="l00344"></a>00344                b(index) =  a(k) 
<a name="l00345"></a>00345                jb(index) = ja(k) 
<a name="l00346"></a>00346                index = index + 1 
<a name="l00347"></a>00347             <span class="keyword">endif</span> 
<a name="l00348"></a>00348    30    continue 
<a name="l00349"></a>00349    10 continue 
<a name="l00350"></a>00350       jb(n+1) = index 
<a name="l00351"></a>00351       return 
<a name="l00352"></a>00352 <span class="keyword">      end subroutine  filterm</span>
<a name="l00353"></a>00353 
<a name="l00354"></a>00354 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l00355"></a><a class="code" href="namespaceunary__mod.html#ad981e96208abed6b51f14cda0410b0f5">00355</a>   <span class="keyword">subroutine </span><a class="code" href="namespaceunary__mod.html#ad981e96208abed6b51f14cda0410b0f5">csort</a> ( n, a, ja, ia, iwork, values )
<a name="l00356"></a>00356 
<a name="l00357"></a>00357   <span class="comment">!*****************************************************************************80</span>
<a name="l00358"></a>00358   <span class="comment">!</span>
<a name="l00359"></a>00359   <span class="comment">!! CSORT sorts the elements of a CSR matrix.</span>
<a name="l00360"></a>00360   <span class="comment">!</span>
<a name="l00361"></a>00361   <span class="comment">!  Discussion:</span>
<a name="l00362"></a>00362   <span class="comment">!</span>
<a name="l00363"></a>00363   <span class="comment">!    This routine sorts the elements of a CSR matrix (stored in Compressed</span>
<a name="l00364"></a>00364   <span class="comment">!    Sparse Row Format) in increasing order of their column indices within</span>
<a name="l00365"></a>00365   <span class="comment">!    each row. It uses a form of bucket sort with a cost of O(nnz) where</span>
<a name="l00366"></a>00366   <span class="comment">!    nnz = number of nonzero elements.</span>
<a name="l00367"></a>00367   <span class="comment">!</span>
<a name="l00368"></a>00368   <span class="comment">!    Requires an integer ( kind = 4 ) work array of size length 2*nnz.</span>
<a name="l00369"></a>00369   <span class="comment">!</span>
<a name="l00370"></a>00370   <span class="comment">!  Modified:</span>
<a name="l00371"></a>00371   <span class="comment">!</span>
<a name="l00372"></a>00372   <span class="comment">!    07 January 2004</span>
<a name="l00373"></a>00373   <span class="comment">!</span>
<a name="l00374"></a>00374   <span class="comment">!  Author:</span>
<a name="l00375"></a>00375   <span class="comment">!</span>
<a name="l00376"></a>00376   <span class="comment">!    Youcef Saad</span>
<a name="l00377"></a>00377   <span class="comment">!</span>
<a name="l00378"></a>00378   <span class="comment">!  Parameters:</span>
<a name="l00379"></a>00379   <span class="comment">!</span>
<a name="l00380"></a>00380   <span class="comment">!    Input, integer ( kind = 4 ) N, the row dimension of the matrix.</span>
<a name="l00381"></a>00381   <span class="comment">!</span>
<a name="l00382"></a>00382   <span class="comment">!    Input, real A(*), integer ( kind = 4 ) JA(*), IA(N+1), the matrix in CSR</span>
<a name="l00383"></a>00383   <span class="comment">!    Compressed Sparse Row format.</span>
<a name="l00384"></a>00384   <span class="comment">!</span>
<a name="l00385"></a>00385   <span class="comment">! iwork = integer ( kind = 4 ) work array of length max ( n+1, 2*nnz )</span>
<a name="l00386"></a>00386   <span class="comment">!         where nnz = 2* (ia(n+1)-ia(1))  ) .</span>
<a name="l00387"></a>00387   <span class="comment">!</span>
<a name="l00388"></a>00388   <span class="comment">! values= logical indicating whether or not the real values a(*) must</span>
<a name="l00389"></a>00389   <span class="comment">!         also be permuted. if (.not. values) then the array a is not</span>
<a name="l00390"></a>00390   <span class="comment">!         touched by csort and can be a dummy array.</span>
<a name="l00391"></a>00391   <span class="comment">!</span>
<a name="l00392"></a>00392   <span class="comment">! on return:</span>
<a name="l00393"></a>00393   <span class="comment">!</span>
<a name="l00394"></a>00394   <span class="comment">! the matrix stored in the structure a, ja, ia is permuted in such a</span>
<a name="l00395"></a>00395   <span class="comment">! way that the column indices are in increasing order within each row.</span>
<a name="l00396"></a>00396   <span class="comment">! iwork(1:nnz) contains the permutation used  to rearrange the elements.</span>
<a name="l00397"></a>00397   <span class="comment">!</span>
<a name="l00398"></a>00398     <span class="keyword">implicit none</span>
<a name="l00399"></a>00399 
<a name="l00400"></a>00400     <span class="keywordtype">integer</span> ::  n
<a name="l00401"></a>00401 
<a name="l00402"></a>00402     <span class="keywordtype">real(wp) </span>:: a(*)
<a name="l00403"></a>00403     <span class="keywordtype">integer</span> :: i
<a name="l00404"></a>00404     <span class="keywordtype">integer</span> :: ia(n+1)
<a name="l00405"></a>00405     <span class="keywordtype">integer</span> :: ifirst
<a name="l00406"></a>00406     <span class="keywordtype">integer</span> :: irow
<a name="l00407"></a>00407     <span class="keywordtype">integer</span> :: iwork(*)
<a name="l00408"></a>00408     <span class="keywordtype">integer</span> :: j
<a name="l00409"></a>00409     <span class="keywordtype">integer</span> :: ja(*)
<a name="l00410"></a>00410     <span class="keywordtype">integer</span> :: k
<a name="l00411"></a>00411     <span class="keywordtype">integer</span> :: ko
<a name="l00412"></a>00412     <span class="keywordtype">integer</span> :: next
<a name="l00413"></a>00413     <span class="keywordtype">integer</span> :: nnz
<a name="l00414"></a>00414     <span class="keywordtype">logical</span> :: values
<a name="l00415"></a>00415   <span class="comment">!</span>
<a name="l00416"></a>00416   <span class="comment">!  Count the number of elements in each column.</span>
<a name="l00417"></a>00417   <span class="comment">!</span>
<a name="l00418"></a>00418     iwork(1:n+1) = 0
<a name="l00419"></a>00419 
<a name="l00420"></a>00420     <span class="keyword">do</span> i = 1, n
<a name="l00421"></a>00421        <span class="keyword">do</span> k = ia(i), ia(i+1)-1
<a name="l00422"></a>00422           j = ja(k) + 1
<a name="l00423"></a>00423           iwork(j) = iwork(j) + 1
<a name="l00424"></a>00424        <span class="keyword">end do</span>
<a name="l00425"></a>00425     <span class="keyword">end do</span>
<a name="l00426"></a>00426   <span class="comment">!</span>
<a name="l00427"></a>00427   <span class="comment">!  Compute pointers from lengths.</span>
<a name="l00428"></a>00428   <span class="comment">!</span>
<a name="l00429"></a>00429     iwork(1) = 1
<a name="l00430"></a>00430 
<a name="l00431"></a>00431     <span class="keyword">do</span> i = 1, n
<a name="l00432"></a>00432        iwork(i+1) = iwork(i) + iwork(i+1)
<a name="l00433"></a>00433     <span class="keyword">end do</span>
<a name="l00434"></a>00434   <span class="comment">!</span>
<a name="l00435"></a>00435   <span class="comment">!  Get the positions of the nonzero elements in order of columns.</span>
<a name="l00436"></a>00436   <span class="comment">!</span>
<a name="l00437"></a>00437     ifirst = ia(1)
<a name="l00438"></a>00438     nnz = ia(n+1)-ifirst
<a name="l00439"></a>00439 
<a name="l00440"></a>00440     <span class="keyword">do</span> i = 1, n
<a name="l00441"></a>00441       <span class="keyword">do</span> k = ia(i), ia(i+1)-1
<a name="l00442"></a>00442         j = ja(k)
<a name="l00443"></a>00443         next = iwork(j)
<a name="l00444"></a>00444         iwork(nnz+next) = k
<a name="l00445"></a>00445         iwork(j) = next + 1
<a name="l00446"></a>00446       <span class="keyword">end do</span>
<a name="l00447"></a>00447     <span class="keyword">end do</span>
<a name="l00448"></a>00448   <span class="comment">!</span>
<a name="l00449"></a>00449   <span class="comment">!  Convert to coordinate format.</span>
<a name="l00450"></a>00450   <span class="comment">!</span>
<a name="l00451"></a>00451     <span class="keyword">do</span> i = 1, n
<a name="l00452"></a>00452       <span class="keyword">do</span> k = ia(i), ia(i+1)-1
<a name="l00453"></a>00453         iwork(k) = i
<a name="l00454"></a>00454       <span class="keyword">end do</span>
<a name="l00455"></a>00455     <span class="keyword">end do</span>
<a name="l00456"></a>00456   <span class="comment">!</span>
<a name="l00457"></a>00457   <span class="comment">!  Loop to find permutation: for each element find the correct</span>
<a name="l00458"></a>00458   <span class="comment">!  position in (sorted) arrays A, JA.  Record this in IWORK.</span>
<a name="l00459"></a>00459   <span class="comment">!</span>
<a name="l00460"></a>00460     <span class="keyword">do</span> k = 1, nnz
<a name="l00461"></a>00461        ko = iwork(nnz+k)
<a name="l00462"></a>00462        irow = iwork(ko)
<a name="l00463"></a>00463        next = ia(irow)
<a name="l00464"></a>00464   <span class="comment">!</span>
<a name="l00465"></a>00465   <span class="comment">!  The current element should go in next position in row. IWORK</span>
<a name="l00466"></a>00466   <span class="comment">!  records this position.</span>
<a name="l00467"></a>00467   <span class="comment">!</span>
<a name="l00468"></a>00468        iwork(ko) = next
<a name="l00469"></a>00469        ia(irow) = next + 1
<a name="l00470"></a>00470     <span class="keyword">end do</span>
<a name="l00471"></a>00471   <span class="comment">!</span>
<a name="l00472"></a>00472   <span class="comment">!  Perform an in-place permutation of the arrays.</span>
<a name="l00473"></a>00473   <span class="comment">!</span>
<a name="l00474"></a>00474        call <a class="code" href="namespaceunary__mod.html#a221b5873142df92fafad6f87e778f736">ivperm </a>( nnz, ja(ifirst), iwork )
<a name="l00475"></a>00475 
<a name="l00476"></a>00476        <span class="keyword">if</span> ( values ) <span class="keyword">then</span>
<a name="l00477"></a>00477          call <a class="code" href="namespaceunary__mod.html#ae9e2b83517a1746a33ad0a5744ce5ab9">dvperm </a>( nnz, a(ifirst), iwork )
<a name="l00478"></a>00478        <span class="keyword">end if</span>
<a name="l00479"></a>00479   <span class="comment">!</span>
<a name="l00480"></a>00480   <span class="comment">!  Reshift the pointers of the original matrix back.</span>
<a name="l00481"></a>00481   <span class="comment">!</span>
<a name="l00482"></a>00482     <span class="keyword">do</span> i = n, 1, -1
<a name="l00483"></a>00483       ia(i+1) = ia(i)
<a name="l00484"></a>00484     <span class="keyword">end do</span>
<a name="l00485"></a>00485 
<a name="l00486"></a>00486     ia(1) = ifirst
<a name="l00487"></a>00487 
<a name="l00488"></a>00488     return
<a name="l00489"></a>00489 <span class="keyword">  end subroutine csort</span>
<a name="l00490"></a>00490 
<a name="l00491"></a>00491 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l00492"></a>00492 
<a name="l00493"></a><a class="code" href="namespaceunary__mod.html#a84c57981ee762e2390488373d9c22f12">00493</a>       <span class="keyword">subroutine </span><a class="code" href="namespaceunary__mod.html#a84c57981ee762e2390488373d9c22f12">clean_CSR</a>(nrow, ja,ia) 
<a name="l00494"></a>00494 
<a name="l00495"></a>00495       <span class="keyword">implicit none</span>
<a name="l00496"></a>00496 
<a name="l00497"></a>00497 <span class="comment">!     .. Scalar Arguments ..                                            </span>
<a name="l00498"></a>00498       <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>   :: nrow
<a name="l00499"></a>00499 <span class="comment">!     ..                                                                </span>
<a name="l00500"></a>00500 <span class="comment">!     .. Array Arguments ..                                             </span>
<a name="l00501"></a>00501       <span class="keywordtype">integer</span>,  <span class="keywordtype">dimension(nrow+1)</span>, <span class="keywordtype">intent(inout)</span> :: ia
<a name="l00502"></a>00502       <span class="keywordtype">integer</span>,  <span class="keywordtype">dimension(:)     </span>, <span class="keywordtype">intent(inout)</span> :: ja
<a name="l00503"></a>00503 
<a name="l00504"></a>00504 <span class="comment">!                                                                       </span>
<a name="l00505"></a>00505 <span class="comment">!     This routine performs two tasks to clean up a CSR matrix          </span>
<a name="l00506"></a>00506 <span class="comment">!     -- remove duplicate entries</span>
<a name="l00507"></a>00507 <span class="comment">!     -- sorts the entries in column increasing order </span>
<a name="l00508"></a>00508 <span class="comment">!                                                                       </span>
<a name="l00509"></a>00509 <span class="comment">!     nrow    -- row dimension of the matrix                            </span>
<a name="l00510"></a>00510 <span class="comment">!     ncol    -- col dimension of the matrix                            </span>
<a name="l00511"></a>00511 <span class="comment">!     ja,ia   -- input matrix in CSR format                             </span>
<a name="l00512"></a>00512 <span class="comment">!                                                                       </span>
<a name="l00513"></a>00513 <span class="comment">!     On return:                                                        </span>
<a name="l00514"></a>00514 
<a name="l00515"></a>00515 <span class="comment">!     ja,ia   -- compressed and order matrix in CSR format                             </span>
<a name="l00516"></a>00516 
<a name="l00517"></a>00517 <span class="comment">!     local work arrays</span>
<a name="l00518"></a>00518 
<a name="l00519"></a>00519       <span class="keywordtype">integer</span>                              :: k1
<a name="l00520"></a>00520       <span class="keywordtype">integer</span>                              :: i,j,k,row_nnz, tot_nnz, del, del_old
<a name="l00521"></a>00521 
<a name="l00522"></a>00522       continue
<a name="l00523"></a>00523 
<a name="l00524"></a>00524       <span class="comment">!if (nrow .le. 0) then</span>
<a name="l00525"></a>00525       <span class="comment">!  write(*,*) &apos;Here, nrow&apos;, nrow</span>
<a name="l00526"></a>00526       <span class="comment">!  stop</span>
<a name="l00527"></a>00527       <span class="comment">!endif</span>
<a name="l00528"></a>00528 
<a name="l00529"></a>00529       row_nnz = 0 ; tot_nnz = 0  
<a name="l00530"></a>00530       del     = 0 ; del_old = 0
<a name="l00531"></a>00531 
<a name="l00532"></a>00532       <span class="keyword">do</span> i = 1,nrow
<a name="l00533"></a>00533 
<a name="l00534"></a>00534         row_nnz = ia(i+1)-ia(i)
<a name="l00535"></a>00535 
<a name="l00536"></a>00536         <span class="comment">!  Bubble sort the entries</span>
<a name="l00537"></a>00537 
<a name="l00538"></a>00538         <span class="keyword">select</span> <span class="keyword">case</span> (row_nnz)
<a name="l00539"></a>00539 
<a name="l00540"></a>00540           <span class="keyword">case</span> (0)
<a name="l00541"></a>00541             del = row_nnz
<a name="l00542"></a>00542 
<a name="l00543"></a>00543           <span class="keyword">case</span> (1)
<a name="l00544"></a>00544 
<a name="l00545"></a>00545             del = row_nnz
<a name="l00546"></a>00546 
<a name="l00547"></a>00547             tot_nnz = tot_nnz + 1
<a name="l00548"></a>00548             ja(tot_nnz) = ja(ia(i))
<a name="l00549"></a>00549 
<a name="l00550"></a>00550           <span class="keyword">case</span> default
<a name="l00551"></a>00551 
<a name="l00552"></a>00552             <span class="keyword">do</span> k1 = ia(i), ia(i+1)-1
<a name="l00553"></a>00553               <span class="keyword">do</span> j = ia(i), ia(i+1)-2
<a name="l00554"></a>00554                 <span class="keyword">if</span>(ja(j+1) &lt; ja(j)) <span class="keyword">then</span>
<a name="l00555"></a>00555                   k       = ja(j+1)
<a name="l00556"></a>00556                   ja(j+1) = ja(j)
<a name="l00557"></a>00557                   ja(j)   = k 
<a name="l00558"></a>00558                 <span class="keyword">endif</span>
<a name="l00559"></a>00559               <span class="keyword">enddo</span>
<a name="l00560"></a>00560             <span class="keyword">enddo</span>
<a name="l00561"></a>00561 
<a name="l00562"></a>00562             del = 1
<a name="l00563"></a>00563 
<a name="l00564"></a>00564             tot_nnz = tot_nnz + 1
<a name="l00565"></a>00565             ja(tot_nnz) = ja(ia(i))
<a name="l00566"></a>00566 
<a name="l00567"></a>00567             <span class="keyword">do</span> j = ia(i)+1, ia(i+1)-1
<a name="l00568"></a>00568               <span class="keyword">if</span>(ja(j) /= ja(j-1)) <span class="keyword">then</span>
<a name="l00569"></a>00569                 tot_nnz = tot_nnz + 1
<a name="l00570"></a>00570                 del   = del   + 1
<a name="l00571"></a>00571                 ja(tot_nnz) = ja(j) 
<a name="l00572"></a>00572               <span class="keyword">endif</span>
<a name="l00573"></a>00573             <span class="keyword">enddo</span>
<a name="l00574"></a>00574 
<a name="l00575"></a>00575         <span class="keyword">end select</span>
<a name="l00576"></a>00576 
<a name="l00577"></a>00577         <span class="keyword">if</span>(i /= 1) <span class="keyword">then</span> 
<a name="l00578"></a>00578           ia(i) = ia(i-1) + del_old
<a name="l00579"></a>00579           del_old = del
<a name="l00580"></a>00580         <span class="keyword">else</span>
<a name="l00581"></a>00581           del_old = del
<a name="l00582"></a>00582         <span class="keyword">endif</span>
<a name="l00583"></a>00583 
<a name="l00584"></a>00584       <span class="keyword">enddo</span>
<a name="l00585"></a>00585 
<a name="l00586"></a>00586       ia(nrow+1) = ia(nrow) + del_old
<a name="l00587"></a>00587 
<a name="l00588"></a>00588 <span class="keyword">      end subroutine clean_CSR</span>
<a name="l00589"></a>00589 
<a name="l00590"></a>00590 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l00591"></a>00591 
<a name="l00592"></a><a class="code" href="namespaceunary__mod.html#a410d2156084d51de8142c0adeeb8b86f">00592</a>       <span class="keyword">subroutine </span><a class="code" href="namespaceunary__mod.html#a410d2156084d51de8142c0adeeb8b86f">clncsr</a>(job,value2,nrow,a,ja,ia,indu,iwk) 
<a name="l00593"></a>00593 <span class="comment">!     .. Scalar Arguments ..                                            </span>
<a name="l00594"></a>00594       <span class="keywordtype">integer</span> job, nrow, value2 
<a name="l00595"></a>00595 <span class="comment">!     ..                                                                </span>
<a name="l00596"></a>00596 <span class="comment">!     .. Array Arguments ..                                             </span>
<a name="l00597"></a>00597       <span class="keywordtype">integer</span> ia(nrow+1),indu(nrow),iwk(nrow+1),ja(*) 
<a name="l00598"></a>00598       <span class="keywordtype">real(wp) </span> a(*) 
<a name="l00599"></a>00599 <span class="comment">!     ..                                                                </span>
<a name="l00600"></a>00600 <span class="comment">!                                                                       </span>
<a name="l00601"></a>00601 <span class="comment">!     This routine performs two tasks to clean up a CSR matrix          </span>
<a name="l00602"></a>00602 <span class="comment">!     -- remove duplicate/zero entries,                                 </span>
<a name="l00603"></a>00603 <span class="comment">!     -- perform a partial ordering, new order lower triangular part,   </span>
<a name="l00604"></a>00604 <span class="comment">!        main diagonal, upper triangular part.                          </span>
<a name="l00605"></a>00605 <span class="comment">!                                                                       </span>
<a name="l00606"></a>00606 <span class="comment">!     On entry:                                                         </span>
<a name="l00607"></a>00607 <span class="comment">!                                                                       </span>
<a name="l00608"></a>00608 <span class="comment">!     job   = options                                                   </span>
<a name="l00609"></a>00609 <span class="comment">!         0 -- nothing is done                                          </span>
<a name="l00610"></a>00610 <span class="comment">!         1 -- eliminate duplicate entries, zero entries.               </span>
<a name="l00611"></a>00611 <span class="comment">!         2 -- eliminate duplicate entries and perform partial ordering.</span>
<a name="l00612"></a>00612 <span class="comment">!         3 -- eliminate duplicate entries, sort the entries in the     </span>
<a name="l00613"></a>00613 <span class="comment">!              increasing order of column indices.                       </span>
<a name="l00614"></a>00614 <span class="comment">!                                                                       </span>
<a name="l00615"></a>00615 <span class="comment">!     value2  -- 0 the matrix is pattern only (a is not touched)        </span>
<a name="l00616"></a>00616 <span class="comment">!                1 matrix has values too.                               </span>
<a name="l00617"></a>00617 <span class="comment">!     nrow    -- row dimension of the matrix                            </span>
<a name="l00618"></a>00618 <span class="comment">!     a,ja,ia -- input matrix in CSR format                             </span>
<a name="l00619"></a>00619 <span class="comment">!                                                                       </span>
<a name="l00620"></a>00620 <span class="comment">!     On return:                                                        </span>
<a name="l00621"></a>00621 <span class="comment">!     a,ja,ia -- cleaned matrix                                         </span>
<a name="l00622"></a>00622 <span class="comment">!     indu    -- pointers to the beginning of the upper triangular      </span>
<a name="l00623"></a>00623 <span class="comment">!                portion if job &gt; 1                                     </span>
<a name="l00624"></a>00624 <span class="comment">!                                                                       </span>
<a name="l00625"></a>00625 <span class="comment">!     Work space:                                                       </span>
<a name="l00626"></a>00626 <span class="comment">!     iwk     -- integer work space of size nrow+1                      </span>
<a name="l00627"></a>00627 <span class="comment">!                                                                       </span>
<a name="l00628"></a>00628 <span class="comment">!     .. Local Scalars ..                                               </span>
<a name="l00629"></a>00629       <span class="keywordtype">integer</span> i,j,k,ko,ipos,kfirst,klast 
<a name="l00630"></a>00630       <span class="keywordtype">real(wp) </span> tmp 
<a name="l00631"></a>00631 <span class="comment">!     ..                                                                </span>
<a name="l00632"></a>00632 <span class="comment">!                                                                       </span>
<a name="l00633"></a>00633       <span class="keyword">if</span> (job &lt;= 0) return 
<a name="l00634"></a>00634 <span class="comment">!                                                                       </span>
<a name="l00635"></a>00635 <span class="comment">!     .. eliminate duplicate entries --                                 </span>
<a name="l00636"></a>00636 <span class="comment">!     array INDU is used as marker for existing indices, it is also the </span>
<a name="l00637"></a>00637 <span class="comment">!     location of the entry.                                            </span>
<a name="l00638"></a>00638 <span class="comment">!     IWK is used to stored the old IA array.                           </span>
<a name="l00639"></a>00639 <span class="comment">!     matrix is copied to squeeze out the space taken by the duplicated </span>
<a name="l00640"></a>00640 <span class="comment">!     entries.                                                          </span>
<a name="l00641"></a>00641 <span class="comment">!                                                                       </span>
<a name="l00642"></a>00642       <span class="keyword">do</span> 90 i = 1, nrow 
<a name="l00643"></a>00643          indu(i) = 0 
<a name="l00644"></a>00644          iwk(i) = ia(i) 
<a name="l00645"></a>00645    90 continue 
<a name="l00646"></a>00646       iwk(nrow+1) = ia(nrow+1) 
<a name="l00647"></a>00647       k = 1 
<a name="l00648"></a>00648       <span class="keyword">do</span> 120 i = 1, nrow 
<a name="l00649"></a>00649          ia(i) = k 
<a name="l00650"></a>00650          ipos = iwk(i) 
<a name="l00651"></a>00651          klast = iwk(i+1) 
<a name="l00652"></a>00652   100    <span class="keyword">if</span> (ipos &lt; klast) <span class="keyword">then</span> 
<a name="l00653"></a>00653             j = ja(ipos) 
<a name="l00654"></a>00654             <span class="keyword">if</span> (indu(j) == 0) <span class="keyword">then</span> 
<a name="l00655"></a>00655 <span class="comment">!     .. new entry ..                                                   </span>
<a name="l00656"></a>00656                <span class="keyword">if</span> (value2 /= 0) <span class="keyword">then</span> 
<a name="l00657"></a>00657                   <span class="keyword">if</span> (a(ipos)  /=  0.0D0) <span class="keyword">then</span> 
<a name="l00658"></a>00658                      indu(j) = k 
<a name="l00659"></a>00659                      ja(k) = ja(ipos) 
<a name="l00660"></a>00660                      a(k) = a(ipos) 
<a name="l00661"></a>00661                      k = k + 1 
<a name="l00662"></a>00662                   <span class="keyword">endif</span> 
<a name="l00663"></a>00663                <span class="keyword">else</span> 
<a name="l00664"></a>00664                   indu(j) = k 
<a name="l00665"></a>00665                   ja(k) = ja(ipos) 
<a name="l00666"></a>00666                   k = k + 1 
<a name="l00667"></a>00667                <span class="keyword">endif</span> 
<a name="l00668"></a>00668             <span class="keyword">else</span> <span class="keyword">if</span> (value2 /= 0) <span class="keyword">then</span> 
<a name="l00669"></a>00669 <span class="comment">!     .. duplicate entry ..                                             </span>
<a name="l00670"></a>00670                a(indu(j)) = a(indu(j)) + a(ipos) 
<a name="l00671"></a>00671             <span class="keyword">endif</span> 
<a name="l00672"></a>00672             ipos = ipos + 1 
<a name="l00673"></a>00673             go to 100 
<a name="l00674"></a>00674          <span class="keyword">endif</span> 
<a name="l00675"></a>00675 <span class="comment">!     .. remove marks before working on the next row ..                 </span>
<a name="l00676"></a>00676          <span class="keyword">do</span> 110 ipos = ia(i), k - 1 
<a name="l00677"></a>00677             indu(ja(ipos)) = 0 
<a name="l00678"></a>00678   110    continue 
<a name="l00679"></a>00679   120 continue 
<a name="l00680"></a>00680       ia(nrow+1) = k 
<a name="l00681"></a>00681       <span class="keyword">if</span> (job &lt;= 1) return 
<a name="l00682"></a>00682 <span class="comment">!                                                                       </span>
<a name="l00683"></a>00683 <span class="comment">!     .. partial ordering ..                                            </span>
<a name="l00684"></a>00684 <span class="comment">!     split the matrix into strict upper/lower triangular               </span>
<a name="l00685"></a>00685 <span class="comment">!     parts, INDU points to the the beginning of the upper part.        </span>
<a name="l00686"></a>00686 <span class="comment">!                                                                       </span>
<a name="l00687"></a>00687       <span class="keyword">do</span> 140 i = 1, nrow 
<a name="l00688"></a>00688          klast = ia(i+1) - 1 
<a name="l00689"></a>00689          kfirst = ia(i) 
<a name="l00690"></a>00690   130    <span class="keyword">if</span> (klast &gt; kfirst) <span class="keyword">then</span> 
<a name="l00691"></a>00691             <span class="keyword">if</span> (ja(klast) &lt; i .and. ja(kfirst) &gt;= i) <span class="keyword">then</span> 
<a name="l00692"></a>00692 <span class="comment">!     .. swap klast with kfirst ..                                      </span>
<a name="l00693"></a>00693                j = ja(klast) 
<a name="l00694"></a>00694                ja(klast) = ja(kfirst) 
<a name="l00695"></a>00695                ja(kfirst) = j 
<a name="l00696"></a>00696                <span class="keyword">if</span> (value2 /= 0) <span class="keyword">then</span> 
<a name="l00697"></a>00697                   tmp = a(klast) 
<a name="l00698"></a>00698                   a(klast) = a(kfirst) 
<a name="l00699"></a>00699                   a(kfirst) = tmp 
<a name="l00700"></a>00700                <span class="keyword">endif</span> 
<a name="l00701"></a>00701             <span class="keyword">endif</span> 
<a name="l00702"></a>00702             <span class="keyword">if</span> (ja(klast) &gt;= i)                                         &amp;
<a name="l00703"></a>00703      &amp;         klast = klast - 1                                        
<a name="l00704"></a>00704             <span class="keyword">if</span> (ja(kfirst) &lt; i)                                        &amp;
<a name="l00705"></a>00705      &amp;         kfirst = kfirst + 1                                      
<a name="l00706"></a>00706             go to 130 
<a name="l00707"></a>00707          <span class="keyword">endif</span> 
<a name="l00708"></a>00708 <span class="comment">!                                                                       </span>
<a name="l00709"></a>00709          <span class="keyword">if</span> (ja(klast) &lt; i) <span class="keyword">then</span> 
<a name="l00710"></a>00710             indu(i) = klast + 1 
<a name="l00711"></a>00711          <span class="keyword">else</span> 
<a name="l00712"></a>00712             indu(i) = klast 
<a name="l00713"></a>00713          <span class="keyword">endif</span> 
<a name="l00714"></a>00714   140 continue 
<a name="l00715"></a>00715       <span class="keyword">if</span> (job &lt;= 2) return 
<a name="l00716"></a>00716 <span class="comment">!                                                                       </span>
<a name="l00717"></a>00717 <span class="comment">!     .. order the entries according to column indices                  </span>
<a name="l00718"></a>00718 <span class="comment">!     burble-sort is used                                               </span>
<a name="l00719"></a>00719 <span class="comment">!                                                                       </span>
<a name="l00720"></a>00720       <span class="keyword">do</span> 190 i = 1, nrow 
<a name="l00721"></a>00721          <span class="keyword">do</span> 160 ipos = ia(i), indu(i)-1 
<a name="l00722"></a>00722             <span class="keyword">do</span> 150 j = indu(i)-1, ipos+1, -1 
<a name="l00723"></a>00723                k = j - 1 
<a name="l00724"></a>00724                <span class="keyword">if</span> (ja(k) &gt; ja(j)) <span class="keyword">then</span> 
<a name="l00725"></a>00725                   ko = ja(k) 
<a name="l00726"></a>00726                   ja(k) = ja(j) 
<a name="l00727"></a>00727                   ja(j) = ko 
<a name="l00728"></a>00728                   <span class="keyword">if</span> (value2 /= 0) <span class="keyword">then</span> 
<a name="l00729"></a>00729                      tmp = a(k) 
<a name="l00730"></a>00730                      a(k) = a(j) 
<a name="l00731"></a>00731                      a(j) = tmp 
<a name="l00732"></a>00732                   <span class="keyword">endif</span> 
<a name="l00733"></a>00733                <span class="keyword">endif</span> 
<a name="l00734"></a>00734   150       continue 
<a name="l00735"></a>00735   160    continue 
<a name="l00736"></a>00736          <span class="keyword">do</span> 180 ipos = indu(i), ia(i+1)-1 
<a name="l00737"></a>00737             <span class="keyword">do</span> 170 j = ia(i+1)-1, ipos+1, -1 
<a name="l00738"></a>00738                k = j - 1 
<a name="l00739"></a>00739                <span class="keyword">if</span> (ja(k) &gt; ja(j)) <span class="keyword">then</span> 
<a name="l00740"></a>00740                   ko = ja(k) 
<a name="l00741"></a>00741                   ja(k) = ja(j) 
<a name="l00742"></a>00742                   ja(j) = ko 
<a name="l00743"></a>00743                   <span class="keyword">if</span> (value2 /= 0) <span class="keyword">then</span> 
<a name="l00744"></a>00744                      tmp = a(k) 
<a name="l00745"></a>00745                      a(k) = a(j) 
<a name="l00746"></a>00746                      a(j) = tmp 
<a name="l00747"></a>00747                   <span class="keyword">endif</span> 
<a name="l00748"></a>00748                <span class="keyword">endif</span> 
<a name="l00749"></a>00749   170       continue 
<a name="l00750"></a>00750   180    continue 
<a name="l00751"></a>00751   190 continue 
<a name="l00752"></a>00752       return 
<a name="l00753"></a>00753 <span class="keyword">      end subroutine  clncsr</span>
<a name="l00754"></a>00754 
<a name="l00755"></a>00755 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l00756"></a>00756 
<a name="l00757"></a><a class="code" href="namespaceunary__mod.html#a920227ee2c45c9bb87ffb900cb5f4980">00757</a>       <span class="keyword">subroutine </span><a class="code" href="namespaceunary__mod.html#a920227ee2c45c9bb87ffb900cb5f4980">copmat</a> (nrow,a,ja,ia,ao,jao,iao,ipos,job) 
<a name="l00758"></a>00758       <span class="keywordtype">real(wp)</span> a(*),ao(*) 
<a name="l00759"></a>00759       <span class="keywordtype">integer</span> nrow, ia(*),ja(*),jao(*),iao(*), ipos, job 
<a name="l00760"></a>00760 <span class="comment">!---------------------------------------------------------------------- </span>
<a name="l00761"></a>00761 <span class="comment">! copies the matrix a, ja, ia, into the matrix ao, jao, iao.            </span>
<a name="l00762"></a>00762 <span class="comment">!---------------------------------------------------------------------- </span>
<a name="l00763"></a>00763 <span class="comment">! on entry:                                                             </span>
<a name="l00764"></a>00764 <span class="comment">!---------                                                              </span>
<a name="l00765"></a>00765 <span class="comment">! nrow        = row dimension of the matrix                             </span>
<a name="l00766"></a>00766 <span class="comment">! a,                                                                    </span>
<a name="l00767"></a>00767 <span class="comment">! ja,                                                                   </span>
<a name="l00768"></a>00768 <span class="comment">! ia    = input matrix in compressed sparse row format.                 </span>
<a name="l00769"></a>00769 <span class="comment">! ipos  = integer. indicates the position in the array ao, jao          </span>
<a name="l00770"></a>00770 <span class="comment">!         where the first element should be copied. Thus                </span>
<a name="l00771"></a>00771 <span class="comment">!         iao(1) = ipos on return.                                      </span>
<a name="l00772"></a>00772 <span class="comment">! job   = job indicator. if (job  /=  1) the values are not copies      </span>
<a name="l00773"></a>00773 <span class="comment">!         (i.e., pattern only is copied in the form of arrays ja, ia).  </span>
<a name="l00774"></a>00774 <span class="comment">!                                                                       </span>
<a name="l00775"></a>00775 <span class="comment">! on return:                                                            </span>
<a name="l00776"></a>00776 <span class="comment">!----------                                                             </span>
<a name="l00777"></a>00777 <span class="comment">! ao,                                                                   </span>
<a name="l00778"></a>00778 <span class="comment">! jao,                                                                  </span>
<a name="l00779"></a>00779 <span class="comment">! iao   = output matrix containing the same data as a, ja, ia.          </span>
<a name="l00780"></a>00780 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l00781"></a>00781 <span class="comment">!           Y. Saad, March 1990.                                        </span>
<a name="l00782"></a>00782 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l00783"></a>00783 <span class="comment">! local variables                                                       </span>
<a name="l00784"></a>00784       <span class="keywordtype">integer</span> kst, i, k 
<a name="l00785"></a>00785 <span class="comment">!                                                                       </span>
<a name="l00786"></a>00786       kst    = ipos -ia(1) 
<a name="l00787"></a>00787       <span class="keyword">do</span> 100 i = 1, nrow+1 
<a name="l00788"></a>00788          iao(i) = ia(i) + kst 
<a name="l00789"></a>00789   100 continue 
<a name="l00790"></a>00790 <span class="comment">!                                                                       </span>
<a name="l00791"></a>00791       <span class="keyword">do</span> 200 k=ia(1), ia(nrow+1)-1 
<a name="l00792"></a>00792          jao(kst+k)= ja(k) 
<a name="l00793"></a>00793   200 continue 
<a name="l00794"></a>00794 <span class="comment">!                                                                       </span>
<a name="l00795"></a>00795       <span class="keyword">if</span> (job  /=  1) return 
<a name="l00796"></a>00796       <span class="keyword">do</span> 201 k=ia(1), ia(nrow+1)-1 
<a name="l00797"></a>00797          ao(kst+k) = a(k) 
<a name="l00798"></a>00798   201 continue 
<a name="l00799"></a>00799 <span class="comment">!                                                                       </span>
<a name="l00800"></a>00800       return 
<a name="l00801"></a>00801 <span class="keyword">      end subroutine  copmat</span>
<a name="l00802"></a>00802 
<a name="l00803"></a>00803 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l00804"></a>00804 
<a name="l00805"></a><a class="code" href="namespaceunary__mod.html#a85db7a56dc0da98b0363d70a1dbac54f">00805</a>       <span class="keyword">subroutine </span><a class="code" href="namespaceunary__mod.html#a85db7a56dc0da98b0363d70a1dbac54f">msrcop</a> (nrow,a,ja,ao,jao,job) 
<a name="l00806"></a>00806       <span class="keywordtype">real(wp)</span> a(*),ao(*) 
<a name="l00807"></a>00807       <span class="keywordtype">integer</span> nrow, ja(*),jao(*), job 
<a name="l00808"></a>00808 <span class="comment">!---------------------------------------------------------------------- </span>
<a name="l00809"></a>00809 <span class="comment">! copies the MSR matrix a, ja, into the MSR matrix ao, jao              </span>
<a name="l00810"></a>00810 <span class="comment">!---------------------------------------------------------------------- </span>
<a name="l00811"></a>00811 <span class="comment">! on entry:                                                             </span>
<a name="l00812"></a>00812 <span class="comment">!---------                                                              </span>
<a name="l00813"></a>00813 <span class="comment">! nrow        = row dimension of the matrix                             </span>
<a name="l00814"></a>00814 <span class="comment">! a,ja  = input matrix in Modified compressed sparse row format.        </span>
<a name="l00815"></a>00815 <span class="comment">! job   = job indicator. Values are not copied if job  /=  1            </span>
<a name="l00816"></a>00816 <span class="comment">!                                                                       </span>
<a name="l00817"></a>00817 <span class="comment">! on return:                                                            </span>
<a name="l00818"></a>00818 <span class="comment">!----------                                                             </span>
<a name="l00819"></a>00819 <span class="comment">! ao, jao   = output matrix containing the same data as a, ja.          </span>
<a name="l00820"></a>00820 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l00821"></a>00821 <span class="comment">!           Y. Saad,                                                    </span>
<a name="l00822"></a>00822 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l00823"></a>00823 <span class="comment">! local variables                                                       </span>
<a name="l00824"></a>00824       <span class="keywordtype">integer</span> i, k 
<a name="l00825"></a>00825 <span class="comment">!                                                                       </span>
<a name="l00826"></a>00826       <span class="keyword">do</span> 100 i = 1, nrow+1 
<a name="l00827"></a>00827          jao(i) = ja(i) 
<a name="l00828"></a>00828   100 continue 
<a name="l00829"></a>00829 <span class="comment">!                                                                       </span>
<a name="l00830"></a>00830       <span class="keyword">do</span> 200 k=ja(1), ja(nrow+1)-1 
<a name="l00831"></a>00831          jao(k)= ja(k) 
<a name="l00832"></a>00832   200 continue 
<a name="l00833"></a>00833 <span class="comment">!                                                                       </span>
<a name="l00834"></a>00834       <span class="keyword">if</span> (job  /=  1) return 
<a name="l00835"></a>00835       <span class="keyword">do</span> 201 k=ja(1), ja(nrow+1)-1 
<a name="l00836"></a>00836          ao(k) = a(k) 
<a name="l00837"></a>00837   201 continue 
<a name="l00838"></a>00838       <span class="keyword">do</span> 202 k=1,nrow 
<a name="l00839"></a>00839          ao(k) = a(k) 
<a name="l00840"></a>00840   202 continue 
<a name="l00841"></a>00841 <span class="comment">!                                                                       </span>
<a name="l00842"></a>00842       return 
<a name="l00843"></a>00843 <span class="keyword">      end subroutine  msrcop</span>
<a name="l00844"></a>00844 
<a name="l00845"></a>00845 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l00846"></a>00846 
<a name="l00847"></a><a class="code" href="namespaceunary__mod.html#a2fcf827e1edad10fc57c7037749df17f">00847</a>       <span class="keyword">double precision </span><span class="keyword">function </span><a class="code" href="namespaceunary__mod.html#a2fcf827e1edad10fc57c7037749df17f">getelm</a> (i,j,a,ja,ia,iadd,sorted) 
<a name="l00848"></a>00848 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l00849"></a>00849 <span class="comment">!     purpose:                                                          </span>
<a name="l00850"></a>00850 <span class="comment">!     --------                                                          </span>
<a name="l00851"></a>00851 <span class="comment">!     this function returns the element a(i,j) of a matrix a,           </span>
<a name="l00852"></a>00852 <span class="comment">!     for any pair (i,j).  the matrix is assumed to be stored           </span>
<a name="l00853"></a>00853 <span class="comment">!     in compressed sparse row (csr) format. getelm performs a          </span>
<a name="l00854"></a>00854 <span class="comment">!     binary search in the case where it is known that the elements     </span>
<a name="l00855"></a>00855 <span class="comment">!     are sorted so that the column indices are in increasing order.    </span>
<a name="l00856"></a>00856 <span class="comment">!     also returns (in iadd) the address of the element a(i,j) in       </span>
<a name="l00857"></a>00857 <span class="comment">!     arrays a and ja when the search is successsful (zero if not).     </span>
<a name="l00858"></a>00858 <span class="comment">!-----                                                                  </span>
<a name="l00859"></a>00859 <span class="comment">!     first contributed by noel nachtigal (mit).                        </span>
<a name="l00860"></a>00860 <span class="comment">!     recoded jan. 20, 1991, by y. saad [in particular                  </span>
<a name="l00861"></a>00861 <span class="comment">!     added handling of the non-sorted case + the iadd output]          </span>
<a name="l00862"></a>00862 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l00863"></a>00863 <span class="comment">!     parameters:                                                       </span>
<a name="l00864"></a>00864 <span class="comment">!     -----------                                                       </span>
<a name="l00865"></a>00865 <span class="comment">! on entry:                                                             </span>
<a name="l00866"></a>00866 <span class="comment">!----------                                                             </span>
<a name="l00867"></a>00867 <span class="comment">!     i      = the row index of the element sought (input).             </span>
<a name="l00868"></a>00868 <span class="comment">!     j      = the column index of the element sought (input).          </span>
<a name="l00869"></a>00869 <span class="comment">!     a      = the matrix a in compressed sparse row format (input).    </span>
<a name="l00870"></a>00870 <span class="comment">!     ja     = the array of column indices (input).                     </span>
<a name="l00871"></a>00871 <span class="comment">!     ia     = the array of pointers to the rows&apos; data (input).         </span>
<a name="l00872"></a>00872 <span class="comment">!     sorted = logical indicating whether the matrix is knonw to        </span>
<a name="l00873"></a>00873 <span class="comment">!              have its column indices sorted in increasing order       </span>
<a name="l00874"></a>00874 <span class="comment">!              (sorted=.true.) or not (sorted=.false.).                 </span>
<a name="l00875"></a>00875 <span class="comment">!              (input).                                                 </span>
<a name="l00876"></a>00876 <span class="comment">! on return:                                                            </span>
<a name="l00877"></a>00877 <span class="comment">!-----------                                                            </span>
<a name="l00878"></a>00878 <span class="comment">!     getelm = value of a(i,j).                                         </span>
<a name="l00879"></a>00879 <span class="comment">!     iadd   = address of element a(i,j) in arrays a, ja if found,      </span>
<a name="l00880"></a>00880 <span class="comment">!              zero if not found. (output)                              </span>
<a name="l00881"></a>00881 <span class="comment">!                                                                       </span>
<a name="l00882"></a>00882 <span class="comment">!     note: the inputs i and j are not checked for validity.            </span>
<a name="l00883"></a>00883 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l00884"></a>00884 <span class="comment">!     noel m. nachtigal october 28, 1990 -- youcef saad jan 20, 1991.   </span>
<a name="l00885"></a>00885 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l00886"></a>00886       <span class="keywordtype">integer</span> i, ia(*), iadd, j, ja(*) 
<a name="l00887"></a>00887       <span class="keywordtype">double precision</span> a(*) 
<a name="l00888"></a>00888       <span class="keywordtype">logical</span> sorted 
<a name="l00889"></a>00889 <span class="comment">!                                                                       </span>
<a name="l00890"></a>00890 <span class="comment">!     local variables.                                                  </span>
<a name="l00891"></a>00891 <span class="comment">!                                                                       </span>
<a name="l00892"></a>00892       <span class="keywordtype">integer</span> ibeg, iend, imid, k 
<a name="l00893"></a>00893 <span class="comment">!                                                                       </span>
<a name="l00894"></a>00894 <span class="comment">!     initialization                                                    </span>
<a name="l00895"></a>00895 <span class="comment">!                                                                       </span>
<a name="l00896"></a>00896       iadd = 0 
<a name="l00897"></a>00897       <a class="code" href="namespaceunary__mod.html#a2fcf827e1edad10fc57c7037749df17f">getelm</a> = 0.0 
<a name="l00898"></a>00898       ibeg = ia(i) 
<a name="l00899"></a>00899       iend = ia(i+1)-1 
<a name="l00900"></a>00900 <span class="comment">!                                                                       </span>
<a name="l00901"></a>00901 <span class="comment">!     case where matrix is not necessarily sorted                       </span>
<a name="l00902"></a>00902 <span class="comment">!                                                                       </span>
<a name="l00903"></a>00903       <span class="keyword">if</span> (.not. sorted) <span class="keyword">then</span> 
<a name="l00904"></a>00904 <span class="comment">!                                                                       </span>
<a name="l00905"></a>00905 <span class="comment">! scan the row - exit as soon as a(i,j) is found                        </span>
<a name="l00906"></a>00906 <span class="comment">!                                                                       </span>
<a name="l00907"></a>00907          <span class="keyword">do</span> 5  k=ibeg, iend 
<a name="l00908"></a>00908             <span class="keyword">if</span> (ja(k)  ==   j) <span class="keyword">then</span> 
<a name="l00909"></a>00909                iadd = k 
<a name="l00910"></a>00910                goto 20 
<a name="l00911"></a>00911             <span class="keyword">endif</span> 
<a name="l00912"></a>00912     5    continue 
<a name="l00913"></a>00913 <span class="comment">!                                                                       </span>
<a name="l00914"></a>00914 <span class="comment">!     end unsorted case. begin sorted case                              </span>
<a name="l00915"></a>00915 <span class="comment">!                                                                       </span>
<a name="l00916"></a>00916       <span class="keyword">else</span> 
<a name="l00917"></a>00917 <span class="comment">!                                                                       </span>
<a name="l00918"></a>00918 <span class="comment">!     begin binary search.   compute the middle index.                  </span>
<a name="l00919"></a>00919 <span class="comment">!                                                                       </span>
<a name="l00920"></a>00920    10    imid = ( ibeg + iend ) / 2 
<a name="l00921"></a>00921 <span class="comment">!                                                                       </span>
<a name="l00922"></a>00922 <span class="comment">!     test if  found                                                    </span>
<a name="l00923"></a>00923 <span class="comment">!                                                                       </span>
<a name="l00924"></a>00924          <span class="keyword">if</span> (ja(imid) == j) <span class="keyword">then</span> 
<a name="l00925"></a>00925             iadd = imid 
<a name="l00926"></a>00926             goto 20 
<a name="l00927"></a>00927          <span class="keyword">endif</span> 
<a name="l00928"></a>00928          <span class="keyword">if</span> (ibeg  &gt;=  iend) goto 20 
<a name="l00929"></a>00929 <span class="comment">!                                                                       </span>
<a name="l00930"></a>00930 <span class="comment">!     else     update the interval bounds.                              </span>
<a name="l00931"></a>00931 <span class="comment">!                                                                       </span>
<a name="l00932"></a>00932          <span class="keyword">if</span> (ja(imid) &gt; j) <span class="keyword">then</span> 
<a name="l00933"></a>00933             iend = imid -1 
<a name="l00934"></a>00934          <span class="keyword">else</span> 
<a name="l00935"></a>00935             ibeg = imid +1 
<a name="l00936"></a>00936          <span class="keyword">endif</span> 
<a name="l00937"></a>00937          goto 10 
<a name="l00938"></a>00938 <span class="comment">!                                                                       </span>
<a name="l00939"></a>00939 <span class="comment">!     end both cases                                                    </span>
<a name="l00940"></a>00940 <span class="comment">!                                                                       </span>
<a name="l00941"></a>00941       <span class="keyword">endif</span> 
<a name="l00942"></a>00942 <span class="comment">!                                                                       </span>
<a name="l00943"></a>00943    20 <span class="keyword">if</span> (iadd  /=  0) <a class="code" href="namespaceunary__mod.html#a2fcf827e1edad10fc57c7037749df17f">getelm</a> = a(iadd) 
<a name="l00944"></a>00944 <span class="comment">!                                                                       </span>
<a name="l00945"></a>00945       return 
<a name="l00946"></a>00946 <span class="keyword">      end function getelm</span>
<a name="l00947"></a>00947 
<a name="l00948"></a>00948 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l00949"></a>00949 
<a name="l00950"></a><a class="code" href="namespaceunary__mod.html#a20390651f13641aac492df2e56c2381b">00950</a>       <span class="keyword">subroutine </span><a class="code" href="namespaceunary__mod.html#a20390651f13641aac492df2e56c2381b">getdia</a> (nrow,ncol,job,a,ja,ia,len,diag,idiag,ioff) 
<a name="l00951"></a>00951       <span class="keywordtype">real(wp)</span> diag(*),a(*) 
<a name="l00952"></a>00952       <span class="keywordtype">integer</span> nrow, ncol, job, len, ioff, ia(*), ja(*), idiag(*) 
<a name="l00953"></a>00953 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l00954"></a>00954 <span class="comment">! this subroutine extracts a given diagonal from a matrix stored in csr </span>
<a name="l00955"></a>00955 <span class="comment">! format. the output matrix may be transformed with the diagonal removed</span>
<a name="l00956"></a>00956 <span class="comment">! from it if desired (as indicated by job.)                             </span>
<a name="l00957"></a>00957 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l00958"></a>00958 <span class="comment">! our definition of a diagonal of matrix is a vector of length nrow     </span>
<a name="l00959"></a>00959 <span class="comment">! (always) which contains the elements in rows 1 to nrow of             </span>
<a name="l00960"></a>00960 <span class="comment">! the matrix that are contained in the diagonal offset by ioff          </span>
<a name="l00961"></a>00961 <span class="comment">! with respect to the main diagonal. if the diagonal element            </span>
<a name="l00962"></a>00962 <span class="comment">! falls outside the matrix then it is defined as a zero entry.          </span>
<a name="l00963"></a>00963 <span class="comment">! thus the proper definition of diag(*) with offset ioff is             </span>
<a name="l00964"></a>00964 <span class="comment">!                                                                       </span>
<a name="l00965"></a>00965 <span class="comment">!     diag(i) = a(i,ioff+i) i=1,2,...,nrow                              </span>
<a name="l00966"></a>00966 <span class="comment">!     with elements falling outside the matrix being defined as zero.   </span>
<a name="l00967"></a>00967 <span class="comment">!                                                                       </span>
<a name="l00968"></a>00968 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l00969"></a>00969 <span class="comment">!                                                                       </span>
<a name="l00970"></a>00970 <span class="comment">! on entry:                                                             </span>
<a name="l00971"></a>00971 <span class="comment">!----------                                                             </span>
<a name="l00972"></a>00972 <span class="comment">!                                                                       </span>
<a name="l00973"></a>00973 <span class="comment">! nrow        = integer. the row dimension of the matrix a.             </span>
<a name="l00974"></a>00974 <span class="comment">! ncol        = integer. the column dimension of the matrix a.          </span>
<a name="l00975"></a>00975 <span class="comment">! job   = integer. job indicator.  if job = 0 then                      </span>
<a name="l00976"></a>00976 <span class="comment">!         the matrix a, ja, ia, is not altered on return.               </span>
<a name="l00977"></a>00977 <span class="comment">!         if job /= 0  then getdia will remove the entries              </span>
<a name="l00978"></a>00978 <span class="comment">!         collected in diag from the original matrix.                   </span>
<a name="l00979"></a>00979 <span class="comment">!         this is done in place.                                        </span>
<a name="l00980"></a>00980 <span class="comment">!                                                                       </span>
<a name="l00981"></a>00981 <span class="comment">! a,ja,                                                                 </span>
<a name="l00982"></a>00982 <span class="comment">!    ia = matrix stored in compressed sparse row a,ja,ia,format         </span>
<a name="l00983"></a>00983 <span class="comment">! ioff  = integer,containing the offset of the wanted diagonal          </span>
<a name="l00984"></a>00984 <span class="comment">!          the diagonal extracted is the one corresponding to the       </span>
<a name="l00985"></a>00985 <span class="comment">!          entries a(i,j) with j-i = ioff.                              </span>
<a name="l00986"></a>00986 <span class="comment">!          thus ioff = 0 means the main diagonal                        </span>
<a name="l00987"></a>00987 <span class="comment">!                                                                       </span>
<a name="l00988"></a>00988 <span class="comment">! on return:                                                            </span>
<a name="l00989"></a>00989 <span class="comment">!-----------                                                            </span>
<a name="l00990"></a>00990 <span class="comment">! len   = number of nonzero elements found in diag.                     </span>
<a name="l00991"></a>00991 <span class="comment">!         (len  &lt;=  min(nrow,ncol-ioff)-max(1,1-ioff) + 1 )             </span>
<a name="l00992"></a>00992 <span class="comment">!                                                                       </span>
<a name="l00993"></a>00993 <span class="comment">! diag  = real(wp) array of length nrow containing the wanted diagonal.   </span>
<a name="l00994"></a>00994 <span class="comment">!          diag contains the diagonal (a(i,j),j-i = ioff ) as defined   </span>
<a name="l00995"></a>00995 <span class="comment">!         above.                                                        </span>
<a name="l00996"></a>00996 <span class="comment">!                                                                       </span>
<a name="l00997"></a>00997 <span class="comment">! idiag = integer array of  length len, containing the poisitions       </span>
<a name="l00998"></a>00998 <span class="comment">!         in the original arrays a and ja of the diagonal elements      </span>
<a name="l00999"></a>00999 <span class="comment">!         collected in diag. a zero entry in idiag(i) means that        </span>
<a name="l01000"></a>01000 <span class="comment">!         there was no entry found in row i belonging to the diagonal.  </span>
<a name="l01001"></a>01001 <span class="comment">!                                                                       </span>
<a name="l01002"></a>01002 <span class="comment">! a, ja,                                                                </span>
<a name="l01003"></a>01003 <span class="comment">!    ia = if job  /=  0 the matrix is unchanged. otherwise the nonzero  </span>
<a name="l01004"></a>01004 <span class="comment">!         diagonal entries collected in diag are removed from the       </span>
<a name="l01005"></a>01005 <span class="comment">!         matrix and therefore the arrays a, ja, ia will change.        </span>
<a name="l01006"></a>01006 <span class="comment">!          (the matrix a, ja, ia will contain len fewer elements)       </span>
<a name="l01007"></a>01007 <span class="comment">!                                                                       </span>
<a name="l01008"></a>01008 <span class="comment">!----------------------------------------------------------------------c</span>
<a name="l01009"></a>01009 <span class="comment">!     Y. Saad, sep. 21 1989 - modified and retested Feb 17, 1996.      c</span>
<a name="l01010"></a>01010 <span class="comment">!----------------------------------------------------------------------c</span>
<a name="l01011"></a>01011 <span class="comment">!     local variables                                                   </span>
<a name="l01012"></a>01012       <span class="keywordtype">integer</span> istart, max, iend, i, kold, k, kdiag, ko 
<a name="l01013"></a>01013 <span class="comment">!                                                                       </span>
<a name="l01014"></a>01014       istart = max(0,-ioff) 
<a name="l01015"></a>01015       iend = min(nrow,ncol-ioff) 
<a name="l01016"></a>01016       len = 0 
<a name="l01017"></a>01017       <span class="keyword">do</span> 1 i=1,nrow 
<a name="l01018"></a>01018          idiag(i) = 0 
<a name="l01019"></a>01019          diag(i) = 0.0d0 
<a name="l01020"></a>01020     1 continue 
<a name="l01021"></a>01021 <span class="comment">!                                                                       </span>
<a name="l01022"></a>01022 <span class="comment">!     extract  diagonal elements                                        </span>
<a name="l01023"></a>01023 <span class="comment">!                                                                       </span>
<a name="l01024"></a>01024       <span class="keyword">do</span> 6 i=istart+1, iend 
<a name="l01025"></a>01025          <span class="keyword">do</span> 51 k= ia(i),ia(i+1) -1 
<a name="l01026"></a>01026             <span class="keyword">if</span> (ja(k)-i  ==  ioff) <span class="keyword">then</span> 
<a name="l01027"></a>01027                diag(i)= a(k) 
<a name="l01028"></a>01028                idiag(i) = k 
<a name="l01029"></a>01029                len = len+1 
<a name="l01030"></a>01030                goto 6 
<a name="l01031"></a>01031             <span class="keyword">endif</span> 
<a name="l01032"></a>01032    51    continue 
<a name="l01033"></a>01033     6 continue 
<a name="l01034"></a>01034       <span class="keyword">if</span> (job  ==  0 .or. len  == 0) return 
<a name="l01035"></a>01035 <span class="comment">!                                                                       </span>
<a name="l01036"></a>01036 <span class="comment">!     remove diagonal elements and rewind structure                     </span>
<a name="l01037"></a>01037 <span class="comment">!                                                                       </span>
<a name="l01038"></a>01038       ko = 0 
<a name="l01039"></a>01039       <span class="keyword">do</span>  7 i=1, nrow 
<a name="l01040"></a>01040          kold = ko 
<a name="l01041"></a>01041          kdiag = idiag(i) 
<a name="l01042"></a>01042          <span class="keyword">do</span> 71 k= ia(i), ia(i+1)-1 
<a name="l01043"></a>01043             <span class="keyword">if</span> (k  /=  kdiag) <span class="keyword">then</span> 
<a name="l01044"></a>01044                ko = ko+1 
<a name="l01045"></a>01045                a(ko) = a(k) 
<a name="l01046"></a>01046                ja(ko) = ja(k) 
<a name="l01047"></a>01047             <span class="keyword">endif</span> 
<a name="l01048"></a>01048    71    continue 
<a name="l01049"></a>01049          ia(i) = kold+1 
<a name="l01050"></a>01050     7 continue 
<a name="l01051"></a>01051 <span class="comment">!                                                                       </span>
<a name="l01052"></a>01052 <span class="comment">!     redefine ia(nrow+1)                                               </span>
<a name="l01053"></a>01053 <span class="comment">!                                                                       </span>
<a name="l01054"></a>01054       ia(nrow+1) = ko+1 
<a name="l01055"></a>01055       return 
<a name="l01056"></a>01056 <span class="keyword">      end subroutine  getdia</span>
<a name="l01057"></a>01057 
<a name="l01058"></a>01058 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l01059"></a>01059 
<a name="l01060"></a><a class="code" href="namespaceunary__mod.html#a112ecdbf3d1dd5a1aef7aa9e75328ba1">01060</a>       <span class="keyword">subroutine </span><a class="code" href="namespaceunary__mod.html#a112ecdbf3d1dd5a1aef7aa9e75328ba1">transp</a> (nrow,ncol,a,ja,ia,iwk,ierr) 
<a name="l01061"></a>01061       <span class="keywordtype">integer</span> nrow, ncol, ia(*), ja(*), iwk(*), ierr 
<a name="l01062"></a>01062       <span class="keywordtype">real(wp)</span> a(*) 
<a name="l01063"></a>01063 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l01064"></a>01064 <span class="comment">! In-place transposition routine.                                       </span>
<a name="l01065"></a>01065 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l01066"></a>01066 <span class="comment">! this subroutine transposes a matrix stored in compressed sparse row   </span>
<a name="l01067"></a>01067 <span class="comment">! format. the transposition is done in place in that the arrays a,ja,ia </span>
<a name="l01068"></a>01068 <span class="comment">! of the transpose are overwritten onto the original arrays.            </span>
<a name="l01069"></a>01069 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l01070"></a>01070 <span class="comment">! on entry:                                                             </span>
<a name="l01071"></a>01071 <span class="comment">!---------                                                              </span>
<a name="l01072"></a>01072 <span class="comment">! nrow        = integer. The row dimension of A.                        </span>
<a name="l01073"></a>01073 <span class="comment">! ncol        = integer. The column dimension of A.                     </span>
<a name="l01074"></a>01074 <span class="comment">! a        = real array of size nnz (number of nonzero elements in A).  </span>
<a name="l01075"></a>01075 <span class="comment">!         containing the nonzero elements                               </span>
<a name="l01076"></a>01076 <span class="comment">! ja        = integer array of length nnz containing the column position</span>
<a name="l01077"></a>01077 <span class="comment">!           of the corresponding elements in a.                         </span>
<a name="l01078"></a>01078 <span class="comment">! ia        = integer of size n+1, where n = max(nrow,ncol). On entry   </span>
<a name="l01079"></a>01079 <span class="comment">!         ia(k) contains the position in a,ja of  the beginning of      </span>
<a name="l01080"></a>01080 <span class="comment">!         the k-th row.                                                 </span>
<a name="l01081"></a>01081 <span class="comment">!                                                                       </span>
<a name="l01082"></a>01082 <span class="comment">! iwk        = integer work array of same length as ja.                 </span>
<a name="l01083"></a>01083 <span class="comment">!                                                                       </span>
<a name="l01084"></a>01084 <span class="comment">! on return:                                                            </span>
<a name="l01085"></a>01085 <span class="comment">!----------                                                             </span>
<a name="l01086"></a>01086 <span class="comment">!                                                                       </span>
<a name="l01087"></a>01087 <span class="comment">! ncol        = actual row dimension of the transpose of the input matri</span>
<a name="l01088"></a>01088 <span class="comment">!         Note that this may be  &lt;=  the input value for ncol, in       </span>
<a name="l01089"></a>01089 <span class="comment">!         case some of the last columns of the input matrix are zero    </span>
<a name="l01090"></a>01090 <span class="comment">!         columns. In the case where the actual number of rows found    </span>
<a name="l01091"></a>01091 <span class="comment">!         in transp(A) exceeds the input value of ncol, transp will     </span>
<a name="l01092"></a>01092 <span class="comment">!         return without completing the transposition. see ierr.        </span>
<a name="l01093"></a>01093 <span class="comment">! a,                                                                    </span>
<a name="l01094"></a>01094 <span class="comment">! ja,                                                                   </span>
<a name="l01095"></a>01095 <span class="comment">! ia        = contains the transposed matrix in compressed sparse       </span>
<a name="l01096"></a>01096 <span class="comment">!         row format. The row dimension of a, ja, ia is now ncol.       </span>
<a name="l01097"></a>01097 <span class="comment">!                                                                       </span>
<a name="l01098"></a>01098 <span class="comment">! ierr        = integer. error message. If the number of rows for the   </span>
<a name="l01099"></a>01099 <span class="comment">!         transposed matrix exceeds the input value of ncol,            </span>
<a name="l01100"></a>01100 <span class="comment">!         then ierr is  set to that number and transp quits.            </span>
<a name="l01101"></a>01101 <span class="comment">!         Otherwise ierr is set to 0 (normal return).                   </span>
<a name="l01102"></a>01102 <span class="comment">!                                                                       </span>
<a name="l01103"></a>01103 <span class="comment">! Note:                                                                 </span>
<a name="l01104"></a>01104 <span class="comment">!----- 1) If you do not need the transposition to be done in place      </span>
<a name="l01105"></a>01105 <span class="comment">!         it is preferrable to use the conversion routine csrcsc        </span>
<a name="l01106"></a>01106 <span class="comment">!         (see conversion routines in formats).                         </span>
<a name="l01107"></a>01107 <span class="comment">!      2) the entries of the output matrix are not sorted (the column   </span>
<a name="l01108"></a>01108 <span class="comment">!         indices in each are not in increasing order) use csrcsc       </span>
<a name="l01109"></a>01109 <span class="comment">!         if you want them sorted.                                      </span>
<a name="l01110"></a>01110 <span class="comment">!----------------------------------------------------------------------c</span>
<a name="l01111"></a>01111 <span class="comment">!           Y. Saad, Sep. 21 1989                                      c</span>
<a name="l01112"></a>01112 <span class="comment">!  modified Oct. 11, 1989.                                             c</span>
<a name="l01113"></a>01113 <span class="comment">!----------------------------------------------------------------------c</span>
<a name="l01114"></a>01114 <span class="comment">! local variables                                                       </span>
<a name="l01115"></a>01115       <span class="keywordtype">real(wp)</span> t, t1 
<a name="l01116"></a>01116       <span class="keywordtype">integer</span> i, inext, init, j, jcol, k, nnz, l
<a name="l01117"></a>01117       ierr = 0 
<a name="l01118"></a>01118       nnz = ia(nrow+1)-1 
<a name="l01119"></a>01119 <span class="comment">!                                                                       </span>
<a name="l01120"></a>01120 <span class="comment">!     determine column dimension                                        </span>
<a name="l01121"></a>01121 <span class="comment">!                                                                       </span>
<a name="l01122"></a>01122       jcol = 0 
<a name="l01123"></a>01123       <span class="keyword">do</span> 1 k=1, nnz 
<a name="l01124"></a>01124          jcol = max(jcol,ja(k)) 
<a name="l01125"></a>01125     1 continue 
<a name="l01126"></a>01126       <span class="keyword">if</span> (jcol  &gt;  ncol) <span class="keyword">then</span> 
<a name="l01127"></a>01127          ierr = jcol 
<a name="l01128"></a>01128          return 
<a name="l01129"></a>01129       <span class="keyword">endif</span> 
<a name="l01130"></a>01130 <span class="comment">!                                                                       </span>
<a name="l01131"></a>01131 <span class="comment">!     convert to coordinate format. use iwk for row indices.            </span>
<a name="l01132"></a>01132 <span class="comment">!                                                                       </span>
<a name="l01133"></a>01133       ncol = jcol 
<a name="l01134"></a>01134 <span class="comment">!                                                                       </span>
<a name="l01135"></a>01135       <span class="keyword">do</span> 3 i=1,nrow 
<a name="l01136"></a>01136          <span class="keyword">do</span> 2 k=ia(i),ia(i+1)-1 
<a name="l01137"></a>01137             iwk(k) = i 
<a name="l01138"></a>01138     2    continue 
<a name="l01139"></a>01139     3 continue 
<a name="l01140"></a>01140 <span class="comment">!     find pointer array for transpose.                                 </span>
<a name="l01141"></a>01141       <span class="keyword">do</span> 35 i=1,ncol+1 
<a name="l01142"></a>01142          ia(i) = 0 
<a name="l01143"></a>01143    35 continue 
<a name="l01144"></a>01144       <span class="keyword">do</span> 4 k=1,nnz 
<a name="l01145"></a>01145          i = ja(k) 
<a name="l01146"></a>01146          ia(i+1) = ia(i+1)+1 
<a name="l01147"></a>01147     4 continue 
<a name="l01148"></a>01148       ia(1) = 1 
<a name="l01149"></a>01149 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l01150"></a>01150       <span class="keyword">do</span> 44 i=1,ncol 
<a name="l01151"></a>01151          ia(i+1) = ia(i) + ia(i+1) 
<a name="l01152"></a>01152    44 continue 
<a name="l01153"></a>01153 <span class="comment">!                                                                       </span>
<a name="l01154"></a>01154 <span class="comment">!     loop for a cycle in chasing process.                              </span>
<a name="l01155"></a>01155 <span class="comment">!                                                                       </span>
<a name="l01156"></a>01156       init = 1 
<a name="l01157"></a>01157       k = 0 
<a name="l01158"></a>01158     5 t = a(init) 
<a name="l01159"></a>01159       i = ja(init) 
<a name="l01160"></a>01160       j = iwk(init) 
<a name="l01161"></a>01161       iwk(init) = -1 
<a name="l01162"></a>01162 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l01163"></a>01163     6 k = k+1 
<a name="l01164"></a>01164 <span class="comment">!     current row number is i.  determine  where to go.                 </span>
<a name="l01165"></a>01165       l = ia(i) 
<a name="l01166"></a>01166 <span class="comment">!     save the chased element.                                          </span>
<a name="l01167"></a>01167       t1 = a(l) 
<a name="l01168"></a>01168       inext = ja(l) 
<a name="l01169"></a>01169 <span class="comment">!     then occupy its location.                                         </span>
<a name="l01170"></a>01170       a(l)  = t 
<a name="l01171"></a>01171       ja(l) = j 
<a name="l01172"></a>01172 <span class="comment">!     update pointer information for next element to be put in row i.   </span>
<a name="l01173"></a>01173       ia(i) = l+1 
<a name="l01174"></a>01174 <span class="comment">!     determine  next element to be chased                              </span>
<a name="l01175"></a>01175       <span class="keyword">if</span> (iwk(l)  &lt;  0) goto 65 
<a name="l01176"></a>01176       t = t1 
<a name="l01177"></a>01177       i = inext 
<a name="l01178"></a>01178       j = iwk(l) 
<a name="l01179"></a>01179       iwk(l) = -1 
<a name="l01180"></a>01180       <span class="keyword">if</span> (k  &lt;  nnz) goto 6 
<a name="l01181"></a>01181       goto 70 
<a name="l01182"></a>01182    65 init = init+1 
<a name="l01183"></a>01183       <span class="keyword">if</span> (init  &gt;  nnz) goto 70 
<a name="l01184"></a>01184       <span class="keyword">if</span> (iwk(init)  &lt;  0) goto 65 
<a name="l01185"></a>01185 <span class="comment">!     restart chasing --                                                </span>
<a name="l01186"></a>01186       goto 5 
<a name="l01187"></a>01187    70 continue 
<a name="l01188"></a>01188       <span class="keyword">do</span> 80 i=ncol,1,-1 
<a name="l01189"></a>01189          ia(i+1) = ia(i) 
<a name="l01190"></a>01190    80 continue 
<a name="l01191"></a>01191       ia(1) = 1 
<a name="l01192"></a>01192 <span class="comment">!                                                                       </span>
<a name="l01193"></a>01193       return 
<a name="l01194"></a>01194 <span class="keyword">      end subroutine  transp</span>
<a name="l01195"></a>01195 
<a name="l01196"></a>01196 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l01197"></a>01197 
<a name="l01198"></a><a class="code" href="namespaceunary__mod.html#a7e2407539b6ce51abe418f4fa1834e18">01198</a>       <span class="keyword">subroutine </span><a class="code" href="namespaceunary__mod.html#a7e2407539b6ce51abe418f4fa1834e18">getl</a> (n,a,ja,ia,ao,jao,iao) 
<a name="l01199"></a>01199       <span class="keywordtype">integer</span> n, ia(*), ja(*), iao(*), jao(*) 
<a name="l01200"></a>01200       <span class="keywordtype">real(wp)</span> a(*), ao(*) 
<a name="l01201"></a>01201 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l01202"></a>01202 <span class="comment">! this subroutine extracts the lower triangular part of a matrix        </span>
<a name="l01203"></a>01203 <span class="comment">! and writes the result ao, jao, iao. The routine is in place in        </span>
<a name="l01204"></a>01204 <span class="comment">! that ao, jao, iao can be the same as a, ja, ia if desired.            </span>
<a name="l01205"></a>01205 <span class="comment">!-----------                                                            </span>
<a name="l01206"></a>01206 <span class="comment">! on input:                                                             </span>
<a name="l01207"></a>01207 <span class="comment">!                                                                       </span>
<a name="l01208"></a>01208 <span class="comment">! n     = dimension of the matrix a.                                    </span>
<a name="l01209"></a>01209 <span class="comment">! a, ja,                                                                </span>
<a name="l01210"></a>01210 <span class="comment">!    ia = matrix stored in compressed sparse row format.                </span>
<a name="l01211"></a>01211 <span class="comment">! On return:                                                            </span>
<a name="l01212"></a>01212 <span class="comment">! ao, jao,                                                              </span>
<a name="l01213"></a>01213 <span class="comment">!    iao = lower triangular matrix (lower part of a)                    </span>
<a name="l01214"></a>01214 <span class="comment">!        stored in a, ja, ia, format                                    </span>
<a name="l01215"></a>01215 <span class="comment">! note: the diagonal element is the last element in each row.           </span>
<a name="l01216"></a>01216 <span class="comment">! i.e. in  a(ia(i+1)-1 )                                                </span>
<a name="l01217"></a>01217 <span class="comment">! ao, jao, iao may be the same as a, ja, ia on entry -- in which case   </span>
<a name="l01218"></a>01218 <span class="comment">! getl will overwrite the result on a, ja, ia.                          </span>
<a name="l01219"></a>01219 <span class="comment">!                                                                       </span>
<a name="l01220"></a>01220 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l01221"></a>01221 <span class="comment">! local variables                                                       </span>
<a name="l01222"></a>01222       <span class="keywordtype">real(wp)</span> t 
<a name="l01223"></a>01223       <span class="keywordtype">integer</span> ko, kold, kdiag, k, i 
<a name="l01224"></a>01224 <span class="comment">!                                                                       </span>
<a name="l01225"></a>01225 <span class="comment">! inititialize ko (pointer for output matrix)                           </span>
<a name="l01226"></a>01226 <span class="comment">!                                                                       </span>
<a name="l01227"></a>01227       ko = 0 
<a name="l01228"></a>01228       <span class="keyword">do</span>  7 i=1, n 
<a name="l01229"></a>01229          kold = ko 
<a name="l01230"></a>01230          kdiag = 0 
<a name="l01231"></a>01231          <span class="keyword">do</span> 71 k = ia(i), ia(i+1) -1 
<a name="l01232"></a>01232             <span class="keyword">if</span> (ja(k)   &gt;  i) goto 71 
<a name="l01233"></a>01233             ko = ko+1 
<a name="l01234"></a>01234             ao(ko) = a(k) 
<a name="l01235"></a>01235             jao(ko) = ja(k) 
<a name="l01236"></a>01236             <span class="keyword">if</span> (ja(k)   ==  i) kdiag = ko 
<a name="l01237"></a>01237    71    continue 
<a name="l01238"></a>01238          <span class="keyword">if</span> (kdiag  ==  0 .or. kdiag  ==  ko) goto 72 
<a name="l01239"></a>01239 <span class="comment">!                                                                       </span>
<a name="l01240"></a>01240 <span class="comment">!     exchange                                                          </span>
<a name="l01241"></a>01241 <span class="comment">!                                                                       </span>
<a name="l01242"></a>01242          t = ao(kdiag) 
<a name="l01243"></a>01243          ao(kdiag) = ao(ko) 
<a name="l01244"></a>01244          ao(ko) = t 
<a name="l01245"></a>01245 <span class="comment">!                                                                       </span>
<a name="l01246"></a>01246          k = jao(kdiag) 
<a name="l01247"></a>01247          jao(kdiag) = jao(ko) 
<a name="l01248"></a>01248          jao(ko) = k 
<a name="l01249"></a>01249    72    iao(i) = kold+1 
<a name="l01250"></a>01250     7 continue 
<a name="l01251"></a>01251 <span class="comment">!     redefine iao(n+1)                                                 </span>
<a name="l01252"></a>01252       iao(n+1) = ko+1 
<a name="l01253"></a>01253       return 
<a name="l01254"></a>01254 <span class="keyword">      end subroutine  getl</span>
<a name="l01255"></a>01255 
<a name="l01256"></a>01256 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l01257"></a>01257 
<a name="l01258"></a><a class="code" href="namespaceunary__mod.html#a7222a581f79547f72a9900fe620404c8">01258</a>       <span class="keyword">subroutine </span><a class="code" href="namespaceunary__mod.html#a7222a581f79547f72a9900fe620404c8">getu</a> (n,a,ja,ia,ao,jao,iao) 
<a name="l01259"></a>01259       <span class="keywordtype">integer</span> n, ia(*), ja(*), iao(*), jao(*) 
<a name="l01260"></a>01260       <span class="keywordtype">real(wp)</span> a(*), ao(*) 
<a name="l01261"></a>01261 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l01262"></a>01262 <span class="comment">! this subroutine extracts the upper triangular part of a matrix        </span>
<a name="l01263"></a>01263 <span class="comment">! and writes the result ao, jao, iao. The routine is in place in        </span>
<a name="l01264"></a>01264 <span class="comment">! that ao, jao, iao can be the same as a, ja, ia if desired.            </span>
<a name="l01265"></a>01265 <span class="comment">!-----------                                                            </span>
<a name="l01266"></a>01266 <span class="comment">! on input:                                                             </span>
<a name="l01267"></a>01267 <span class="comment">!                                                                       </span>
<a name="l01268"></a>01268 <span class="comment">! n     = dimension of the matrix a.                                    </span>
<a name="l01269"></a>01269 <span class="comment">! a, ja,                                                                </span>
<a name="l01270"></a>01270 <span class="comment">!    ia = matrix stored in a, ja, ia, format                            </span>
<a name="l01271"></a>01271 <span class="comment">! On return:                                                            </span>
<a name="l01272"></a>01272 <span class="comment">! ao, jao,                                                              </span>
<a name="l01273"></a>01273 <span class="comment">!    iao = upper triangular matrix (upper part of a)                    </span>
<a name="l01274"></a>01274 <span class="comment">!        stored in compressed sparse row format                         </span>
<a name="l01275"></a>01275 <span class="comment">! note: the diagonal element is the last element in each row.           </span>
<a name="l01276"></a>01276 <span class="comment">! i.e. in  a(ia(i+1)-1 )                                                </span>
<a name="l01277"></a>01277 <span class="comment">! ao, jao, iao may be the same as a, ja, ia on entry -- in which case   </span>
<a name="l01278"></a>01278 <span class="comment">! getu will overwrite the result on a, ja, ia.                          </span>
<a name="l01279"></a>01279 <span class="comment">!                                                                       </span>
<a name="l01280"></a>01280 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l01281"></a>01281 <span class="comment">! local variables                                                       </span>
<a name="l01282"></a>01282       <span class="keywordtype">real(wp)</span> t 
<a name="l01283"></a>01283       <span class="keywordtype">integer</span> ko, k, i, kdiag, kfirst 
<a name="l01284"></a>01284       ko = 0 
<a name="l01285"></a>01285       <span class="keyword">do</span>  7 i=1, n 
<a name="l01286"></a>01286          kfirst = ko+1 
<a name="l01287"></a>01287          kdiag = 0 
<a name="l01288"></a>01288          <span class="keyword">do</span> 71 k = ia(i), ia(i+1) -1 
<a name="l01289"></a>01289             <span class="keyword">if</span> (ja(k)   &lt;  i) goto 71 
<a name="l01290"></a>01290             ko = ko+1 
<a name="l01291"></a>01291             ao(ko) = a(k) 
<a name="l01292"></a>01292             jao(ko) = ja(k) 
<a name="l01293"></a>01293             <span class="keyword">if</span> (ja(k)   ==  i) kdiag = ko 
<a name="l01294"></a>01294    71    continue 
<a name="l01295"></a>01295          <span class="keyword">if</span> (kdiag  ==  0 .or. kdiag  ==  kfirst) goto 72 
<a name="l01296"></a>01296 <span class="comment">!     exchange                                                          </span>
<a name="l01297"></a>01297          t = ao(kdiag) 
<a name="l01298"></a>01298          ao(kdiag) = ao(kfirst) 
<a name="l01299"></a>01299          ao(kfirst) = t 
<a name="l01300"></a>01300 <span class="comment">!                                                                       </span>
<a name="l01301"></a>01301          k = jao(kdiag) 
<a name="l01302"></a>01302          jao(kdiag) = jao(kfirst) 
<a name="l01303"></a>01303          jao(kfirst) = k 
<a name="l01304"></a>01304    72    iao(i) = kfirst 
<a name="l01305"></a>01305     7 continue 
<a name="l01306"></a>01306 <span class="comment">!     redefine iao(n+1)                                                 </span>
<a name="l01307"></a>01307       iao(n+1) = ko+1 
<a name="l01308"></a>01308       return 
<a name="l01309"></a>01309 <span class="keyword">      end subroutine  getu</span>
<a name="l01310"></a>01310 
<a name="l01311"></a>01311 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l01312"></a>01312 
<a name="l01313"></a><a class="code" href="namespaceunary__mod.html#a81b9d99f31dcd1660768aa3e470c8486">01313</a>       <span class="keyword">subroutine </span><a class="code" href="namespaceunary__mod.html#a81b9d99f31dcd1660768aa3e470c8486">levels</a> (n, jal, ial, nlev, lev, ilev, levnum) 
<a name="l01314"></a>01314       <span class="keywordtype">integer</span> n, nlev
<a name="l01315"></a>01315       <span class="keywordtype">integer</span> jal(*),ial(*), levnum(*), ilev(*), lev(*) 
<a name="l01316"></a>01316 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l01317"></a>01317 <span class="comment">! levels gets the level structure of a lower triangular matrix          </span>
<a name="l01318"></a>01318 <span class="comment">! for level scheduling in the parallel solution of triangular systems   </span>
<a name="l01319"></a>01319 <span class="comment">! strict lower matrices (e.g. unit) as well matrices with their main    </span>
<a name="l01320"></a>01320 <span class="comment">! diagonal are accepted.                                                </span>
<a name="l01321"></a>01321 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l01322"></a>01322 <span class="comment">! on entry:                                                             </span>
<a name="l01323"></a>01323 <span class="comment">!----------                                                             </span>
<a name="l01324"></a>01324 <span class="comment">! n        = integer. The row dimension of the matrix                   </span>
<a name="l01325"></a>01325 <span class="comment">! jal, ial =                                                            </span>
<a name="l01326"></a>01326 <span class="comment">!                                                                       </span>
<a name="l01327"></a>01327 <span class="comment">! on return:                                                            </span>
<a name="l01328"></a>01328 <span class="comment">!-----------                                                            </span>
<a name="l01329"></a>01329 <span class="comment">! nlev     = integer. number of levels found                            </span>
<a name="l01330"></a>01330 <span class="comment">! lev      = integer array of length n containing the level             </span>
<a name="l01331"></a>01331 <span class="comment">!            scheduling permutation.                                    </span>
<a name="l01332"></a>01332 <span class="comment">! ilev     = integer array. pointer to beginning of levels in lev.      </span>
<a name="l01333"></a>01333 <span class="comment">!            the numbers lev(i) to lev(i+1)-1 contain the row numbers   </span>
<a name="l01334"></a>01334 <span class="comment">!            that belong to level number i, in the level scheduling     </span>
<a name="l01335"></a>01335 <span class="comment">!            ordering. The equations of the same level can be solved    </span>
<a name="l01336"></a>01336 <span class="comment">!            in parallel, once those of all the previous levels have    </span>
<a name="l01337"></a>01337 <span class="comment">!            been solved.                                               </span>
<a name="l01338"></a>01338 <span class="comment">! work arrays:                                                          </span>
<a name="l01339"></a>01339 <span class="comment">!-------------                                                          </span>
<a name="l01340"></a>01340 <span class="comment">! levnum   = integer array of length n (containing the level numbers    </span>
<a name="l01341"></a>01341 <span class="comment">!            of each unknown on return)                                 </span>
<a name="l01342"></a>01342 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l01343"></a>01343       <span class="keywordtype">integer</span> i, j, levi    
<a name="l01344"></a>01344 
<a name="l01345"></a>01345       <span class="keyword">do</span> 10 i = 1, n 
<a name="l01346"></a>01346          levnum(i) = 0 
<a name="l01347"></a>01347    10 continue 
<a name="l01348"></a>01348 <span class="comment">!                                                                       </span>
<a name="l01349"></a>01349 <span class="comment">!     compute level of each node --                                     </span>
<a name="l01350"></a>01350 <span class="comment">!                                                                       </span>
<a name="l01351"></a>01351       nlev = 0 
<a name="l01352"></a>01352       <span class="keyword">do</span> 20 i = 1, n 
<a name="l01353"></a>01353          levi = 0 
<a name="l01354"></a>01354          <span class="keyword">do</span> 15 j = ial(i), ial(i+1) - 1 
<a name="l01355"></a>01355             levi = max (levi, levnum(jal(j))) 
<a name="l01356"></a>01356    15    continue 
<a name="l01357"></a>01357          levi = levi+1 
<a name="l01358"></a>01358          levnum(i) = levi 
<a name="l01359"></a>01359          nlev = max(nlev,levi) 
<a name="l01360"></a>01360    20 continue 
<a name="l01361"></a>01361 <span class="comment">!-------------set data structure  --------------------------------------</span>
<a name="l01362"></a>01362       <span class="keyword">do</span> 21 j=1, nlev+1 
<a name="l01363"></a>01363          ilev(j) = 0 
<a name="l01364"></a>01364    21 continue 
<a name="l01365"></a>01365 <span class="comment">!------count  number   of elements in each level -----------------------</span>
<a name="l01366"></a>01366       <span class="keyword">do</span> 22 j=1, n 
<a name="l01367"></a>01367          i = levnum(j)+1 
<a name="l01368"></a>01368          ilev(i) = ilev(i)+1 
<a name="l01369"></a>01369    22 continue 
<a name="l01370"></a>01370 <span class="comment">!---- set up pointer for  each  level ----------------------------------</span>
<a name="l01371"></a>01371       ilev(1) = 1 
<a name="l01372"></a>01372       <span class="keyword">do</span> 23 j=1, nlev 
<a name="l01373"></a>01373          ilev(j+1) = ilev(j)+ilev(j+1) 
<a name="l01374"></a>01374    23 continue 
<a name="l01375"></a>01375 <span class="comment">!-----determine elements of each level -------------------------------- </span>
<a name="l01376"></a>01376       <span class="keyword">do</span> 30 j=1,n 
<a name="l01377"></a>01377          i = levnum(j) 
<a name="l01378"></a>01378          lev(ilev(i)) = j 
<a name="l01379"></a>01379          ilev(i) = ilev(i)+1 
<a name="l01380"></a>01380    30 continue 
<a name="l01381"></a>01381 <span class="comment">!     reset pointers backwards                                          </span>
<a name="l01382"></a>01382       <span class="keyword">do</span> 35 j=nlev, 1, -1 
<a name="l01383"></a>01383          ilev(j+1) = ilev(j) 
<a name="l01384"></a>01384    35 continue 
<a name="l01385"></a>01385       ilev(1) = 1 
<a name="l01386"></a>01386       return 
<a name="l01387"></a>01387 <span class="keyword">      end subroutine  levels</span>
<a name="l01388"></a>01388 
<a name="l01389"></a>01389 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l01390"></a>01390 
<a name="l01391"></a><a class="code" href="namespaceunary__mod.html#aba678ebf9e878079ed129f748ec29aef">01391</a>       <span class="keyword">subroutine </span><a class="code" href="namespaceunary__mod.html#aba678ebf9e878079ed129f748ec29aef">amask</a> (nrow,ncol,a,ja,ia,jmask,imask,                  &amp;
<a name="l01392"></a>01392      &amp;                  c,jc,ic,iw,nzmax,ierr)                          
<a name="l01393"></a>01393 <span class="comment">!---------------------------------------------------------------------  </span>
<a name="l01394"></a>01394       <span class="keywordtype">real(wp)</span> a(*),c(*)
<a name="l01395"></a>01395       <span class="keywordtype">integer</span> nrow, ncol, nzmax, ierr
<a name="l01396"></a>01396       <span class="keywordtype">integer</span> ia(nrow+1),ja(*),jc(*),ic(nrow+1),jmask(*),imask(nrow+1) 
<a name="l01397"></a>01397       <span class="keywordtype">logical</span> iw(ncol) 
<a name="l01398"></a>01398 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l01399"></a>01399 <span class="comment">! This subroutine builds a sparse matrix from an input matrix by        </span>
<a name="l01400"></a>01400 <span class="comment">! extracting only elements in positions defined by the mask jmask, imask</span>
<a name="l01401"></a>01401 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l01402"></a>01402 <span class="comment">! On entry:                                                             </span>
<a name="l01403"></a>01403 <span class="comment">!---------                                                              </span>
<a name="l01404"></a>01404 <span class="comment">! nrow  = integer. row dimension of input matrix                        </span>
<a name="l01405"></a>01405 <span class="comment">! ncol        = integer. Column dimension of input matrix.              </span>
<a name="l01406"></a>01406 <span class="comment">!                                                                       </span>
<a name="l01407"></a>01407 <span class="comment">! a,                                                                    </span>
<a name="l01408"></a>01408 <span class="comment">! ja,                                                                   </span>
<a name="l01409"></a>01409 <span class="comment">! ia        = matrix in Compressed Sparse Row format                    </span>
<a name="l01410"></a>01410 <span class="comment">!                                                                       </span>
<a name="l01411"></a>01411 <span class="comment">! jmask,                                                                </span>
<a name="l01412"></a>01412 <span class="comment">! imask = matrix defining mask (pattern only) stored in compressed      </span>
<a name="l01413"></a>01413 <span class="comment">!         sparse row format.                                            </span>
<a name="l01414"></a>01414 <span class="comment">!                                                                       </span>
<a name="l01415"></a>01415 <span class="comment">! nzmax = length of arrays c and jc. see ierr.                          </span>
<a name="l01416"></a>01416 <span class="comment">!                                                                       </span>
<a name="l01417"></a>01417 <span class="comment">! On return:                                                            </span>
<a name="l01418"></a>01418 <span class="comment">!-----------                                                            </span>
<a name="l01419"></a>01419 <span class="comment">!                                                                       </span>
<a name="l01420"></a>01420 <span class="comment">! a, ja, ia and jmask, imask are unchanged.                             </span>
<a name="l01421"></a>01421 <span class="comment">!                                                                       </span>
<a name="l01422"></a>01422 <span class="comment">! c                                                                     </span>
<a name="l01423"></a>01423 <span class="comment">! jc,                                                                   </span>
<a name="l01424"></a>01424 <span class="comment">! ic        = the output matrix in Compressed Sparse Row format.        </span>
<a name="l01425"></a>01425 <span class="comment">!                                                                       </span>
<a name="l01426"></a>01426 <span class="comment">! ierr  = integer. serving as error message.c                           </span>
<a name="l01427"></a>01427 <span class="comment">!         ierr = 1  means normal return                                 </span>
<a name="l01428"></a>01428 <span class="comment">!         ierr  &gt;  1 means that amask stopped when processing          </span>
<a name="l01429"></a>01429 <span class="comment">!         row number ierr, because there was not enough space in        </span>
<a name="l01430"></a>01430 <span class="comment">!         c, jc according to the value of nzmax.                        </span>
<a name="l01431"></a>01431 <span class="comment">!                                                                       </span>
<a name="l01432"></a>01432 <span class="comment">! work arrays:                                                          </span>
<a name="l01433"></a>01433 <span class="comment">!-------------                                                          </span>
<a name="l01434"></a>01434 <span class="comment">! iw        = logical work array of length ncol.                        </span>
<a name="l01435"></a>01435 <span class="comment">!                                                                       </span>
<a name="l01436"></a>01436 <span class="comment">! note:                                                                 </span>
<a name="l01437"></a>01437 <span class="comment">!------ the  algorithm is in place: c, jc, ic can be the same as        </span>
<a name="l01438"></a>01438 <span class="comment">! a, ja, ia in which cas the code will overwrite the matrix c           </span>
<a name="l01439"></a>01439 <span class="comment">! on a, ja, ia                                                          </span>
<a name="l01440"></a>01440 <span class="comment">!                                                                       </span>
<a name="l01441"></a>01441 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l01442"></a>01442       <span class="keywordtype">integer</span> ii, j, k, k1, k2, len
<a name="l01443"></a>01443 
<a name="l01444"></a>01444       ierr = 0 
<a name="l01445"></a>01445       len = 0 
<a name="l01446"></a>01446       <span class="keyword">do</span> 1 j=1, ncol 
<a name="l01447"></a>01447          iw(j) = .false. 
<a name="l01448"></a>01448     1 continue 
<a name="l01449"></a>01449 <span class="comment">!     unpack the mask for row ii in iw                                  </span>
<a name="l01450"></a>01450       <span class="keyword">do</span> 100 ii=1, nrow 
<a name="l01451"></a>01451 <span class="comment">!     save pointer in order to be able to do things in place            </span>
<a name="l01452"></a>01452          <span class="keyword">do</span> 2 k=imask(ii), imask(ii+1)-1 
<a name="l01453"></a>01453             iw(jmask(k)) = .true. 
<a name="l01454"></a>01454     2    continue 
<a name="l01455"></a>01455 <span class="comment">!     add umasked elemnts of row ii                                     </span>
<a name="l01456"></a>01456          k1 = ia(ii) 
<a name="l01457"></a>01457          k2 = ia(ii+1)-1 
<a name="l01458"></a>01458          ic(ii) = len+1 
<a name="l01459"></a>01459          <span class="keyword">do</span> 200 k=k1,k2 
<a name="l01460"></a>01460             j = ja(k) 
<a name="l01461"></a>01461             <span class="keyword">if</span> (iw(j)) <span class="keyword">then</span> 
<a name="l01462"></a>01462                len = len+1 
<a name="l01463"></a>01463                <span class="keyword">if</span> (len  &gt;  nzmax) <span class="keyword">then</span> 
<a name="l01464"></a>01464                   ierr = ii 
<a name="l01465"></a>01465                   return 
<a name="l01466"></a>01466                <span class="keyword">endif</span> 
<a name="l01467"></a>01467                jc(len) = j 
<a name="l01468"></a>01468                c(len) = a(k) 
<a name="l01469"></a>01469             <span class="keyword">endif</span> 
<a name="l01470"></a>01470   200    continue 
<a name="l01471"></a>01471 <span class="comment">!                                                                       </span>
<a name="l01472"></a>01472          <span class="keyword">do</span> 3 k=imask(ii), imask(ii+1)-1 
<a name="l01473"></a>01473             iw(jmask(k)) = .false. 
<a name="l01474"></a>01474     3    continue 
<a name="l01475"></a>01475   100 continue 
<a name="l01476"></a>01476       ic(nrow+1)=len+1 
<a name="l01477"></a>01477 <span class="comment">!                                                                       </span>
<a name="l01478"></a>01478       return 
<a name="l01479"></a>01479 <span class="keyword">      end subroutine  amask</span>
<a name="l01480"></a>01480 
<a name="l01481"></a>01481 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l01482"></a>01482 
<a name="l01483"></a><a class="code" href="namespaceunary__mod.html#ac8cbdc4380307b940c0153271f95bf22">01483</a>       <span class="keyword">subroutine </span><a class="code" href="namespaceunary__mod.html#ac8cbdc4380307b940c0153271f95bf22">rperm</a> (nrow,a,ja,ia,ao,jao,iao,perm,job) 
<a name="l01484"></a>01484       <span class="keywordtype">integer</span> nrow,ja(*),ia(nrow+1),jao(*),iao(nrow+1),perm(nrow),job 
<a name="l01485"></a>01485       <span class="keywordtype">real(wp)</span> a(*),ao(*) 
<a name="l01486"></a>01486 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l01487"></a>01487 <span class="comment">! this subroutine permutes the rows of a matrix in CSR format.          </span>
<a name="l01488"></a>01488 <span class="comment">! rperm  computes B = P A  where P is a permutation matrix.             </span>
<a name="l01489"></a>01489 <span class="comment">! the permutation P is defined through the array perm: for each j,      </span>
<a name="l01490"></a>01490 <span class="comment">! perm(j) represents the destination row number of row number j.        </span>
<a name="l01491"></a>01491 <span class="comment">! Youcef Saad -- recoded Jan 28, 1991.                                  </span>
<a name="l01492"></a>01492 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l01493"></a>01493 <span class="comment">! on entry:                                                             </span>
<a name="l01494"></a>01494 <span class="comment">!----------                                                             </span>
<a name="l01495"></a>01495 <span class="comment">! n         = dimension of the matrix                                   </span>
<a name="l01496"></a>01496 <span class="comment">! a, ja, ia = input matrix in csr format                                </span>
<a name="l01497"></a>01497 <span class="comment">! perm         = integer array of length nrow containing the permutation</span>
<a name="l01498"></a>01498 <span class="comment">!          for the rows: perm(i) is the destination of row i in the     </span>
<a name="l01499"></a>01499 <span class="comment">!         permuted matrix.                                              </span>
<a name="l01500"></a>01500 <span class="comment">!         ---&gt; a(i,j) in the original matrix becomes a(perm(i),j)       </span>
<a name="l01501"></a>01501 <span class="comment">!         in the output  matrix.                                        </span>
<a name="l01502"></a>01502 <span class="comment">!                                                                       </span>
<a name="l01503"></a>01503 <span class="comment">! job        = integer indicating the work to be done:                  </span>
<a name="l01504"></a>01504 <span class="comment">!                 job = 1        permute a, ja, ia into ao, jao, iao    </span>
<a name="l01505"></a>01505 <span class="comment">!                       (including the copying of real values ao and    </span>
<a name="l01506"></a>01506 <span class="comment">!                       the array iao).                                 </span>
<a name="l01507"></a>01507 <span class="comment">!                 job  /=  1 :  ignore real values.                     </span>
<a name="l01508"></a>01508 <span class="comment">!                     (in which case arrays a and ao are not needed nor </span>
<a name="l01509"></a>01509 <span class="comment">!                      used).                                           </span>
<a name="l01510"></a>01510 <span class="comment">!                                                                       </span>
<a name="l01511"></a>01511 <span class="comment">!------------                                                           </span>
<a name="l01512"></a>01512 <span class="comment">! on return:                                                            </span>
<a name="l01513"></a>01513 <span class="comment">!------------                                                           </span>
<a name="l01514"></a>01514 <span class="comment">! ao, jao, iao = input matrix in a, ja, ia format                       </span>
<a name="l01515"></a>01515 <span class="comment">! note :                                                                </span>
<a name="l01516"></a>01516 <span class="comment">!        if (job /= 1)  then the arrays a and ao are not used.          </span>
<a name="l01517"></a>01517 <span class="comment">!----------------------------------------------------------------------c</span>
<a name="l01518"></a>01518 <span class="comment">!           Y. Saad, May  2, 1990                                      c</span>
<a name="l01519"></a>01519 <span class="comment">!----------------------------------------------------------------------c</span>
<a name="l01520"></a>01520       <span class="keywordtype">integer</span> i , ii, j, k, ko
<a name="l01521"></a>01521       <span class="keywordtype">logical</span> values 
<a name="l01522"></a>01522       
<a name="l01523"></a>01523       values = (job  ==  1) 
<a name="l01524"></a>01524 <span class="comment">!                                                                       </span>
<a name="l01525"></a>01525 <span class="comment">!     determine pointers for output matix.                              </span>
<a name="l01526"></a>01526 <span class="comment">!                                                                       </span>
<a name="l01527"></a>01527       <span class="keyword">do</span> 50 j=1,nrow 
<a name="l01528"></a>01528          i = perm(j) 
<a name="l01529"></a>01529          iao(i+1) = ia(j+1) - ia(j) 
<a name="l01530"></a>01530    50 continue 
<a name="l01531"></a>01531 <span class="comment">!                                                                       </span>
<a name="l01532"></a>01532 <span class="comment">! get pointers from lengths                                             </span>
<a name="l01533"></a>01533 <span class="comment">!                                                                       </span>
<a name="l01534"></a>01534       iao(1) = 1 
<a name="l01535"></a>01535       <span class="keyword">do</span> 51 j=1,nrow 
<a name="l01536"></a>01536          iao(j+1)=iao(j+1)+iao(j) 
<a name="l01537"></a>01537    51 continue 
<a name="l01538"></a>01538 <span class="comment">!                                                                       </span>
<a name="l01539"></a>01539 <span class="comment">! copying                                                               </span>
<a name="l01540"></a>01540 <span class="comment">!                                                                       </span>
<a name="l01541"></a>01541       <span class="keyword">do</span> 100 ii=1,nrow 
<a name="l01542"></a>01542 <span class="comment">!                                                                       </span>
<a name="l01543"></a>01543 <span class="comment">! old row = ii  -- new row = iperm(ii) -- ko = new pointer              </span>
<a name="l01544"></a>01544 <span class="comment">!                                                                       </span>
<a name="l01545"></a>01545          ko = iao(perm(ii)) 
<a name="l01546"></a>01546          <span class="keyword">do</span> 60 k=ia(ii), ia(ii+1)-1 
<a name="l01547"></a>01547             jao(ko) = ja(k) 
<a name="l01548"></a>01548             <span class="keyword">if</span> (values) ao(ko) = a(k) 
<a name="l01549"></a>01549             ko = ko+1 
<a name="l01550"></a>01550    60    continue 
<a name="l01551"></a>01551   100 continue 
<a name="l01552"></a>01552 <span class="comment">!                                                                       </span>
<a name="l01553"></a>01553       return 
<a name="l01554"></a>01554 <span class="keyword">      end subroutine  rperm</span>
<a name="l01555"></a>01555 
<a name="l01556"></a>01556 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l01557"></a>01557 
<a name="l01558"></a><a class="code" href="namespaceunary__mod.html#a3911ae3b59ca413043b651034c4faa94">01558</a>       <span class="keyword">subroutine </span><a class="code" href="namespaceunary__mod.html#a3911ae3b59ca413043b651034c4faa94">cperm</a> (nrow,a,ja,ia,ao,jao,iao,perm,job) 
<a name="l01559"></a>01559       <span class="keywordtype">integer</span> nrow,ja(*),ia(nrow+1),jao(*),iao(nrow+1),perm(*), job 
<a name="l01560"></a>01560       <span class="keywordtype">real(wp)</span> a(*), ao(*) 
<a name="l01561"></a>01561 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l01562"></a>01562 <span class="comment">! this subroutine permutes the columns of a matrix a, ja, ia.           </span>
<a name="l01563"></a>01563 <span class="comment">! the result is written in the output matrix  ao, jao, iao.             </span>
<a name="l01564"></a>01564 <span class="comment">! cperm computes B = A P, where  P is a permutation matrix              </span>
<a name="l01565"></a>01565 <span class="comment">! that maps column j into column perm(j), i.e., on return               </span>
<a name="l01566"></a>01566 <span class="comment">!      a(i,j) becomes a(i,perm(j)) in new matrix                        </span>
<a name="l01567"></a>01567 <span class="comment">! Y. Saad, May 2, 1990 / modified Jan. 28, 1991.                        </span>
<a name="l01568"></a>01568 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l01569"></a>01569 <span class="comment">! on entry:                                                             </span>
<a name="l01570"></a>01570 <span class="comment">!----------                                                             </span>
<a name="l01571"></a>01571 <span class="comment">! nrow         = row dimension of the matrix                            </span>
<a name="l01572"></a>01572 <span class="comment">!                                                                       </span>
<a name="l01573"></a>01573 <span class="comment">! a, ja, ia = input matrix in csr format.                               </span>
<a name="l01574"></a>01574 <span class="comment">!                                                                       </span>
<a name="l01575"></a>01575 <span class="comment">! perm        = integer array of length ncol (number of columns of A    </span>
<a name="l01576"></a>01576 <span class="comment">!         containing the permutation array  the columns:                </span>
<a name="l01577"></a>01577 <span class="comment">!         a(i,j) in the original matrix becomes a(i,perm(j))            </span>
<a name="l01578"></a>01578 <span class="comment">!         in the output matrix.                                         </span>
<a name="l01579"></a>01579 <span class="comment">!                                                                       </span>
<a name="l01580"></a>01580 <span class="comment">! job        = integer indicating the work to be done:                  </span>
<a name="l01581"></a>01581 <span class="comment">!                 job = 1        permute a, ja, ia into ao, jao, iao    </span>
<a name="l01582"></a>01582 <span class="comment">!                       (including the copying of real values ao and    </span>
<a name="l01583"></a>01583 <span class="comment">!                       the array iao).                                 </span>
<a name="l01584"></a>01584 <span class="comment">!                 job  /=  1 :  ignore real values ao and ignore iao.   </span>
<a name="l01585"></a>01585 <span class="comment">!                                                                       </span>
<a name="l01586"></a>01586 <span class="comment">!------------                                                           </span>
<a name="l01587"></a>01587 <span class="comment">! on return:                                                            </span>
<a name="l01588"></a>01588 <span class="comment">!------------                                                           </span>
<a name="l01589"></a>01589 <span class="comment">! ao, jao, iao = input matrix in a, ja, ia format (array ao not needed) </span>
<a name="l01590"></a>01590 <span class="comment">!                                                                       </span>
<a name="l01591"></a>01591 <span class="comment">! Notes:                                                                </span>
<a name="l01592"></a>01592 <span class="comment">!-------                                                                </span>
<a name="l01593"></a>01593 <span class="comment">! 1. if job=1 then ao, iao are not used.                                </span>
<a name="l01594"></a>01594 <span class="comment">! 2. This routine is in place: ja, jao can be the same.                 </span>
<a name="l01595"></a>01595 <span class="comment">! 3. If the matrix is initially sorted (by increasing column number)    </span>
<a name="l01596"></a>01596 <span class="comment">!    then ao,jao,iao  may not be on return.                             </span>
<a name="l01597"></a>01597 <span class="comment">!                                                                       </span>
<a name="l01598"></a>01598 <span class="comment">!----------------------------------------------------------------------c</span>
<a name="l01599"></a>01599 <span class="comment">! local parameters:                                                     </span>
<a name="l01600"></a>01600       <span class="keywordtype">integer</span> k, i, nnz 
<a name="l01601"></a>01601 <span class="comment">!                                                                       </span>
<a name="l01602"></a>01602       nnz = ia(nrow+1)-1 
<a name="l01603"></a>01603       <span class="keyword">do</span> 100 k=1,nnz 
<a name="l01604"></a>01604          jao(k) = perm(ja(k)) 
<a name="l01605"></a>01605   100 continue 
<a name="l01606"></a>01606 <span class="comment">!                                                                       </span>
<a name="l01607"></a>01607 <span class="comment">!     done with ja array. return if no need to touch values.            </span>
<a name="l01608"></a>01608 <span class="comment">!                                                                       </span>
<a name="l01609"></a>01609       <span class="keyword">if</span> (job  /=  1) return 
<a name="l01610"></a>01610 <span class="comment">!                                                                       </span>
<a name="l01611"></a>01611 <span class="comment">! else get new pointers -- and copy values too.                         </span>
<a name="l01612"></a>01612 <span class="comment">!                                                                       </span>
<a name="l01613"></a>01613       <span class="keyword">do</span> 1 i=1, nrow+1 
<a name="l01614"></a>01614          iao(i) = ia(i) 
<a name="l01615"></a>01615     1 continue 
<a name="l01616"></a>01616 <span class="comment">!                                                                       </span>
<a name="l01617"></a>01617       <span class="keyword">do</span> 2 k=1, nnz 
<a name="l01618"></a>01618          ao(k) = a(k) 
<a name="l01619"></a>01619     2 continue 
<a name="l01620"></a>01620 <span class="comment">!                                                                       </span>
<a name="l01621"></a>01621       return 
<a name="l01622"></a>01622 <span class="keyword">      end subroutine  cperm</span>
<a name="l01623"></a>01623 
<a name="l01624"></a>01624 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l01625"></a>01625 
<a name="l01626"></a><a class="code" href="namespaceunary__mod.html#a8247fa4ab43954b9f840fc56fd441c23">01626</a>       <span class="keyword">subroutine </span><a class="code" href="namespaceunary__mod.html#a8247fa4ab43954b9f840fc56fd441c23">dperm</a> (nrow,a,ja,ia,ao,jao,iao,perm,qperm,job) 
<a name="l01627"></a>01627       <span class="keywordtype">integer</span> nrow,ja(*),ia(nrow+1),jao(*),iao(nrow+1),perm(nrow),      
<a name="l01628"></a>01628              qperm(*),job                                              
<a name="l01629"></a>01629       <span class="keywordtype">real(wp)</span> a(*),ao(*) 
<a name="l01630"></a>01630 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l01631"></a>01631 <span class="comment">! This routine permutes the rows and columns of a matrix stored in CSR  </span>
<a name="l01632"></a>01632 <span class="comment">! format. i.e., it computes P A Q, where P, Q are permutation matrices. </span>
<a name="l01633"></a>01633 <span class="comment">! P maps row i into row perm(i) and Q maps column j into column qperm(j)</span>
<a name="l01634"></a>01634 <span class="comment">!      a(i,j)    becomes   a(perm(i),qperm(j)) in new matrix            </span>
<a name="l01635"></a>01635 <span class="comment">! In the particular case where Q is the transpose of P (symmetric       </span>
<a name="l01636"></a>01636 <span class="comment">! permutation of A) then qperm is not needed.                           </span>
<a name="l01637"></a>01637 <span class="comment">! note that qperm should be of length ncol (number of columns) but this </span>
<a name="l01638"></a>01638 <span class="comment">! is not checked.                                                       </span>
<a name="l01639"></a>01639 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l01640"></a>01640 <span class="comment">! Y. Saad, Sep. 21 1989 / recoded Jan. 28 1991.                         </span>
<a name="l01641"></a>01641 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l01642"></a>01642 <span class="comment">! on entry:                                                             </span>
<a name="l01643"></a>01643 <span class="comment">!----------                                                             </span>
<a name="l01644"></a>01644 <span class="comment">! n         = dimension of the matrix                                   </span>
<a name="l01645"></a>01645 <span class="comment">! a, ja,                                                                </span>
<a name="l01646"></a>01646 <span class="comment">!    ia = input matrix in a, ja, ia format                              </span>
<a name="l01647"></a>01647 <span class="comment">! perm         = integer array of length n containing the permutation ar</span>
<a name="l01648"></a>01648 <span class="comment">!          for the rows: perm(i) is the destination of row i in the     </span>
<a name="l01649"></a>01649 <span class="comment">!         permuted matrix -- also the destination of column i in case   </span>
<a name="l01650"></a>01650 <span class="comment">!         permutation is symmetric (job  &lt;=  2)                         </span>
<a name="l01651"></a>01651 <span class="comment">!                                                                       </span>
<a name="l01652"></a>01652 <span class="comment">! qperm        = same thing for the columns. This should be provided onl</span>
<a name="l01653"></a>01653 <span class="comment">!         if job=3 or job=4, i.e., only in the case of a nonsymmetric   </span>
<a name="l01654"></a>01654 <span class="comment">!          permutation of rows and columns. Otherwise qperm is a dummy  </span>
<a name="l01655"></a>01655 <span class="comment">!                                                                       </span>
<a name="l01656"></a>01656 <span class="comment">! job        = integer indicating the work to be done:                  </span>
<a name="l01657"></a>01657 <span class="comment">! * job = 1,2 permutation is symmetric  Ao :== P * A * transp(P)        </span>
<a name="l01658"></a>01658 <span class="comment">!                 job = 1        permute a, ja, ia into ao, jao, iao    </span>
<a name="l01659"></a>01659 <span class="comment">!                 job = 2 permute matrix ignoring real values.          </span>
<a name="l01660"></a>01660 <span class="comment">! * job = 3,4 permutation is non-symmetric  Ao :== P * A * Q            </span>
<a name="l01661"></a>01661 <span class="comment">!                 job = 3        permute a, ja, ia into ao, jao, iao    </span>
<a name="l01662"></a>01662 <span class="comment">!                 job = 4 permute matrix ignoring real values.          </span>
<a name="l01663"></a>01663 <span class="comment">!                                                                       </span>
<a name="l01664"></a>01664 <span class="comment">! on return:                                                            </span>
<a name="l01665"></a>01665 <span class="comment">!-----------                                                            </span>
<a name="l01666"></a>01666 <span class="comment">! ao, jao, iao = input matrix in a, ja, ia format                       </span>
<a name="l01667"></a>01667 <span class="comment">!                                                                       </span>
<a name="l01668"></a>01668 <span class="comment">! in case job  ==  2 or job  ==  4, a and ao are never referred to      </span>
<a name="l01669"></a>01669 <span class="comment">! and can be dummy arguments.                                           </span>
<a name="l01670"></a>01670 <span class="comment">! Notes:                                                                </span>
<a name="l01671"></a>01671 <span class="comment">!-------                                                                </span>
<a name="l01672"></a>01672 <span class="comment">!  1) algorithm is in place                                             </span>
<a name="l01673"></a>01673 <span class="comment">!  2) column indices may not be sorted on return even  though they may b</span>
<a name="l01674"></a>01674 <span class="comment">!     on entry.                                                         </span>
<a name="l01675"></a>01675 <span class="comment">!----------------------------------------------------------------------c</span>
<a name="l01676"></a>01676 <span class="comment">! local variables                                                       </span>
<a name="l01677"></a>01677       <span class="keywordtype">integer</span> locjob, mod 
<a name="l01678"></a>01678 <span class="comment">!                                                                       </span>
<a name="l01679"></a>01679 <span class="comment">!     locjob indicates whether or not real values must be copied.       </span>
<a name="l01680"></a>01680 <span class="comment">!                                                                       </span>
<a name="l01681"></a>01681       locjob = mod(job,2) 
<a name="l01682"></a>01682 <span class="comment">!                                                                       </span>
<a name="l01683"></a>01683 <span class="comment">! permute rows first                                                    </span>
<a name="l01684"></a>01684 <span class="comment">!                                                                       </span>
<a name="l01685"></a>01685       call <a class="code" href="namespaceunary__mod.html#ac8cbdc4380307b940c0153271f95bf22">rperm </a>(nrow,a,ja,ia,ao,jao,iao,perm,locjob) 
<a name="l01686"></a>01686 <span class="comment">!                                                                       </span>
<a name="l01687"></a>01687 <span class="comment">! then permute columns                                                  </span>
<a name="l01688"></a>01688 <span class="comment">!                                                                       </span>
<a name="l01689"></a>01689       locjob = 0 
<a name="l01690"></a>01690 <span class="comment">!                                                                       </span>
<a name="l01691"></a>01691       <span class="keyword">if</span> (job  &lt;=  2) <span class="keyword">then</span> 
<a name="l01692"></a>01692          call <a class="code" href="namespaceunary__mod.html#a3911ae3b59ca413043b651034c4faa94">cperm </a>(nrow,ao,jao,iao,ao,jao,iao,perm,locjob) 
<a name="l01693"></a>01693       <span class="keyword">else</span> 
<a name="l01694"></a>01694          call <a class="code" href="namespaceunary__mod.html#a3911ae3b59ca413043b651034c4faa94">cperm </a>(nrow,ao,jao,iao,ao,jao,iao,qperm,locjob) 
<a name="l01695"></a>01695       <span class="keyword">endif</span> 
<a name="l01696"></a>01696 <span class="comment">!                                                                       </span>
<a name="l01697"></a>01697       return 
<a name="l01698"></a>01698 <span class="keyword">      end subroutine  dperm</span>
<a name="l01699"></a>01699 
<a name="l01700"></a>01700 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l01701"></a>01701 
<a name="l01702"></a><a class="code" href="namespaceunary__mod.html#aaf7b005b24a656894fcfb8db85b7ed63">01702</a>       <span class="keyword">subroutine </span><a class="code" href="namespaceunary__mod.html#aaf7b005b24a656894fcfb8db85b7ed63">dperm1</a> (i1,i2,a,ja,ia,b,jb,ib,perm,ipos,job) 
<a name="l01703"></a>01703       <span class="keywordtype">integer</span> ipos
<a name="l01704"></a>01704       <span class="keywordtype">integer</span> i1,i2,job,ja(*),ia(*),jb(*),ib(*),perm(*) 
<a name="l01705"></a>01705       <span class="keywordtype">real(wp)</span> a(*),b(*) 
<a name="l01706"></a>01706 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l01707"></a>01707 <span class="comment">!     general submatrix extraction routine.                             </span>
<a name="l01708"></a>01708 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l01709"></a>01709 <span class="comment">!     extracts rows perm(i1), perm(i1+1), ..., perm(i2) (in this order) </span>
<a name="l01710"></a>01710 <span class="comment">!     from a matrix (doing nothing in the column indices.) The resulting</span>
<a name="l01711"></a>01711 <span class="comment">!     submatrix is constructed in b, jb, ib. A pointer ipos to the      </span>
<a name="l01712"></a>01712 <span class="comment">!     beginning of arrays b,jb,is also allowed (i.e., nonzero elements  </span>
<a name="l01713"></a>01713 <span class="comment">!     are accumulated starting in position ipos of b, jb).              </span>
<a name="l01714"></a>01714 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l01715"></a>01715 <span class="comment">! Y. Saad,Sep. 21 1989 / recoded Jan. 28 1991 / modified for PSPARSLIB  </span>
<a name="l01716"></a>01716 <span class="comment">! Sept. 1997..                                                          </span>
<a name="l01717"></a>01717 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l01718"></a>01718 <span class="comment">! on entry:                                                             </span>
<a name="l01719"></a>01719 <span class="comment">!----------                                                             </span>
<a name="l01720"></a>01720 <span class="comment">! n         = dimension of the matrix                                   </span>
<a name="l01721"></a>01721 <span class="comment">! a,ja,                                                                 </span>
<a name="l01722"></a>01722 <span class="comment">!   ia  = input matrix in CSR format                                    </span>
<a name="l01723"></a>01723 <span class="comment">! perm         = integer array of length n containing the indices of the</span>
<a name="l01724"></a>01724 <span class="comment">!         to be extracted.                                              </span>
<a name="l01725"></a>01725 <span class="comment">!                                                                       </span>
<a name="l01726"></a>01726 <span class="comment">! job   = job indicator. if (job  /= 1) values are not copied (i.e.,    </span>
<a name="l01727"></a>01727 <span class="comment">!         only pattern is copied).                                      </span>
<a name="l01728"></a>01728 <span class="comment">!                                                                       </span>
<a name="l01729"></a>01729 <span class="comment">! on return:                                                            </span>
<a name="l01730"></a>01730 <span class="comment">!-----------                                                            </span>
<a name="l01731"></a>01731 <span class="comment">! b,ja,                                                                 </span>
<a name="l01732"></a>01732 <span class="comment">! ib   = matrix in csr format. b(ipos:ipos+nnz-1),jb(ipos:ipos+nnz-1)   </span>
<a name="l01733"></a>01733 <span class="comment">!     contain the value and column indices respectively of the nnz      </span>
<a name="l01734"></a>01734 <span class="comment">!     nonzero elements of the permuted matrix. thus ib(1)=ipos.         </span>
<a name="l01735"></a>01735 <span class="comment">!                                                                       </span>
<a name="l01736"></a>01736 <span class="comment">! Notes:                                                                </span>
<a name="l01737"></a>01737 <span class="comment">!-------                                                                </span>
<a name="l01738"></a>01738 <span class="comment">!  algorithm is NOT in place                                            </span>
<a name="l01739"></a>01739 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l01740"></a>01740 <span class="comment">! local variables                                                       </span>
<a name="l01741"></a>01741 <span class="comment">!                                                                       </span>
<a name="l01742"></a>01742       <span class="keywordtype">integer</span> ko, irow, k, i 
<a name="l01743"></a>01743       <span class="keywordtype">logical</span> values 
<a name="l01744"></a>01744 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l01745"></a>01745       values = (job  ==  1) 
<a name="l01746"></a>01746       ko = ipos 
<a name="l01747"></a>01747       ib(1) = ko 
<a name="l01748"></a>01748       <span class="keyword">do</span> 900 i=i1,i2 
<a name="l01749"></a>01749          irow = perm(i) 
<a name="l01750"></a>01750          <span class="keyword">do</span> 800 k=ia(irow),ia(irow+1)-1 
<a name="l01751"></a>01751             <span class="keyword">if</span> (values) b(ko) = a(k) 
<a name="l01752"></a>01752             jb(ko) = ja(k) 
<a name="l01753"></a>01753             ko=ko+1 
<a name="l01754"></a>01754   800    continue 
<a name="l01755"></a>01755          ib(i-i1+2) = ko 
<a name="l01756"></a>01756   900 continue 
<a name="l01757"></a>01757       return 
<a name="l01758"></a>01758 <span class="keyword">      end subroutine  dperm1</span>
<a name="l01759"></a>01759 
<a name="l01760"></a>01760 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l01761"></a>01761 
<a name="l01762"></a><a class="code" href="namespaceunary__mod.html#aaecb5f9282e584983945e8bf2a9e315f">01762</a>       <span class="keyword">subroutine </span><a class="code" href="namespaceunary__mod.html#aaecb5f9282e584983945e8bf2a9e315f">dperm2</a> (i1,i2,a,ja,ia,b,jb,ib,cperm,rperm,istart,      &amp;
<a name="l01763"></a>01763      &amp;        ipos,job)                                                 
<a name="l01764"></a>01764      <span class="keywordtype">integer</span> ipos 
<a name="l01765"></a>01765      <span class="keywordtype">integer</span> i1,i2,job,istart,ja(*),ia(*),jb(*),ib(*),cperm(*),rperm(*) 
<a name="l01766"></a>01766       <span class="keywordtype">real(wp)</span> a(*),b(*) 
<a name="l01767"></a>01767 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l01768"></a>01768 <span class="comment">!     general submatrix permutation/ extraction routine.                </span>
<a name="l01769"></a>01769 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l01770"></a>01770 <span class="comment">!     extracts rows rperm(i1), rperm(i1+1), ..., rperm(i2) and does an  </span>
<a name="l01771"></a>01771 <span class="comment">!     associated column permutation (using array cperm). The resulting  </span>
<a name="l01772"></a>01772 <span class="comment">!     submatrix is constructed in b, jb, ib. For added flexibility, the </span>
<a name="l01773"></a>01773 <span class="comment">!     extracted elements are put in sequence starting from row &apos;istart&apos; </span>
<a name="l01774"></a>01774 <span class="comment">!     of B. In addition a pointer ipos to the beginning of arrays b,jb, </span>
<a name="l01775"></a>01775 <span class="comment">!     is also allowed (i.e., nonzero elements are accumulated starting i</span>
<a name="l01776"></a>01776 <span class="comment">!     position ipos of b, jb). In most applications istart and ipos are </span>
<a name="l01777"></a>01777 <span class="comment">!     equal to one. However, the generality adds substantial flexiblity.</span>
<a name="l01778"></a>01778 <span class="comment">!     EXPLE: (1) to permute msr to msr (excluding diagonals)            </span>
<a name="l01779"></a>01779 <span class="comment">!     call dperm2 (1,n,a,ja,ja,b,jb,jb,rperm,rperm,1,n+2)               </span>
<a name="l01780"></a>01780 <span class="comment">!            (2) To extract rows 1 to 10: define rperm and cperm to be  </span>
<a name="l01781"></a>01781 <span class="comment">!     identity permutations (rperm(i)=i, i=1,n) and then                </span>
<a name="l01782"></a>01782 <span class="comment">!            call dperm2 (1,10,a,ja,ia,b,jb,ib,rperm,rperm,1,1)         </span>
<a name="l01783"></a>01783 <span class="comment">!            (3) to achieve a symmetric permutation as defined by perm: </span>
<a name="l01784"></a>01784 <span class="comment">!            call dperm2 (1,10,a,ja,ia,b,jb,ib,perm,perm,1,1)           </span>
<a name="l01785"></a>01785 <span class="comment">!            (4) to get a symmetric permutation of A and append the     </span>
<a name="l01786"></a>01786 <span class="comment">!            resulting data structure to A&apos;s data structure (useful!)   </span>
<a name="l01787"></a>01787 <span class="comment">!            call dperm2 (1,10,a,ja,ia,a,ja,ia(n+1),perm,perm,1,ia(n+1))</span>
<a name="l01788"></a>01788 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l01789"></a>01789 <span class="comment">! Y. Saad,Sep. 21 1989 / recoded Jan. 28 1991.                          </span>
<a name="l01790"></a>01790 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l01791"></a>01791 <span class="comment">! on entry:                                                             </span>
<a name="l01792"></a>01792 <span class="comment">!----------                                                             </span>
<a name="l01793"></a>01793 <span class="comment">! n         = dimension of the matrix                                   </span>
<a name="l01794"></a>01794 <span class="comment">! i1,i2 = extract rows rperm(i1) to rperm(i2) of A, with i1&lt;i2.         </span>
<a name="l01795"></a>01795 <span class="comment">!                                                                       </span>
<a name="l01796"></a>01796 <span class="comment">! a,ja,                                                                 </span>
<a name="l01797"></a>01797 <span class="comment">!   ia  = input matrix in CSR format                                    </span>
<a name="l01798"></a>01798 <span class="comment">! cperm = integer array of length n containing the permutation arrays   </span>
<a name="l01799"></a>01799 <span class="comment">!          for the columns: cperm(i) is the destination of column j,    </span>
<a name="l01800"></a>01800 <span class="comment">!         i.e., any column index ja(k) is transformed into cperm(ja(k)) </span>
<a name="l01801"></a>01801 <span class="comment">!                                                                       </span>
<a name="l01802"></a>01802 <span class="comment">! rperm        =  permutation array for the rows. rperm(i) = origin (in </span>
<a name="l01803"></a>01803 <span class="comment">!          row i in B. This is the reverse permutation relative to the  </span>
<a name="l01804"></a>01804 <span class="comment">!          ones used in routines cperm, dperm,....                      </span>
<a name="l01805"></a>01805 <span class="comment">!          rows rperm(i1), rperm(i1)+1, ... rperm(i2) are               </span>
<a name="l01806"></a>01806 <span class="comment">!          extracted from A and stacked into B, starting in row istart  </span>
<a name="l01807"></a>01807 <span class="comment">!          of B.                                                        </span>
<a name="l01808"></a>01808 <span class="comment">! istart= starting row for B where extracted matrix is to be added.     </span>
<a name="l01809"></a>01809 <span class="comment">!         this is also only a pointer of the be beginning address for   </span>
<a name="l01810"></a>01810 <span class="comment">!         ib , on return.                                               </span>
<a name="l01811"></a>01811 <span class="comment">! ipos  = beginning position in arrays b and jb where to start copying  </span>
<a name="l01812"></a>01812 <span class="comment">!         elements. Thus, ib(istart) = ipos.                            </span>
<a name="l01813"></a>01813 <span class="comment">!                                                                       </span>
<a name="l01814"></a>01814 <span class="comment">! job   = job indicator. if (job  /= 1) values are not copied (i.e.,    </span>
<a name="l01815"></a>01815 <span class="comment">!         only pattern is copied).                                      </span>
<a name="l01816"></a>01816 <span class="comment">!                                                                       </span>
<a name="l01817"></a>01817 <span class="comment">! on return:                                                            </span>
<a name="l01818"></a>01818 <span class="comment">!-----------                                                            </span>
<a name="l01819"></a>01819 <span class="comment">! b,ja,                                                                 </span>
<a name="l01820"></a>01820 <span class="comment">! ib   = matrix in csr format. positions 1,2,...,istart-1 of ib         </span>
<a name="l01821"></a>01821 <span class="comment">!     are not touched. b(ipos:ipos+nnz-1),jb(ipos:ipos+nnz-1)           </span>
<a name="l01822"></a>01822 <span class="comment">!     contain the value and column indices respectively of the nnz      </span>
<a name="l01823"></a>01823 <span class="comment">!     nonzero elements of the permuted matrix. thus ib(istart)=ipos.    </span>
<a name="l01824"></a>01824 <span class="comment">!                                                                       </span>
<a name="l01825"></a>01825 <span class="comment">! Notes:                                                                </span>
<a name="l01826"></a>01826 <span class="comment">!-------                                                                </span>
<a name="l01827"></a>01827 <span class="comment">!  1) algorithm is NOT in place                                         </span>
<a name="l01828"></a>01828 <span class="comment">!  2) column indices may not be sorted on return even  though they      </span>
<a name="l01829"></a>01829 <span class="comment">!     may be on entry.                                                  </span>
<a name="l01830"></a>01830 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l01831"></a>01831 <span class="comment">! local variables                                                       </span>
<a name="l01832"></a>01832 <span class="comment">!                                                                       </span>
<a name="l01833"></a>01833       <span class="keywordtype">integer</span> ko, irow, k, i 
<a name="l01834"></a>01834       <span class="keywordtype">logical</span> values 
<a name="l01835"></a>01835 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l01836"></a>01836       values = (job  ==  1) 
<a name="l01837"></a>01837       ko = ipos 
<a name="l01838"></a>01838       ib(istart) = ko 
<a name="l01839"></a>01839       <span class="keyword">do</span> 900 i=i1,i2 
<a name="l01840"></a>01840          irow = rperm(i) 
<a name="l01841"></a>01841          <span class="keyword">do</span> 800 k=ia(irow),ia(irow+1)-1 
<a name="l01842"></a>01842             <span class="keyword">if</span> (values) b(ko) = a(k) 
<a name="l01843"></a>01843             jb(ko) = cperm(ja(k)) 
<a name="l01844"></a>01844             ko=ko+1 
<a name="l01845"></a>01845   800    continue 
<a name="l01846"></a>01846          ib(istart+i-i1+1) = ko 
<a name="l01847"></a>01847   900 continue 
<a name="l01848"></a>01848       return 
<a name="l01849"></a>01849 <span class="keyword">      end subroutine  dperm2</span>
<a name="l01850"></a>01850 
<a name="l01851"></a>01851 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l01852"></a>01852 
<a name="l01853"></a><a class="code" href="namespaceunary__mod.html#a4d6e990ebe5d27f9b2c447d6ca9014e5">01853</a>       <span class="keyword">subroutine </span><a class="code" href="namespaceunary__mod.html#a4d6e990ebe5d27f9b2c447d6ca9014e5">dmperm</a> (nrow,a,ja,ao,jao,perm,job) 
<a name="l01854"></a>01854       <span class="keywordtype">integer</span> nrow,ja(*),jao(*),perm(nrow),job 
<a name="l01855"></a>01855       <span class="keywordtype">real(wp)</span> a(*),ao(*) 
<a name="l01856"></a>01856 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l01857"></a>01857 <span class="comment">! This routine performs a symmetric permutation of the rows and         </span>
<a name="l01858"></a>01858 <span class="comment">! columns of a matrix stored in MSR format. i.e., it computes           </span>
<a name="l01859"></a>01859 <span class="comment">! B = P A transp(P), where P, is  a permutation matrix.                 </span>
<a name="l01860"></a>01860 <span class="comment">! P maps row i into row perm(i) and column j into column perm(j):       </span>
<a name="l01861"></a>01861 <span class="comment">!      a(i,j)    becomes   a(perm(i),perm(j)) in new matrix             </span>
<a name="l01862"></a>01862 <span class="comment">! (i.e.  ao(perm(i),perm(j)) = a(i,j) )                                 </span>
<a name="l01863"></a>01863 <span class="comment">! calls dperm.                                                          </span>
<a name="l01864"></a>01864 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l01865"></a>01865 <span class="comment">! Y. Saad, Nov 15, 1991.                                                </span>
<a name="l01866"></a>01866 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l01867"></a>01867 <span class="comment">! on entry:                                                             </span>
<a name="l01868"></a>01868 <span class="comment">!----------                                                             </span>
<a name="l01869"></a>01869 <span class="comment">! n         = dimension of the matrix                                   </span>
<a name="l01870"></a>01870 <span class="comment">! a, ja = input matrix in MSR format.                                   </span>
<a name="l01871"></a>01871 <span class="comment">! perm         = integer array of length n containing the permutation ar</span>
<a name="l01872"></a>01872 <span class="comment">!          for the rows: perm(i) is the destination of row i in the     </span>
<a name="l01873"></a>01873 <span class="comment">!         permuted matrix -- also the destination of column i in case   </span>
<a name="l01874"></a>01874 <span class="comment">!         permutation is symmetric (job  &lt;=  2)                         </span>
<a name="l01875"></a>01875 <span class="comment">!                                                                       </span>
<a name="l01876"></a>01876 <span class="comment">! job        = integer indicating the work to be done:                  </span>
<a name="l01877"></a>01877 <span class="comment">!                 job = 1        permute a, ja, ia into ao, jao, iao    </span>
<a name="l01878"></a>01878 <span class="comment">!                 job = 2 permute matrix ignoring real values.          </span>
<a name="l01879"></a>01879 <span class="comment">!                                                                       </span>
<a name="l01880"></a>01880 <span class="comment">! on return:                                                            </span>
<a name="l01881"></a>01881 <span class="comment">!-----------                                                            </span>
<a name="l01882"></a>01882 <span class="comment">! ao, jao = output matrix in MSR.                                       </span>
<a name="l01883"></a>01883 <span class="comment">!                                                                       </span>
<a name="l01884"></a>01884 <span class="comment">! in case job  ==  2 a and ao are never referred to and can be dummy    </span>
<a name="l01885"></a>01885 <span class="comment">! arguments.                                                            </span>
<a name="l01886"></a>01886 <span class="comment">!                                                                       </span>
<a name="l01887"></a>01887 <span class="comment">! Notes:                                                                </span>
<a name="l01888"></a>01888 <span class="comment">!-------                                                                </span>
<a name="l01889"></a>01889 <span class="comment">!  1) algorithm is NOT in place                                         </span>
<a name="l01890"></a>01890 <span class="comment">!  2) column indices may not be sorted on return even  though they may b</span>
<a name="l01891"></a>01891 <span class="comment">!     on entry.                                                         </span>
<a name="l01892"></a>01892 <span class="comment">!----------------------------------------------------------------------c</span>
<a name="l01893"></a>01893 <span class="comment">!     local variables                                                   </span>
<a name="l01894"></a>01894 <span class="comment">!                                                                       </span>
<a name="l01895"></a>01895       <span class="keywordtype">integer</span> n1, n2, j 
<a name="l01896"></a>01896       n1 = nrow+1 
<a name="l01897"></a>01897       n2 = n1+1 
<a name="l01898"></a>01898 <span class="comment">!                                                                       </span>
<a name="l01899"></a>01899       call <a class="code" href="namespaceunary__mod.html#a8247fa4ab43954b9f840fc56fd441c23">dperm </a>(nrow,a,ja,ja,ao(n2),jao(n2),jao,perm,perm,job) 
<a name="l01900"></a>01900 <span class="comment">!                                                                       </span>
<a name="l01901"></a>01901       jao(1) = n2 
<a name="l01902"></a>01902       <span class="keyword">do</span> 101 j=1, nrow 
<a name="l01903"></a>01903          ao(perm(j)) = a(j) 
<a name="l01904"></a>01904          jao(j+1) = jao(j+1)+n1 
<a name="l01905"></a>01905   101 continue 
<a name="l01906"></a>01906       return
<a name="l01907"></a>01907 <span class="keyword">      end subroutine dmperm</span>
<a name="l01908"></a>01908 
<a name="l01909"></a>01909 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l01910"></a><a class="code" href="namespaceunary__mod.html#ae9e2b83517a1746a33ad0a5744ce5ab9">01910</a>   <span class="keyword">subroutine </span><a class="code" href="namespaceunary__mod.html#ae9e2b83517a1746a33ad0a5744ce5ab9">dvperm</a> ( n, x, perm )
<a name="l01911"></a>01911 
<a name="l01912"></a>01912   <span class="comment">!*****************************************************************************80</span>
<a name="l01913"></a>01913   <span class="comment">!</span>
<a name="l01914"></a>01914   <span class="comment">!! DVPERM performs an in-place permutation of a real vector.</span>
<a name="l01915"></a>01915   <span class="comment">!</span>
<a name="l01916"></a>01916   <span class="comment">!  Discussion:</span>
<a name="l01917"></a>01917   <span class="comment">!</span>
<a name="l01918"></a>01918   <span class="comment">!    This routine permutes a real vector X using a permutation PERM.</span>
<a name="l01919"></a>01919   <span class="comment">!</span>
<a name="l01920"></a>01920   <span class="comment">!    On return, the vector X satisfies,</span>
<a name="l01921"></a>01921   <span class="comment">!</span>
<a name="l01922"></a>01922   <span class="comment">!      x(perm(j)) :== x(j), j = 1,2,.., n</span>
<a name="l01923"></a>01923   <span class="comment">!</span>
<a name="l01924"></a>01924   <span class="comment">!  Modified:</span>
<a name="l01925"></a>01925   <span class="comment">!</span>
<a name="l01926"></a>01926   <span class="comment">!    07 January 2004</span>
<a name="l01927"></a>01927   <span class="comment">!</span>
<a name="l01928"></a>01928   <span class="comment">!  Author:</span>
<a name="l01929"></a>01929   <span class="comment">!</span>
<a name="l01930"></a>01930   <span class="comment">!    Youcef Saad</span>
<a name="l01931"></a>01931   <span class="comment">!</span>
<a name="l01932"></a>01932   <span class="comment">!  Parameters:</span>
<a name="l01933"></a>01933   <span class="comment">!</span>
<a name="l01934"></a>01934   <span class="comment">!    Input, integer ( kind = 4 ) N, the length of X.</span>
<a name="l01935"></a>01935   <span class="comment">!</span>
<a name="l01936"></a>01936   <span class="comment">!    Input/output, real X(N), the vector to be permuted.</span>
<a name="l01937"></a>01937   <span class="comment">!</span>
<a name="l01938"></a>01938   <span class="comment">!    Input, integer ( kind = 4 ) PERM(N), the permutation.</span>
<a name="l01939"></a>01939   <span class="comment">!</span>
<a name="l01940"></a>01940     <span class="keyword">implicit none</span>
<a name="l01941"></a>01941 
<a name="l01942"></a>01942     <span class="keywordtype">integer</span> :: n
<a name="l01943"></a>01943 
<a name="l01944"></a>01944     <span class="keywordtype">integer</span> :: ii
<a name="l01945"></a>01945     <span class="keywordtype">integer</span> :: init
<a name="l01946"></a>01946     <span class="keywordtype">integer</span> :: k
<a name="l01947"></a>01947     <span class="keywordtype">integer</span> :: next
<a name="l01948"></a>01948     <span class="keywordtype">integer</span> :: perm(n)
<a name="l01949"></a>01949     <span class="keywordtype">real(wp) </span>:: tmp
<a name="l01950"></a>01950     <span class="keywordtype">real(wp) </span>:: tmp1
<a name="l01951"></a>01951     <span class="keywordtype">real(wp) </span>:: x(n)
<a name="l01952"></a>01952 
<a name="l01953"></a>01953     init = 1
<a name="l01954"></a>01954     tmp = x(init)
<a name="l01955"></a>01955     ii = perm(init)
<a name="l01956"></a>01956     perm(init)= -perm(init)
<a name="l01957"></a>01957     k = 0
<a name="l01958"></a>01958   <span class="comment">!</span>
<a name="l01959"></a>01959   <span class="comment">!  The main loop.</span>
<a name="l01960"></a>01960   <span class="comment">!</span>
<a name="l01961"></a>01961    6  continue
<a name="l01962"></a>01962 
<a name="l01963"></a>01963      k = k + 1
<a name="l01964"></a>01964   <span class="comment">!</span>
<a name="l01965"></a>01965   <span class="comment">!  Save the chased element.</span>
<a name="l01966"></a>01966   <span class="comment">!</span>
<a name="l01967"></a>01967     tmp1 = x(ii)
<a name="l01968"></a>01968     x(ii) = tmp
<a name="l01969"></a>01969     next = perm(ii)
<a name="l01970"></a>01970 
<a name="l01971"></a>01971     <span class="keyword">if</span> ( next &lt; 0 ) <span class="keyword">then</span>
<a name="l01972"></a>01972       go to 65
<a name="l01973"></a>01973     <span class="keyword">end if</span>
<a name="l01974"></a>01974   <span class="comment">!</span>
<a name="l01975"></a>01975   <span class="comment">!  Test for end.</span>
<a name="l01976"></a>01976   <span class="comment">!</span>
<a name="l01977"></a>01977     <span class="keyword">if</span> ( n &lt; k ) <span class="keyword">then</span>
<a name="l01978"></a>01978       perm(1:n) = -perm(1:n)
<a name="l01979"></a>01979       return
<a name="l01980"></a>01980     <span class="keyword">end if</span>
<a name="l01981"></a>01981 
<a name="l01982"></a>01982     tmp = tmp1
<a name="l01983"></a>01983     perm(ii) = -perm(ii)
<a name="l01984"></a>01984     ii = next
<a name="l01985"></a>01985   <span class="comment">!</span>
<a name="l01986"></a>01986   <span class="comment">!  End of the loop.</span>
<a name="l01987"></a>01987   <span class="comment">!</span>
<a name="l01988"></a>01988     go to 6
<a name="l01989"></a>01989   <span class="comment">!</span>
<a name="l01990"></a>01990   <span class="comment">!  Reinitialize cycle.</span>
<a name="l01991"></a>01991   <span class="comment">!</span>
<a name="l01992"></a>01992    65   continue
<a name="l01993"></a>01993 
<a name="l01994"></a>01994     init = init + 1
<a name="l01995"></a>01995 
<a name="l01996"></a>01996     <span class="keyword">if</span> ( n &lt; init ) <span class="keyword">then</span> 
<a name="l01997"></a>01997       perm(1:n) = -perm(1:n)
<a name="l01998"></a>01998       return
<a name="l01999"></a>01999     <span class="keyword">end if</span>
<a name="l02000"></a>02000 
<a name="l02001"></a>02001     <span class="keyword">if</span> ( perm(init) &lt; 0 ) <span class="keyword">then</span>
<a name="l02002"></a>02002       go to 65
<a name="l02003"></a>02003     <span class="keyword">end if</span>
<a name="l02004"></a>02004 
<a name="l02005"></a>02005     tmp = x(init)
<a name="l02006"></a>02006     ii = perm(init)
<a name="l02007"></a>02007     perm(init) = -perm(init)
<a name="l02008"></a>02008     go to 6
<a name="l02009"></a>02009 
<a name="l02010"></a>02010 <span class="keyword">  end subroutine dvperm</span>
<a name="l02011"></a>02011 
<a name="l02012"></a>02012 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l02013"></a>02013 
<a name="l02014"></a><a class="code" href="namespaceunary__mod.html#a221b5873142df92fafad6f87e778f736">02014</a>       <span class="keyword">subroutine </span><a class="code" href="namespaceunary__mod.html#a221b5873142df92fafad6f87e778f736">ivperm</a> (n, ix, perm) 
<a name="l02015"></a>02015       <span class="keywordtype">integer</span> n, perm(n), ix(n) 
<a name="l02016"></a>02016 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l02017"></a>02017 <span class="comment">! this subroutine performs an in-place permutation of an integer vector </span>
<a name="l02018"></a>02018 <span class="comment">! ix according to the permutation array perm(*), i.e., on return,       </span>
<a name="l02019"></a>02019 <span class="comment">! the vector x satisfies,                                               </span>
<a name="l02020"></a>02020 <span class="comment">!                                                                       </span>
<a name="l02021"></a>02021 <span class="comment">!        ix(perm(j)) :== ix(j), j=1,2,.., n                             </span>
<a name="l02022"></a>02022 <span class="comment">!                                                                       </span>
<a name="l02023"></a>02023 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l02024"></a>02024 <span class="comment">! on entry:                                                             </span>
<a name="l02025"></a>02025 <span class="comment">!---------                                                              </span>
<a name="l02026"></a>02026 <span class="comment">! n         = length of vector x.                                       </span>
<a name="l02027"></a>02027 <span class="comment">! perm         = integer array of length n containing the permutation  a</span>
<a name="l02028"></a>02028 <span class="comment">! ix        = input vector                                              </span>
<a name="l02029"></a>02029 <span class="comment">!                                                                       </span>
<a name="l02030"></a>02030 <span class="comment">! on return:                                                            </span>
<a name="l02031"></a>02031 <span class="comment">!----------                                                             </span>
<a name="l02032"></a>02032 <span class="comment">! ix        = vector x permuted according to ix(perm(*)) :=  ix(*)      </span>
<a name="l02033"></a>02033 <span class="comment">!                                                                       </span>
<a name="l02034"></a>02034 <span class="comment">!----------------------------------------------------------------------c</span>
<a name="l02035"></a>02035 <span class="comment">!           Y. Saad, Sep. 21 1989                                      c</span>
<a name="l02036"></a>02036 <span class="comment">!----------------------------------------------------------------------c</span>
<a name="l02037"></a>02037 <span class="comment">! local variables                                                       </span>
<a name="l02038"></a>02038       <span class="keywordtype">integer</span> tmp, tmp1, ii, init, j, k, next 
<a name="l02039"></a>02039 <span class="comment">!                                                                       </span>
<a name="l02040"></a>02040       init      = 1 
<a name="l02041"></a>02041       tmp        = ix(init) 
<a name="l02042"></a>02042       ii        = perm(init) 
<a name="l02043"></a>02043       perm(init)= -perm(init) 
<a name="l02044"></a>02044       k         = 0 
<a name="l02045"></a>02045 <span class="comment">!                                                                       </span>
<a name="l02046"></a>02046 <span class="comment">! loop                                                                  </span>
<a name="l02047"></a>02047 <span class="comment">!                                                                       </span>
<a name="l02048"></a>02048     6 k = k+1 
<a name="l02049"></a>02049 <span class="comment">!                                                                       </span>
<a name="l02050"></a>02050 <span class="comment">! save the chased element --                                            </span>
<a name="l02051"></a>02051 <span class="comment">!                                                                       </span>
<a name="l02052"></a>02052       tmp1          = ix(ii) 
<a name="l02053"></a>02053       ix(ii)     = tmp 
<a name="l02054"></a>02054       next          = perm(ii) 
<a name="l02055"></a>02055       <span class="keyword">if</span> (next  &lt;  0 ) goto 65 
<a name="l02056"></a>02056 <span class="comment">!                                                                       </span>
<a name="l02057"></a>02057 <span class="comment">! test for end                                                          </span>
<a name="l02058"></a>02058 <span class="comment">!                                                                       </span>
<a name="l02059"></a>02059       <span class="keyword">if</span> (k  &gt;  n) goto 101 
<a name="l02060"></a>02060       tmp       = tmp1 
<a name="l02061"></a>02061       perm(ii)  = - perm(ii) 
<a name="l02062"></a>02062       ii        = next 
<a name="l02063"></a>02063 <span class="comment">!                                                                       </span>
<a name="l02064"></a>02064 <span class="comment">! end loop                                                              </span>
<a name="l02065"></a>02065 <span class="comment">!                                                                       </span>
<a name="l02066"></a>02066       goto 6 
<a name="l02067"></a>02067 <span class="comment">!                                                                       </span>
<a name="l02068"></a>02068 <span class="comment">! reinitilaize cycle --                                                 </span>
<a name="l02069"></a>02069 <span class="comment">!                                                                       </span>
<a name="l02070"></a>02070    65 init      = init+1 
<a name="l02071"></a>02071       <span class="keyword">if</span> (init  &gt;  n) goto 101 
<a name="l02072"></a>02072       <span class="keyword">if</span> (perm(init)  &lt;  0) goto 65 
<a name="l02073"></a>02073       tmp        = ix(init) 
<a name="l02074"></a>02074       ii        = perm(init) 
<a name="l02075"></a>02075       perm(init)=-perm(init) 
<a name="l02076"></a>02076       goto 6 
<a name="l02077"></a>02077 <span class="comment">!                                                                       </span>
<a name="l02078"></a>02078   101 continue 
<a name="l02079"></a>02079       <span class="keyword">do</span> 200 j=1, n 
<a name="l02080"></a>02080          perm(j) = -perm(j) 
<a name="l02081"></a>02081   200 continue 
<a name="l02082"></a>02082 <span class="comment">!                                                                       </span>
<a name="l02083"></a>02083       return 
<a name="l02084"></a>02084 <span class="keyword">      end subroutine  ivperm</span>
<a name="l02085"></a>02085 
<a name="l02086"></a>02086 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l02087"></a>02087 
<a name="l02088"></a><a class="code" href="namespaceunary__mod.html#a7f6ca3c3deea36531409c5aee05f9168">02088</a>       <span class="keyword">subroutine </span><a class="code" href="namespaceunary__mod.html#a7f6ca3c3deea36531409c5aee05f9168">retmx</a> (n,a,ja,ia,dd) 
<a name="l02089"></a>02089       <span class="keywordtype">real(wp)</span> a(*),dd(*) 
<a name="l02090"></a>02090       <span class="keywordtype">integer</span> n,ia(*),ja(*) 
<a name="l02091"></a>02091 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l02092"></a>02092 <span class="comment">! returns in dd(*) the max absolute value of elements in row *.         </span>
<a name="l02093"></a>02093 <span class="comment">! used for scaling purposes. superseded by rnrms  .                     </span>
<a name="l02094"></a>02094 <span class="comment">!                                                                       </span>
<a name="l02095"></a>02095 <span class="comment">! on entry:                                                             </span>
<a name="l02096"></a>02096 <span class="comment">! n        = dimension of A                                             </span>
<a name="l02097"></a>02097 <span class="comment">! a,ja,ia                                                               </span>
<a name="l02098"></a>02098 <span class="comment">!        = matrix stored in compressed sparse row format                </span>
<a name="l02099"></a>02099 <span class="comment">! dd        = real(wp) array of length n. On output,entry dd(i) contains  </span>
<a name="l02100"></a>02100 <span class="comment">!          the element of row i that has the largest absolute value.    </span>
<a name="l02101"></a>02101 <span class="comment">!          Moreover the sign of dd is modified such that it is the      </span>
<a name="l02102"></a>02102 <span class="comment">!          same as that of the diagonal element in row i.               </span>
<a name="l02103"></a>02103 <span class="comment">!----------------------------------------------------------------------c</span>
<a name="l02104"></a>02104 <span class="comment">!           Y. Saad, Sep. 21 1989                                      c</span>
<a name="l02105"></a>02105 <span class="comment">!----------------------------------------------------------------------c</span>
<a name="l02106"></a>02106 <span class="comment">! local variables                                                       </span>
<a name="l02107"></a>02107       <span class="keywordtype">integer</span> k2, i, k1, k 
<a name="l02108"></a>02108       <span class="keywordtype">real(wp)</span> t, t1, t2
<a name="l02109"></a>02109 
<a name="l02110"></a>02110       t = 0.0_wp
<a name="l02111"></a>02111       t1 = 0.0_wp
<a name="l02112"></a>02112       t2 = 0.0_wp
<a name="l02113"></a>02113 <span class="comment">!                                                                       </span>
<a name="l02114"></a>02114 <span class="comment">! initialize                                                            </span>
<a name="l02115"></a>02115 <span class="comment">!                                                                       </span>
<a name="l02116"></a>02116       k2 = 1 
<a name="l02117"></a>02117       <span class="keyword">do</span> 11 i=1,n 
<a name="l02118"></a>02118          k1 = k2 
<a name="l02119"></a>02119          k2 = ia(i+1) - 1 
<a name="l02120"></a>02120          t = 0.0d0 
<a name="l02121"></a>02121          <span class="keyword">do</span> 101  k=k1,k2 
<a name="l02122"></a>02122             t1 = abs(a(k)) 
<a name="l02123"></a>02123             <span class="keyword">if</span> (t1  &gt;  t) t = t1 
<a name="l02124"></a>02124             <span class="keyword">if</span> (ja(k)  ==  i) <span class="keyword">then</span> 
<a name="l02125"></a>02125                <span class="keyword">if</span> (a(k)  &gt;=  0.0) <span class="keyword">then</span> 
<a name="l02126"></a>02126                   t2 = a(k) 
<a name="l02127"></a>02127                <span class="keyword">else</span> 
<a name="l02128"></a>02128                   t2 = - a(k) 
<a name="l02129"></a>02129                <span class="keyword">endif</span> 
<a name="l02130"></a>02130             <span class="keyword">endif</span> 
<a name="l02131"></a>02131   101    continue 
<a name="l02132"></a>02132          dd(i) =  t2*t 
<a name="l02133"></a>02133 <span class="comment">!     we do not invert diag                                             </span>
<a name="l02134"></a>02134    11 continue 
<a name="l02135"></a>02135       return 
<a name="l02136"></a>02136 <span class="keyword">      end subroutine  retmx</span>
<a name="l02137"></a>02137 
<a name="l02138"></a>02138 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l02139"></a>02139 
<a name="l02140"></a><a class="code" href="namespaceunary__mod.html#a26d9a8ea570451619e73d58120350141">02140</a>       <span class="keyword">subroutine </span><a class="code" href="namespaceunary__mod.html#a26d9a8ea570451619e73d58120350141">diapos</a>  (n,ja,ia,idiag) 
<a name="l02141"></a>02141       <span class="keywordtype">integer</span> n
<a name="l02142"></a>02142       <span class="keywordtype">integer</span> ia(n+1), ja(*), idiag(n) 
<a name="l02143"></a>02143 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l02144"></a>02144 <span class="comment">! this subroutine returns the positions of the diagonal elements of a   </span>
<a name="l02145"></a>02145 <span class="comment">! sparse matrix a, ja, ia, in the array idiag.                          </span>
<a name="l02146"></a>02146 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l02147"></a>02147 <span class="comment">! on entry:                                                             </span>
<a name="l02148"></a>02148 <span class="comment">!----------                                                             </span>
<a name="l02149"></a>02149 <span class="comment">!                                                                       </span>
<a name="l02150"></a>02150 <span class="comment">! n        = integer. row dimension of the matrix a.                    </span>
<a name="l02151"></a>02151 <span class="comment">! a,ja,                                                                 </span>
<a name="l02152"></a>02152 <span class="comment">!    ia = matrix stored compressed sparse row format. a array skipped.  </span>
<a name="l02153"></a>02153 <span class="comment">!                                                                       </span>
<a name="l02154"></a>02154 <span class="comment">! on return:                                                            </span>
<a name="l02155"></a>02155 <span class="comment">!-----------                                                            </span>
<a name="l02156"></a>02156 <span class="comment">! idiag  = integer array of length n. The i-th entry of idiag           </span>
<a name="l02157"></a>02157 <span class="comment">!          points to the diagonal element a(i,i) in the arrays          </span>
<a name="l02158"></a>02158 <span class="comment">!          a, ja. (i.e., a(idiag(i)) = element A(i,i) of matrix A)      </span>
<a name="l02159"></a>02159 <span class="comment">!          if no diagonal element is found the entry is set to 0.       </span>
<a name="l02160"></a>02160 <span class="comment">!----------------------------------------------------------------------c</span>
<a name="l02161"></a>02161 <span class="comment">!           Y. Saad, March, 1990                                        </span>
<a name="l02162"></a>02162 <span class="comment">!----------------------------------------------------------------------c</span>
<a name="l02163"></a>02163       <span class="keywordtype">integer</span> i, k
<a name="l02164"></a>02164 
<a name="l02165"></a>02165       <span class="keyword">do</span> 1 i=1, n 
<a name="l02166"></a>02166          idiag(i) = 0 
<a name="l02167"></a>02167     1 continue 
<a name="l02168"></a>02168 <span class="comment">!                                                                       </span>
<a name="l02169"></a>02169 <span class="comment">!     sweep through data structure.                                     </span>
<a name="l02170"></a>02170 <span class="comment">!                                                                       </span>
<a name="l02171"></a>02171       <span class="keyword">do</span>  6 i=1,n 
<a name="l02172"></a>02172          <span class="keyword">do</span> 51 k= ia(i),ia(i+1) -1 
<a name="l02173"></a>02173             <span class="keyword">if</span> (ja(k)  ==  i) idiag(i) = k 
<a name="l02174"></a>02174    51    continue 
<a name="l02175"></a>02175     6 continue 
<a name="l02176"></a>02176       return 
<a name="l02177"></a>02177 <span class="keyword">      end subroutine  diapos</span>
<a name="l02178"></a>02178 
<a name="l02179"></a>02179 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l02180"></a>02180 
<a name="l02181"></a><a class="code" href="namespaceunary__mod.html#a24760c698002fe9eae23504626783f69">02181</a>       <span class="keyword">subroutine </span><a class="code" href="namespaceunary__mod.html#a24760c698002fe9eae23504626783f69">dscaldg</a> (n,a,ja,ia,diag,job) 
<a name="l02182"></a>02182       <span class="keywordtype">integer</span> n, job
<a name="l02183"></a>02183       <span class="keywordtype">real(wp)</span> a(*), diag(*),t 
<a name="l02184"></a>02184       <span class="keywordtype">integer</span> ia(*),ja(*) 
<a name="l02185"></a>02185 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l02186"></a>02186 <span class="comment">! scales rows by diag where diag is either given (job=0)                </span>
<a name="l02187"></a>02187 <span class="comment">! or to be computed:                                                    </span>
<a name="l02188"></a>02188 <span class="comment">!  job = 1 ,scale row i by  by  +/- max |a(i,j) | and put inverse of    </span>
<a name="l02189"></a>02189 <span class="comment">!       scaling factor in diag(i),where +/- is the sign of a(i,i).      </span>
<a name="l02190"></a>02190 <span class="comment">!  job = 2 scale by 2-norm of each row..                                </span>
<a name="l02191"></a>02191 <span class="comment">! if diag(i) = 0,then diag(i) is replaced by one                        </span>
<a name="l02192"></a>02192 <span class="comment">! (no scaling)..                                                        </span>
<a name="l02193"></a>02193 <span class="comment">!----------------------------------------------------------------------c</span>
<a name="l02194"></a>02194 <span class="comment">!           Y. Saad, Sep. 21 1989                                      c</span>
<a name="l02195"></a>02195 <span class="comment">!----------------------------------------------------------------------c</span>
<a name="l02196"></a>02196       <span class="keywordtype">integer</span> i, j, k, k1, k2
<a name="l02197"></a>02197 
<a name="l02198"></a>02198       goto (12,11,10) job+1 
<a name="l02199"></a>02199    10 <span class="keyword">do</span> 110 j=1,n 
<a name="l02200"></a>02200          k1= ia(j) 
<a name="l02201"></a>02201          k2 = ia(j+1)-1 
<a name="l02202"></a>02202          t = 0.0d0 
<a name="l02203"></a>02203          <span class="keyword">do</span> 111 k = k1,k2 
<a name="l02204"></a>02204   111       t = t+a(k)*a(k) 
<a name="l02205"></a>02205   110       diag(j) = sqrt(t) 
<a name="l02206"></a>02206             goto 12 
<a name="l02207"></a>02207    11 continue 
<a name="l02208"></a>02208       call <a class="code" href="namespaceunary__mod.html#a7f6ca3c3deea36531409c5aee05f9168">retmx </a>(n,a,ja,ia,diag) 
<a name="l02209"></a>02209 <span class="comment">!------                                                                 </span>
<a name="l02210"></a>02210    12 <span class="keyword">do</span> 1 j=1,n 
<a name="l02211"></a>02211          <span class="keyword">if</span> (diag(j)  /=  0.0d0) <span class="keyword">then</span> 
<a name="l02212"></a>02212             diag(j) = 1.0d0/diag(j) 
<a name="l02213"></a>02213          <span class="keyword">else</span> 
<a name="l02214"></a>02214             diag(j) = 1.0d0 
<a name="l02215"></a>02215          <span class="keyword">endif</span> 
<a name="l02216"></a>02216     1 continue 
<a name="l02217"></a>02217       <span class="keyword">do</span> 2 i=1,n 
<a name="l02218"></a>02218          t = diag(i) 
<a name="l02219"></a>02219          <span class="keyword">do</span> 21 k=ia(i),ia(i+1) -1 
<a name="l02220"></a>02220             a(k) = a(k)*t 
<a name="l02221"></a>02221    21    continue 
<a name="l02222"></a>02222     2 continue 
<a name="l02223"></a>02223       return 
<a name="l02224"></a>02224 <span class="keyword">      end subroutine  dscaldg</span>
<a name="l02225"></a>02225 
<a name="l02226"></a>02226 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l02227"></a>02227 
<a name="l02228"></a><a class="code" href="namespaceunary__mod.html#a2f5b821c17de5f87fdbf599af530dd32">02228</a>       <span class="keyword">subroutine </span><a class="code" href="namespaceunary__mod.html#a2f5b821c17de5f87fdbf599af530dd32">extbdg</a> (n,a,ja,ia,bdiag,nblk,ao,jao,iao) 
<a name="l02229"></a>02229       implicit <span class="keywordtype">real(wp) </span>(a-h,o-z) 
<a name="l02230"></a>02230       <span class="keywordtype">integer</span> n, nblk
<a name="l02231"></a>02231       <span class="keywordtype">real(wp)</span> bdiag(*),a(*),ao(*) 
<a name="l02232"></a>02232       <span class="keywordtype">integer</span> ia(*),ja(*),jao(*),iao(*) 
<a name="l02233"></a>02233 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l02234"></a>02234 <span class="comment">! this subroutine extracts the main diagonal blocks of a                </span>
<a name="l02235"></a>02235 <span class="comment">! matrix stored in compressed sparse row format and puts the result     </span>
<a name="l02236"></a>02236 <span class="comment">! into the array bdiag and the remainder in ao,jao,iao.                 </span>
<a name="l02237"></a>02237 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l02238"></a>02238 <span class="comment">! on entry:                                                             </span>
<a name="l02239"></a>02239 <span class="comment">!----------                                                             </span>
<a name="l02240"></a>02240 <span class="comment">! n        = integer. The row dimension of the matrix a.                </span>
<a name="l02241"></a>02241 <span class="comment">! a,                                                                    </span>
<a name="l02242"></a>02242 <span class="comment">! ja,                                                                   </span>
<a name="l02243"></a>02243 <span class="comment">! ia    = matrix stored in csr format                                   </span>
<a name="l02244"></a>02244 <span class="comment">! nblk  = dimension of each diagonal block. The diagonal blocks are     </span>
<a name="l02245"></a>02245 <span class="comment">!         stored in compressed format rowwise,i.e.,we store in          </span>
<a name="l02246"></a>02246 <span class="comment">!          succession the i nonzeros of the i-th row after those of     </span>
<a name="l02247"></a>02247 <span class="comment">!          row number i-1..                                             </span>
<a name="l02248"></a>02248 <span class="comment">!                                                                       </span>
<a name="l02249"></a>02249 <span class="comment">! on return:                                                            </span>
<a name="l02250"></a>02250 <span class="comment">!----------                                                             </span>
<a name="l02251"></a>02251 <span class="comment">! bdiag = real(wp) array of size (n x nblk) containing the diagonal       </span>
<a name="l02252"></a>02252 <span class="comment">!          blocks of A on return                                        </span>
<a name="l02253"></a>02253 <span class="comment">! ao,                                                                   </span>
<a name="l02254"></a>02254 <span class="comment">! jao,                                                                  </span>
<a name="l02255"></a>02255 <span class="comment">! iao   = remainder of the matrix stored in csr format.                 </span>
<a name="l02256"></a>02256 <span class="comment">!----------------------------------------------------------------------c</span>
<a name="l02257"></a>02257 <span class="comment">!           Y. Saad, Sep. 21 1989                                      c</span>
<a name="l02258"></a>02258 <span class="comment">!----------------------------------------------------------------------c</span>
<a name="l02259"></a>02259       <span class="keywordtype">integer</span> i, j, j1, j2, jj, k, kb, ko, l, ltr, m 
<a name="l02260"></a>02260 
<a name="l02261"></a>02261       m = 1 + (n-1)/nblk 
<a name="l02262"></a>02262 <span class="comment">! this version is sequential -- there is a more parallel version        </span>
<a name="l02263"></a>02263 <span class="comment">! that goes through the structure twice ....                            </span>
<a name="l02264"></a>02264       ltr =  ((nblk-1)*nblk)/2 
<a name="l02265"></a>02265       l = m * ltr 
<a name="l02266"></a>02266       <span class="keyword">do</span> 1 i=1,l 
<a name="l02267"></a>02267          bdiag(i) = 0.0d0 
<a name="l02268"></a>02268     1 continue 
<a name="l02269"></a>02269       ko = 0 
<a name="l02270"></a>02270       kb = 1 
<a name="l02271"></a>02271       iao(1) = 1 
<a name="l02272"></a>02272 <span class="comment">!-------------------------                                              </span>
<a name="l02273"></a>02273       <span class="keyword">do</span> 11 jj = 1,m 
<a name="l02274"></a>02274          j1 = (jj-1)*nblk+1 
<a name="l02275"></a>02275          j2 =  min0 (n,j1+nblk-1) 
<a name="l02276"></a>02276          <span class="keyword">do</span> 12 j=j1,j2 
<a name="l02277"></a>02277             <span class="keyword">do</span> 13 i=ia(j),ia(j+1) -1 
<a name="l02278"></a>02278                k = ja(i) 
<a name="l02279"></a>02279                <span class="keyword">if</span> (k  &lt;  j1) <span class="keyword">then</span> 
<a name="l02280"></a>02280                   ko = ko+1 
<a name="l02281"></a>02281                   ao(ko) = a(i) 
<a name="l02282"></a>02282                   jao(ko) = k 
<a name="l02283"></a>02283                <span class="keyword">else</span> <span class="keyword">if</span> (k  &lt;  j) <span class="keyword">then</span> 
<a name="l02284"></a>02284 <span class="comment">!     kb = (jj-1)*ltr+((j-j1)*(j-j1-1))/2+k-j1+1                        </span>
<a name="l02285"></a>02285 <span class="comment">!     bdiag(kb) = a(i)                                                  </span>
<a name="l02286"></a>02286                   bdiag(kb+k-j1) = a(i) 
<a name="l02287"></a>02287                <span class="keyword">endif</span> 
<a name="l02288"></a>02288    13       continue 
<a name="l02289"></a>02289             kb = kb + j-j1 
<a name="l02290"></a>02290             iao(j+1) = ko+1 
<a name="l02291"></a>02291    12    continue 
<a name="l02292"></a>02292    11 continue 
<a name="l02293"></a>02293       return 
<a name="l02294"></a>02294 <span class="keyword">      end subroutine  extbdg</span>
<a name="l02295"></a>02295 
<a name="l02296"></a>02296 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l02297"></a>02297 
<a name="l02298"></a><a class="code" href="namespaceunary__mod.html#af032fc78ab7048f7af4f92dd3ee728a2">02298</a>       <span class="keyword">subroutine </span><a class="code" href="namespaceunary__mod.html#af032fc78ab7048f7af4f92dd3ee728a2">getbwd</a>(n,a,ja,ia,ml,mu) 
<a name="l02299"></a>02299 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l02300"></a>02300 <span class="comment">! gets the bandwidth of lower part and upper part of A.                 </span>
<a name="l02301"></a>02301 <span class="comment">! does not assume that A is sorted.                                     </span>
<a name="l02302"></a>02302 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l02303"></a>02303 <span class="comment">! on entry:                                                             </span>
<a name="l02304"></a>02304 <span class="comment">!----------                                                             </span>
<a name="l02305"></a>02305 <span class="comment">! n        = integer = the row dimension of the matrix                  </span>
<a name="l02306"></a>02306 <span class="comment">! a, ja,                                                                </span>
<a name="l02307"></a>02307 <span class="comment">!    ia = matrix in compressed sparse row format.                       </span>
<a name="l02308"></a>02308 <span class="comment">!                                                                       </span>
<a name="l02309"></a>02309 <span class="comment">! on return:                                                            </span>
<a name="l02310"></a>02310 <span class="comment">!-----------                                                            </span>
<a name="l02311"></a>02311 <span class="comment">! ml        = integer. The bandwidth of the strict lower part of A      </span>
<a name="l02312"></a>02312 <span class="comment">! mu        = integer. The bandwidth of the strict upper part of A      </span>
<a name="l02313"></a>02313 <span class="comment">!                                                                       </span>
<a name="l02314"></a>02314 <span class="comment">! Notes:                                                                </span>
<a name="l02315"></a>02315 <span class="comment">! ===== ml and mu are allowed to be negative or return. This may be     </span>
<a name="l02316"></a>02316 <span class="comment">!       useful since it will tell us whether a band is confined         </span>
<a name="l02317"></a>02317 <span class="comment">!       in the strict  upper/lower triangular part.                     </span>
<a name="l02318"></a>02318 <span class="comment">!       indeed the definitions of ml and mu are                         </span>
<a name="l02319"></a>02319 <span class="comment">!                                                                       </span>
<a name="l02320"></a>02320 <span class="comment">!       ml = max ( (i-j)  s.t. a(i,j)  /=  0  )                         </span>
<a name="l02321"></a>02321 <span class="comment">!       mu = max ( (j-i)  s.t. a(i,j)  /=  0  )                         </span>
<a name="l02322"></a>02322 <span class="comment">!----------------------------------------------------------------------c</span>
<a name="l02323"></a>02323 <span class="comment">! Y. Saad, Sep. 21 1989                                                c</span>
<a name="l02324"></a>02324 <span class="comment">!----------------------------------------------------------------------c</span>
<a name="l02325"></a>02325       <span class="keywordtype">integer</span> n 
<a name="l02326"></a>02326       <span class="keywordtype">real(wp)</span> a(*) 
<a name="l02327"></a>02327       <span class="keywordtype">integer</span> ja(*),ia(n+1),ml,mu,ldist,i,k 
<a name="l02328"></a>02328       ml = - n 
<a name="l02329"></a>02329       mu = - n 
<a name="l02330"></a>02330       <span class="keyword">do</span> 3 i=1,n 
<a name="l02331"></a>02331          <span class="keyword">do</span> 31 k=ia(i),ia(i+1)-1 
<a name="l02332"></a>02332             ldist = i-ja(k) 
<a name="l02333"></a>02333             ml = max(ml,ldist) 
<a name="l02334"></a>02334             mu = max(mu,-ldist) 
<a name="l02335"></a>02335    31    continue 
<a name="l02336"></a>02336     3 continue 
<a name="l02337"></a>02337       return 
<a name="l02338"></a>02338 <span class="keyword">      end subroutine  getbwd</span>
<a name="l02339"></a>02339 
<a name="l02340"></a>02340 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l02341"></a>02341 
<a name="l02342"></a><a class="code" href="namespaceunary__mod.html#a71dd5530cc0ce5c94197446231229434">02342</a>       <span class="keyword">subroutine </span><a class="code" href="namespaceunary__mod.html#a71dd5530cc0ce5c94197446231229434">blkfnd</a> (nrow,ja,ia,nblk) 
<a name="l02343"></a>02343 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l02344"></a>02344 <span class="comment">! This routine attemptps to determine whether or not  the input         </span>
<a name="l02345"></a>02345 <span class="comment">! matrix has a block structure and finds the blocks size                </span>
<a name="l02346"></a>02346 <span class="comment">! if it does. A block matrix is one which is                            </span>
<a name="l02347"></a>02347 <span class="comment">! comprised of small square dense blocks. If there are zero             </span>
<a name="l02348"></a>02348 <span class="comment">! elements within the square blocks and the original data structure     </span>
<a name="l02349"></a>02349 <span class="comment">! takes these zeros into account then blkchk may fail to find the       </span>
<a name="l02350"></a>02350 <span class="comment">! correct block size.                                                   </span>
<a name="l02351"></a>02351 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l02352"></a>02352 <span class="comment">! on entry                                                              </span>
<a name="l02353"></a>02353 <span class="comment">!---------                                                              </span>
<a name="l02354"></a>02354 <span class="comment">! nrow        = integer equal to the row dimension of the matrix.       </span>
<a name="l02355"></a>02355 <span class="comment">! ja    = integer array containing the column indices of the entries    </span>
<a name="l02356"></a>02356 <span class="comment">!         nonzero entries of the matrix stored by row.                  </span>
<a name="l02357"></a>02357 <span class="comment">! ia    = integer array of length nrow + 1 containing the pointers      </span>
<a name="l02358"></a>02358 <span class="comment">!         beginning of each row in array ja.                            </span>
<a name="l02359"></a>02359 <span class="comment">!                                                                       </span>
<a name="l02360"></a>02360 <span class="comment">! nblk  = integer containing the assumed value of nblk if job = 0       </span>
<a name="l02361"></a>02361 <span class="comment">!                                                                       </span>
<a name="l02362"></a>02362 <span class="comment">! on return                                                             </span>
<a name="l02363"></a>02363 <span class="comment">!----------                                                             </span>
<a name="l02364"></a>02364 <span class="comment">! nblk  = integer containing the value found for nblk when job = 1.     </span>
<a name="l02365"></a>02365 <span class="comment">!         if imsg  /=  0 this value is meaningless however.             </span>
<a name="l02366"></a>02366 <span class="comment">!                                                                       </span>
<a name="l02367"></a>02367 <span class="comment">!----------------------------------------------------------------------c</span>
<a name="l02368"></a>02368 <span class="comment">!           Y. Saad, Sep. 21 1989                                      c</span>
<a name="l02369"></a>02369 <span class="comment">!----------------------------------------------------------------------c</span>
<a name="l02370"></a>02370       <span class="keywordtype">integer</span> nrow, nblk
<a name="l02371"></a>02371       <span class="keywordtype">integer</span> ia(nrow+1),ja(*) 
<a name="l02372"></a>02372 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l02373"></a>02373 <span class="comment">! first part of code will find candidate block sizes.                   </span>
<a name="l02374"></a>02374 <span class="comment">! criterion used here is a simple one: scan rows and  determine groups  </span>
<a name="l02375"></a>02375 <span class="comment">! of rows that have the same length and such that the first column      </span>
<a name="l02376"></a>02376 <span class="comment">! number and the last column number are identical.                      </span>
<a name="l02377"></a>02377 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l02378"></a>02378       <span class="keywordtype">integer</span> i, i1, i2, iblk, imsg, irow, jf, jl, jlast, jfirst, jrow, len, 
<a name="l02379"></a>02379              len0, minlen
<a name="l02380"></a>02380 
<a name="l02381"></a>02381       minlen = ia(2)-ia(1) 
<a name="l02382"></a>02382       irow   = 1 
<a name="l02383"></a>02383       <span class="keyword">do</span> 1 i=2,nrow 
<a name="l02384"></a>02384          len = ia(i+1)-ia(i) 
<a name="l02385"></a>02385          <span class="keyword">if</span> (len  &lt;  minlen) <span class="keyword">then</span> 
<a name="l02386"></a>02386             minlen = len 
<a name="l02387"></a>02387             irow = i 
<a name="l02388"></a>02388          <span class="keyword">endif</span> 
<a name="l02389"></a>02389     1 continue 
<a name="l02390"></a>02390 <span class="comment">!                                                                       </span>
<a name="l02391"></a>02391 <span class="comment">!     ---- candidates are all dividers of minlen                        </span>
<a name="l02392"></a>02392 <span class="comment">!                                                                       </span>
<a name="l02393"></a>02393       nblk = 1 
<a name="l02394"></a>02394       <span class="keyword">if</span> (minlen  &lt;=  1) return 
<a name="l02395"></a>02395 <span class="comment">!                                                                       </span>
<a name="l02396"></a>02396       <span class="keyword">do</span> 99 iblk = minlen, 1, -1 
<a name="l02397"></a>02397          <span class="keyword">if</span> (mod(minlen,iblk)  /=  0) goto 99 
<a name="l02398"></a>02398          len = ia(2) - ia(1) 
<a name="l02399"></a>02399          len0 = len 
<a name="l02400"></a>02400          jfirst = ja(1) 
<a name="l02401"></a>02401          jlast = ja(ia(2)-1) 
<a name="l02402"></a>02402          <span class="keyword">do</span> 10 jrow = irow+1,irow+nblk-1 
<a name="l02403"></a>02403             i1 = ia(jrow) 
<a name="l02404"></a>02404             i2 = ia(jrow+1)-1 
<a name="l02405"></a>02405             len = i2+1-i1 
<a name="l02406"></a>02406             jf = ja(i1) 
<a name="l02407"></a>02407             jl = ja(i2) 
<a name="l02408"></a>02408             <span class="keyword">if</span> (len  /=  len0 .or. jf  /=  jfirst .or.                  &amp;
<a name="l02409"></a>02409      &amp;           jl  /=  jlast) goto 99                                 
<a name="l02410"></a>02410    10    continue 
<a name="l02411"></a>02411 <span class="comment">!                                                                       </span>
<a name="l02412"></a>02412 <span class="comment">!     check for this candidate ----                                     </span>
<a name="l02413"></a>02413 <span class="comment">!                                                                       </span>
<a name="l02414"></a>02414          call <a class="code" href="namespaceunary__mod.html#a94e8849a8382568d6114ac4e7b24a19c">blkchk </a>(nrow,ja,ia,iblk,imsg) 
<a name="l02415"></a>02415          <span class="keyword">if</span> (imsg  ==  0) <span class="keyword">then</span> 
<a name="l02416"></a>02416 <span class="comment">!                                                                       </span>
<a name="l02417"></a>02417 <span class="comment">!     block size found                                                  </span>
<a name="l02418"></a>02418 <span class="comment">!                                                                       </span>
<a name="l02419"></a>02419             nblk = iblk 
<a name="l02420"></a>02420             return 
<a name="l02421"></a>02421          <span class="keyword">endif</span> 
<a name="l02422"></a>02422    99 continue 
<a name="l02423"></a>02423 <span class="keyword">      end subroutine  blkfnd</span>
<a name="l02424"></a>02424 
<a name="l02425"></a>02425 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l02426"></a>02426 
<a name="l02427"></a><a class="code" href="namespaceunary__mod.html#a94e8849a8382568d6114ac4e7b24a19c">02427</a>       <span class="keyword">subroutine </span><a class="code" href="namespaceunary__mod.html#a94e8849a8382568d6114ac4e7b24a19c">blkchk</a> (nrow,ja,ia,nblk,imsg) 
<a name="l02428"></a>02428 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l02429"></a>02429 <span class="comment">! This routine checks whether the input matrix is a block               </span>
<a name="l02430"></a>02430 <span class="comment">! matrix with block size of nblk. A block matrix is one which is        </span>
<a name="l02431"></a>02431 <span class="comment">! comprised of small square dense blocks. If there are zero             </span>
<a name="l02432"></a>02432 <span class="comment">! elements within the square blocks and the data structure              </span>
<a name="l02433"></a>02433 <span class="comment">! takes them into account then blkchk may fail to find the              </span>
<a name="l02434"></a>02434 <span class="comment">! correct block size.                                                   </span>
<a name="l02435"></a>02435 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l02436"></a>02436 <span class="comment">! on entry                                                              </span>
<a name="l02437"></a>02437 <span class="comment">!---------                                                              </span>
<a name="l02438"></a>02438 <span class="comment">! nrow        = integer equal to the row dimension of the matrix.       </span>
<a name="l02439"></a>02439 <span class="comment">! ja    = integer array containing the column indices of the entries    </span>
<a name="l02440"></a>02440 <span class="comment">!         nonzero entries of the matrix stored by row.                  </span>
<a name="l02441"></a>02441 <span class="comment">! ia    = integer array of length nrow + 1 containing the pointers      </span>
<a name="l02442"></a>02442 <span class="comment">!         beginning of each row in array ja.                            </span>
<a name="l02443"></a>02443 <span class="comment">!                                                                       </span>
<a name="l02444"></a>02444 <span class="comment">! nblk  = integer containing the value of nblk to be checked.           </span>
<a name="l02445"></a>02445 <span class="comment">!                                                                       </span>
<a name="l02446"></a>02446 <span class="comment">! on return                                                             </span>
<a name="l02447"></a>02447 <span class="comment">!----------                                                             </span>
<a name="l02448"></a>02448 <span class="comment">!                                                                       </span>
<a name="l02449"></a>02449 <span class="comment">! imsg  = integer containing a message  with the following meaning.     </span>
<a name="l02450"></a>02450 <span class="comment">!          imsg = 0 means that the output value of nblk is a correct    </span>
<a name="l02451"></a>02451 <span class="comment">!                   block size. nblk  &lt;  0 means nblk not correct      </span>
<a name="l02452"></a>02452 <span class="comment">!                   block size.                                         </span>
<a name="l02453"></a>02453 <span class="comment">!          imsg = -1 : nblk does not divide nrow                        </span>
<a name="l02454"></a>02454 <span class="comment">!          imsg = -2 : a starting element in a row is at wrong position </span>
<a name="l02455"></a>02455 <span class="comment">!             (j  /=  mult*nblk +1 )                                    </span>
<a name="l02456"></a>02456 <span class="comment">!          imsg = -3 : nblk does divide a row length -                  </span>
<a name="l02457"></a>02457 <span class="comment">!          imsg = -4 : an element is isolated outside a block or        </span>
<a name="l02458"></a>02458 <span class="comment">!             two rows in same group have different lengths             </span>
<a name="l02459"></a>02459 <span class="comment">!----------------------------------------------------------------------c</span>
<a name="l02460"></a>02460 <span class="comment">!           Y. Saad, Sep. 21 1989                                      c</span>
<a name="l02461"></a>02461 <span class="comment">!----------------------------------------------------------------------c</span>
<a name="l02462"></a>02462       <span class="keywordtype">integer</span> nrow, nblk, imsg
<a name="l02463"></a>02463       <span class="keywordtype">integer</span> ia(nrow+1),ja(*) 
<a name="l02464"></a>02464 <span class="comment">!---------------------------------------------------------------------- </span>
<a name="l02465"></a>02465 <span class="comment">! first part of code will find candidate block sizes.                   </span>
<a name="l02466"></a>02466 <span class="comment">! this is not guaranteed to work . so a check is done at the end        </span>
<a name="l02467"></a>02467 <span class="comment">! the criterion used here is a simple one:                              </span>
<a name="l02468"></a>02468 <span class="comment">! scan rows and determine groups of rows that have the same length      </span>
<a name="l02469"></a>02469 <span class="comment">! and such that the first column number and the last column number      </span>
<a name="l02470"></a>02470 <span class="comment">! are identical.                                                        </span>
<a name="l02471"></a>02471 <span class="comment">!---------------------------------------------------------------------- </span>
<a name="l02472"></a>02472       <span class="keywordtype">integer</span> i, i1, ii, irow, j, j2, jstart, k, len, lena, nr
<a name="l02473"></a>02473 
<a name="l02474"></a>02474       imsg = 0 
<a name="l02475"></a>02475       <span class="keyword">if</span> (nblk  &lt;=  1) return 
<a name="l02476"></a>02476       nr = nrow/nblk 
<a name="l02477"></a>02477       <span class="keyword">if</span> (nr*nblk  /=  nrow) goto 101 
<a name="l02478"></a>02478 <span class="comment">!--   main loop --------------------------------------------------------</span>
<a name="l02479"></a>02479       irow = 1 
<a name="l02480"></a>02480       <span class="keyword">do</span> 20 ii=1, nr 
<a name="l02481"></a>02481 <span class="comment">!     i1= starting position for group of nblk rows in original matrix   </span>
<a name="l02482"></a>02482          i1 = ia(irow) 
<a name="l02483"></a>02483          j2 = i1 
<a name="l02484"></a>02484 <span class="comment">!     lena = length of each row in that group  in the original matrix   </span>
<a name="l02485"></a>02485          lena = ia(irow+1)-i1 
<a name="l02486"></a>02486 <span class="comment">!     len = length of each block-row in that group in the output matrix </span>
<a name="l02487"></a>02487          len = lena/nblk 
<a name="l02488"></a>02488          <span class="keyword">if</span> (len* nblk  /=  lena) goto 103 
<a name="l02489"></a>02489 <span class="comment">!                                                                       </span>
<a name="l02490"></a>02490 <span class="comment">!     for each row                                                      </span>
<a name="l02491"></a>02491 <span class="comment">!                                                                       </span>
<a name="l02492"></a>02492          <span class="keyword">do</span> 6 i = 1, nblk 
<a name="l02493"></a>02493             irow = irow + 1 
<a name="l02494"></a>02494             <span class="keyword">if</span> (ia(irow)-ia(irow-1)  /=  lena ) goto 104 
<a name="l02495"></a>02495 <span class="comment">!                                                                       </span>
<a name="l02496"></a>02496 <span class="comment">!     for each block                                                    </span>
<a name="l02497"></a>02497 <span class="comment">!                                                                       </span>
<a name="l02498"></a>02498             <span class="keyword">do</span> 7 k=0, len-1 
<a name="l02499"></a>02499                jstart = ja(i1+nblk*k)-1 
<a name="l02500"></a>02500                <span class="keyword">if</span> ( (jstart/nblk)*nblk  /=  jstart) goto 102 
<a name="l02501"></a>02501 <span class="comment">!                                                                       </span>
<a name="l02502"></a>02502 <span class="comment">!     for each column                                                   </span>
<a name="l02503"></a>02503 <span class="comment">!                                                                       </span>
<a name="l02504"></a>02504                <span class="keyword">do</span> 5 j=1, nblk 
<a name="l02505"></a>02505                   <span class="keyword">if</span> (jstart+j  /=  ja(j2) )  goto 104 
<a name="l02506"></a>02506                   j2 = j2+1 
<a name="l02507"></a>02507     5          continue 
<a name="l02508"></a>02508     7       continue 
<a name="l02509"></a>02509     6    continue 
<a name="l02510"></a>02510    20 continue 
<a name="l02511"></a>02511 <span class="comment">!     went through all loops successfully:                              </span>
<a name="l02512"></a>02512       return 
<a name="l02513"></a>02513   101 imsg = -1 
<a name="l02514"></a>02514       return 
<a name="l02515"></a>02515   102 imsg = -2 
<a name="l02516"></a>02516       return 
<a name="l02517"></a>02517   103 imsg = -3 
<a name="l02518"></a>02518       return 
<a name="l02519"></a>02519   104 imsg = -4 
<a name="l02520"></a>02520       return 
<a name="l02521"></a>02521 <span class="keyword">      end subroutine  blkchk</span>
<a name="l02522"></a>02522 
<a name="l02523"></a>02523 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l02524"></a>02524 
<a name="l02525"></a><a class="code" href="namespaceunary__mod.html#aea51dde72eeb852381d58caaaba70961">02525</a>       <span class="keyword">subroutine </span><a class="code" href="namespaceunary__mod.html#aea51dde72eeb852381d58caaaba70961">infdia</a> (n,ja,ia,ind,idiag) 
<a name="l02526"></a>02526       <span class="keywordtype">integer</span> n, idiag
<a name="l02527"></a>02527       <span class="keywordtype">integer</span> ia(*), ind(*), ja(*) 
<a name="l02528"></a>02528 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l02529"></a>02529 <span class="comment">!     obtains information on the diagonals of A.                        </span>
<a name="l02530"></a>02530 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l02531"></a>02531 <span class="comment">! this subroutine finds the lengths of each of the 2*n-1 diagonals of A </span>
<a name="l02532"></a>02532 <span class="comment">! it also outputs the number of nonzero diagonals found.                </span>
<a name="l02533"></a>02533 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l02534"></a>02534 <span class="comment">! on entry:                                                             </span>
<a name="l02535"></a>02535 <span class="comment">!----------                                                             </span>
<a name="l02536"></a>02536 <span class="comment">! n        = dimension of the matrix a.                                 </span>
<a name="l02537"></a>02537 <span class="comment">!                                                                       </span>
<a name="l02538"></a>02538 <span class="comment">! a,    ..... not needed here.                                          </span>
<a name="l02539"></a>02539 <span class="comment">! ja,                                                                   </span>
<a name="l02540"></a>02540 <span class="comment">! ia    = matrix stored in csr format                                   </span>
<a name="l02541"></a>02541 <span class="comment">!                                                                       </span>
<a name="l02542"></a>02542 <span class="comment">! on return:                                                            </span>
<a name="l02543"></a>02543 <span class="comment">!-----------                                                            </span>
<a name="l02544"></a>02544 <span class="comment">!                                                                       </span>
<a name="l02545"></a>02545 <span class="comment">! idiag = integer. number of nonzero diagonals found.                   </span>
<a name="l02546"></a>02546 <span class="comment">!                                                                       </span>
<a name="l02547"></a>02547 <span class="comment">! ind   = integer array of length at least 2*n-1. The k-th entry in     </span>
<a name="l02548"></a>02548 <span class="comment">!         ind contains the number of nonzero elements in the diagonal   </span>
<a name="l02549"></a>02549 <span class="comment">!         number k, the numbering beeing from the lowermost diagonal    </span>
<a name="l02550"></a>02550 <span class="comment">!         (bottom-left). In other words ind(k) = length of diagonal     </span>
<a name="l02551"></a>02551 <span class="comment">!         whose offset wrt the main diagonal is = - n + k.              </span>
<a name="l02552"></a>02552 <span class="comment">!----------------------------------------------------------------------c</span>
<a name="l02553"></a>02553 <span class="comment">!           Y. Saad, Sep. 21 1989                                      c</span>
<a name="l02554"></a>02554 <span class="comment">!----------------------------------------------------------------------c</span>
<a name="l02555"></a>02555       <span class="keywordtype">integer</span> i, j, k, n2      
<a name="l02556"></a>02556 
<a name="l02557"></a>02557       n2= n+n-1 
<a name="l02558"></a>02558       <span class="keyword">do</span> 1 i=1,n2 
<a name="l02559"></a>02559          ind(i) = 0 
<a name="l02560"></a>02560     1 continue 
<a name="l02561"></a>02561       <span class="keyword">do</span> 3 i=1, n 
<a name="l02562"></a>02562          <span class="keyword">do</span> 2 k=ia(i),ia(i+1)-1 
<a name="l02563"></a>02563             j = ja(k) 
<a name="l02564"></a>02564             ind(n+j-i) = ind(n+j-i) +1 
<a name="l02565"></a>02565     2    continue 
<a name="l02566"></a>02566     3 continue 
<a name="l02567"></a>02567 <span class="comment">!     count the nonzero ones.                                           </span>
<a name="l02568"></a>02568       idiag = 0 
<a name="l02569"></a>02569       <span class="keyword">do</span> 41 k=1, n2 
<a name="l02570"></a>02570          <span class="keyword">if</span> (ind(k)  /=  0) idiag = idiag+1 
<a name="l02571"></a>02571    41 continue 
<a name="l02572"></a>02572       return 
<a name="l02573"></a>02573 <span class="keyword">      end subroutine  infdia</span>
<a name="l02574"></a>02574 
<a name="l02575"></a>02575 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l02576"></a>02576 
<a name="l02577"></a><a class="code" href="namespaceunary__mod.html#a94eff567ff346c4ab17791a55d513945">02577</a>   <span class="keyword">subroutine </span><a class="code" href="namespaceunary__mod.html#a94eff567ff346c4ab17791a55d513945">amubdg</a> ( nrow, ncol, ncolb, ja, ia, jb, ib, ndegr, nnz, iw )
<a name="l02578"></a>02578 
<a name="l02579"></a>02579   <span class="comment">!*****************************************************************************80</span>
<a name="l02580"></a>02580   <span class="comment">!</span>
<a name="l02581"></a>02581   <span class="comment">!! AMUBDG gets the number of nonzero elements in each row of A * B.</span>
<a name="l02582"></a>02582   <span class="comment">!</span>
<a name="l02583"></a>02583   <span class="comment">!  Discussion:</span>
<a name="l02584"></a>02584   <span class="comment">!</span>
<a name="l02585"></a>02585   <span class="comment">!    The routine also computes the total number of nonzero elements in A * B.</span>
<a name="l02586"></a>02586   <span class="comment">!</span>
<a name="l02587"></a>02587   <span class="comment">!    Method: A&apos; * A = sum [over i = 1, nrow]  a(i)^T a(i)</span>
<a name="l02588"></a>02588   <span class="comment">!    where a(i) = i-th row of  A.  We must be careful not to add  the</span>
<a name="l02589"></a>02589   <span class="comment">!    elements already accounted for.</span>
<a name="l02590"></a>02590   <span class="comment">!</span>
<a name="l02591"></a>02591   <span class="comment">!  Modified:</span>
<a name="l02592"></a>02592   <span class="comment">!</span>
<a name="l02593"></a>02593   <span class="comment">!    07 January 2004</span>
<a name="l02594"></a>02594   <span class="comment">!</span>
<a name="l02595"></a>02595   <span class="comment">!  Author:</span>
<a name="l02596"></a>02596   <span class="comment">!</span>
<a name="l02597"></a>02597   <span class="comment">!    Youcef Saad</span>
<a name="l02598"></a>02598   <span class="comment">!</span>
<a name="l02599"></a>02599   <span class="comment">!  Parameters:</span>
<a name="l02600"></a>02600   <span class="comment">!</span>
<a name="l02601"></a>02601   <span class="comment">!    Input, integer ( kind = 4 ) NROW, the row dimension of the matrix A.</span>
<a name="l02602"></a>02602   <span class="comment">!</span>
<a name="l02603"></a>02603   <span class="comment">!    Input, integer ( kind = 4 ) NCOL, the column dimension of the matrix A,</span>
<a name="l02604"></a>02604   <span class="comment">!    (and the row dimension of B).</span>
<a name="l02605"></a>02605   <span class="comment">!</span>
<a name="l02606"></a>02606   <span class="comment">!    Input, integer ( kind = 4 ) NCOLB, the column dimension of the matrix B.</span>
<a name="l02607"></a>02607   <span class="comment">!</span>
<a name="l02608"></a>02608   <span class="comment">!    Input, ja, ia= row structure of input matrix A: ja = column indices of</span>
<a name="l02609"></a>02609   <span class="comment">!    the nonzero elements of A stored by rows.</span>
<a name="l02610"></a>02610   <span class="comment">!    ia = pointer to beginning of each row in ja.</span>
<a name="l02611"></a>02611   <span class="comment">!</span>
<a name="l02612"></a>02612   <span class="comment">!    Input, jb, ib, the row structure of input matrix B: jb = column indices of</span>
<a name="l02613"></a>02613   <span class="comment">!    the nonzero elements of A stored by rows.</span>
<a name="l02614"></a>02614   <span class="comment">!    ib is a pointer to beginning of each row in jb.</span>
<a name="l02615"></a>02615   <span class="comment">!</span>
<a name="l02616"></a>02616   <span class="comment">!    Output, integer ( kind = 4 ) NDEGR(NROW), contains the degrees (the number</span>
<a name="l02617"></a>02617   <span class="comment">!    of nonzeros in each row of the matrix A * B.</span>
<a name="l02618"></a>02618   <span class="comment">!</span>
<a name="l02619"></a>02619   <span class="comment">!    Output, integer ( kind = 4 ) NNZ, the number of nonzero elements </span>
<a name="l02620"></a>02620   <span class="comment">!    found in A * B.</span>
<a name="l02621"></a>02621   <span class="comment">!</span>
<a name="l02622"></a>02622   <span class="comment">!    Workspace, integer ( kind = 4 ) IW(NCOLB).</span>
<a name="l02623"></a>02623   <span class="comment">!</span>
<a name="l02624"></a>02624     <span class="keyword">implicit none</span>
<a name="l02625"></a>02625 
<a name="l02626"></a>02626     <span class="keywordtype">integer</span> :: ncol
<a name="l02627"></a>02627     <span class="keywordtype">integer</span> :: ncolb
<a name="l02628"></a>02628     <span class="keywordtype">integer</span> :: nrow
<a name="l02629"></a>02629 
<a name="l02630"></a>02630     <span class="keywordtype">integer</span> :: ia(nrow+1)
<a name="l02631"></a>02631     <span class="keywordtype">integer</span> :: ib(ncol+1)
<a name="l02632"></a>02632     <span class="keywordtype">integer</span> :: ii
<a name="l02633"></a>02633     <span class="keywordtype">integer</span> :: iw(ncolb)
<a name="l02634"></a>02634     <span class="keywordtype">integer</span> :: j
<a name="l02635"></a>02635     <span class="keywordtype">integer</span> :: ja(*)
<a name="l02636"></a>02636     <span class="keywordtype">integer</span> :: jb(*)
<a name="l02637"></a>02637     <span class="keywordtype">integer</span> :: jc
<a name="l02638"></a>02638     <span class="keywordtype">integer</span> :: jr
<a name="l02639"></a>02639     <span class="keywordtype">integer</span> :: k
<a name="l02640"></a>02640     <span class="keywordtype">integer</span> :: last
<a name="l02641"></a>02641     <span class="keywordtype">integer</span> :: ldg
<a name="l02642"></a>02642     <span class="keywordtype">integer</span> :: ndegr(nrow)
<a name="l02643"></a>02643     <span class="keywordtype">integer</span> :: nnz
<a name="l02644"></a>02644 
<a name="l02645"></a>02645     iw(1:ncolb) = 0
<a name="l02646"></a>02646     ndegr(1:nrow) = 0
<a name="l02647"></a>02647 
<a name="l02648"></a>02648     <span class="keyword">do</span> ii = 1, nrow
<a name="l02649"></a>02649   <span class="comment">!</span>
<a name="l02650"></a>02650   <span class="comment">!  For each row of A.</span>
<a name="l02651"></a>02651   <span class="comment">!</span>
<a name="l02652"></a>02652       ldg = 0
<a name="l02653"></a>02653   <span class="comment">!</span>
<a name="l02654"></a>02654   <span class="comment">!  End-of-linked list.</span>
<a name="l02655"></a>02655   <span class="comment">!</span>
<a name="l02656"></a>02656       last = -1
<a name="l02657"></a>02657 
<a name="l02658"></a>02658       <span class="keyword">do</span> j = ia(ii), ia(ii+1)-1
<a name="l02659"></a>02659   <span class="comment">!</span>
<a name="l02660"></a>02660   <span class="comment">!  Row number to be added.</span>
<a name="l02661"></a>02661   <span class="comment">!</span>
<a name="l02662"></a>02662           jr = ja(j)
<a name="l02663"></a>02663 
<a name="l02664"></a>02664           <span class="keyword">do</span> k = ib(jr), ib(jr+1)-1
<a name="l02665"></a>02665              jc = jb(k)
<a name="l02666"></a>02666   <span class="comment">!</span>
<a name="l02667"></a>02667   <span class="comment">!  Add one element to the linked list.</span>
<a name="l02668"></a>02668   <span class="comment">!</span>
<a name="l02669"></a>02669              <span class="keyword">if</span> ( iw(jc) == 0 ) <span class="keyword">then</span>
<a name="l02670"></a>02670                 ldg = ldg + 1
<a name="l02671"></a>02671                 iw(jc) = last
<a name="l02672"></a>02672                 last = jc
<a name="l02673"></a>02673              <span class="keyword">end if</span>
<a name="l02674"></a>02674 
<a name="l02675"></a>02675            <span class="keyword">end do</span>
<a name="l02676"></a>02676 
<a name="l02677"></a>02677       <span class="keyword">end do</span>
<a name="l02678"></a>02678 
<a name="l02679"></a>02679       ndegr(ii) = ldg
<a name="l02680"></a>02680   <span class="comment">!</span>
<a name="l02681"></a>02681   <span class="comment">!  Reset IW to zero.</span>
<a name="l02682"></a>02682   <span class="comment">!</span>
<a name="l02683"></a>02683       <span class="keyword">do</span> k = 1, ldg
<a name="l02684"></a>02684         j = iw(last)
<a name="l02685"></a>02685         iw(last) = 0
<a name="l02686"></a>02686         last = j
<a name="l02687"></a>02687        <span class="keyword">end do</span>
<a name="l02688"></a>02688 
<a name="l02689"></a>02689     <span class="keyword">end do</span>
<a name="l02690"></a>02690 
<a name="l02691"></a>02691     nnz = sum ( ndegr(1:nrow) )
<a name="l02692"></a>02692 
<a name="l02693"></a>02693     return
<a name="l02694"></a>02694 <span class="keyword">  end subroutine amubdg</span>
<a name="l02695"></a>02695 
<a name="l02696"></a>02696 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l02697"></a><a class="code" href="namespaceunary__mod.html#a7125e985b907bc5ba0787bdf69cea281">02697</a>   <span class="keyword">subroutine </span><a class="code" href="namespaceunary__mod.html#a7125e985b907bc5ba0787bdf69cea281">aplbdg</a> ( nrow, ncol, ja, ia, jb, ib, ndegr, nnz, iw )
<a name="l02698"></a>02698 
<a name="l02699"></a>02699   <span class="comment">!*****************************************************************************80</span>
<a name="l02700"></a>02700   <span class="comment">!</span>
<a name="l02701"></a>02701   <span class="comment">!! APLBDG gets the number of nonzero elements in each row of A + B.</span>
<a name="l02702"></a>02702   <span class="comment">!</span>
<a name="l02703"></a>02703   <span class="comment">!  Discussion:</span>
<a name="l02704"></a>02704   <span class="comment">!</span>
<a name="l02705"></a>02705   <span class="comment">!    It also reports the total number of nonzero elements in A + B.</span>
<a name="l02706"></a>02706   <span class="comment">!</span>
<a name="l02707"></a>02707   <span class="comment">!  Modified:</span>
<a name="l02708"></a>02708   <span class="comment">!</span>
<a name="l02709"></a>02709   <span class="comment">!    07 January 2004</span>
<a name="l02710"></a>02710   <span class="comment">!</span>
<a name="l02711"></a>02711   <span class="comment">!  Author:</span>
<a name="l02712"></a>02712   <span class="comment">!</span>
<a name="l02713"></a>02713   <span class="comment">!    Youcef Saad</span>
<a name="l02714"></a>02714   <span class="comment">!</span>
<a name="l02715"></a>02715   <span class="comment">!  Parameters:</span>
<a name="l02716"></a>02716   <span class="comment">!</span>
<a name="l02717"></a>02717   <span class="comment">!    Input, integer ( kind = 4 ) NROW, the row dimension of A and B.</span>
<a name="l02718"></a>02718   <span class="comment">!</span>
<a name="l02719"></a>02719   <span class="comment">!    Input, integer ( kind = 4 ) NCOL, the column dimension of A and B.</span>
<a name="l02720"></a>02720   <span class="comment">!</span>
<a name="l02721"></a>02721   <span class="comment">!    Input, real A(*), integer ( kind = 4 ) JA(*), IA(NROW+1), the matrix in CSR</span>
<a name="l02722"></a>02722   <span class="comment">!    Compressed Sparse Row format.</span>
<a name="l02723"></a>02723   <span class="comment">!</span>
<a name="l02724"></a>02724   <span class="comment">!    Input, b, jb, ib, matrix B in compressed sparse row format.</span>
<a name="l02725"></a>02725   <span class="comment">!</span>
<a name="l02726"></a>02726   <span class="comment">!    Output, integer ( kind = 4 ) NDEGR(NROW), the number of nonzeros in each row </span>
<a name="l02727"></a>02727   <span class="comment">!    of the matrix A + B.</span>
<a name="l02728"></a>02728   <span class="comment">!</span>
<a name="l02729"></a>02729   <span class="comment">!    Output, integer ( kind = 4 ) NNZ, the total number of nonzero elements found </span>
<a name="l02730"></a>02730   <span class="comment">!    in A + B.</span>
<a name="l02731"></a>02731   <span class="comment">!</span>
<a name="l02732"></a>02732   <span class="comment">!    Workspace, integer ( kind = 4 ) IW(NCOL).</span>
<a name="l02733"></a>02733   <span class="comment">!</span>
<a name="l02734"></a>02734     <span class="keyword">implicit none</span>
<a name="l02735"></a>02735 
<a name="l02736"></a>02736     <span class="keywordtype">integer</span> :: ncol
<a name="l02737"></a>02737     <span class="keywordtype">integer</span> :: nrow
<a name="l02738"></a>02738 
<a name="l02739"></a>02739     <span class="keywordtype">integer</span> :: ia(nrow+1)
<a name="l02740"></a>02740     <span class="keywordtype">integer</span> :: ib(nrow+1)
<a name="l02741"></a>02741     <span class="keywordtype">integer</span> :: ii
<a name="l02742"></a>02742     <span class="keywordtype">integer</span> :: iw(ncol)
<a name="l02743"></a>02743     <span class="keywordtype">integer</span> :: j
<a name="l02744"></a>02744     <span class="keywordtype">integer</span> :: ja(*)
<a name="l02745"></a>02745     <span class="keywordtype">integer</span> :: jb(*)
<a name="l02746"></a>02746     <span class="keywordtype">integer</span> :: jc
<a name="l02747"></a>02747     <span class="keywordtype">integer</span> :: jr
<a name="l02748"></a>02748     <span class="keywordtype">integer</span> :: k
<a name="l02749"></a>02749     <span class="keywordtype">integer</span> :: last
<a name="l02750"></a>02750     <span class="keywordtype">integer</span> :: ldg
<a name="l02751"></a>02751     <span class="keywordtype">integer</span> :: ndegr(nrow)
<a name="l02752"></a>02752     <span class="keywordtype">integer</span> :: nnz
<a name="l02753"></a>02753 
<a name="l02754"></a>02754     iw(1:ncol) = 0
<a name="l02755"></a>02755 
<a name="l02756"></a>02756     ndegr(1:nrow) = 0
<a name="l02757"></a>02757 
<a name="l02758"></a>02758     <span class="keyword">do</span> ii = 1, nrow
<a name="l02759"></a>02759 
<a name="l02760"></a>02760        ldg = 0
<a name="l02761"></a>02761   <span class="comment">!</span>
<a name="l02762"></a>02762   <span class="comment">!  End-of-linked list.</span>
<a name="l02763"></a>02763   <span class="comment">!</span>
<a name="l02764"></a>02764        last = -1
<a name="l02765"></a>02765   <span class="comment">!</span>
<a name="l02766"></a>02766   <span class="comment">!  Row of A.</span>
<a name="l02767"></a>02767   <span class="comment">!</span>
<a name="l02768"></a>02768        <span class="keyword">do</span> j = ia(ii), ia(ii+1)-1
<a name="l02769"></a>02769           jr = ja(j)
<a name="l02770"></a>02770   <span class="comment">!</span>
<a name="l02771"></a>02771   <span class="comment">!  Add element to the linked list.</span>
<a name="l02772"></a>02772   <span class="comment">!</span>
<a name="l02773"></a>02773           ldg = ldg + 1
<a name="l02774"></a>02774           iw(jr) = last
<a name="l02775"></a>02775           last = jr
<a name="l02776"></a>02776        <span class="keyword">end do</span>
<a name="l02777"></a>02777   <span class="comment">!</span>
<a name="l02778"></a>02778   <span class="comment">!  Row of B.</span>
<a name="l02779"></a>02779   <span class="comment">!</span>
<a name="l02780"></a>02780        <span class="keyword">do</span> j = ib(ii), ib(ii+1)-1
<a name="l02781"></a>02781 
<a name="l02782"></a>02782           jc = jb(j)
<a name="l02783"></a>02783   <span class="comment">!</span>
<a name="l02784"></a>02784   <span class="comment">!  Add one element to the linked list.</span>
<a name="l02785"></a>02785   <span class="comment">!</span>
<a name="l02786"></a>02786           <span class="keyword">if</span> ( iw(jc) == 0 ) <span class="keyword">then</span>
<a name="l02787"></a>02787              ldg = ldg + 1
<a name="l02788"></a>02788              iw(jc) = last
<a name="l02789"></a>02789              last = jc
<a name="l02790"></a>02790           <span class="keyword">end if</span>
<a name="l02791"></a>02791 
<a name="l02792"></a>02792        <span class="keyword">end do</span>
<a name="l02793"></a>02793   <span class="comment">!</span>
<a name="l02794"></a>02794   <span class="comment">!  Done with row II.</span>
<a name="l02795"></a>02795   <span class="comment">!</span>
<a name="l02796"></a>02796        ndegr(ii) = ldg
<a name="l02797"></a>02797   <span class="comment">!</span>
<a name="l02798"></a>02798   <span class="comment">!  Reset IW to zero.</span>
<a name="l02799"></a>02799   <span class="comment">!</span>
<a name="l02800"></a>02800        <span class="keyword">do</span> k = 1, ldg
<a name="l02801"></a>02801           j = iw(last)
<a name="l02802"></a>02802           iw(last) = 0
<a name="l02803"></a>02803           last = j
<a name="l02804"></a>02804        <span class="keyword">end do</span>
<a name="l02805"></a>02805 
<a name="l02806"></a>02806     <span class="keyword">end do</span>
<a name="l02807"></a>02807 
<a name="l02808"></a>02808     nnz = sum ( ndegr(1:nrow) )
<a name="l02809"></a>02809 
<a name="l02810"></a>02810     return
<a name="l02811"></a>02811 <span class="keyword">  end subroutine aplbdg</span>
<a name="l02812"></a>02812 
<a name="l02813"></a>02813 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l02814"></a>02814 
<a name="l02815"></a><a class="code" href="namespaceunary__mod.html#a4a28396a33a2df91bedc9c664c8aae4d">02815</a>       <span class="keyword">subroutine </span><a class="code" href="namespaceunary__mod.html#a4a28396a33a2df91bedc9c664c8aae4d">rnrms</a>   (nrow, nrm, a, ja, ia, diag) 
<a name="l02816"></a>02816       <span class="keywordtype">integer</span> nrow, nrm
<a name="l02817"></a>02817       <span class="keywordtype">real(wp)</span> a(*), diag(nrow), scal 
<a name="l02818"></a>02818       <span class="keywordtype">integer</span> ja(*), ia(nrow+1) 
<a name="l02819"></a>02819 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l02820"></a>02820 <span class="comment">! gets the norms of each row of A. (choice of three norms)              </span>
<a name="l02821"></a>02821 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l02822"></a>02822 <span class="comment">! on entry:                                                             </span>
<a name="l02823"></a>02823 <span class="comment">! ---------                                                             </span>
<a name="l02824"></a>02824 <span class="comment">! nrow        = integer. The row dimension of A                         </span>
<a name="l02825"></a>02825 <span class="comment">!                                                                       </span>
<a name="l02826"></a>02826 <span class="comment">! nrm   = integer. norm indicator. nrm = 1, means 1-norm, nrm =2        </span>
<a name="l02827"></a>02827 <span class="comment">!                  means the 2-nrm, nrm = 0 means max norm              </span>
<a name="l02828"></a>02828 <span class="comment">!                                                                       </span>
<a name="l02829"></a>02829 <span class="comment">! a,                                                                    </span>
<a name="l02830"></a>02830 <span class="comment">! ja,                                                                   </span>
<a name="l02831"></a>02831 <span class="comment">! ia   = Matrix A in compressed sparse row format.                      </span>
<a name="l02832"></a>02832 <span class="comment">!                                                                       </span>
<a name="l02833"></a>02833 <span class="comment">! on return:                                                            </span>
<a name="l02834"></a>02834 <span class="comment">!----------                                                             </span>
<a name="l02835"></a>02835 <span class="comment">!                                                                       </span>
<a name="l02836"></a>02836 <span class="comment">! diag = real vector of length nrow containing the norms                </span>
<a name="l02837"></a>02837 <span class="comment">!                                                                       </span>
<a name="l02838"></a>02838 <span class="comment">!-----------------------------------------------------------------      </span>
<a name="l02839"></a>02839       <span class="keywordtype">integer</span> ii, k, k1, k2      
<a name="l02840"></a>02840 
<a name="l02841"></a>02841       <span class="keyword">do</span> 1 ii=1,nrow 
<a name="l02842"></a>02842 <span class="comment">!                                                                       </span>
<a name="l02843"></a>02843 <span class="comment">!     compute the norm if each element.                                 </span>
<a name="l02844"></a>02844 <span class="comment">!                                                                       </span>
<a name="l02845"></a>02845          scal = 0.0d0 
<a name="l02846"></a>02846          k1 = ia(ii) 
<a name="l02847"></a>02847          k2 = ia(ii+1)-1 
<a name="l02848"></a>02848          <span class="keyword">if</span> (nrm  ==  0) <span class="keyword">then</span> 
<a name="l02849"></a>02849             <span class="keyword">do</span> 2 k=k1, k2 
<a name="l02850"></a>02850                scal = max(scal,abs(a(k) ) ) 
<a name="l02851"></a>02851     2       continue 
<a name="l02852"></a>02852          elseif (nrm  ==  1) <span class="keyword">then</span> 
<a name="l02853"></a>02853             <span class="keyword">do</span> 3 k=k1, k2 
<a name="l02854"></a>02854                scal = scal + abs(a(k) ) 
<a name="l02855"></a>02855     3       continue 
<a name="l02856"></a>02856          <span class="keyword">else</span> 
<a name="l02857"></a>02857             <span class="keyword">do</span> 4 k=k1, k2 
<a name="l02858"></a>02858                scal = scal+a(k)**2 
<a name="l02859"></a>02859     4       continue 
<a name="l02860"></a>02860          <span class="keyword">endif</span> 
<a name="l02861"></a>02861          <span class="keyword">if</span> (nrm  ==  2) scal = sqrt(scal) 
<a name="l02862"></a>02862          diag(ii) = scal 
<a name="l02863"></a>02863     1 continue 
<a name="l02864"></a>02864       return 
<a name="l02865"></a>02865 <span class="keyword">      end subroutine  rnrms</span>
<a name="l02866"></a>02866 
<a name="l02867"></a>02867 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l02868"></a>02868 
<a name="l02869"></a><a class="code" href="namespaceunary__mod.html#a26f0b8306f9202771207b2d2ad2a5645">02869</a>       <span class="keyword">subroutine </span><a class="code" href="namespaceunary__mod.html#a26f0b8306f9202771207b2d2ad2a5645">cnrms</a>   (nrow, nrm, a, ja, ia, diag) 
<a name="l02870"></a>02870       <span class="keywordtype">integer</span> nrow, nrm
<a name="l02871"></a>02871       <span class="keywordtype">real(wp)</span> a(*), diag(nrow) 
<a name="l02872"></a>02872       <span class="keywordtype">integer</span> ja(*), ia(nrow+1) 
<a name="l02873"></a>02873 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l02874"></a>02874 <span class="comment">! gets the norms of each column of A. (choice of three norms)           </span>
<a name="l02875"></a>02875 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l02876"></a>02876 <span class="comment">! on entry:                                                             </span>
<a name="l02877"></a>02877 <span class="comment">! ---------                                                             </span>
<a name="l02878"></a>02878 <span class="comment">! nrow        = integer. The row dimension of A                         </span>
<a name="l02879"></a>02879 <span class="comment">!                                                                       </span>
<a name="l02880"></a>02880 <span class="comment">! nrm   = integer. norm indicator. nrm = 1, means 1-norm, nrm =2        </span>
<a name="l02881"></a>02881 <span class="comment">!                  means the 2-nrm, nrm = 0 means max norm              </span>
<a name="l02882"></a>02882 <span class="comment">!                                                                       </span>
<a name="l02883"></a>02883 <span class="comment">! a,                                                                    </span>
<a name="l02884"></a>02884 <span class="comment">! ja,                                                                   </span>
<a name="l02885"></a>02885 <span class="comment">! ia   = Matrix A in compressed sparse row format.                      </span>
<a name="l02886"></a>02886 <span class="comment">!                                                                       </span>
<a name="l02887"></a>02887 <span class="comment">! on return:                                                            </span>
<a name="l02888"></a>02888 <span class="comment">!----------                                                             </span>
<a name="l02889"></a>02889 <span class="comment">!                                                                       </span>
<a name="l02890"></a>02890 <span class="comment">! diag = real vector of length nrow containing the norms                </span>
<a name="l02891"></a>02891 <span class="comment">!                                                                       </span>
<a name="l02892"></a>02892 <span class="comment">!-----------------------------------------------------------------      </span>
<a name="l02893"></a>02893       <span class="keywordtype">integer</span> ii, j, k, k1, k2  
<a name="l02894"></a>02894 
<a name="l02895"></a>02895       <span class="keyword">do</span> 10 k=1, nrow 
<a name="l02896"></a>02896          diag(k) = 0.0d0 
<a name="l02897"></a>02897    10 continue 
<a name="l02898"></a>02898       <span class="keyword">do</span> 1 ii=1,nrow 
<a name="l02899"></a>02899          k1 = ia(ii) 
<a name="l02900"></a>02900          k2 = ia(ii+1)-1 
<a name="l02901"></a>02901          <span class="keyword">do</span> 2 k=k1, k2 
<a name="l02902"></a>02902             j = ja(k) 
<a name="l02903"></a>02903 <span class="comment">!     update the norm of each column                                    </span>
<a name="l02904"></a>02904             <span class="keyword">if</span> (nrm  ==  0) <span class="keyword">then</span> 
<a name="l02905"></a>02905                diag(j) = max(diag(j),abs(a(k) ) ) 
<a name="l02906"></a>02906             elseif (nrm  ==  1) <span class="keyword">then</span> 
<a name="l02907"></a>02907                diag(j) = diag(j) + abs(a(k) ) 
<a name="l02908"></a>02908             <span class="keyword">else</span> 
<a name="l02909"></a>02909                diag(j) = diag(j)+a(k)**2 
<a name="l02910"></a>02910             <span class="keyword">endif</span> 
<a name="l02911"></a>02911     2    continue 
<a name="l02912"></a>02912     1 continue 
<a name="l02913"></a>02913       <span class="keyword">if</span> (nrm  /=  2) return 
<a name="l02914"></a>02914       <span class="keyword">do</span> 3 k=1, nrow 
<a name="l02915"></a>02915          diag(k) = sqrt(diag(k)) 
<a name="l02916"></a>02916     3 continue 
<a name="l02917"></a>02917       return 
<a name="l02918"></a>02918 <span class="keyword">      end subroutine  cnrms</span>
<a name="l02919"></a>02919 
<a name="l02920"></a>02920 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l02921"></a>02921 
<a name="l02922"></a><a class="code" href="namespaceunary__mod.html#a0788b4cbcf605f5a0a4cd4c7e74c23c4">02922</a>       <span class="keyword">subroutine </span><a class="code" href="namespaceunary__mod.html#a0788b4cbcf605f5a0a4cd4c7e74c23c4">roscal</a>(nrow,job,nrm,a,ja,ia,diag,b,jb,ib,ierr) 
<a name="l02923"></a>02923       <span class="keywordtype">integer</span> nrow 
<a name="l02924"></a>02924       <span class="keywordtype">real(wp)</span> a(*), b(*), diag(nrow) 
<a name="l02925"></a>02925       <span class="keywordtype">integer</span> job,nrm,ja(*),jb(*),ia(nrow+1),ib(nrow+1),ierr 
<a name="l02926"></a>02926 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l02927"></a>02927 <span class="comment">! scales the rows of A such that their norms are one on return          </span>
<a name="l02928"></a>02928 <span class="comment">! 3 choices of norms: 1-norm, 2-norm, max-norm.                         </span>
<a name="l02929"></a>02929 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l02930"></a>02930 <span class="comment">! on entry:                                                             </span>
<a name="l02931"></a>02931 <span class="comment">! ---------                                                             </span>
<a name="l02932"></a>02932 <span class="comment">! nrow        = integer. The row dimension of A                         </span>
<a name="l02933"></a>02933 <span class="comment">!                                                                       </span>
<a name="l02934"></a>02934 <span class="comment">! job   = integer. job indicator. Job=0 means get array b only          </span>
<a name="l02935"></a>02935 <span class="comment">!         job = 1 means get b, and the integer arrays ib, jb.           </span>
<a name="l02936"></a>02936 <span class="comment">!                                                                       </span>
<a name="l02937"></a>02937 <span class="comment">! nrm   = integer. norm indicator. nrm = 1, means 1-norm, nrm =2        </span>
<a name="l02938"></a>02938 <span class="comment">!                  means the 2-nrm, nrm = 0 means max norm              </span>
<a name="l02939"></a>02939 <span class="comment">!                                                                       </span>
<a name="l02940"></a>02940 <span class="comment">! a,                                                                    </span>
<a name="l02941"></a>02941 <span class="comment">! ja,                                                                   </span>
<a name="l02942"></a>02942 <span class="comment">! ia   = Matrix A in compressed sparse row format.                      </span>
<a name="l02943"></a>02943 <span class="comment">!                                                                       </span>
<a name="l02944"></a>02944 <span class="comment">! on return:                                                            </span>
<a name="l02945"></a>02945 <span class="comment">!----------                                                             </span>
<a name="l02946"></a>02946 <span class="comment">!                                                                       </span>
<a name="l02947"></a>02947 <span class="comment">! diag = diagonal matrix stored as a vector containing the matrix       </span>
<a name="l02948"></a>02948 <span class="comment">!        by which the rows have been scaled, i.e., on return            </span>
<a name="l02949"></a>02949 <span class="comment">!        we have B = Diag*A.                                            </span>
<a name="l02950"></a>02950 <span class="comment">!                                                                       </span>
<a name="l02951"></a>02951 <span class="comment">! b,                                                                    </span>
<a name="l02952"></a>02952 <span class="comment">! jb,                                                                   </span>
<a name="l02953"></a>02953 <span class="comment">! ib        = resulting matrix B in compressed sparse row sparse format.</span>
<a name="l02954"></a>02954 <span class="comment">!                                                                       </span>
<a name="l02955"></a>02955 <span class="comment">! ierr  = error message. ierr=0     : Normal return                     </span>
<a name="l02956"></a>02956 <span class="comment">!                        ierr=i &gt; 0 : Row number i is a zero row.       </span>
<a name="l02957"></a>02957 <span class="comment">! Notes:                                                                </span>
<a name="l02958"></a>02958 <span class="comment">!-------                                                                </span>
<a name="l02959"></a>02959 <span class="comment">! 1)        The column dimension of A is not needed.                    </span>
<a name="l02960"></a>02960 <span class="comment">! 2)        algorithm in place (B can take the place of A).             </span>
<a name="l02961"></a>02961 <span class="comment">!-----------------------------------------------------------------      </span>
<a name="l02962"></a>02962       <span class="keywordtype">integer</span> j
<a name="l02963"></a>02963 
<a name="l02964"></a>02964       call <a class="code" href="namespaceunary__mod.html#a4a28396a33a2df91bedc9c664c8aae4d">rnrms </a>(nrow,nrm,a,ja,ia,diag) 
<a name="l02965"></a>02965       ierr = 0 
<a name="l02966"></a>02966       <span class="keyword">do</span> 1 j=1, nrow 
<a name="l02967"></a>02967          <span class="keyword">if</span> (diag(j)  ==  0.0d0) <span class="keyword">then</span> 
<a name="l02968"></a>02968             ierr = j 
<a name="l02969"></a>02969             return 
<a name="l02970"></a>02970          <span class="keyword">else</span> 
<a name="l02971"></a>02971             diag(j) = 1.0d0/diag(j) 
<a name="l02972"></a>02972          <span class="keyword">endif</span> 
<a name="l02973"></a>02973     1 continue 
<a name="l02974"></a>02974       call <a class="code" href="namespaceunary__mod.html#a428ee1d4e4ab14a12be914c401b90158">diamua</a>(nrow,job,a,ja,ia,diag,b,jb,ib) 
<a name="l02975"></a>02975       return 
<a name="l02976"></a>02976 <span class="keyword">      end subroutine  roscal</span>
<a name="l02977"></a>02977 
<a name="l02978"></a>02978 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l02979"></a>02979 
<a name="l02980"></a><a class="code" href="namespaceunary__mod.html#acdc7adf3df388e3b94a6f222762a57ff">02980</a>       <span class="keyword">subroutine </span><a class="code" href="namespaceunary__mod.html#acdc7adf3df388e3b94a6f222762a57ff">coscal</a>(nrow,job,nrm,a,ja,ia,diag,b,jb,ib,ierr) 
<a name="l02981"></a>02981 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l02982"></a>02982       <span class="keywordtype">integer</span> nrow, nrm
<a name="l02983"></a>02983       <span class="keywordtype">real(wp)</span> a(*),b(*),diag(nrow) 
<a name="l02984"></a>02984       <span class="keywordtype">integer</span> job,ja(*),jb(*),ia(nrow+1),ib(nrow+1),ierr 
<a name="l02985"></a>02985 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l02986"></a>02986 <span class="comment">! scales the columns of A such that their norms are one on return       </span>
<a name="l02987"></a>02987 <span class="comment">! result matrix written on b, or overwritten on A.                      </span>
<a name="l02988"></a>02988 <span class="comment">! 3 choices of norms: 1-norm, 2-norm, max-norm. in place.               </span>
<a name="l02989"></a>02989 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l02990"></a>02990 <span class="comment">! on entry:                                                             </span>
<a name="l02991"></a>02991 <span class="comment">! ---------                                                             </span>
<a name="l02992"></a>02992 <span class="comment">! nrow        = integer. The row dimension of A                         </span>
<a name="l02993"></a>02993 <span class="comment">!                                                                       </span>
<a name="l02994"></a>02994 <span class="comment">! job   = integer. job indicator. Job=0 means get array b only          </span>
<a name="l02995"></a>02995 <span class="comment">!         job = 1 means get b, and the integer arrays ib, jb.           </span>
<a name="l02996"></a>02996 <span class="comment">!                                                                       </span>
<a name="l02997"></a>02997 <span class="comment">! nrm   = integer. norm indicator. nrm = 1, means 1-norm, nrm =2        </span>
<a name="l02998"></a>02998 <span class="comment">!                  means the 2-nrm, nrm = 0 means max norm              </span>
<a name="l02999"></a>02999 <span class="comment">!                                                                       </span>
<a name="l03000"></a>03000 <span class="comment">! a,                                                                    </span>
<a name="l03001"></a>03001 <span class="comment">! ja,                                                                   </span>
<a name="l03002"></a>03002 <span class="comment">! ia   = Matrix A in compressed sparse row format.                      </span>
<a name="l03003"></a>03003 <span class="comment">!                                                                       </span>
<a name="l03004"></a>03004 <span class="comment">! on return:                                                            </span>
<a name="l03005"></a>03005 <span class="comment">!----------                                                             </span>
<a name="l03006"></a>03006 <span class="comment">!                                                                       </span>
<a name="l03007"></a>03007 <span class="comment">! diag = diagonal matrix stored as a vector containing the matrix       </span>
<a name="l03008"></a>03008 <span class="comment">!        by which the columns have been scaled, i.e., on return         </span>
<a name="l03009"></a>03009 <span class="comment">!        we have B = A * Diag                                           </span>
<a name="l03010"></a>03010 <span class="comment">!                                                                       </span>
<a name="l03011"></a>03011 <span class="comment">! b,                                                                    </span>
<a name="l03012"></a>03012 <span class="comment">! jb,                                                                   </span>
<a name="l03013"></a>03013 <span class="comment">! ib        = resulting matrix B in compressed sparse row sparse format.</span>
<a name="l03014"></a>03014 <span class="comment">!                                                                       </span>
<a name="l03015"></a>03015 <span class="comment">! ierr  = error message. ierr=0     : Normal return                     </span>
<a name="l03016"></a>03016 <span class="comment">!                        ierr=i &gt; 0 : Column number i is a zero row.    </span>
<a name="l03017"></a>03017 <span class="comment">! Notes:                                                                </span>
<a name="l03018"></a>03018 <span class="comment">!-------                                                                </span>
<a name="l03019"></a>03019 <span class="comment">! 1)     The column dimension of A is not needed.                       </span>
<a name="l03020"></a>03020 <span class="comment">! 2)     algorithm in place (B can take the place of A).                </span>
<a name="l03021"></a>03021 <span class="comment">!-----------------------------------------------------------------      </span>
<a name="l03022"></a>03022       <span class="keywordtype">integer</span> j
<a name="l03023"></a>03023 
<a name="l03024"></a>03024       call <a class="code" href="namespaceunary__mod.html#a26f0b8306f9202771207b2d2ad2a5645">cnrms </a>(nrow,nrm,a,ja,ia,diag) 
<a name="l03025"></a>03025       ierr = 0 
<a name="l03026"></a>03026       <span class="keyword">do</span> 1 j=1, nrow 
<a name="l03027"></a>03027          <span class="keyword">if</span> (diag(j)  ==  0.0) <span class="keyword">then</span> 
<a name="l03028"></a>03028             ierr = j 
<a name="l03029"></a>03029             return 
<a name="l03030"></a>03030          <span class="keyword">else</span> 
<a name="l03031"></a>03031             diag(j) = 1.0d0/diag(j) 
<a name="l03032"></a>03032          <span class="keyword">endif</span> 
<a name="l03033"></a>03033     1 continue 
<a name="l03034"></a>03034       call <a class="code" href="namespaceunary__mod.html#a1fd7556350f3910e37b411bb32adcb26">amudia </a>(nrow,job,a,ja,ia,diag,b,jb,ib) 
<a name="l03035"></a>03035       return 
<a name="l03036"></a>03036 <span class="keyword">      end subroutine  coscal</span>
<a name="l03037"></a>03037 
<a name="l03038"></a>03038 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l03039"></a>03039 
<a name="l03040"></a><a class="code" href="namespaceunary__mod.html#adcb6be66d3cdb9ea28e65db790378ab3">03040</a>       <span class="keyword">subroutine </span><a class="code" href="namespaceunary__mod.html#adcb6be66d3cdb9ea28e65db790378ab3">addblk</a>(nrowa, ncola, a, ja, ia, ipos, jpos, job,       &amp;
<a name="l03041"></a>03041      &amp; nrowb, ncolb, b, jb, ib, nrowc, ncolc, c, jc, ic, nzmx, ierr)    
<a name="l03042"></a>03042 <span class="comment">!      implicit none                                                    </span>
<a name="l03043"></a>03043       <span class="keywordtype">integer</span> nrowa, nrowb, nrowc, ncola, ncolb, ncolc, ipos, jpos 
<a name="l03044"></a>03044       <span class="keywordtype">integer</span> nzmx, ierr, job 
<a name="l03045"></a>03045       <span class="keywordtype">integer</span> ja(1:*), ia(1:*), jb(1:*), ib(1:*), jc(1:*), ic(1:*) 
<a name="l03046"></a>03046       <span class="keywordtype">real(wp)</span> a(1:*), b(1:*), c(1:*) 
<a name="l03047"></a>03047 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l03048"></a>03048 <span class="comment">!     This subroutine adds a matrix B into a submatrix of A whose       </span>
<a name="l03049"></a>03049 <span class="comment">!     (1,1) element is located in the starting position (ipos, jpos).   </span>
<a name="l03050"></a>03050 <span class="comment">!     The resulting matrix is allowed to be larger than A (and B),      </span>
<a name="l03051"></a>03051 <span class="comment">!     and the resulting dimensions nrowc, ncolc will be redefined       </span>
<a name="l03052"></a>03052 <span class="comment">!     accordingly upon return.                                          </span>
<a name="l03053"></a>03053 <span class="comment">!     The input matrices are assumed to be sorted, i.e. in each row     </span>
<a name="l03054"></a>03054 <span class="comment">!     the column indices appear in ascending order in the CSR format.   </span>
<a name="l03055"></a>03055 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l03056"></a>03056 <span class="comment">! on entry:                                                             </span>
<a name="l03057"></a>03057 <span class="comment">! ---------                                                             </span>
<a name="l03058"></a>03058 <span class="comment">! nrowa    = number of rows in A.                                       </span>
<a name="l03059"></a>03059 <span class="comment">! bcola    = number of columns in A.                                    </span>
<a name="l03060"></a>03060 <span class="comment">! a,ja,ia  = Matrix A in compressed sparse row format with entries sorte</span>
<a name="l03061"></a>03061 <span class="comment">! nrowb    = number of rows in B.                                       </span>
<a name="l03062"></a>03062 <span class="comment">! ncolb    = number of columns in B.                                    </span>
<a name="l03063"></a>03063 <span class="comment">! b,jb,ib  = Matrix B in compressed sparse row format with entries sorte</span>
<a name="l03064"></a>03064 <span class="comment">!                                                                       </span>
<a name="l03065"></a>03065 <span class="comment">! nzmax           = integer. The  length of the arrays c and jc. addblk </span>
<a name="l03066"></a>03066 <span class="comment">!            stop if the number of nonzero elements in the matrix C     </span>
<a name="l03067"></a>03067 <span class="comment">!            exceeds nzmax. See ierr.                                   </span>
<a name="l03068"></a>03068 <span class="comment">!                                                                       </span>
<a name="l03069"></a>03069 <span class="comment">! on return:                                                            </span>
<a name="l03070"></a>03070 <span class="comment">!----------                                                             </span>
<a name="l03071"></a>03071 <span class="comment">! nrowc    = number of rows in C.                                       </span>
<a name="l03072"></a>03072 <span class="comment">! ncolc    = number of columns in C.                                    </span>
<a name="l03073"></a>03073 <span class="comment">! c,jc,ic  = resulting matrix C in compressed sparse row sparse format  </span>
<a name="l03074"></a>03074 <span class="comment">!            with entries sorted ascendly in each row.                  </span>
<a name="l03075"></a>03075 <span class="comment">!                                                                       </span>
<a name="l03076"></a>03076 <span class="comment">! ierr           = integer. serving as error message.                   </span>
<a name="l03077"></a>03077 <span class="comment">!         ierr = 0 means normal return,                                 </span>
<a name="l03078"></a>03078 <span class="comment">!         ierr  &gt;  0 means that addblk stopped while computing the     </span>
<a name="l03079"></a>03079 <span class="comment">!         i-th row  of C with i=ierr, because the number                </span>
<a name="l03080"></a>03080 <span class="comment">!         of elements in C exceeds nzmax.                               </span>
<a name="l03081"></a>03081 <span class="comment">!                                                                       </span>
<a name="l03082"></a>03082 <span class="comment">! Notes:                                                                </span>
<a name="l03083"></a>03083 <span class="comment">!-------                                                                </span>
<a name="l03084"></a>03084 <span class="comment">!     this will not work if any of the two input matrices is not sorted </span>
<a name="l03085"></a>03085 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l03086"></a>03086       <span class="keywordtype">logical</span> values 
<a name="l03087"></a>03087       <span class="keywordtype">integer</span> i,j1,j2,ka,kb,kc,kamax,kbmax 
<a name="l03088"></a>03088       values = (job  /=  0) 
<a name="l03089"></a>03089       ierr = 0 
<a name="l03090"></a>03090       nrowc = max(nrowa, nrowb+ipos-1) 
<a name="l03091"></a>03091       ncolc = max(ncola, ncolb+jpos-1) 
<a name="l03092"></a>03092       kc = 1 
<a name="l03093"></a>03093       kamax = 0
<a name="l03094"></a>03094       kbmax = 0 
<a name="l03095"></a>03095       ic(1) = kc 
<a name="l03096"></a>03096 <span class="comment">!                                                                       </span>
<a name="l03097"></a>03097       <span class="keyword">do</span> 10 i=1, nrowc 
<a name="l03098"></a>03098          <span class="keyword">if</span> (i &lt;= nrowa) <span class="keyword">then</span> 
<a name="l03099"></a>03099             ka = ia(i) 
<a name="l03100"></a>03100             kamax = ia(i+1)-1 
<a name="l03101"></a>03101          <span class="keyword">else</span> 
<a name="l03102"></a>03102             ka = ia(nrowa+1) 
<a name="l03103"></a>03103          <span class="keyword">end if</span> 
<a name="l03104"></a>03104          <span class="keyword">if</span> ((i &gt;= ipos).and.((i-ipos) &lt;= nrowb)) <span class="keyword">then</span> 
<a name="l03105"></a>03105             kb = ib(i-ipos+1) 
<a name="l03106"></a>03106             kbmax = ib(i-ipos+2)-1 
<a name="l03107"></a>03107          <span class="keyword">else</span> 
<a name="l03108"></a>03108             kb = ib(nrowb+1) 
<a name="l03109"></a>03109          <span class="keyword">end if</span> 
<a name="l03110"></a>03110 <span class="comment">!                                                                       </span>
<a name="l03111"></a>03111 <span class="comment">!     a do-while type loop -- goes through all the elements in a row.   </span>
<a name="l03112"></a>03112 <span class="comment">!                                                                       </span>
<a name="l03113"></a>03113    20    continue 
<a name="l03114"></a>03114          <span class="keyword">if</span> (ka  &lt;=  kamax) <span class="keyword">then</span> 
<a name="l03115"></a>03115             j1 = ja(ka) 
<a name="l03116"></a>03116          <span class="keyword">else</span> 
<a name="l03117"></a>03117             j1 = ncolc+1 
<a name="l03118"></a>03118          <span class="keyword">endif</span> 
<a name="l03119"></a>03119          <span class="keyword">if</span> (kb  &lt;=  kbmax) <span class="keyword">then</span> 
<a name="l03120"></a>03120             j2 = jb(kb) + jpos - 1 
<a name="l03121"></a>03121          <span class="keyword">else</span> 
<a name="l03122"></a>03122             j2 = ncolc+1 
<a name="l03123"></a>03123          <span class="keyword">endif</span> 
<a name="l03124"></a>03124 <span class="comment">!                                                                       </span>
<a name="l03125"></a>03125 <span class="comment">!     if there are more elements to be added.                           </span>
<a name="l03126"></a>03126 <span class="comment">!                                                                       </span>
<a name="l03127"></a>03127          <span class="keyword">if</span> ((ka  &lt;=  kamax .or. kb  &lt;=  kbmax) .and.                   &amp;
<a name="l03128"></a>03128      &amp;        (j1  &lt;=  ncolc .or. j2  &lt;=  ncolc)) <span class="keyword">then</span>                  
<a name="l03129"></a>03129 <span class="comment">!                                                                       </span>
<a name="l03130"></a>03130 <span class="comment">!     three cases                                                       </span>
<a name="l03131"></a>03131 <span class="comment">!                                                                       </span>
<a name="l03132"></a>03132             <span class="keyword">if</span> (j1  ==  j2) <span class="keyword">then</span> 
<a name="l03133"></a>03133                <span class="keyword">if</span> (values) c(kc) = a(ka)+b(kb) 
<a name="l03134"></a>03134                jc(kc) = j1 
<a name="l03135"></a>03135                ka = ka+1 
<a name="l03136"></a>03136                kb = kb+1 
<a name="l03137"></a>03137                kc = kc+1 
<a name="l03138"></a>03138             <span class="keyword">else</span> <span class="keyword">if</span> (j1  &lt;  j2) <span class="keyword">then</span> 
<a name="l03139"></a>03139                jc(kc) = j1 
<a name="l03140"></a>03140                <span class="keyword">if</span> (values) c(kc) = a(ka) 
<a name="l03141"></a>03141                ka = ka+1 
<a name="l03142"></a>03142                kc = kc+1 
<a name="l03143"></a>03143             <span class="keyword">else</span> <span class="keyword">if</span> (j1  &gt;  j2) <span class="keyword">then</span> 
<a name="l03144"></a>03144                jc(kc) = j2 
<a name="l03145"></a>03145                <span class="keyword">if</span> (values) c(kc) = b(kb) 
<a name="l03146"></a>03146                kb = kb+1 
<a name="l03147"></a>03147                kc = kc+1 
<a name="l03148"></a>03148             <span class="keyword">endif</span> 
<a name="l03149"></a>03149             <span class="keyword">if</span> (kc  &gt;  nzmx) goto 999 
<a name="l03150"></a>03150             goto 20 
<a name="l03151"></a>03151          <span class="keyword">end if</span> 
<a name="l03152"></a>03152          ic(i+1) = kc 
<a name="l03153"></a>03153    10 continue 
<a name="l03154"></a>03154       return 
<a name="l03155"></a>03155   999 ierr = i 
<a name="l03156"></a>03156       return 
<a name="l03157"></a>03157 <span class="keyword">      end subroutine  addblk</span>
<a name="l03158"></a>03158 
<a name="l03159"></a>03159 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l03160"></a>03160 
<a name="l03161"></a><a class="code" href="namespaceunary__mod.html#addde2fe4df5918f55a05df92451b5467">03161</a>       <span class="keyword">subroutine </span><a class="code" href="namespaceunary__mod.html#addde2fe4df5918f55a05df92451b5467">block_addblk</a>(nb, nrowa, ncola, a, ja, ia, ipos, jpos,  &amp;
<a name="l03162"></a>03162      &amp; job, nrowb, ncolb, b, jb, ib, nrowc, ncolc, c, jc, ic, nzmx, ierr)    
<a name="l03163"></a>03163 
<a name="l03164"></a>03164       <span class="keyword">implicit none</span>                                                    
<a name="l03165"></a>03165 
<a name="l03166"></a>03166       <span class="keywordtype">integer</span>,                <span class="keywordtype">intent(in)</span>          :: nb
<a name="l03167"></a>03167       <span class="keywordtype">integer</span>,                <span class="keywordtype">intent(in)</span>          :: nrowa, ncola
<a name="l03168"></a>03168       <span class="keywordtype">integer</span>,                <span class="keywordtype">intent(in)</span>          :: nrowb, ncolb
<a name="l03169"></a>03169       <span class="keywordtype">integer</span>,                <span class="keywordtype">intent(in)</span>          :: ipos,  jpos
<a name="l03170"></a>03170       <span class="keywordtype">integer</span>,                <span class="keywordtype">intent(in)</span>          :: job,   nzmx
<a name="l03171"></a>03171       <span class="keywordtype">integer</span>,                <span class="keywordtype">intent(inout)</span>       :: nrowc, ncolc
<a name="l03172"></a>03172       <span class="keywordtype">integer</span>,                <span class="keywordtype">intent(out)</span>         :: ierr
<a name="l03173"></a>03173 
<a name="l03174"></a>03174       <span class="keywordtype">integer</span> , <span class="keywordtype">dimension(*)</span>, <span class="keywordtype">intent(in)</span>          :: ia, ja
<a name="l03175"></a>03175       <span class="keywordtype">integer</span> , <span class="keywordtype">dimension(*)</span>, <span class="keywordtype">intent(in)</span>          :: ib, jb
<a name="l03176"></a>03176       <span class="keywordtype">integer</span> , <span class="keywordtype">dimension(*)</span>, <span class="keywordtype">intent(inout)</span>       :: ic, jc 
<a name="l03177"></a>03177 
<a name="l03178"></a>03178       <span class="keywordtype">real(wp)</span>, <span class="keywordtype">dimension(nb,nb,*)</span>, <span class="keywordtype">intent(in)</span>    :: a, b
<a name="l03179"></a>03179       <span class="keywordtype">real(wp)</span>, <span class="keywordtype">dimension(nb,nb,*)</span>, <span class="keywordtype">intent(inout)</span> :: c
<a name="l03180"></a>03180 
<a name="l03181"></a>03181       <span class="keywordtype">logical</span>         :: values 
<a name="l03182"></a>03182       <span class="keywordtype">integer</span>         ::  i,j1,j2,ka,kb,kc,kamax,kbmax 
<a name="l03183"></a>03183 
<a name="l03184"></a>03184 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l03185"></a>03185 <span class="comment">!     This subroutine adds a matrix B into a submatrix of A whose       </span>
<a name="l03186"></a>03186 <span class="comment">!     (1,1) element is located in the starting position (ipos, jpos).   </span>
<a name="l03187"></a>03187 <span class="comment">!     The resulting matrix is allowed to be larger than A (and B),      </span>
<a name="l03188"></a>03188 <span class="comment">!     and the resulting dimensions nrowc, ncolc will be redefined       </span>
<a name="l03189"></a>03189 <span class="comment">!     accordingly upon return.                                          </span>
<a name="l03190"></a>03190 <span class="comment">!     The input matrices are assumed to be sorted, i.e. in each row     </span>
<a name="l03191"></a>03191 <span class="comment">!     the column indices appear in ascending order in the CSR format.   </span>
<a name="l03192"></a>03192 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l03193"></a>03193 <span class="comment">! on entry:                                                             </span>
<a name="l03194"></a>03194 <span class="comment">! ---------                                                             </span>
<a name="l03195"></a>03195 <span class="comment">! nrowa    = number of rows in A.                                       </span>
<a name="l03196"></a>03196 <span class="comment">! bcola    = number of columns in A.                                    </span>
<a name="l03197"></a>03197 <span class="comment">! a,ja,ia  = Matrix A in compressed sparse row format with entries sorte</span>
<a name="l03198"></a>03198 <span class="comment">! nrowb    = number of rows in B.                                       </span>
<a name="l03199"></a>03199 <span class="comment">! ncolb    = number of columns in B.                                    </span>
<a name="l03200"></a>03200 <span class="comment">! b,jb,ib  = Matrix B in compressed sparse row format with entries sorte</span>
<a name="l03201"></a>03201 <span class="comment">!                                                                       </span>
<a name="l03202"></a>03202 <span class="comment">! nzmax           = integer. The  length of the arrays c and jc. addblk </span>
<a name="l03203"></a>03203 <span class="comment">!            stop if the number of nonzero elements in the matrix C     </span>
<a name="l03204"></a>03204 <span class="comment">!            exceeds nzmax. See ierr.                                   </span>
<a name="l03205"></a>03205 <span class="comment">!                                                                       </span>
<a name="l03206"></a>03206 <span class="comment">! on return:                                                            </span>
<a name="l03207"></a>03207 <span class="comment">!----------                                                             </span>
<a name="l03208"></a>03208 <span class="comment">! nrowc    = number of rows in C.                                       </span>
<a name="l03209"></a>03209 <span class="comment">! ncolc    = number of columns in C.                                    </span>
<a name="l03210"></a>03210 <span class="comment">! c,jc,ic  = resulting matrix C in compressed sparse row sparse format  </span>
<a name="l03211"></a>03211 <span class="comment">!            with entries sorted ascendly in each row.                  </span>
<a name="l03212"></a>03212 <span class="comment">!                                                                       </span>
<a name="l03213"></a>03213 <span class="comment">! ierr           = integer. serving as error message.                   </span>
<a name="l03214"></a>03214 <span class="comment">!         ierr = 0 means normal return,                                 </span>
<a name="l03215"></a>03215 <span class="comment">!         ierr  &gt;  0 means that addblk stopped while computing the     </span>
<a name="l03216"></a>03216 <span class="comment">!         i-th row  of C with i=ierr, because the number                </span>
<a name="l03217"></a>03217 <span class="comment">!         of elements in C exceeds nzmax.                               </span>
<a name="l03218"></a>03218 <span class="comment">!                                                                       </span>
<a name="l03219"></a>03219 <span class="comment">! Notes:                                                                </span>
<a name="l03220"></a>03220 <span class="comment">!-------                                                                </span>
<a name="l03221"></a>03221 <span class="comment">!     this will not work if any of the two input matrices is not sorted </span>
<a name="l03222"></a>03222 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l03223"></a>03223 
<a name="l03224"></a>03224       values = (job  /=  0) 
<a name="l03225"></a>03225       ierr = 0 
<a name="l03226"></a>03226       nrowc = max(nrowa, nrowb+ipos-1) 
<a name="l03227"></a>03227       ncolc = max(ncola, ncolb+jpos-1) 
<a name="l03228"></a>03228       kc = 1 
<a name="l03229"></a>03229       kamax = 0
<a name="l03230"></a>03230       kbmax = 0 
<a name="l03231"></a>03231       ic(1) = kc 
<a name="l03232"></a>03232 <span class="comment">!                                                                       </span>
<a name="l03233"></a>03233       <span class="keyword">do</span> 10 i=1, nrowc 
<a name="l03234"></a>03234          <span class="keyword">if</span> (i &lt;= nrowa) <span class="keyword">then</span> 
<a name="l03235"></a>03235             ka = ia(i) 
<a name="l03236"></a>03236             kamax = ia(i+1)-1 
<a name="l03237"></a>03237          <span class="keyword">else</span> 
<a name="l03238"></a>03238             ka = ia(nrowa+1) 
<a name="l03239"></a>03239          <span class="keyword">end if</span> 
<a name="l03240"></a>03240          <span class="keyword">if</span> ((i &gt;= ipos).and.((i-ipos) &lt;= nrowb)) <span class="keyword">then</span> 
<a name="l03241"></a>03241             kb = ib(i-ipos+1) 
<a name="l03242"></a>03242             kbmax = ib(i-ipos+2)-1 
<a name="l03243"></a>03243          <span class="keyword">else</span> 
<a name="l03244"></a>03244             kb = ib(nrowb+1) 
<a name="l03245"></a>03245          <span class="keyword">end if</span> 
<a name="l03246"></a>03246 <span class="comment">!                                                                       </span>
<a name="l03247"></a>03247 <span class="comment">!     a do-while type loop -- goes through all the elements in a row.   </span>
<a name="l03248"></a>03248 <span class="comment">!                                                                       </span>
<a name="l03249"></a>03249    20    continue 
<a name="l03250"></a>03250          <span class="keyword">if</span> (ka  &lt;=  kamax) <span class="keyword">then</span> 
<a name="l03251"></a>03251             j1 = ja(ka) 
<a name="l03252"></a>03252          <span class="keyword">else</span> 
<a name="l03253"></a>03253             j1 = ncolc+1 
<a name="l03254"></a>03254          <span class="keyword">endif</span> 
<a name="l03255"></a>03255          <span class="keyword">if</span> (kb  &lt;=  kbmax) <span class="keyword">then</span> 
<a name="l03256"></a>03256             j2 = jb(kb) + jpos - 1 
<a name="l03257"></a>03257          <span class="keyword">else</span> 
<a name="l03258"></a>03258             j2 = ncolc+1 
<a name="l03259"></a>03259          <span class="keyword">endif</span> 
<a name="l03260"></a>03260 <span class="comment">!                                                                       </span>
<a name="l03261"></a>03261 <span class="comment">!     if there are more elements to be added.                           </span>
<a name="l03262"></a>03262 <span class="comment">!                                                                       </span>
<a name="l03263"></a>03263          <span class="keyword">if</span> ((ka  &lt;=  kamax .or. kb  &lt;=  kbmax) .and.                   &amp;
<a name="l03264"></a>03264      &amp;        (j1  &lt;=  ncolc .or. j2  &lt;=  ncolc)) <span class="keyword">then</span>                  
<a name="l03265"></a>03265 <span class="comment">!                                                                       </span>
<a name="l03266"></a>03266 <span class="comment">!     three cases                                                       </span>
<a name="l03267"></a>03267 <span class="comment">!                                                                       </span>
<a name="l03268"></a>03268             <span class="keyword">if</span> (j1  ==  j2) <span class="keyword">then</span> 
<a name="l03269"></a>03269                <span class="keyword">if</span> (values) c(:,:,kc) = a(:,:,ka)+b(:,:,kb) 
<a name="l03270"></a>03270                jc(kc) = j1 
<a name="l03271"></a>03271                ka = ka+1 
<a name="l03272"></a>03272                kb = kb+1 
<a name="l03273"></a>03273                kc = kc+1 
<a name="l03274"></a>03274             <span class="keyword">else</span> <span class="keyword">if</span> (j1  &lt;  j2) <span class="keyword">then</span> 
<a name="l03275"></a>03275                jc(kc) = j1 
<a name="l03276"></a>03276                <span class="keyword">if</span> (values) c(:,:,kc) = a(:,:,ka) 
<a name="l03277"></a>03277                ka = ka+1 
<a name="l03278"></a>03278                kc = kc+1 
<a name="l03279"></a>03279             <span class="keyword">else</span> <span class="keyword">if</span> (j1  &gt;  j2) <span class="keyword">then</span> 
<a name="l03280"></a>03280                jc(kc) = j2 
<a name="l03281"></a>03281                <span class="keyword">if</span> (values) c(:,:,kc) = b(:,:,kb) 
<a name="l03282"></a>03282                kb = kb+1 
<a name="l03283"></a>03283                kc = kc+1 
<a name="l03284"></a>03284             <span class="keyword">endif</span> 
<a name="l03285"></a>03285             <span class="keyword">if</span> (kc  &gt;  nzmx) goto 999 
<a name="l03286"></a>03286             goto 20 
<a name="l03287"></a>03287          <span class="keyword">end if</span> 
<a name="l03288"></a>03288          ic(i+1) = kc 
<a name="l03289"></a>03289    10 continue 
<a name="l03290"></a>03290       return 
<a name="l03291"></a>03291   999 ierr = i 
<a name="l03292"></a>03292       return 
<a name="l03293"></a>03293 <span class="keyword">      end subroutine  block_addblk</span>
<a name="l03294"></a>03294 
<a name="l03295"></a>03295 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l03296"></a>03296 
<a name="l03297"></a><a class="code" href="namespaceunary__mod.html#a50ca555eca84a4dbb632b5e4488f8802">03297</a>       <span class="keyword">subroutine </span><a class="code" href="namespaceunary__mod.html#a50ca555eca84a4dbb632b5e4488f8802">get1up</a> (n,ja,ia,ju) 
<a name="l03298"></a>03298       <span class="keywordtype">integer</span>  n, ja(*),ia(*),ju(*) 
<a name="l03299"></a>03299 <span class="comment">!---------------------------------------------------------------------- </span>
<a name="l03300"></a>03300 <span class="comment">! obtains the first element of each row of the upper triangular part    </span>
<a name="l03301"></a>03301 <span class="comment">! of a matrix. Assumes that the matrix is already sorted.               </span>
<a name="l03302"></a>03302 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l03303"></a>03303 <span class="comment">! parameters                                                            </span>
<a name="l03304"></a>03304 <span class="comment">! input                                                                 </span>
<a name="l03305"></a>03305 <span class="comment">! -----                                                                 </span>
<a name="l03306"></a>03306 <span class="comment">! ja      = integer array containing the column indices of aij          </span>
<a name="l03307"></a>03307 <span class="comment">! ia      = pointer array. ia(j) contains the position of the           </span>
<a name="l03308"></a>03308 <span class="comment">!           beginning of row j in ja                                    </span>
<a name="l03309"></a>03309 <span class="comment">!                                                                       </span>
<a name="l03310"></a>03310 <span class="comment">! output                                                                </span>
<a name="l03311"></a>03311 <span class="comment">! ------                                                                </span>
<a name="l03312"></a>03312 <span class="comment">! ju      = integer array of length n. ju(i) is the address in ja       </span>
<a name="l03313"></a>03313 <span class="comment">!           of the first element of the uper triangular part of         </span>
<a name="l03314"></a>03314 <span class="comment">!           of A (including rthe diagonal. Thus if row i does have      </span>
<a name="l03315"></a>03315 <span class="comment">!           a nonzero diagonal element then ju(i) will point to it.     </span>
<a name="l03316"></a>03316 <span class="comment">!           This is a more general version of diapos.                   </span>
<a name="l03317"></a>03317 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l03318"></a>03318 <span class="comment">! local vAriables                                                       </span>
<a name="l03319"></a>03319       <span class="keywordtype">integer</span> i, k 
<a name="l03320"></a>03320 <span class="comment">!                                                                       </span>
<a name="l03321"></a>03321       <span class="keyword">do</span> 5 i=1, n 
<a name="l03322"></a>03322          ju(i) = 0 
<a name="l03323"></a>03323          k = ia(i) 
<a name="l03324"></a>03324 <span class="comment">!                                                                       </span>
<a name="l03325"></a>03325     1    continue 
<a name="l03326"></a>03326          <span class="keyword">if</span> (ja(k)  &gt;=  i) <span class="keyword">then</span> 
<a name="l03327"></a>03327             ju(i) = k 
<a name="l03328"></a>03328             goto 5 
<a name="l03329"></a>03329          elseif (k  &lt;  ia(i+1) -1) <span class="keyword">then</span> 
<a name="l03330"></a>03330             k=k+1 
<a name="l03331"></a>03331 <span class="comment">!                                                                       </span>
<a name="l03332"></a>03332 <span class="comment">! go try next element in row                                            </span>
<a name="l03333"></a>03333 <span class="comment">!                                                                       </span>
<a name="l03334"></a>03334             goto 1 
<a name="l03335"></a>03335          <span class="keyword">endif</span> 
<a name="l03336"></a>03336     5 continue 
<a name="l03337"></a>03337       return 
<a name="l03338"></a>03338 <span class="keyword">      end subroutine  get1up</span>
<a name="l03339"></a>03339 
<a name="l03340"></a>03340 <span class="comment">!---------------------------------------------------------------------- </span>
<a name="l03341"></a>03341 
<a name="l03342"></a><a class="code" href="namespaceunary__mod.html#a16d00526a748f6f1d4bdee17b94d2fb6">03342</a>       <span class="keyword">subroutine </span><a class="code" href="namespaceunary__mod.html#a16d00526a748f6f1d4bdee17b94d2fb6">xtrows</a> (i1,i2,a,ja,ia,ao,jao,iao,iperm,job) 
<a name="l03343"></a>03343       <span class="keywordtype">integer</span> i1,i2,ja(*),ia(*),jao(*),iao(*),iperm(*),job 
<a name="l03344"></a>03344       <span class="keywordtype">real(wp)</span> a(*),ao(*) 
<a name="l03345"></a>03345 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l03346"></a>03346 <span class="comment">! this subroutine extracts given rows from a matrix in CSR format.      </span>
<a name="l03347"></a>03347 <span class="comment">! Specifically, rows number iperm(i1), iperm(i1+1), ...., iperm(i2)     </span>
<a name="l03348"></a>03348 <span class="comment">! are extracted and put in the output matrix ao, jao, iao, in CSR       </span>
<a name="l03349"></a>03349 <span class="comment">! format.  NOT in place.                                                </span>
<a name="l03350"></a>03350 <span class="comment">! Youcef Saad -- coded Feb 15, 1992.                                    </span>
<a name="l03351"></a>03351 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l03352"></a>03352 <span class="comment">! on entry:                                                             </span>
<a name="l03353"></a>03353 <span class="comment">!----------                                                             </span>
<a name="l03354"></a>03354 <span class="comment">! i1,i2   = two integers indicating the rows to be extracted.           </span>
<a name="l03355"></a>03355 <span class="comment">!           xtrows will extract rows iperm(i1), iperm(i1+1),..,iperm(i2)</span>
<a name="l03356"></a>03356 <span class="comment">!           from original matrix and stack them in output matrix        </span>
<a name="l03357"></a>03357 <span class="comment">!           ao, jao, iao in csr format                                  </span>
<a name="l03358"></a>03358 <span class="comment">!                                                                       </span>
<a name="l03359"></a>03359 <span class="comment">! a, ja, ia = input matrix in csr format                                </span>
<a name="l03360"></a>03360 <span class="comment">!                                                                       </span>
<a name="l03361"></a>03361 <span class="comment">! iperm        = integer array of length nrow containing the reverse per</span>
<a name="l03362"></a>03362 <span class="comment">!         array for the rows. row number iperm(j) in permuted matrix PA </span>
<a name="l03363"></a>03363 <span class="comment">!         used to be row number j in unpermuted matrix.                 </span>
<a name="l03364"></a>03364 <span class="comment">!         ---&gt; a(i,j) in the permuted matrix was a(iperm(i),j)          </span>
<a name="l03365"></a>03365 <span class="comment">!         in the inout matrix.                                          </span>
<a name="l03366"></a>03366 <span class="comment">!                                                                       </span>
<a name="l03367"></a>03367 <span class="comment">! job        = integer indicating the work to be done:                  </span>
<a name="l03368"></a>03368 <span class="comment">!                 job  /=  1 : get structure only of output matrix,,    </span>
<a name="l03369"></a>03369 <span class="comment">!               i.e., ignore real values. (in which case arrays a       </span>
<a name="l03370"></a>03370 <span class="comment">!               and ao are not used nor accessed).                      </span>
<a name="l03371"></a>03371 <span class="comment">!                 job = 1        get complete data structure of output m</span>
<a name="l03372"></a>03372 <span class="comment">!               (i.e., including arrays ao and iao).                    </span>
<a name="l03373"></a>03373 <span class="comment">!------------                                                           </span>
<a name="l03374"></a>03374 <span class="comment">! on return:                                                            </span>
<a name="l03375"></a>03375 <span class="comment">!------------                                                           </span>
<a name="l03376"></a>03376 <span class="comment">! ao, jao, iao = input matrix in a, ja, ia format                       </span>
<a name="l03377"></a>03377 <span class="comment">! note :                                                                </span>
<a name="l03378"></a>03378 <span class="comment">!        if (job /= 1)  then the arrays a and ao are not used.          </span>
<a name="l03379"></a>03379 <span class="comment">!----------------------------------------------------------------------c</span>
<a name="l03380"></a>03380 <span class="comment">!           Y. Saad, revised May  2, 1990                              c</span>
<a name="l03381"></a>03381 <span class="comment">!----------------------------------------------------------------------c</span>
<a name="l03382"></a>03382       <span class="keywordtype">logical</span> values 
<a name="l03383"></a>03383       <span class="keywordtype">integer</span> ii, j, k, ko 
<a name="l03384"></a>03384 
<a name="l03385"></a>03385       values = (job  ==  1) 
<a name="l03386"></a>03386 <span class="comment">!                                                                       </span>
<a name="l03387"></a>03387 <span class="comment">! copying                                                               </span>
<a name="l03388"></a>03388 <span class="comment">!                                                                       </span>
<a name="l03389"></a>03389       ko = 1 
<a name="l03390"></a>03390       iao(1) = ko 
<a name="l03391"></a>03391       <span class="keyword">do</span> 100 j=i1,i2 
<a name="l03392"></a>03392 <span class="comment">!                                                                       </span>
<a name="l03393"></a>03393 <span class="comment">! ii=iperm(j) is the index of old row to be copied.                     </span>
<a name="l03394"></a>03394 <span class="comment">!                                                                       </span>
<a name="l03395"></a>03395          ii = iperm(j) 
<a name="l03396"></a>03396          <span class="keyword">do</span> 60 k=ia(ii), ia(ii+1)-1 
<a name="l03397"></a>03397             jao(ko) = ja(k) 
<a name="l03398"></a>03398             <span class="keyword">if</span> (values) ao(ko) = a(k) 
<a name="l03399"></a>03399             ko = ko+1 
<a name="l03400"></a>03400    60    continue 
<a name="l03401"></a>03401          iao(j-i1+2) = ko 
<a name="l03402"></a>03402   100 continue 
<a name="l03403"></a>03403 <span class="comment">!                                                                       </span>
<a name="l03404"></a>03404       return 
<a name="l03405"></a>03405 <span class="keyword">      end subroutine  xtrows</span>
<a name="l03406"></a>03406 
<a name="l03407"></a>03407 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l03408"></a>03408 
<a name="l03409"></a><a class="code" href="namespaceunary__mod.html#a4c72b933bfa153b488246b75c79dd26a">03409</a>       <span class="keyword">subroutine </span><a class="code" href="namespaceunary__mod.html#a4c72b933bfa153b488246b75c79dd26a">csrkvstr</a>(n, ia, ja, nr, kvstr) 
<a name="l03410"></a>03410 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l03411"></a>03411       <span class="keywordtype">integer</span> n, ia(n+1), ja(*), nr, kvstr(*) 
<a name="l03412"></a>03412 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l03413"></a>03413 <span class="comment">!     Finds block row partitioning of matrix in CSR format.             </span>
<a name="l03414"></a>03414 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l03415"></a>03415 <span class="comment">!     On entry:                                                         </span>
<a name="l03416"></a>03416 <span class="comment">!--------------                                                         </span>
<a name="l03417"></a>03417 <span class="comment">!     n       = number of matrix scalar rows                            </span>
<a name="l03418"></a>03418 <span class="comment">!     ia,ja   = input matrix sparsity structure in CSR format           </span>
<a name="l03419"></a>03419 <span class="comment">!                                                                       </span>
<a name="l03420"></a>03420 <span class="comment">!     On return:                                                        </span>
<a name="l03421"></a>03421 <span class="comment">!---------------                                                        </span>
<a name="l03422"></a>03422 <span class="comment">!     nr      = number of block rows                                    </span>
<a name="l03423"></a>03423 <span class="comment">!     kvstr   = first row number for each block row                     </span>
<a name="l03424"></a>03424 <span class="comment">!                                                                       </span>
<a name="l03425"></a>03425 <span class="comment">!     Notes:                                                            </span>
<a name="l03426"></a>03426 <span class="comment">!-----------                                                            </span>
<a name="l03427"></a>03427 <span class="comment">!     Assumes that the matrix is sorted by columns.                     </span>
<a name="l03428"></a>03428 <span class="comment">!     This routine does not need any workspace.                         </span>
<a name="l03429"></a>03429 <span class="comment">!                                                                       </span>
<a name="l03430"></a>03430 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l03431"></a>03431 <span class="comment">!     local variables                                                   </span>
<a name="l03432"></a>03432       <span class="keywordtype">integer</span> i, j, jdiff 
<a name="l03433"></a>03433 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l03434"></a>03434       nr = 1 
<a name="l03435"></a>03435       kvstr(1) = 1 
<a name="l03436"></a>03436 <span class="comment">!---------------------------------                                      </span>
<a name="l03437"></a>03437       <span class="keyword">do</span> i = 2, n 
<a name="l03438"></a>03438          jdiff = ia(i+1)-ia(i) 
<a name="l03439"></a>03439          <span class="keyword">if</span> (jdiff  ==  ia(i)-ia(i-1)) <span class="keyword">then</span> 
<a name="l03440"></a>03440             <span class="keyword">do</span> j = ia(i), ia(i+1)-1 
<a name="l03441"></a>03441                <span class="keyword">if</span> (ja(j)  /=  ja(j-jdiff)) <span class="keyword">then</span> 
<a name="l03442"></a>03442                   nr = nr + 1 
<a name="l03443"></a>03443                   kvstr(nr) = i 
<a name="l03444"></a>03444                   goto 299 
<a name="l03445"></a>03445                <span class="keyword">endif</span> 
<a name="l03446"></a>03446             <span class="keyword">enddo</span> 
<a name="l03447"></a>03447   299       continue 
<a name="l03448"></a>03448          <span class="keyword">else</span> 
<a name="l03449"></a>03449 <span class="comment">! 300       nr = nr + 1    MHC</span>
<a name="l03450"></a>03450             nr = nr + 1 
<a name="l03451"></a>03451             kvstr(nr) = i 
<a name="l03452"></a>03452          <span class="keyword">endif</span> 
<a name="l03453"></a>03453       <span class="keyword">enddo</span> 
<a name="l03454"></a>03454       kvstr(nr+1) = n+1 
<a name="l03455"></a>03455 <span class="comment">!---------------------------------                                      </span>
<a name="l03456"></a>03456       return 
<a name="l03457"></a>03457 <span class="keyword">      end subroutine  csrkvstr</span>
<a name="l03458"></a>03458 
<a name="l03459"></a><a class="code" href="namespaceunary__mod.html#ab6a2e48e86f78322c5efe201bd4af52d">03459</a>       <span class="keyword">subroutine </span><a class="code" href="namespaceunary__mod.html#ab6a2e48e86f78322c5efe201bd4af52d">csrkvstc</a>(n, ia, ja, nc, kvstc, iwk) 
<a name="l03460"></a>03460 
<a name="l03461"></a>03461 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l03462"></a>03462       <span class="keywordtype">integer</span> n, ia(n+1), ja(*), nc, kvstc(*), iwk(*) 
<a name="l03463"></a>03463 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l03464"></a>03464 <span class="comment">!     Finds block column partitioning of matrix in CSR format.          </span>
<a name="l03465"></a>03465 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l03466"></a>03466 <span class="comment">!     On entry:                                                         </span>
<a name="l03467"></a>03467 <span class="comment">!--------------                                                         </span>
<a name="l03468"></a>03468 <span class="comment">!     n       = number of matrix scalar rows                            </span>
<a name="l03469"></a>03469 <span class="comment">!     ia,ja   = input matrix sparsity structure in CSR format           </span>
<a name="l03470"></a>03470 <span class="comment">!                                                                       </span>
<a name="l03471"></a>03471 <span class="comment">!     On return:                                                        </span>
<a name="l03472"></a>03472 <span class="comment">!---------------                                                        </span>
<a name="l03473"></a>03473 <span class="comment">!     nc      = number of block columns                                 </span>
<a name="l03474"></a>03474 <span class="comment">!     kvstc   = first column number for each block column               </span>
<a name="l03475"></a>03475 <span class="comment">!                                                                       </span>
<a name="l03476"></a>03476 <span class="comment">!     Work space:                                                       </span>
<a name="l03477"></a>03477 <span class="comment">!----------------                                                       </span>
<a name="l03478"></a>03478 <span class="comment">!     iwk(*) of size equal to the number of scalar columns plus one.    </span>
<a name="l03479"></a>03479 <span class="comment">!        Assumed initialized to 0, and left initialized on return.      </span>
<a name="l03480"></a>03480 <span class="comment">!                                                                       </span>
<a name="l03481"></a>03481 <span class="comment">!     Notes:                                                            </span>
<a name="l03482"></a>03482 <span class="comment">!-----------                                                            </span>
<a name="l03483"></a>03483 <span class="comment">!     Assumes that the matrix is sorted by columns.                     </span>
<a name="l03484"></a>03484 <span class="comment">!                                                                       </span>
<a name="l03485"></a>03485 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l03486"></a>03486 <span class="comment">!     local variables                                                   </span>
<a name="l03487"></a>03487       <span class="keywordtype">integer</span> i, j, k, ncol 
<a name="l03488"></a>03488 <span class="comment">!                                                                       </span>
<a name="l03489"></a>03489 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l03490"></a>03490 <span class="comment">!-----use ncol to find maximum scalar column number                     </span>
<a name="l03491"></a>03491       ncol = 0 
<a name="l03492"></a>03492 <span class="comment">!-----mark the beginning position of the blocks in iwk                  </span>
<a name="l03493"></a>03493       <span class="keyword">do</span> i = 1, n 
<a name="l03494"></a>03494          <span class="keyword">if</span> (ia(i)  &lt;  ia(i+1)) <span class="keyword">then</span> 
<a name="l03495"></a>03495             j = ja(ia(i)) 
<a name="l03496"></a>03496             iwk(j) = 1 
<a name="l03497"></a>03497             <span class="keyword">do</span> k = ia(i)+1, ia(i+1)-1 
<a name="l03498"></a>03498                j = ja(k) 
<a name="l03499"></a>03499                <span class="keyword">if</span> (ja(k-1) /= j-1) <span class="keyword">then</span> 
<a name="l03500"></a>03500                   iwk(j) = 1 
<a name="l03501"></a>03501                   iwk(ja(k-1)+1) = 1 
<a name="l03502"></a>03502                <span class="keyword">endif</span> 
<a name="l03503"></a>03503             <span class="keyword">enddo</span> 
<a name="l03504"></a>03504             iwk(j+1) = 1 
<a name="l03505"></a>03505             ncol = max0(ncol, j) 
<a name="l03506"></a>03506          <span class="keyword">endif</span> 
<a name="l03507"></a>03507       <span class="keyword">enddo</span> 
<a name="l03508"></a>03508 <span class="comment">!---------------------------------                                      </span>
<a name="l03509"></a>03509       nc = 1 
<a name="l03510"></a>03510       kvstc(1) = 1 
<a name="l03511"></a>03511       <span class="keyword">do</span> i = 2, ncol+1 
<a name="l03512"></a>03512          <span class="keyword">if</span> (iwk(i) /= 0) <span class="keyword">then</span> 
<a name="l03513"></a>03513             nc = nc + 1 
<a name="l03514"></a>03514             kvstc(nc) = i 
<a name="l03515"></a>03515             iwk(i) = 0 
<a name="l03516"></a>03516          <span class="keyword">endif</span> 
<a name="l03517"></a>03517       <span class="keyword">enddo</span> 
<a name="l03518"></a>03518       nc = nc - 1 
<a name="l03519"></a>03519 <span class="comment">!---------------------------------                                      </span>
<a name="l03520"></a>03520       return 
<a name="l03521"></a>03521 <span class="keyword">      end subroutine  csrkvstc</span>
<a name="l03522"></a>03522 
<a name="l03523"></a>03523 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l03524"></a>03524 
<a name="l03525"></a><a class="code" href="namespaceunary__mod.html#a83317b26aa2bdbcda3eb607a41b1fbc1">03525</a>       <span class="keyword">subroutine </span><a class="code" href="namespaceunary__mod.html#a83317b26aa2bdbcda3eb607a41b1fbc1">kvstmerge</a>(nr, kvstr, nc, kvstc, n, kvst) 
<a name="l03526"></a>03526 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l03527"></a>03527       <span class="keywordtype">integer</span> nr, kvstr(nr+1), nc, kvstc(nc+1), n, kvst(*) 
<a name="l03528"></a>03528 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l03529"></a>03529 <span class="comment">!     Merges block partitionings, for conformal row/col pattern.        </span>
<a name="l03530"></a>03530 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l03531"></a>03531 <span class="comment">!     On entry:                                                         </span>
<a name="l03532"></a>03532 <span class="comment">!--------------                                                         </span>
<a name="l03533"></a>03533 <span class="comment">!     nr,nc   = matrix block row and block column dimension             </span>
<a name="l03534"></a>03534 <span class="comment">!     kvstr   = first row number for each block row                     </span>
<a name="l03535"></a>03535 <span class="comment">!     kvstc   = first column number for each block column               </span>
<a name="l03536"></a>03536 <span class="comment">!                                                                       </span>
<a name="l03537"></a>03537 <span class="comment">!     On return:                                                        </span>
<a name="l03538"></a>03538 <span class="comment">!---------------                                                        </span>
<a name="l03539"></a>03539 <span class="comment">!     n       = conformal row/col matrix block dimension                </span>
<a name="l03540"></a>03540 <span class="comment">!     kvst    = conformal row/col block partitioning                    </span>
<a name="l03541"></a>03541 <span class="comment">!                                                                       </span>
<a name="l03542"></a>03542 <span class="comment">!     Notes:                                                            </span>
<a name="l03543"></a>03543 <span class="comment">!-----------                                                            </span>
<a name="l03544"></a>03544 <span class="comment">!     If matrix is not square, this routine returns without warning.    </span>
<a name="l03545"></a>03545 <span class="comment">!                                                                       </span>
<a name="l03546"></a>03546 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l03547"></a>03547 <span class="comment">!-----local variables                                                   </span>
<a name="l03548"></a>03548       <span class="keywordtype">integer</span> i,j 
<a name="l03549"></a>03549 <span class="comment">!---------------------------------                                      </span>
<a name="l03550"></a>03550       <span class="keyword">if</span> (kvstr(nr+1)  /=  kvstc(nc+1)) return 
<a name="l03551"></a>03551       i = 1 
<a name="l03552"></a>03552       j = 1 
<a name="l03553"></a>03553       n = 1 
<a name="l03554"></a>03554   200 <span class="keyword">if</span> (i  &gt;  nr+1) <span class="keyword">then</span> 
<a name="l03555"></a>03555          kvst(n) = kvstc(j) 
<a name="l03556"></a>03556          j = j + 1 
<a name="l03557"></a>03557       elseif (j  &gt;  nc+1) <span class="keyword">then</span> 
<a name="l03558"></a>03558          kvst(n) = kvstr(i) 
<a name="l03559"></a>03559          i = i + 1 
<a name="l03560"></a>03560       elseif (kvstc(j)  ==  kvstr(i)) <span class="keyword">then</span> 
<a name="l03561"></a>03561          kvst(n) = kvstc(j) 
<a name="l03562"></a>03562          j = j + 1 
<a name="l03563"></a>03563          i = i + 1 
<a name="l03564"></a>03564       elseif (kvstc(j)  &lt;  kvstr(i)) <span class="keyword">then</span> 
<a name="l03565"></a>03565          kvst(n) = kvstc(j) 
<a name="l03566"></a>03566          j = j + 1 
<a name="l03567"></a>03567       <span class="keyword">else</span> 
<a name="l03568"></a>03568          kvst(n) = kvstr(i) 
<a name="l03569"></a>03569          i = i + 1 
<a name="l03570"></a>03570       <span class="keyword">endif</span> 
<a name="l03571"></a>03571       n = n + 1 
<a name="l03572"></a>03572       <span class="keyword">if</span> (i &lt;= nr+1 .or. j &lt;= nc+1) goto 200 
<a name="l03573"></a>03573       n = n - 2 
<a name="l03574"></a>03574 <span class="comment">!---------------------------------                                      </span>
<a name="l03575"></a>03575       return 
<a name="l03576"></a>03576 <span class="keyword">      end subroutine  kvstmerge</span>
<a name="l03577"></a>03577 
<a name="l03578"></a>03578 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l03579"></a><a class="code" href="namespaceunary__mod.html#a0b2722e1ac3c64f3c952ea05ca313a51">03579</a>   <span class="keyword">subroutine </span><a class="code" href="namespaceunary__mod.html#a0b2722e1ac3c64f3c952ea05ca313a51">amub</a> ( nrow, ncol, job, a, ja, ia, b, jb, ib, c, jc, ic, nzmax, &amp;
<a name="l03580"></a>03580     iw, ierr )
<a name="l03581"></a>03581 
<a name="l03582"></a>03582   <span class="comment">!*****************************************************************************80</span>
<a name="l03583"></a>03583   <span class="comment">!</span>
<a name="l03584"></a>03584   <span class="comment">!! AMUB performs the matrix product C = A * B.</span>
<a name="l03585"></a>03585   <span class="comment">!</span>
<a name="l03586"></a>03586   <span class="comment">!  Discussion:</span>
<a name="l03587"></a>03587   <span class="comment">!</span>
<a name="l03588"></a>03588   <span class="comment">!    The column dimension of B is not needed.</span>
<a name="l03589"></a>03589   <span class="comment">!</span>
<a name="l03590"></a>03590   <span class="comment">!  Modified:</span>
<a name="l03591"></a>03591   <span class="comment">!</span>
<a name="l03592"></a>03592   <span class="comment">!    08 January 2004</span>
<a name="l03593"></a>03593   <span class="comment">!</span>
<a name="l03594"></a>03594   <span class="comment">!  Author:</span>
<a name="l03595"></a>03595   <span class="comment">!</span>
<a name="l03596"></a>03596   <span class="comment">!    Youcef Saad</span>
<a name="l03597"></a>03597   <span class="comment">!</span>
<a name="l03598"></a>03598   <span class="comment">!  Parameters:</span>
<a name="l03599"></a>03599   <span class="comment">!</span>
<a name="l03600"></a>03600   <span class="comment">!    Input, integer ( kind = 4 ) NROW, the row dimension of the matrix.</span>
<a name="l03601"></a>03601   <span class="comment">!</span>
<a name="l03602"></a>03602   <span class="comment">!    Input, integer ( kind = 4 ) NCOL, the column dimension of the matrix.</span>
<a name="l03603"></a>03603   <span class="comment">!</span>
<a name="l03604"></a>03604   <span class="comment">!    Input, integer ( kind = 4 ) JOB, job indicator.  When JOB = 0, only the</span>
<a name="l03605"></a>03605   <span class="comment">!    structure is computed, that is, the arrays JC and IC, but the real values</span>
<a name="l03606"></a>03606   <span class="comment">!    are ignored.</span>
<a name="l03607"></a>03607   <span class="comment">!</span>
<a name="l03608"></a>03608   <span class="comment">!    Input, real A(*), integer ( kind = 4 ) JA(*), IA(NROW+1), the matrix in CSR</span>
<a name="l03609"></a>03609   <span class="comment">!    Compressed Sparse Row format.</span>
<a name="l03610"></a>03610   <span class="comment">!</span>
<a name="l03611"></a>03611   <span class="comment">!    Input, b, jb, ib, matrix B in compressed sparse row format.</span>
<a name="l03612"></a>03612   <span class="comment">!</span>
<a name="l03613"></a>03613   <span class="comment">!    Input, integer ( kind = 4 ) NZMAX, the length of the arrays c and jc.</span>
<a name="l03614"></a>03614   <span class="comment">!    The routine will stop if the result matrix C  has a number</span>
<a name="l03615"></a>03615   <span class="comment">!    of elements that exceeds exceeds NZMAX.</span>
<a name="l03616"></a>03616   <span class="comment">!</span>
<a name="l03617"></a>03617   <span class="comment">! on return:</span>
<a name="l03618"></a>03618   <span class="comment">!</span>
<a name="l03619"></a>03619   <span class="comment">! c,</span>
<a name="l03620"></a>03620   <span class="comment">! jc,</span>
<a name="l03621"></a>03621   <span class="comment">! ic    = resulting matrix C in compressed sparse row sparse format.</span>
<a name="l03622"></a>03622   <span class="comment">!</span>
<a name="l03623"></a>03623   <span class="comment">! ierr      = integer ( kind = 4 ). serving as error message.</span>
<a name="l03624"></a>03624   <span class="comment">!         ierr = 0 means normal return,</span>
<a name="l03625"></a>03625   <span class="comment">!         ierr &gt; 0 means that amub stopped while computing the</span>
<a name="l03626"></a>03626   <span class="comment">!         i-th row  of C with i = ierr, because the number</span>
<a name="l03627"></a>03627   <span class="comment">!         of elements in C exceeds nzmax.</span>
<a name="l03628"></a>03628   <span class="comment">!</span>
<a name="l03629"></a>03629   <span class="comment">! work arrays:</span>
<a name="l03630"></a>03630   <span class="comment">!</span>
<a name="l03631"></a>03631   <span class="comment">!  iw      = integer ( kind = 4 ) work array of length equal to the number of</span>
<a name="l03632"></a>03632   <span class="comment">!         columns in A.</span>
<a name="l03633"></a>03633   <span class="comment">!</span>
<a name="l03634"></a>03634     <span class="keyword">implicit none</span>
<a name="l03635"></a>03635 
<a name="l03636"></a>03636     <span class="keywordtype">integer</span> :: ncol
<a name="l03637"></a>03637     <span class="keywordtype">integer</span> :: nrow
<a name="l03638"></a>03638     <span class="keywordtype">integer</span> :: nzmax
<a name="l03639"></a>03639 
<a name="l03640"></a>03640     <span class="keywordtype">real(wp) </span>:: a(*)
<a name="l03641"></a>03641     <span class="keywordtype">real(wp) </span>:: b(*)
<a name="l03642"></a>03642     <span class="keywordtype">real(wp) </span>:: c(nzmax)
<a name="l03643"></a>03643     <span class="keywordtype">integer</span> :: ia(nrow+1)
<a name="l03644"></a>03644     <span class="keywordtype">integer</span> :: ib(ncol+1)
<a name="l03645"></a>03645     <span class="keywordtype">integer</span> :: ic(ncol+1)
<a name="l03646"></a>03646     <span class="keywordtype">integer</span> :: ierr
<a name="l03647"></a>03647     <span class="keywordtype">integer</span> :: ii
<a name="l03648"></a>03648     <span class="keywordtype">integer</span> :: iw(ncol)
<a name="l03649"></a>03649     <span class="keywordtype">integer</span> :: ja(*)
<a name="l03650"></a>03650     <span class="keywordtype">integer</span> :: jb(*)
<a name="l03651"></a>03651     <span class="keywordtype">integer</span> :: jc(nzmax)
<a name="l03652"></a>03652     <span class="keywordtype">integer</span> :: jcol
<a name="l03653"></a>03653     <span class="keywordtype">integer</span> :: jj
<a name="l03654"></a>03654     <span class="keywordtype">integer</span> :: job
<a name="l03655"></a>03655     <span class="keywordtype">integer</span> :: jpos
<a name="l03656"></a>03656     <span class="keywordtype">integer</span> :: k
<a name="l03657"></a>03657     <span class="keywordtype">integer</span> :: ka
<a name="l03658"></a>03658     <span class="keywordtype">integer</span> :: kb
<a name="l03659"></a>03659     <span class="keywordtype">integer</span> :: len
<a name="l03660"></a>03660     <span class="keywordtype">real(wp) </span>:: scal
<a name="l03661"></a>03661     <span class="keywordtype">logical</span> :: values
<a name="l03662"></a>03662 
<a name="l03663"></a>03663     values = ( job /= 0 )
<a name="l03664"></a>03664     len = 0
<a name="l03665"></a>03665     ic(1) = 1
<a name="l03666"></a>03666     ierr = 0
<a name="l03667"></a>03667     scal = 0.0_wp
<a name="l03668"></a>03668   <span class="comment">!</span>
<a name="l03669"></a>03669   <span class="comment">!  Initialize IW.</span>
<a name="l03670"></a>03670   <span class="comment">!</span>
<a name="l03671"></a>03671     iw(1:ncol) = 0
<a name="l03672"></a>03672 
<a name="l03673"></a>03673     <span class="keyword">do</span> ii = 1, nrow
<a name="l03674"></a>03674   <span class="comment">!</span>
<a name="l03675"></a>03675   <span class="comment">!  Row I.</span>
<a name="l03676"></a>03676   <span class="comment">!</span>
<a name="l03677"></a>03677       <span class="keyword">do</span> ka = ia(ii), ia(ii+1)-1
<a name="l03678"></a>03678 
<a name="l03679"></a>03679         <span class="keyword">if</span> ( values ) <span class="keyword">then</span>
<a name="l03680"></a>03680           scal = a(ka)
<a name="l03681"></a>03681         <span class="keyword">end if</span>
<a name="l03682"></a>03682 
<a name="l03683"></a>03683         jj = ja(ka)
<a name="l03684"></a>03684 
<a name="l03685"></a>03685         <span class="keyword">do</span> kb = ib(jj), ib(jj+1)-1
<a name="l03686"></a>03686 
<a name="l03687"></a>03687              jcol = jb(kb)
<a name="l03688"></a>03688              jpos = iw(jcol)
<a name="l03689"></a>03689 
<a name="l03690"></a>03690              <span class="keyword">if</span> ( jpos == 0 ) <span class="keyword">then</span>
<a name="l03691"></a>03691                 len = len + 1
<a name="l03692"></a>03692                 <span class="keyword">if</span> ( nzmax &lt; len ) <span class="keyword">then</span>
<a name="l03693"></a>03693                    ierr = ii
<a name="l03694"></a>03694                    return
<a name="l03695"></a>03695                 <span class="keyword">end if</span>
<a name="l03696"></a>03696                 jc(len) = jcol
<a name="l03697"></a>03697                 iw(jcol)= len
<a name="l03698"></a>03698                 <span class="keyword">if</span> ( values ) <span class="keyword">then</span>
<a name="l03699"></a>03699                   c(len) = scal * b(kb)
<a name="l03700"></a>03700                 <span class="keyword">end if</span>
<a name="l03701"></a>03701              <span class="keyword">else</span>
<a name="l03702"></a>03702                 <span class="keyword">if</span> ( values ) <span class="keyword">then</span>
<a name="l03703"></a>03703                   c(jpos) = c(jpos) + scal * b(kb)
<a name="l03704"></a>03704                 <span class="keyword">end if</span>
<a name="l03705"></a>03705              <span class="keyword">end if</span>
<a name="l03706"></a>03706 
<a name="l03707"></a>03707            <span class="keyword">end do</span>
<a name="l03708"></a>03708 
<a name="l03709"></a>03709       <span class="keyword">end do</span>
<a name="l03710"></a>03710 
<a name="l03711"></a>03711       <span class="keyword">do</span> k = ic(ii), len
<a name="l03712"></a>03712         iw(jc(k)) = 0
<a name="l03713"></a>03713       <span class="keyword">end do</span>
<a name="l03714"></a>03714 
<a name="l03715"></a>03715       ic(ii+1) = len + 1
<a name="l03716"></a>03716 
<a name="l03717"></a>03717     <span class="keyword">end do</span>
<a name="l03718"></a>03718 
<a name="l03719"></a>03719     return
<a name="l03720"></a>03720 <span class="keyword">  end subroutine amub</span>
<a name="l03721"></a>03721 
<a name="l03722"></a>03722 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l03723"></a>03723 
<a name="l03724"></a><a class="code" href="namespaceunary__mod.html#aa13625ff5a681041e10a45dc75e46dcc">03724</a>   <span class="keywordtype">pure</span> <span class="keyword">subroutine </span><a class="code" href="namespaceunary__mod.html#aa13625ff5a681041e10a45dc75e46dcc">a_sc_mu_b_bl</a>(nrow,ncol,nb,a,ja,ia,b,jb,ib,c,jc,ic,nzmax,iw,ierr)                          
<a name="l03725"></a>03725 
<a name="l03726"></a>03726       <span class="keyword">implicit none</span>
<a name="l03727"></a>03727 
<a name="l03728"></a>03728       <span class="keywordtype">integer</span>,                      <span class="keywordtype">intent(in)</span>    :: nrow, ncol, nb, nzmax
<a name="l03729"></a>03729       <span class="keywordtype">real(wp)</span>, <span class="keywordtype">dimension(*)</span>,       <span class="keywordtype">intent(in)</span>    ::  a
<a name="l03730"></a>03730       <span class="keywordtype">real(wp)</span>, <span class="keywordtype">dimension(nb,nb,*)</span>, <span class="keywordtype">intent(in)</span>    ::  b
<a name="l03731"></a>03731       <span class="keywordtype">real(wp)</span>, <span class="keywordtype">dimension(nb,nb,*)</span>, <span class="keywordtype">intent(out)</span>   ::  c
<a name="l03732"></a>03732       
<a name="l03733"></a>03733       <span class="keywordtype">integer</span>, <span class="keywordtype">dimension(nrow+1)</span>,   <span class="keywordtype">intent(in)</span>    :: ia
<a name="l03734"></a>03734       <span class="keywordtype">integer</span>, <span class="keywordtype">dimension(*)</span>,        <span class="keywordtype">intent(in)</span>    :: ja
<a name="l03735"></a>03735       <span class="keywordtype">integer</span>, <span class="keywordtype">dimension(*)</span>,        <span class="keywordtype">intent(in)</span>    :: ib,jb
<a name="l03736"></a>03736       <span class="keywordtype">integer</span>, <span class="keywordtype">dimension(*)</span>,        <span class="keywordtype">intent(out)</span>   :: ic,jc
<a name="l03737"></a>03737  
<a name="l03738"></a>03738       <span class="keywordtype">integer</span>, <span class="keywordtype">dimension(*)</span>,       <span class="keywordtype">intent(inout)</span> :: iw
<a name="l03739"></a>03739 
<a name="l03740"></a>03740       <span class="keywordtype">integer</span>,                     <span class="keywordtype">intent(out)</span>   :: ierr
<a name="l03741"></a>03741 
<a name="l03742"></a>03742       <span class="keywordtype">integer</span>                  :: k,ka,jj,ii,j,jcol,jpos,kb,len
<a name="l03743"></a>03743 
<a name="l03744"></a>03744       <span class="keywordtype">real(wp)                                  </span>:: scal 
<a name="l03745"></a>03745 
<a name="l03746"></a>03746 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l03747"></a>03747 <span class="comment">! performs the matrix by matrix product C = (A tensor product I_nb) B  and </span>
<a name="l03748"></a>03748 <span class="comment">! stores the resulting matrix in thr 3D array C whose shape is (nb,nb,nzmax)</span>
<a name="l03749"></a>03749 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l03750"></a>03750 <span class="comment">! on entry:  </span>
<a name="l03751"></a>03751 <span class="comment">! ---------                                                             </span>
<a name="l03752"></a>03752 <span class="comment">! nrow  = integer. The row dimension of A          </span>
<a name="l03753"></a>03753 <span class="comment">! ncol  = integer. The column dimension of B   </span>
<a name="l03754"></a>03754 <span class="comment">! nb    = integer. The block size of the matrices a, b, and c </span>
<a name="l03755"></a>03755 <span class="comment">!                                                                       </span>
<a name="l03756"></a>03756 <span class="comment">! a,  ja, ia ; Matrix A in compressed sparse row format.                      </span>
<a name="l03757"></a>03757 <span class="comment">! b,  jb, ib ; Matrix B in compressed sparse row format.                    </span>
<a name="l03758"></a>03758 <span class="comment">!                                                                       </span>
<a name="l03759"></a>03759 <span class="comment">! nzmax = integer. The  length of the arrays c and jc.                  </span>
<a name="l03760"></a>03760 <span class="comment">!         a_sc_mu_b_bl will stop if the result matrix C has a number           </span>
<a name="l03761"></a>03761 <span class="comment">!         of elements that exceeds exceeds nzmax. See ierr.</span>
<a name="l03762"></a>03762 <span class="comment">!                                                                       </span>
<a name="l03763"></a>03763 <span class="comment">! on return: ! ----------                                                             </span>
<a name="l03764"></a>03764 <span class="comment">! c,  jc, ic ; resulting matrix C in compressed sparse row sparse format.  </span>
<a name="l03765"></a>03765 <span class="comment">!              Each element of the vector c is a block of size nb.</span>
<a name="l03766"></a>03766 <span class="comment">!                                                                       </span>
<a name="l03767"></a>03767 <span class="comment">! ierr  = integer. serving as error message.                            </span>
<a name="l03768"></a>03768 <span class="comment">!         ierr = 0 means normal return,                                 </span>
<a name="l03769"></a>03769 <span class="comment">!         ierr  &gt;  0 means that amub stopped while computing the       </span>
<a name="l03770"></a>03770 <span class="comment">!         i-th row  of C with i=ierr, because the number                </span>
<a name="l03771"></a>03771 <span class="comment">!         of elements in C exceeds nzmax.                               </span>
<a name="l03772"></a>03772 <span class="comment">!                                                                       </span>
<a name="l03773"></a>03773 <span class="comment">! work arrays:                                                          </span>
<a name="l03774"></a>03774 <span class="comment">!------------                                                           </span>
<a name="l03775"></a>03775 <span class="comment">! iw    = integer work array of length equal to the number of columns in A.                                                 </span>
<a name="l03776"></a>03776 
<a name="l03777"></a>03777 <span class="comment">!   The row dimension of B is not needed. However there is no checking  </span>
<a name="l03778"></a>03778 <span class="comment">!   on the condition that ncol(A) = nrow(B).                            </span>
<a name="l03779"></a>03779 
<a name="l03780"></a>03780       continue
<a name="l03781"></a>03781 
<a name="l03782"></a>03782       len   = 0 
<a name="l03783"></a>03783       ic(1) = 1 
<a name="l03784"></a>03784       ierr  = 0 
<a name="l03785"></a>03785 
<a name="l03786"></a>03786 <span class="comment">!     initialize array iw.                                              </span>
<a name="l03787"></a>03787       <span class="keyword">do</span> j=1, ncol 
<a name="l03788"></a>03788          iw(j) = 0 
<a name="l03789"></a>03789       <span class="keyword">enddo</span>
<a name="l03790"></a>03790 <span class="comment">!                                                                       </span>
<a name="l03791"></a>03791       <span class="keyword">do</span> ii=1, nrow                   <span class="comment">!     row i                                                             </span>
<a name="l03792"></a>03792 
<a name="l03793"></a>03793          <span class="keyword">do</span> ka=ia(ii), ia(ii+1)-1 
<a name="l03794"></a>03794 
<a name="l03795"></a>03795                  scal =  a(ka) 
<a name="l03796"></a>03796                  jj   = ja(ka) 
<a name="l03797"></a>03797 
<a name="l03798"></a>03798             <span class="keyword">do</span> kb=ib(jj),ib(jj+1)-1 
<a name="l03799"></a>03799                jcol = jb(kb) 
<a name="l03800"></a>03800                jpos = iw(jcol) 
<a name="l03801"></a>03801                <span class="keyword">if</span> (jpos  ==  0) <span class="keyword">then</span> 
<a name="l03802"></a>03802                   len = len+1 
<a name="l03803"></a>03803                   <span class="keyword">if</span> (len  &gt;  nzmax) <span class="keyword">then</span> 
<a name="l03804"></a>03804                      ierr = ii 
<a name="l03805"></a>03805                      return 
<a name="l03806"></a>03806                   <span class="keyword">endif</span> 
<a name="l03807"></a>03807                   jc(len) = jcol 
<a name="l03808"></a>03808                   iw(jcol)= len 
<a name="l03809"></a>03809                   c(:,:,len)  = scal*b(:,:,kb)
<a name="l03810"></a>03810                <span class="keyword">else</span> 
<a name="l03811"></a>03811                   c(:,:,jpos) = c(:,:,jpos) + scal*b(:,:,kb) 
<a name="l03812"></a>03812                <span class="keyword">endif</span> 
<a name="l03813"></a>03813             <span class="keyword">enddo</span>
<a name="l03814"></a>03814 
<a name="l03815"></a>03815          <span class="keyword">enddo</span>
<a name="l03816"></a>03816 
<a name="l03817"></a>03817          <span class="keyword">do</span> k=ic(ii), len 
<a name="l03818"></a>03818             iw(jc(k)) = 0 
<a name="l03819"></a>03819          <span class="keyword">enddo</span>
<a name="l03820"></a>03820 
<a name="l03821"></a>03821          ic(ii+1) = len+1 
<a name="l03822"></a>03822 
<a name="l03823"></a>03823       <span class="keyword">enddo</span>
<a name="l03824"></a>03824 
<a name="l03825"></a>03825 <span class="keyword">      end subroutine a_sc_mu_b_bl</span>
<a name="l03826"></a>03826 
<a name="l03827"></a>03827 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l03828"></a>03828 
<a name="l03829"></a><a class="code" href="namespaceunary__mod.html#a567f589fa5c03090c85884b98e93e19d">03829</a>   <span class="keywordtype">pure</span> <span class="keyword">subroutine </span><a class="code" href="namespaceunary__mod.html#a567f589fa5c03090c85884b98e93e19d">a_bl_mu_b_bl</a>(nrow,ncol,nb,a,ja,ia,b,jb,ib,c,jc,ic,nzmax,iw,ierr)                          
<a name="l03830"></a>03830 
<a name="l03831"></a>03831       <span class="keyword">implicit none</span>
<a name="l03832"></a>03832 
<a name="l03833"></a>03833       <span class="keywordtype">integer</span>,                      <span class="keywordtype">intent(in)</span>    :: nrow, ncol, nb, nzmax
<a name="l03834"></a>03834       <span class="keywordtype">real(wp)</span>, <span class="keywordtype">dimension(nb,nb,*)</span>, <span class="keywordtype">intent(in)</span>    ::  a
<a name="l03835"></a>03835       <span class="keywordtype">real(wp)</span>, <span class="keywordtype">dimension(nb,nb,*)</span>, <span class="keywordtype">intent(in)</span>    ::  b
<a name="l03836"></a>03836       <span class="keywordtype">real(wp)</span>, <span class="keywordtype">dimension(nb,nb,*)</span>, <span class="keywordtype">intent(out)</span>   ::  c
<a name="l03837"></a>03837       
<a name="l03838"></a>03838       <span class="keywordtype">integer</span>, <span class="keywordtype">dimension(nrow+1)</span>,   <span class="keywordtype">intent(in)</span>    :: ia
<a name="l03839"></a>03839       <span class="keywordtype">integer</span>, <span class="keywordtype">dimension(*)</span>,        <span class="keywordtype">intent(in)</span>    :: ja
<a name="l03840"></a>03840       <span class="keywordtype">integer</span>, <span class="keywordtype">dimension(*)</span>,        <span class="keywordtype">intent(in)</span>    :: ib,jb
<a name="l03841"></a>03841       <span class="keywordtype">integer</span>, <span class="keywordtype">dimension(*)</span>,        <span class="keywordtype">intent(out)</span>   :: ic,jc
<a name="l03842"></a>03842 
<a name="l03843"></a>03843       <span class="keywordtype">integer</span>, <span class="keywordtype">dimension(*)</span>,        <span class="keywordtype">intent(inout)</span> :: iw
<a name="l03844"></a>03844 
<a name="l03845"></a>03845       <span class="keywordtype">integer</span>,                      <span class="keywordtype">intent(out)</span>   :: ierr
<a name="l03846"></a>03846 
<a name="l03847"></a>03847       <span class="keywordtype">integer</span>                  :: k,ka,jj,ii,j,jcol,jpos,kb,len
<a name="l03848"></a>03848 
<a name="l03849"></a>03849       <span class="keywordtype">real(wp)</span>, <span class="keywordtype">dimension(nb,nb)                </span>:: scal 
<a name="l03850"></a>03850 
<a name="l03851"></a>03851 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l03852"></a>03852 <span class="comment">! performs the matrix by matrix product C = A B                         </span>
<a name="l03853"></a>03853 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l03854"></a>03854 <span class="comment">!</span>
<a name="l03855"></a>03855 <span class="comment">! on entry:  </span>
<a name="l03856"></a>03856 <span class="comment">! ---------                                                             </span>
<a name="l03857"></a>03857 <span class="comment">! nrow  = integer. The row dimension of A = row dimension of C          </span>
<a name="l03858"></a>03858 <span class="comment">! ncol  = integer. The column dimension of B = column dimension of C    </span>
<a name="l03859"></a>03859 <span class="comment">! nb    = integer. The block size of the matrices a, b, and c </span>
<a name="l03860"></a>03860 <span class="comment">!                                                                       </span>
<a name="l03861"></a>03861 <span class="comment">! a,  ja, ia ; Matrix A in compressed sparse row format.                      </span>
<a name="l03862"></a>03862 <span class="comment">! b,  jb, ib ; Matrix B in compressed sparse row format.                    </span>
<a name="l03863"></a>03863 <span class="comment">!                                                                       </span>
<a name="l03864"></a>03864 <span class="comment">! nzmax = integer. The  length of the arrays c and jc.                  </span>
<a name="l03865"></a>03865 <span class="comment">!         amub will stop if the result matrix C  has a number           </span>
<a name="l03866"></a>03866 <span class="comment">!         of elements that exceeds exceeds nzmax. See ierr.             </span>
<a name="l03867"></a>03867 <span class="comment">!                                                                       </span>
<a name="l03868"></a>03868 <span class="comment">! on return: ! ----------                                                             </span>
<a name="l03869"></a>03869 <span class="comment">! c,  jc, ic ; resulting matrix C in compressed sparse row sparse format.    </span>
<a name="l03870"></a>03870 <span class="comment">!                                                                       </span>
<a name="l03871"></a>03871 <span class="comment">! ierr  = integer. serving as error message.                            </span>
<a name="l03872"></a>03872 <span class="comment">!         ierr = 0 means normal return,                                 </span>
<a name="l03873"></a>03873 <span class="comment">!         ierr  &gt;  0 means that amub stopped while computing the       </span>
<a name="l03874"></a>03874 <span class="comment">!         i-th row  of C with i=ierr, because the number                </span>
<a name="l03875"></a>03875 <span class="comment">!         of elements in C exceeds nzmax.                               </span>
<a name="l03876"></a>03876 <span class="comment">!                                                                       </span>
<a name="l03877"></a>03877 <span class="comment">! work arrays:                                                          </span>
<a name="l03878"></a>03878 <span class="comment">!------------                                                           </span>
<a name="l03879"></a>03879 <span class="comment">! iw    = integer work array of length equal to the number of columns in A.                                                 </span>
<a name="l03880"></a>03880 
<a name="l03881"></a>03881 <span class="comment">!   The row dimension of B is not needed. However there is no checking  </span>
<a name="l03882"></a>03882 <span class="comment">!   on the condition that ncol(A) = nrow(B).                            </span>
<a name="l03883"></a>03883 
<a name="l03884"></a>03884       continue
<a name="l03885"></a>03885 
<a name="l03886"></a>03886       len   = 0 
<a name="l03887"></a>03887       ic(1) = 1 
<a name="l03888"></a>03888       ierr  = 0 
<a name="l03889"></a>03889 
<a name="l03890"></a>03890 <span class="comment">!     initialize array iw.                                              </span>
<a name="l03891"></a>03891       <span class="keyword">do</span> j=1, ncol 
<a name="l03892"></a>03892          iw(j) = 0 
<a name="l03893"></a>03893       <span class="keyword">enddo</span>
<a name="l03894"></a>03894 <span class="comment">!                                                                       </span>
<a name="l03895"></a>03895       <span class="keyword">do</span> ii=1, nrow                   <span class="comment">!     row i                                                             </span>
<a name="l03896"></a>03896 
<a name="l03897"></a>03897          <span class="keyword">do</span> ka=ia(ii), ia(ii+1)-1 
<a name="l03898"></a>03898 
<a name="l03899"></a>03899             scal(:,:) = a (:,:,ka) 
<a name="l03900"></a>03900                  jj   = ja(    ka) 
<a name="l03901"></a>03901 
<a name="l03902"></a>03902             <span class="keyword">do</span> kb=ib(jj),ib(jj+1)-1 
<a name="l03903"></a>03903                jcol = jb(kb) 
<a name="l03904"></a>03904                jpos = iw(jcol) 
<a name="l03905"></a>03905                <span class="keyword">if</span> (jpos  ==  0) <span class="keyword">then</span> 
<a name="l03906"></a>03906                   len = len+1 
<a name="l03907"></a>03907                   <span class="keyword">if</span> (len  &gt;  nzmax) <span class="keyword">then</span> 
<a name="l03908"></a>03908                      ierr = ii 
<a name="l03909"></a>03909                      return 
<a name="l03910"></a>03910                   <span class="keyword">endif</span> 
<a name="l03911"></a>03911                   jc(len) = jcol 
<a name="l03912"></a>03912                   iw(jcol)= len 
<a name="l03913"></a>03913                   c(:,:,len)  = matmul( scal(:,:),b(:,:,kb) )
<a name="l03914"></a>03914                <span class="keyword">else</span> 
<a name="l03915"></a>03915                   c(:,:,jpos) = c(:,:,jpos) + matmul( scal(:,:),b(:,:,kb) )
<a name="l03916"></a>03916                <span class="keyword">endif</span> 
<a name="l03917"></a>03917             <span class="keyword">enddo</span>
<a name="l03918"></a>03918 
<a name="l03919"></a>03919          <span class="keyword">enddo</span>
<a name="l03920"></a>03920 
<a name="l03921"></a>03921          <span class="keyword">do</span> k=ic(ii), len 
<a name="l03922"></a>03922             iw(jc(k)) = 0 
<a name="l03923"></a>03923          <span class="keyword">enddo</span>
<a name="l03924"></a>03924 
<a name="l03925"></a>03925          ic(ii+1) = len+1 
<a name="l03926"></a>03926 
<a name="l03927"></a>03927       <span class="keyword">enddo</span>
<a name="l03928"></a>03928 
<a name="l03929"></a>03929 <span class="keyword">      end subroutine a_bl_mu_b_bl</span>
<a name="l03930"></a>03930 
<a name="l03931"></a>03931 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l03932"></a>03932 
<a name="l03933"></a><a class="code" href="namespaceunary__mod.html#a14f70b4fba629443e7b35cfe21e3b76d">03933</a>   <span class="keywordtype">pure</span> <span class="keyword">subroutine </span><a class="code" href="namespaceunary__mod.html#a14f70b4fba629443e7b35cfe21e3b76d">a_bl_mu_b_sc</a>(nrow,ncol,nb,a,ja,ia,b,jb,ib,c,jc,ic,nzmax,iw,ierr)                          
<a name="l03934"></a>03934 
<a name="l03935"></a>03935       <span class="keyword">implicit none</span>
<a name="l03936"></a>03936 
<a name="l03937"></a>03937       <span class="keywordtype">integer</span>,                      <span class="keywordtype">intent(in)</span>    :: nrow, ncol, nb, nzmax
<a name="l03938"></a>03938       <span class="keywordtype">real(wp)</span>, <span class="keywordtype">dimension(nb,nb,*)</span>, <span class="keywordtype">intent(in)</span>    ::  a
<a name="l03939"></a>03939       <span class="keywordtype">real(wp)</span>, <span class="keywordtype">dimension(*)</span>,       <span class="keywordtype">intent(in)</span>    ::  b
<a name="l03940"></a>03940       <span class="keywordtype">real(wp)</span>, <span class="keywordtype">dimension(nb,nb,*)</span>, <span class="keywordtype">intent(out)</span>   ::  c
<a name="l03941"></a>03941       
<a name="l03942"></a>03942       <span class="keywordtype">integer</span>, <span class="keywordtype">dimension(nrow+1)</span>,   <span class="keywordtype">intent(in)</span>    :: ia
<a name="l03943"></a>03943       <span class="keywordtype">integer</span>, <span class="keywordtype">dimension(*)</span>,        <span class="keywordtype">intent(in)</span>    :: ja
<a name="l03944"></a>03944       <span class="keywordtype">integer</span>, <span class="keywordtype">dimension(*)</span>,        <span class="keywordtype">intent(in)</span>    :: ib,jb
<a name="l03945"></a>03945       <span class="keywordtype">integer</span>, <span class="keywordtype">dimension(*)</span>,        <span class="keywordtype">intent(out)</span>   :: ic,jc
<a name="l03946"></a>03946 
<a name="l03947"></a>03947       <span class="keywordtype">integer</span>, <span class="keywordtype">dimension(*)</span>,        <span class="keywordtype">intent(inout)</span> :: iw
<a name="l03948"></a>03948 
<a name="l03949"></a>03949       <span class="keywordtype">integer</span>,                      <span class="keywordtype">intent(out)</span>   :: ierr
<a name="l03950"></a>03950 
<a name="l03951"></a>03951       <span class="keywordtype">integer</span>                  :: k,ka,jj,ii,j,jcol,jpos,kb,len
<a name="l03952"></a>03952 
<a name="l03953"></a>03953       <span class="keywordtype">real(wp)</span>, <span class="keywordtype">dimension(nb,nb)                </span>:: scal 
<a name="l03954"></a>03954 
<a name="l03955"></a>03955 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l03956"></a>03956 <span class="comment">! performs the matrix by matrix product C = A B                         </span>
<a name="l03957"></a>03957 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l03958"></a>03958 <span class="comment">!</span>
<a name="l03959"></a>03959 <span class="comment">! on entry:  </span>
<a name="l03960"></a>03960 <span class="comment">! ---------                                                             </span>
<a name="l03961"></a>03961 <span class="comment">! nrow  = integer. The row dimension of A = row dimension of C          </span>
<a name="l03962"></a>03962 <span class="comment">! ncol  = integer. The column dimension of B = column dimension of C    </span>
<a name="l03963"></a>03963 <span class="comment">! nb    = integer. The block size of the matrices a, b, and c </span>
<a name="l03964"></a>03964 <span class="comment">!                                                                       </span>
<a name="l03965"></a>03965 <span class="comment">! a,  ja, ia ; Matrix A in compressed sparse row format.                      </span>
<a name="l03966"></a>03966 <span class="comment">! b,  jb, ib ; Matrix B in compressed sparse row format.                    </span>
<a name="l03967"></a>03967 <span class="comment">!                                                                       </span>
<a name="l03968"></a>03968 <span class="comment">! nzmax = integer. The  length of the arrays c and jc.                  </span>
<a name="l03969"></a>03969 <span class="comment">!         amub will stop if the result matrix C  has a number           </span>
<a name="l03970"></a>03970 <span class="comment">!         of elements that exceeds exceeds nzmax. See ierr.             </span>
<a name="l03971"></a>03971 <span class="comment">!                                                                       </span>
<a name="l03972"></a>03972 <span class="comment">! on return: ! ----------                                                             </span>
<a name="l03973"></a>03973 <span class="comment">! c,  jc, ic ; resulting matrix C in compressed sparse row sparse format.    </span>
<a name="l03974"></a>03974 <span class="comment">!                                                                       </span>
<a name="l03975"></a>03975 <span class="comment">! ierr  = integer. serving as error message.                            </span>
<a name="l03976"></a>03976 <span class="comment">!         ierr = 0 means normal return,                                 </span>
<a name="l03977"></a>03977 <span class="comment">!         ierr  &gt;  0 means that amub stopped while computing the       </span>
<a name="l03978"></a>03978 <span class="comment">!         i-th row  of C with i=ierr, because the number                </span>
<a name="l03979"></a>03979 <span class="comment">!         of elements in C exceeds nzmax.                               </span>
<a name="l03980"></a>03980 <span class="comment">!                                                                       </span>
<a name="l03981"></a>03981 <span class="comment">! work arrays:                                                          </span>
<a name="l03982"></a>03982 <span class="comment">!------------                                                           </span>
<a name="l03983"></a>03983 <span class="comment">! iw    = integer work array of length equal to the number of columns in A.                                                 </span>
<a name="l03984"></a>03984 
<a name="l03985"></a>03985 <span class="comment">!   The row dimension of B is not needed. However there is no checking  </span>
<a name="l03986"></a>03986 <span class="comment">!   on the condition that ncol(A) = nrow(B).                            </span>
<a name="l03987"></a>03987 
<a name="l03988"></a>03988       continue
<a name="l03989"></a>03989 
<a name="l03990"></a>03990       len   = 0 
<a name="l03991"></a>03991       ic(1) = 1 
<a name="l03992"></a>03992       ierr  = 0 
<a name="l03993"></a>03993 
<a name="l03994"></a>03994 <span class="comment">!     initialize array iw.                                              </span>
<a name="l03995"></a>03995       <span class="keyword">do</span> j=1, ncol 
<a name="l03996"></a>03996          iw(j) = 0 
<a name="l03997"></a>03997       <span class="keyword">enddo</span>
<a name="l03998"></a>03998 <span class="comment">!                                                                       </span>
<a name="l03999"></a>03999       <span class="keyword">do</span> ii=1, nrow                   <span class="comment">!     row i                                                             </span>
<a name="l04000"></a>04000 
<a name="l04001"></a>04001          <span class="keyword">do</span> ka=ia(ii), ia(ii+1)-1 
<a name="l04002"></a>04002 
<a name="l04003"></a>04003             scal(:,:) =  a(:,:,ka) 
<a name="l04004"></a>04004                  jj   = ja(    ka) 
<a name="l04005"></a>04005 
<a name="l04006"></a>04006             <span class="keyword">do</span> kb=ib(jj),ib(jj+1)-1 
<a name="l04007"></a>04007                jcol = jb(kb) 
<a name="l04008"></a>04008                jpos = iw(jcol) 
<a name="l04009"></a>04009                <span class="keyword">if</span> (jpos  ==  0) <span class="keyword">then</span> 
<a name="l04010"></a>04010                   len = len+1 
<a name="l04011"></a>04011                   <span class="keyword">if</span> (len  &gt;  nzmax) <span class="keyword">then</span> 
<a name="l04012"></a>04012                      ierr = ii 
<a name="l04013"></a>04013                      return 
<a name="l04014"></a>04014                   <span class="keyword">endif</span> 
<a name="l04015"></a>04015                   jc(len) = jcol 
<a name="l04016"></a>04016                   iw(jcol)= len 
<a name="l04017"></a>04017                   c(:,:,len)  =             + scal(:,:) * b(kb) 
<a name="l04018"></a>04018                <span class="keyword">else</span> 
<a name="l04019"></a>04019                   c(:,:,jpos) = c(:,:,jpos) + scal(:,:) * b(kb)
<a name="l04020"></a>04020                <span class="keyword">endif</span> 
<a name="l04021"></a>04021             <span class="keyword">enddo</span>
<a name="l04022"></a>04022 
<a name="l04023"></a>04023          <span class="keyword">enddo</span>
<a name="l04024"></a>04024 
<a name="l04025"></a>04025          <span class="keyword">do</span> k=ic(ii), len 
<a name="l04026"></a>04026             iw(jc(k)) = 0 
<a name="l04027"></a>04027          <span class="keyword">enddo</span>
<a name="l04028"></a>04028 
<a name="l04029"></a>04029          ic(ii+1) = len+1 
<a name="l04030"></a>04030 
<a name="l04031"></a>04031       <span class="keyword">enddo</span>
<a name="l04032"></a>04032 
<a name="l04033"></a>04033 <span class="keyword">      end subroutine a_bl_mu_b_sc</span>
<a name="l04034"></a>04034 
<a name="l04035"></a>04035   <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l04036"></a><a class="code" href="namespaceunary__mod.html#ad0d8a19e91684be702bb07ef7fe3a59c">04036</a>   <span class="keyword">subroutine </span><a class="code" href="namespaceunary__mod.html#ad0d8a19e91684be702bb07ef7fe3a59c">aplb</a> ( nrow, ncol, job, a, ja, ia, b, jb, ib, c, jc, ic, nzmax, &amp;
<a name="l04037"></a>04037     iw, ierr )
<a name="l04038"></a>04038 
<a name="l04039"></a>04039   <span class="comment">!*****************************************************************************80</span>
<a name="l04040"></a>04040   <span class="comment">!</span>
<a name="l04041"></a>04041   <span class="comment">!! APLB performs the CSR matrix sum C = A + B.</span>
<a name="l04042"></a>04042   <span class="comment">!</span>
<a name="l04043"></a>04043   <span class="comment">!  Modified:</span>
<a name="l04044"></a>04044   <span class="comment">!</span>
<a name="l04045"></a>04045   <span class="comment">!    07 January 2004</span>
<a name="l04046"></a>04046   <span class="comment">!</span>
<a name="l04047"></a>04047   <span class="comment">!  Author:</span>
<a name="l04048"></a>04048   <span class="comment">!</span>
<a name="l04049"></a>04049   <span class="comment">!    Youcef Saad</span>
<a name="l04050"></a>04050   <span class="comment">!</span>
<a name="l04051"></a>04051   <span class="comment">!  Parameters:</span>
<a name="l04052"></a>04052   <span class="comment">!</span>
<a name="l04053"></a>04053   <span class="comment">!    Input, integer ( kind = 4 ) NROW, the row dimension of A and B.</span>
<a name="l04054"></a>04054   <span class="comment">!</span>
<a name="l04055"></a>04055   <span class="comment">!    Input, integer ( kind = 4 ) NCOL, the column dimension of A and B.</span>
<a name="l04056"></a>04056   <span class="comment">!</span>
<a name="l04057"></a>04057   <span class="comment">!    Input, integer ( kind = 4 ) JOB.  When JOB = 0, only the structure</span>
<a name="l04058"></a>04058   <span class="comment">!    (i.e. the arrays jc, ic) is computed and the</span>
<a name="l04059"></a>04059   <span class="comment">!    real values are ignored.</span>
<a name="l04060"></a>04060   <span class="comment">!</span>
<a name="l04061"></a>04061   <span class="comment">!    Input, real A(*), integer ( kind = 4 ) JA(*), IA(NROW+1), the matrix in CSR</span>
<a name="l04062"></a>04062   <span class="comment">!    Compressed Sparse Row format.</span>
<a name="l04063"></a>04063   <span class="comment">!</span>
<a name="l04064"></a>04064   <span class="comment">! b,</span>
<a name="l04065"></a>04065   <span class="comment">! jb,</span>
<a name="l04066"></a>04066   <span class="comment">! ib      =  Matrix B in compressed sparse row format.</span>
<a name="l04067"></a>04067   <span class="comment">!</span>
<a name="l04068"></a>04068   <span class="comment">! nzmax      = integer ( kind = 4 ). The  length of the arrays c and jc.</span>
<a name="l04069"></a>04069   <span class="comment">!         amub will stop if the result matrix C  has a number</span>
<a name="l04070"></a>04070   <span class="comment">!         of elements that exceeds exceeds nzmax. See ierr.</span>
<a name="l04071"></a>04071   <span class="comment">!</span>
<a name="l04072"></a>04072   <span class="comment">! on return:</span>
<a name="l04073"></a>04073   <span class="comment">!</span>
<a name="l04074"></a>04074   <span class="comment">! c,</span>
<a name="l04075"></a>04075   <span class="comment">! jc,</span>
<a name="l04076"></a>04076   <span class="comment">! ic      = resulting matrix C in compressed sparse row sparse format.</span>
<a name="l04077"></a>04077   <span class="comment">!</span>
<a name="l04078"></a>04078   <span class="comment">! ierr      = integer ( kind = 4 ). serving as error message.</span>
<a name="l04079"></a>04079   <span class="comment">!         ierr = 0 means normal return,</span>
<a name="l04080"></a>04080   <span class="comment">!         ierr &gt; 0 means that amub stopped while computing the</span>
<a name="l04081"></a>04081   <span class="comment">!         i-th row  of C with i = ierr, because the number</span>
<a name="l04082"></a>04082   <span class="comment">!         of elements in C exceeds nzmax.</span>
<a name="l04083"></a>04083   <span class="comment">!</span>
<a name="l04084"></a>04084   <span class="comment">! work arrays:</span>
<a name="l04085"></a>04085   <span class="comment">!</span>
<a name="l04086"></a>04086   <span class="comment">! iw      = integer ( kind = 4 ) work array of length equal to the number of</span>
<a name="l04087"></a>04087   <span class="comment">!         columns in A.</span>
<a name="l04088"></a>04088   <span class="comment">!</span>
<a name="l04089"></a>04089     <span class="keyword">implicit none</span>
<a name="l04090"></a>04090 
<a name="l04091"></a>04091     <span class="keywordtype">integer</span> :: ncol
<a name="l04092"></a>04092     <span class="keywordtype">integer</span> :: nrow
<a name="l04093"></a>04093 
<a name="l04094"></a>04094     <span class="keywordtype">real(wp)</span> a(*)
<a name="l04095"></a>04095     <span class="keywordtype">real(wp)</span> b(*)
<a name="l04096"></a>04096     <span class="keywordtype">real(wp)</span> c(*)
<a name="l04097"></a>04097     <span class="keywordtype">integer</span> :: ia(nrow+1)
<a name="l04098"></a>04098     <span class="keywordtype">integer</span> :: ib(nrow+1)
<a name="l04099"></a>04099     <span class="keywordtype">integer</span> :: ic(nrow+1)
<a name="l04100"></a>04100     <span class="keywordtype">integer</span> :: ierr
<a name="l04101"></a>04101     <span class="keywordtype">integer</span> :: ii
<a name="l04102"></a>04102     <span class="keywordtype">integer</span> :: iw(ncol)
<a name="l04103"></a>04103     <span class="keywordtype">integer</span> :: ja(*)
<a name="l04104"></a>04104     <span class="keywordtype">integer</span> :: jb(*)
<a name="l04105"></a>04105     <span class="keywordtype">integer</span> :: jc(*)
<a name="l04106"></a>04106     <span class="keywordtype">integer</span> :: jcol
<a name="l04107"></a>04107     <span class="keywordtype">integer</span> :: job
<a name="l04108"></a>04108     <span class="keywordtype">integer</span> :: jpos
<a name="l04109"></a>04109     <span class="keywordtype">integer</span> :: k
<a name="l04110"></a>04110     <span class="keywordtype">integer</span> :: ka
<a name="l04111"></a>04111     <span class="keywordtype">integer</span> :: kb
<a name="l04112"></a>04112     <span class="keywordtype">integer</span> :: len
<a name="l04113"></a>04113     <span class="keywordtype">integer</span> :: nzmax
<a name="l04114"></a>04114     <span class="keywordtype">logical</span> :: values
<a name="l04115"></a>04115 
<a name="l04116"></a>04116     values = ( job /= 0 )
<a name="l04117"></a>04117     ierr = 0
<a name="l04118"></a>04118     len = 0
<a name="l04119"></a>04119     ic(1) = 1
<a name="l04120"></a>04120     iw(1:ncol) = 0
<a name="l04121"></a>04121 
<a name="l04122"></a>04122     <span class="keyword">do</span> ii = 1, nrow
<a name="l04123"></a>04123   <span class="comment">!</span>
<a name="l04124"></a>04124   <span class="comment">!  Row I.</span>
<a name="l04125"></a>04125   <span class="comment">!</span>
<a name="l04126"></a>04126        <span class="keyword">do</span> ka = ia(ii), ia(ii+1)-1
<a name="l04127"></a>04127 
<a name="l04128"></a>04128           len = len + 1
<a name="l04129"></a>04129           jcol = ja(ka)
<a name="l04130"></a>04130 
<a name="l04131"></a>04131           <span class="keyword">if</span> ( nzmax &lt; len ) <span class="keyword">then</span>
<a name="l04132"></a>04132             ierr = ii
<a name="l04133"></a>04133             return
<a name="l04134"></a>04134           <span class="keyword">end if</span>
<a name="l04135"></a>04135 
<a name="l04136"></a>04136           jc(len) = jcol
<a name="l04137"></a>04137           <span class="keyword">if</span> ( values ) <span class="keyword">then</span>
<a name="l04138"></a>04138             c(len) = a(ka)
<a name="l04139"></a>04139           <span class="keyword">end if</span>
<a name="l04140"></a>04140           iw(jcol) = len
<a name="l04141"></a>04141        <span class="keyword">end do</span>
<a name="l04142"></a>04142 
<a name="l04143"></a>04143        <span class="keyword">do</span> kb = ib(ii), ib(ii+1)-1
<a name="l04144"></a>04144 
<a name="l04145"></a>04145           jcol = jb(kb)
<a name="l04146"></a>04146           jpos = iw(jcol)
<a name="l04147"></a>04147    
<a name="l04148"></a>04148           <span class="keyword">if</span> ( jpos == 0 ) <span class="keyword">then</span>
<a name="l04149"></a>04149 
<a name="l04150"></a>04150              len = len + 1
<a name="l04151"></a>04151 
<a name="l04152"></a>04152              <span class="keyword">if</span> ( nzmax &lt; len ) <span class="keyword">then</span>
<a name="l04153"></a>04153                ierr = ii
<a name="l04154"></a>04154                return
<a name="l04155"></a>04155              <span class="keyword">end if</span>
<a name="l04156"></a>04156 
<a name="l04157"></a>04157              jc(len) = jcol
<a name="l04158"></a>04158              <span class="keyword">if</span> ( values ) <span class="keyword">then</span>
<a name="l04159"></a>04159                c(len) = b(kb)
<a name="l04160"></a>04160              <span class="keyword">end if</span>
<a name="l04161"></a>04161              iw(jcol)= len
<a name="l04162"></a>04162           <span class="keyword">else</span>
<a name="l04163"></a>04163              <span class="keyword">if</span> ( values ) <span class="keyword">then</span>
<a name="l04164"></a>04164                c(jpos) = c(jpos) + b(kb)
<a name="l04165"></a>04165              <span class="keyword">end if</span>
<a name="l04166"></a>04166           <span class="keyword">end if</span>
<a name="l04167"></a>04167 
<a name="l04168"></a>04168        <span class="keyword">end do</span>
<a name="l04169"></a>04169   
<a name="l04170"></a>04170        <span class="keyword">do</span> k = ic(ii), len
<a name="l04171"></a>04171          iw(jc(k)) = 0
<a name="l04172"></a>04172        <span class="keyword">end do</span>
<a name="l04173"></a>04173 
<a name="l04174"></a>04174        ic(ii+1) = len+1
<a name="l04175"></a>04175     <span class="keyword">end do</span>
<a name="l04176"></a>04176 
<a name="l04177"></a>04177     return
<a name="l04178"></a>04178 <span class="keyword">  end subroutine aplb</span>
<a name="l04179"></a>04179 
<a name="l04180"></a>04180 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l04181"></a>04181 
<a name="l04182"></a><a class="code" href="namespaceunary__mod.html#a2e235041e13f858f57a874a2c00fa767">04182</a> <span class="keyword">subroutine </span><a class="code" href="namespaceunary__mod.html#a2e235041e13f858f57a874a2c00fa767">aplb1</a> ( nrow, ncol, job, a, ja, ia, b, jb, ib, c, jc, ic, nzmax, ierr )
<a name="l04183"></a>04183 
<a name="l04184"></a>04184 <span class="comment">!*****************************************************************************80</span>
<a name="l04185"></a>04185 <span class="comment">!</span>
<a name="l04186"></a>04186 <span class="comment">!! APLB1 performs the sum C = A + B for sorted CSR matrices.</span>
<a name="l04187"></a>04187 <span class="comment">!</span>
<a name="l04188"></a>04188 <span class="comment">!  Discussion:</span>
<a name="l04189"></a>04189 <span class="comment">!</span>
<a name="l04190"></a>04190 <span class="comment">!    The difference between this routine and APLB is that here the </span>
<a name="l04191"></a>04191 <span class="comment">!    resulting matrix is such that the elements of each row are sorted,</span>
<a name="l04192"></a>04192 <span class="comment">!    with increasing column indices in each row, provided the original</span>
<a name="l04193"></a>04193 <span class="comment">!    matrices are sorted in the same way.</span>
<a name="l04194"></a>04194 <span class="comment">!</span>
<a name="l04195"></a>04195 <span class="comment">!    This routine will not work if either of the two input matrices is </span>
<a name="l04196"></a>04196 <span class="comment">!    not sorted.</span>
<a name="l04197"></a>04197 <span class="comment">!</span>
<a name="l04198"></a>04198 <span class="comment">!  Modified:</span>
<a name="l04199"></a>04199 <span class="comment">!</span>
<a name="l04200"></a>04200 <span class="comment">!    11 January 2004</span>
<a name="l04201"></a>04201 <span class="comment">!</span>
<a name="l04202"></a>04202 <span class="comment">!  Author:</span>
<a name="l04203"></a>04203 <span class="comment">!</span>
<a name="l04204"></a>04204 <span class="comment">!    Youcef Saad</span>
<a name="l04205"></a>04205 <span class="comment">!</span>
<a name="l04206"></a>04206 <span class="comment">!  Parameters:</span>
<a name="l04207"></a>04207 <span class="comment">!</span>
<a name="l04208"></a>04208 <span class="comment">!    Input, integer ( kind = 4 ) NROW, the row dimension of A and B.</span>
<a name="l04209"></a>04209 <span class="comment">!    Input, integer ( kind = 4 ) NCOL, the column dimension of A and B.</span>
<a name="l04210"></a>04210 <span class="comment">!    Input, integer ( kind = 4 ) JOB.  When JOB = 0, only the structure</span>
<a name="l04211"></a>04211 
<a name="l04212"></a>04212 <span class="comment">!    (i.e. the arrays jc, ic) is computed and the real values are ignored.</span>
<a name="l04213"></a>04213 <span class="comment">!</span>
<a name="l04214"></a>04214 <span class="comment">!    Input, real A(*), integer ( kind = 4 ) JA(*), IA(NROW+1), the matrix in CSR</span>
<a name="l04215"></a>04215 <span class="comment">!    Compressed Sparse Row format with entries sorted.</span>
<a name="l04216"></a>04216 <span class="comment">!</span>
<a name="l04217"></a>04217 <span class="comment">! b,</span>
<a name="l04218"></a>04218 <span class="comment">! jb,</span>
<a name="l04219"></a>04219 <span class="comment">! ib      =  Matrix B in compressed sparse row format with entries sorted</span>
<a name="l04220"></a>04220 <span class="comment">!        ascendly in each row</span>
<a name="l04221"></a>04221 <span class="comment">!</span>
<a name="l04222"></a>04222 <span class="comment">! nzmax      = integer ( kind = 4 ). The  length of the arrays c and jc.</span>
<a name="l04223"></a>04223 <span class="comment">!         amub will stop if the result matrix C  has a number</span>
<a name="l04224"></a>04224 <span class="comment">!         of elements that exceeds exceeds nzmax. See ierr.</span>
<a name="l04225"></a>04225 <span class="comment">!</span>
<a name="l04226"></a>04226 <span class="comment">! on return:</span>
<a name="l04227"></a>04227 <span class="comment">!</span>
<a name="l04228"></a>04228 <span class="comment">! c,</span>
<a name="l04229"></a>04229 <span class="comment">! jc,</span>
<a name="l04230"></a>04230 <span class="comment">! ic      = resulting matrix C in compressed sparse row sparse format</span>
<a name="l04231"></a>04231 <span class="comment">!         with entries sorted ascendly in each row.</span>
<a name="l04232"></a>04232 <span class="comment">!</span>
<a name="l04233"></a>04233 <span class="comment">! ierr      = integer ( kind = 4 ). serving as error message.</span>
<a name="l04234"></a>04234 <span class="comment">!         ierr = 0 means normal return,</span>
<a name="l04235"></a>04235 <span class="comment">!         ierr &gt; 0 means that amub stopped while computing the</span>
<a name="l04236"></a>04236 <span class="comment">!         i-th row  of C with i = ierr, because the number</span>
<a name="l04237"></a>04237 <span class="comment">!         of elements in C exceeds nzmax.</span>
<a name="l04238"></a>04238 <span class="comment">!</span>
<a name="l04239"></a>04239   <span class="keyword">implicit none</span>
<a name="l04240"></a>04240 
<a name="l04241"></a>04241   <span class="keywordtype">integer</span>,                     <span class="keywordtype">intent(in)</span>    ::  nrow, ncol, job
<a name="l04242"></a>04242 
<a name="l04243"></a>04243   <span class="keywordtype">integer</span>,  <span class="keywordtype">dimension(nrow+1)</span>, <span class="keywordtype">intent(in)</span>    :: ia, ib
<a name="l04244"></a>04244   <span class="keywordtype">integer</span>,  <span class="keywordtype">dimension(*)</span>,      <span class="keywordtype">intent(in)</span>    :: ja, jb
<a name="l04245"></a>04245   <span class="keywordtype">real(wp)</span>, <span class="keywordtype">dimension(*)</span>,      <span class="keywordtype">intent(in)</span>    ::  a,  b
<a name="l04246"></a>04246 
<a name="l04247"></a>04247   <span class="keywordtype">integer</span>,  <span class="keywordtype">dimension(nrow+1)</span>, <span class="keywordtype">intent(inout)</span> :: ic
<a name="l04248"></a>04248   <span class="keywordtype">integer</span>,  <span class="keywordtype">dimension(*)</span>,      <span class="keywordtype">intent(inout)</span> :: jc
<a name="l04249"></a>04249   <span class="keywordtype">real(wp)</span>, <span class="keywordtype">dimension(*)</span>,      <span class="keywordtype">intent(inout)</span> ::  c
<a name="l04250"></a>04250 
<a name="l04251"></a>04251   <span class="keywordtype">integer</span>,                     <span class="keywordtype">intent(inout)</span> :: nzmax
<a name="l04252"></a>04252   <span class="keywordtype">integer</span>,                     <span class="keywordtype">intent(out)</span>   :: ierr
<a name="l04253"></a>04253 
<a name="l04254"></a>04254   <span class="keywordtype">integer</span> :: i
<a name="l04255"></a>04255   <span class="keywordtype">integer</span> :: j1, j2
<a name="l04256"></a>04256   <span class="keywordtype">integer</span> :: ka, kamax
<a name="l04257"></a>04257   <span class="keywordtype">integer</span> :: kb, kbmax
<a name="l04258"></a>04258   <span class="keywordtype">integer</span> :: kc
<a name="l04259"></a>04259   <span class="keywordtype">logical</span> :: values
<a name="l04260"></a>04260   
<a name="l04261"></a>04261   values = ( job /= 0 )
<a name="l04262"></a>04262   ierr = 0
<a name="l04263"></a>04263   kc = 1
<a name="l04264"></a>04264   ic(1) = kc
<a name="l04265"></a>04265 
<a name="l04266"></a>04266   <span class="keyword">do</span> i = 1, nrow
<a name="l04267"></a>04267 
<a name="l04268"></a>04268     ka = ia(i)
<a name="l04269"></a>04269     kb = ib(i)
<a name="l04270"></a>04270     kamax = ia(i+1) - 1
<a name="l04271"></a>04271     kbmax = ib(i+1) - 1
<a name="l04272"></a>04272 
<a name="l04273"></a>04273     <span class="keyword">do</span>
<a name="l04274"></a>04274 
<a name="l04275"></a>04275       <span class="keyword">if</span> ( ka &lt;= kamax ) <span class="keyword">then</span>
<a name="l04276"></a>04276         j1 = ja(ka)
<a name="l04277"></a>04277       <span class="keyword">else</span>
<a name="l04278"></a>04278         j1 = ncol + 1
<a name="l04279"></a>04279       <span class="keyword">end if</span>
<a name="l04280"></a>04280 
<a name="l04281"></a>04281       <span class="keyword">if</span> ( kb &lt;= kbmax ) <span class="keyword">then</span>
<a name="l04282"></a>04282         j2 = jb(kb)
<a name="l04283"></a>04283       <span class="keyword">else</span>
<a name="l04284"></a>04284         j2 = ncol + 1
<a name="l04285"></a>04285       <span class="keyword">end if</span>
<a name="l04286"></a>04286 <span class="comment">!</span>
<a name="l04287"></a>04287 <span class="comment">!  Three cases</span>
<a name="l04288"></a>04288 <span class="comment">!</span>
<a name="l04289"></a>04289       <span class="keyword">if</span> ( j1 == j2 ) <span class="keyword">then</span>
<a name="l04290"></a>04290         <span class="keyword">if</span> ( values ) <span class="keyword">then</span>
<a name="l04291"></a>04291           c(kc) = a(ka) + b(kb)
<a name="l04292"></a>04292         <span class="keyword">end if</span>
<a name="l04293"></a>04293         jc(kc) = j1
<a name="l04294"></a>04294         ka = ka + 1
<a name="l04295"></a>04295         kb = kb + 1
<a name="l04296"></a>04296         kc = kc + 1
<a name="l04297"></a>04297       <span class="keyword">else</span> <span class="keyword">if</span> ( j1 &lt; j2 ) <span class="keyword">then</span>
<a name="l04298"></a>04298         jc(kc) = j1
<a name="l04299"></a>04299         <span class="keyword">if</span> ( values ) <span class="keyword">then</span>
<a name="l04300"></a>04300           c(kc) = a(ka)
<a name="l04301"></a>04301         <span class="keyword">end if</span>
<a name="l04302"></a>04302         ka = ka + 1
<a name="l04303"></a>04303         kc = kc + 1
<a name="l04304"></a>04304       <span class="keyword">else</span> <span class="keyword">if</span> ( j2 &lt; j1 ) <span class="keyword">then</span>
<a name="l04305"></a>04305         jc(kc) = j2
<a name="l04306"></a>04306         <span class="keyword">if</span> ( values ) <span class="keyword">then</span>
<a name="l04307"></a>04307           c(kc) = b(kb)
<a name="l04308"></a>04308         <span class="keyword">end if</span>
<a name="l04309"></a>04309         kb = kb + 1
<a name="l04310"></a>04310         kc = kc + 1
<a name="l04311"></a>04311       <span class="keyword">end if</span>
<a name="l04312"></a>04312 
<a name="l04313"></a>04313       <span class="keyword">if</span> ( (kc  &gt;  nzmax) .and. (i/=nrow) ) <span class="keyword">then</span>
<a name="l04314"></a>04314         ierr = i
<a name="l04315"></a>04315         return
<a name="l04316"></a>04316       <span class="keyword">end if</span>
<a name="l04317"></a>04317 
<a name="l04318"></a>04318       <span class="keyword">if</span> ( kamax &lt; ka .and. kbmax &lt; kb ) <span class="keyword">then</span>
<a name="l04319"></a>04319         exit
<a name="l04320"></a>04320       <span class="keyword">end if</span>
<a name="l04321"></a>04321 
<a name="l04322"></a>04322      <span class="keyword">end do</span>
<a name="l04323"></a>04323 
<a name="l04324"></a>04324      ic(i+1) = kc
<a name="l04325"></a>04325 
<a name="l04326"></a>04326   <span class="keyword">end do</span>
<a name="l04327"></a>04327 
<a name="l04328"></a>04328   return
<a name="l04329"></a>04329 <span class="keyword">end subroutine aplb1</span>
<a name="l04330"></a>04330 
<a name="l04331"></a>04331 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l04332"></a>04332 
<a name="l04333"></a><a class="code" href="namespaceunary__mod.html#aa6c4c1ef7fe51cabc14fbc76c53a9d73">04333</a> <span class="keyword">subroutine </span><a class="code" href="namespaceunary__mod.html#aa6c4c1ef7fe51cabc14fbc76c53a9d73">a_bl_pl_b_bl1</a>( nrow, ncol, nblk, a, ja, ia, b, jb, ib,  &amp;
<a name="l04334"></a>04334                                           &amp; c, jc, ic, nzmax, ierr )
<a name="l04335"></a>04335 
<a name="l04336"></a>04336 <span class="comment">!*****************************************************************************80</span>
<a name="l04337"></a>04337 <span class="comment">!</span>
<a name="l04338"></a>04338 <span class="comment">!! APLB1 performs the sum C = A + B for sorted CSR matrices.</span>
<a name="l04339"></a>04339 <span class="comment">!</span>
<a name="l04340"></a>04340 <span class="comment">!  Discussion:</span>
<a name="l04341"></a>04341 <span class="comment">!</span>
<a name="l04342"></a>04342 <span class="comment">!    The difference between this routine and APLB is that here the </span>
<a name="l04343"></a>04343 <span class="comment">!    resulting matrix is such that the elements of each row are sorted,</span>
<a name="l04344"></a>04344 <span class="comment">!    with increasing column indices in each row, provided the original</span>
<a name="l04345"></a>04345 <span class="comment">!    matrices are sorted in the same way.</span>
<a name="l04346"></a>04346 <span class="comment">!</span>
<a name="l04347"></a>04347 <span class="comment">!    This routine will not work if either of the two input matrices is </span>
<a name="l04348"></a>04348 <span class="comment">!    not sorted.</span>
<a name="l04349"></a>04349 <span class="comment">!</span>
<a name="l04350"></a>04350 <span class="comment">!  Modified:</span>
<a name="l04351"></a>04351 <span class="comment">!</span>
<a name="l04352"></a>04352 <span class="comment">!    11 January 2004</span>
<a name="l04353"></a>04353 <span class="comment">!</span>
<a name="l04354"></a>04354 <span class="comment">!  Author:</span>
<a name="l04355"></a>04355 <span class="comment">!</span>
<a name="l04356"></a>04356 <span class="comment">!    Youcef Saad</span>
<a name="l04357"></a>04357 <span class="comment">!</span>
<a name="l04358"></a>04358 <span class="comment">!  Parameters:</span>
<a name="l04359"></a>04359 <span class="comment">!</span>
<a name="l04360"></a>04360 <span class="comment">!    Input, integer ( kind = 4 ) NROW, the row dimension of A and B.</span>
<a name="l04361"></a>04361 <span class="comment">!    Input, integer ( kind = 4 ) NCOL, the column dimension of A and B.</span>
<a name="l04362"></a>04362 <span class="comment">!</span>
<a name="l04363"></a>04363 <span class="comment">!    Input, real A(*), integer ( kind = 4 ) JA(*), IA(NROW+1), the matrix in CSR</span>
<a name="l04364"></a>04364 <span class="comment">!    Compressed Sparse Row format with entries sorted.</span>
<a name="l04365"></a>04365 <span class="comment">!</span>
<a name="l04366"></a>04366 <span class="comment">!  b,</span>
<a name="l04367"></a>04367 <span class="comment">! jb,</span>
<a name="l04368"></a>04368 <span class="comment">! ib      =  Matrix B in compressed sparse row format with entries sorted</span>
<a name="l04369"></a>04369 <span class="comment">!        ascendly in each row</span>
<a name="l04370"></a>04370 <span class="comment">!</span>
<a name="l04371"></a>04371 <span class="comment">! nzmax      = integer ( kind = 4 ). The  length of the arrays c and jc.</span>
<a name="l04372"></a>04372 <span class="comment">!         amub will stop if the result matrix C  has a number</span>
<a name="l04373"></a>04373 <span class="comment">!         of elements that exceeds exceeds nzmax. See ierr.</span>
<a name="l04374"></a>04374 <span class="comment">!</span>
<a name="l04375"></a>04375 <span class="comment">! on return:</span>
<a name="l04376"></a>04376 <span class="comment">!</span>
<a name="l04377"></a>04377 <span class="comment">!  c,</span>
<a name="l04378"></a>04378 <span class="comment">! jc,</span>
<a name="l04379"></a>04379 <span class="comment">! ic      = resulting matrix C in compressed sparse row sparse format</span>
<a name="l04380"></a>04380 <span class="comment">!         with entries sorted ascendly in each row.</span>
<a name="l04381"></a>04381 <span class="comment">!</span>
<a name="l04382"></a>04382 <span class="comment">! ierr      = integer ( kind = 4 ). serving as error message.</span>
<a name="l04383"></a>04383 <span class="comment">!         ierr = 0 means normal return,</span>
<a name="l04384"></a>04384 <span class="comment">!         ierr &gt; 0 means that amub stopped while computing the</span>
<a name="l04385"></a>04385 <span class="comment">!         i-th row  of C with i = ierr, because the number</span>
<a name="l04386"></a>04386 <span class="comment">!         of elements in C exceeds nzmax.</span>
<a name="l04387"></a>04387 <span class="comment">!</span>
<a name="l04388"></a>04388   <span class="keyword">implicit none</span>
<a name="l04389"></a>04389 
<a name="l04390"></a>04390   <span class="keywordtype">integer</span>,                          <span class="keywordtype">intent(in)</span>    ::  nrow, ncol, nblk, nzmax
<a name="l04391"></a>04391 
<a name="l04392"></a>04392   <span class="keywordtype">integer</span>,  <span class="keywordtype">dimension(nrow+1)</span>,      <span class="keywordtype">intent(in)</span>    :: ia, ib
<a name="l04393"></a>04393   <span class="keywordtype">integer</span>,  <span class="keywordtype">dimension(*)</span>,           <span class="keywordtype">intent(in)</span>    :: ja, jb
<a name="l04394"></a>04394   <span class="keywordtype">real(wp)</span>, <span class="keywordtype">dimension(nblk,nblk,*)</span>, <span class="keywordtype">intent(in)</span>    ::  a,  b
<a name="l04395"></a>04395 
<a name="l04396"></a>04396   <span class="keywordtype">integer</span>,  <span class="keywordtype">dimension(nrow+1)</span>,      <span class="keywordtype">intent(inout)</span> :: ic
<a name="l04397"></a>04397   <span class="keywordtype">integer</span>,  <span class="keywordtype">dimension(*)</span>,           <span class="keywordtype">intent(inout)</span> :: jc
<a name="l04398"></a>04398   <span class="keywordtype">real(wp)</span>, <span class="keywordtype">dimension(nblk,nblk,*)</span>, <span class="keywordtype">intent(inout)</span> ::  c
<a name="l04399"></a>04399 
<a name="l04400"></a>04400   <span class="keywordtype">integer</span>,                          <span class="keywordtype">intent(out)</span>   :: ierr
<a name="l04401"></a>04401 
<a name="l04402"></a>04402   <span class="keywordtype">integer</span> :: i
<a name="l04403"></a>04403   <span class="keywordtype">integer</span> :: j1, j2
<a name="l04404"></a>04404   <span class="keywordtype">integer</span> :: ka, kamax
<a name="l04405"></a>04405   <span class="keywordtype">integer</span> :: kb, kbmax
<a name="l04406"></a>04406   <span class="keywordtype">integer</span> :: kc
<a name="l04407"></a>04407 
<a name="l04408"></a>04408   ierr = 0
<a name="l04409"></a>04409   kc = 1
<a name="l04410"></a>04410   ic(1) = kc
<a name="l04411"></a>04411 
<a name="l04412"></a>04412   <span class="keyword">do</span> i = 1, nrow
<a name="l04413"></a>04413 
<a name="l04414"></a>04414        ka = ia(i)
<a name="l04415"></a>04415        kb = ib(i)
<a name="l04416"></a>04416     kamax = ia(i+1) - 1
<a name="l04417"></a>04417     kbmax = ib(i+1) - 1
<a name="l04418"></a>04418 
<a name="l04419"></a>04419     <span class="keyword">do</span>
<a name="l04420"></a>04420 
<a name="l04421"></a>04421       <span class="keyword">if</span> ( ka &lt;= kamax ) <span class="keyword">then</span>
<a name="l04422"></a>04422         j1 = ja(ka)
<a name="l04423"></a>04423       <span class="keyword">else</span>
<a name="l04424"></a>04424         j1 = ncol + 1
<a name="l04425"></a>04425       <span class="keyword">end if</span>
<a name="l04426"></a>04426 
<a name="l04427"></a>04427       <span class="keyword">if</span> ( kb &lt;= kbmax ) <span class="keyword">then</span>
<a name="l04428"></a>04428         j2 = jb(kb)
<a name="l04429"></a>04429       <span class="keyword">else</span>
<a name="l04430"></a>04430         j2 = ncol + 1
<a name="l04431"></a>04431       <span class="keyword">end if</span>
<a name="l04432"></a>04432 <span class="comment">!</span>
<a name="l04433"></a>04433 <span class="comment">!  Three cases</span>
<a name="l04434"></a>04434 <span class="comment">!</span>
<a name="l04435"></a>04435       <span class="keyword">if</span> ( j1 == j2 ) <span class="keyword">then</span>
<a name="l04436"></a>04436         c(:,:,kc) = a(:,:,ka) + b(:,:,kb)
<a name="l04437"></a>04437         jc(kc) = j1
<a name="l04438"></a>04438         ka = ka + 1
<a name="l04439"></a>04439         kb = kb + 1
<a name="l04440"></a>04440         kc = kc + 1
<a name="l04441"></a>04441       <span class="keyword">else</span> <span class="keyword">if</span> ( j1 &lt; j2 ) <span class="keyword">then</span>
<a name="l04442"></a>04442         jc(kc) = j1
<a name="l04443"></a>04443         c(:,:,kc) = a(:,:,ka)
<a name="l04444"></a>04444         ka = ka + 1
<a name="l04445"></a>04445         kc = kc + 1
<a name="l04446"></a>04446       <span class="keyword">else</span> <span class="keyword">if</span> ( j2 &lt; j1 ) <span class="keyword">then</span>
<a name="l04447"></a>04447         jc(kc) = j2
<a name="l04448"></a>04448         c(:,:,kc) = b(:,:,kb)
<a name="l04449"></a>04449         kb = kb + 1
<a name="l04450"></a>04450         kc = kc + 1
<a name="l04451"></a>04451       <span class="keyword">end if</span>
<a name="l04452"></a>04452 
<a name="l04453"></a>04453       <span class="keyword">if</span> ( (kc  &gt;  nzmax) .and. (i/=nrow) ) <span class="keyword">then</span>
<a name="l04454"></a>04454         ierr = i
<a name="l04455"></a>04455         return
<a name="l04456"></a>04456       <span class="keyword">end if</span>
<a name="l04457"></a>04457 
<a name="l04458"></a>04458       <span class="keyword">if</span> ( kamax &lt; ka .and. kbmax &lt; kb ) <span class="keyword">then</span>
<a name="l04459"></a>04459         exit
<a name="l04460"></a>04460       <span class="keyword">end if</span>
<a name="l04461"></a>04461 
<a name="l04462"></a>04462      <span class="keyword">end do</span>
<a name="l04463"></a>04463 
<a name="l04464"></a>04464      ic(i+1) = kc
<a name="l04465"></a>04465 
<a name="l04466"></a>04466   <span class="keyword">end do</span>
<a name="l04467"></a>04467 
<a name="l04468"></a>04468   return
<a name="l04469"></a>04469 <span class="keyword">end subroutine a_bl_pl_b_bl1</span>
<a name="l04470"></a>04470 
<a name="l04471"></a>04471 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l04472"></a>04472 
<a name="l04473"></a><a class="code" href="namespaceunary__mod.html#a0de15cd3c5844f3bfbf60831e68b9fa7">04473</a>       <span class="keyword">subroutine </span><a class="code" href="namespaceunary__mod.html#a0de15cd3c5844f3bfbf60831e68b9fa7">aplsb</a> (nrow,ncol,a,ja,ia,s,b,jb,ib,c,jc,ic,nzmax,ierr)
<a name="l04474"></a>04474       <span class="keywordtype">integer</span> nrow,ncol,nzmax,ierr
<a name="l04475"></a>04475       <span class="keywordtype">real(wp)</span> a(*), b(*), c(*), s 
<a name="l04476"></a>04476       <span class="keywordtype">integer</span> ja(*),jb(*),jc(*),ia(nrow+1),ib(nrow+1),ic(nrow+1) 
<a name="l04477"></a>04477 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l04478"></a>04478 <span class="comment">! performs the operation C = A+s B for matrices in sorted CSR format.   </span>
<a name="l04479"></a>04479 <span class="comment">! the difference with aplsb is that the resulting matrix is such that   </span>
<a name="l04480"></a>04480 <span class="comment">! the elements of each row are sorted with increasing column indices in </span>
<a name="l04481"></a>04481 <span class="comment">! each row, provided the original matrices are sorted in the same way.  </span>
<a name="l04482"></a>04482 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l04483"></a>04483 <span class="comment">! on entry:                                                             </span>
<a name="l04484"></a>04484 <span class="comment">! ---------                                                             </span>
<a name="l04485"></a>04485 <span class="comment">! nrow        = integer. The row dimension of A and B                   </span>
<a name="l04486"></a>04486 <span class="comment">! ncol  = integer. The column dimension of A and B.                     </span>
<a name="l04487"></a>04487 <span class="comment">!                                                                       </span>
<a name="l04488"></a>04488 <span class="comment">! a,                                                                    </span>
<a name="l04489"></a>04489 <span class="comment">! ja,                                                                   </span>
<a name="l04490"></a>04490 <span class="comment">! ia   = Matrix A in compressed sparse row format with entries sorted   </span>
<a name="l04491"></a>04491 <span class="comment">!                                                                       </span>
<a name="l04492"></a>04492 <span class="comment">! s        = real. scalar factor for B.                                 </span>
<a name="l04493"></a>04493 <span class="comment">!                                                                       </span>
<a name="l04494"></a>04494 <span class="comment">! b,                                                                    </span>
<a name="l04495"></a>04495 <span class="comment">! jb,                                                                   </span>
<a name="l04496"></a>04496 <span class="comment">! ib        =  Matrix B in compressed sparse row format with entries sor</span>
<a name="l04497"></a>04497 <span class="comment">!        ascendly in each row                                           </span>
<a name="l04498"></a>04498 <span class="comment">!                                                                       </span>
<a name="l04499"></a>04499 <span class="comment">! nzmax        = integer. The  length of the arrays c and jc.           </span>
<a name="l04500"></a>04500 <span class="comment">!         amub will stop if the result matrix C  has a number           </span>
<a name="l04501"></a>04501 <span class="comment">!         of elements that exceeds exceeds nzmax. See ierr.             </span>
<a name="l04502"></a>04502 <span class="comment">!                                                                       </span>
<a name="l04503"></a>04503 <span class="comment">! on return:                                                            </span>
<a name="l04504"></a>04504 <span class="comment">!----------                                                             </span>
<a name="l04505"></a>04505 <span class="comment">! c,                                                                    </span>
<a name="l04506"></a>04506 <span class="comment">! jc,                                                                   </span>
<a name="l04507"></a>04507 <span class="comment">! ic        = resulting matrix C in compressed sparse row sparse format </span>
<a name="l04508"></a>04508 <span class="comment">!         with entries sorted ascendly in each row.                     </span>
<a name="l04509"></a>04509 <span class="comment">!                                                                       </span>
<a name="l04510"></a>04510 <span class="comment">! ierr        = integer. serving as error message.                      </span>
<a name="l04511"></a>04511 <span class="comment">!         ierr = 0 means normal return,                                 </span>
<a name="l04512"></a>04512 <span class="comment">!         ierr  &gt;  0 means that amub stopped while computing the       </span>
<a name="l04513"></a>04513 <span class="comment">!         i-th row  of C with i=ierr, because the number                </span>
<a name="l04514"></a>04514 <span class="comment">!         of elements in C exceeds nzmax.                               </span>
<a name="l04515"></a>04515 <span class="comment">!                                                                       </span>
<a name="l04516"></a>04516 <span class="comment">! Notes:                                                                </span>
<a name="l04517"></a>04517 <span class="comment">!-------                                                                </span>
<a name="l04518"></a>04518 <span class="comment">!     this will not work if any of the two input matrices is not sorted </span>
<a name="l04519"></a>04519 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l04520"></a>04520       <span class="keywordtype">integer</span> i, j1, j2, ka, kamax, kb, kbmax, kc
<a name="l04521"></a>04521 
<a name="l04522"></a>04522       ierr = 0 
<a name="l04523"></a>04523       kc = 1 
<a name="l04524"></a>04524       ic(1) = kc 
<a name="l04525"></a>04525 <span class="comment">!                                                                       </span>
<a name="l04526"></a>04526 <span class="comment">!     the following loop does a merge of two sparse rows + adds  them.  </span>
<a name="l04527"></a>04527 <span class="comment">!                                                                       </span>
<a name="l04528"></a>04528       <span class="keyword">do</span> 6 i=1, nrow 
<a name="l04529"></a>04529          ka = ia(i) 
<a name="l04530"></a>04530          kb = ib(i) 
<a name="l04531"></a>04531          kamax = ia(i+1)-1 
<a name="l04532"></a>04532          kbmax = ib(i+1)-1 
<a name="l04533"></a>04533     5    continue 
<a name="l04534"></a>04534 <span class="comment">!                                                                       </span>
<a name="l04535"></a>04535 <span class="comment">!     this is a while  -- do loop --                                    </span>
<a name="l04536"></a>04536 <span class="comment">!                                                                       </span>
<a name="l04537"></a>04537          <span class="keyword">if</span> (ka  &lt;=  kamax .or. kb  &lt;=  kbmax) <span class="keyword">then</span> 
<a name="l04538"></a>04538 <span class="comment">!                                                                       </span>
<a name="l04539"></a>04539             <span class="keyword">if</span> (ka  &lt;=  kamax) <span class="keyword">then</span> 
<a name="l04540"></a>04540                j1 = ja(ka) 
<a name="l04541"></a>04541             <span class="keyword">else</span> 
<a name="l04542"></a>04542 <span class="comment">!     take j1 large enough  that always j2  &lt;  j1                      </span>
<a name="l04543"></a>04543                j1 = ncol+1 
<a name="l04544"></a>04544             <span class="keyword">endif</span> 
<a name="l04545"></a>04545             <span class="keyword">if</span> (kb  &lt;=  kbmax) <span class="keyword">then</span> 
<a name="l04546"></a>04546                j2 = jb(kb) 
<a name="l04547"></a>04547             <span class="keyword">else</span> 
<a name="l04548"></a>04548 <span class="comment">!     similarly take j2 large enough  that always j1  &lt;  j2            </span>
<a name="l04549"></a>04549                j2 = ncol+1 
<a name="l04550"></a>04550             <span class="keyword">endif</span> 
<a name="l04551"></a>04551 <span class="comment">!                                                                       </span>
<a name="l04552"></a>04552 <span class="comment">!     three cases                                                       </span>
<a name="l04553"></a>04553 <span class="comment">!                                                                       </span>
<a name="l04554"></a>04554             <span class="keyword">if</span> (j1  ==  j2) <span class="keyword">then</span> 
<a name="l04555"></a>04555                c(kc) = a(ka)+s*b(kb) 
<a name="l04556"></a>04556                jc(kc) = j1 
<a name="l04557"></a>04557                ka = ka+1 
<a name="l04558"></a>04558                kb = kb+1 
<a name="l04559"></a>04559                kc = kc+1 
<a name="l04560"></a>04560             <span class="keyword">else</span> <span class="keyword">if</span> (j1  &lt;  j2) <span class="keyword">then</span> 
<a name="l04561"></a>04561                jc(kc) = j1 
<a name="l04562"></a>04562                c(kc) = a(ka) 
<a name="l04563"></a>04563                ka = ka+1 
<a name="l04564"></a>04564                kc = kc+1 
<a name="l04565"></a>04565             <span class="keyword">else</span> <span class="keyword">if</span> (j1  &gt;  j2) <span class="keyword">then</span> 
<a name="l04566"></a>04566                jc(kc) = j2 
<a name="l04567"></a>04567                c(kc) = s*b(kb) 
<a name="l04568"></a>04568                kb = kb+1 
<a name="l04569"></a>04569                kc = kc+1 
<a name="l04570"></a>04570             <span class="keyword">endif</span> 
<a name="l04571"></a>04571             <span class="keyword">if</span> (kc  &gt;  nzmax) goto 999 
<a name="l04572"></a>04572             goto 5 
<a name="l04573"></a>04573 <span class="comment">!                                                                       </span>
<a name="l04574"></a>04574 <span class="comment">!     end while loop                                                    </span>
<a name="l04575"></a>04575 <span class="comment">!                                                                       </span>
<a name="l04576"></a>04576          <span class="keyword">endif</span> 
<a name="l04577"></a>04577          ic(i+1) = kc 
<a name="l04578"></a>04578     6 continue 
<a name="l04579"></a>04579       return 
<a name="l04580"></a>04580   999 ierr = i 
<a name="l04581"></a>04581       return 
<a name="l04582"></a>04582 <span class="comment">!------------end-of-aplsb --------------------------------------------- </span>
<a name="l04583"></a>04583 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l04584"></a>04584 <span class="keyword">      end subroutine aplsb</span>
<a name="l04585"></a>04585 
<a name="l04586"></a>04586 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l04587"></a><a class="code" href="namespaceunary__mod.html#a74f4d4f5c3a2ed700c06f382e2ac5c72">04587</a>       <span class="keyword">subroutine </span><a class="code" href="namespaceunary__mod.html#a74f4d4f5c3a2ed700c06f382e2ac5c72">aplsb1</a> (nrow,ncol,a,ja,ia,s,b,jb,ib,c,jc,ic,           &amp;
<a name="l04588"></a>04588      &amp;     nzmax,ierr)                                                  
<a name="l04589"></a>04589      <span class="keywordtype">integer</span> nrow, ncol, nzmax, ierr 
<a name="l04590"></a>04590      <span class="keywordtype">real(wp)</span> a(*), b(*), c(*), s 
<a name="l04591"></a>04591      <span class="keywordtype">integer</span> ja(*),jb(*),jc(*),ia(nrow+1),ib(nrow+1),ic(nrow+1) 
<a name="l04592"></a>04592 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l04593"></a>04593 <span class="comment">! performs the operation C = A+s B for matrices in sorted CSR format.   </span>
<a name="l04594"></a>04594 <span class="comment">! the difference with aplsb is that the resulting matrix is such that   </span>
<a name="l04595"></a>04595 <span class="comment">! the elements of each row are sorted with increasing column indices in </span>
<a name="l04596"></a>04596 <span class="comment">! each row, provided the original matrices are sorted in the same way.  </span>
<a name="l04597"></a>04597 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l04598"></a>04598 <span class="comment">! on entry:                                                             </span>
<a name="l04599"></a>04599 <span class="comment">! ---------                                                             </span>
<a name="l04600"></a>04600 <span class="comment">! nrow        = integer. The row dimension of A and B                   </span>
<a name="l04601"></a>04601 <span class="comment">! ncol  = integer. The column dimension of A and B.                     </span>
<a name="l04602"></a>04602 <span class="comment">!                                                                       </span>
<a name="l04603"></a>04603 <span class="comment">! a,                                                                    </span>
<a name="l04604"></a>04604 <span class="comment">! ja,                                                                   </span>
<a name="l04605"></a>04605 <span class="comment">! ia   = Matrix A in compressed sparse row format with entries sorted   </span>
<a name="l04606"></a>04606 <span class="comment">!                                                                       </span>
<a name="l04607"></a>04607 <span class="comment">! s        = real. scalar factor for B.                                 </span>
<a name="l04608"></a>04608 <span class="comment">!                                                                       </span>
<a name="l04609"></a>04609 <span class="comment">! b,                                                                    </span>
<a name="l04610"></a>04610 <span class="comment">! jb,                                                                   </span>
<a name="l04611"></a>04611 <span class="comment">! ib        =  Matrix B in compressed sparse row format with entries sor</span>
<a name="l04612"></a>04612 <span class="comment">!        ascendly in each row                                           </span>
<a name="l04613"></a>04613 <span class="comment">!                                                                       </span>
<a name="l04614"></a>04614 <span class="comment">! nzmax        = integer. The  length of the arrays c and jc.           </span>
<a name="l04615"></a>04615 <span class="comment">!         amub will stop if the result matrix C  has a number           </span>
<a name="l04616"></a>04616 <span class="comment">!         of elements that exceeds exceeds nzmax. See ierr.             </span>
<a name="l04617"></a>04617 <span class="comment">!                                                                       </span>
<a name="l04618"></a>04618 <span class="comment">! on return:                                                            </span>
<a name="l04619"></a>04619 <span class="comment">!----------                                                             </span>
<a name="l04620"></a>04620 <span class="comment">! c,                                                                    </span>
<a name="l04621"></a>04621 <span class="comment">! jc,                                                                   </span>
<a name="l04622"></a>04622 <span class="comment">! ic        = resulting matrix C in compressed sparse row sparse format </span>
<a name="l04623"></a>04623 <span class="comment">!         with entries sorted ascendly in each row.                     </span>
<a name="l04624"></a>04624 <span class="comment">!                                                                       </span>
<a name="l04625"></a>04625 <span class="comment">! ierr        = integer. serving as error message.                      </span>
<a name="l04626"></a>04626 <span class="comment">!         ierr = 0 means normal return,                                 </span>
<a name="l04627"></a>04627 <span class="comment">!         ierr  &gt;  0 means that amub stopped while computing the       </span>
<a name="l04628"></a>04628 <span class="comment">!         i-th row  of C with i=ierr, because the number                </span>
<a name="l04629"></a>04629 <span class="comment">!         of elements in C exceeds nzmax.                               </span>
<a name="l04630"></a>04630 <span class="comment">!                                                                       </span>
<a name="l04631"></a>04631 <span class="comment">! Notes:                                                                </span>
<a name="l04632"></a>04632 <span class="comment">!-------                                                                </span>
<a name="l04633"></a>04633 <span class="comment">!     this will not work if any of the two input matrices is not sorted </span>
<a name="l04634"></a>04634 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l04635"></a>04635       <span class="keywordtype">integer</span> i, j1, j2, ka, kamax, kb, kbmax, kc
<a name="l04636"></a>04636 
<a name="l04637"></a>04637       ierr = 0 
<a name="l04638"></a>04638       kc = 1 
<a name="l04639"></a>04639       ic(1) = kc 
<a name="l04640"></a>04640 <span class="comment">!                                                                       </span>
<a name="l04641"></a>04641 <span class="comment">!     the following loop does a merge of two sparse rows + adds  them.  </span>
<a name="l04642"></a>04642 <span class="comment">!                                                                       </span>
<a name="l04643"></a>04643       <span class="keyword">do</span> 6 i=1, nrow 
<a name="l04644"></a>04644          ka = ia(i) 
<a name="l04645"></a>04645          kb = ib(i) 
<a name="l04646"></a>04646          kamax = ia(i+1)-1 
<a name="l04647"></a>04647          kbmax = ib(i+1)-1 
<a name="l04648"></a>04648     5    continue 
<a name="l04649"></a>04649 <span class="comment">!                                                                       </span>
<a name="l04650"></a>04650 <span class="comment">!     this is a while  -- do loop --                                    </span>
<a name="l04651"></a>04651 <span class="comment">!                                                                       </span>
<a name="l04652"></a>04652          <span class="keyword">if</span> (ka  &lt;=  kamax .or. kb  &lt;=  kbmax) <span class="keyword">then</span> 
<a name="l04653"></a>04653 <span class="comment">!                                                                       </span>
<a name="l04654"></a>04654             <span class="keyword">if</span> (ka  &lt;=  kamax) <span class="keyword">then</span> 
<a name="l04655"></a>04655                j1 = ja(ka) 
<a name="l04656"></a>04656             <span class="keyword">else</span> 
<a name="l04657"></a>04657 <span class="comment">!     take j1 large enough  that always j2  &lt;  j1                      </span>
<a name="l04658"></a>04658                j1 = ncol+1 
<a name="l04659"></a>04659             <span class="keyword">endif</span> 
<a name="l04660"></a>04660             <span class="keyword">if</span> (kb  &lt;=  kbmax) <span class="keyword">then</span> 
<a name="l04661"></a>04661                j2 = jb(kb) 
<a name="l04662"></a>04662             <span class="keyword">else</span> 
<a name="l04663"></a>04663 <span class="comment">!     similarly take j2 large enough  that always j1  &lt;  j2            </span>
<a name="l04664"></a>04664                j2 = ncol+1 
<a name="l04665"></a>04665             <span class="keyword">endif</span> 
<a name="l04666"></a>04666 <span class="comment">!                                                                       </span>
<a name="l04667"></a>04667 <span class="comment">!     three cases                                                       </span>
<a name="l04668"></a>04668 <span class="comment">!                                                                       </span>
<a name="l04669"></a>04669             <span class="keyword">if</span> (j1  ==  j2) <span class="keyword">then</span> 
<a name="l04670"></a>04670                c(kc) = a(ka)+s*b(kb) 
<a name="l04671"></a>04671                jc(kc) = j1 
<a name="l04672"></a>04672                ka = ka+1 
<a name="l04673"></a>04673                kb = kb+1 
<a name="l04674"></a>04674                kc = kc+1 
<a name="l04675"></a>04675             <span class="keyword">else</span> <span class="keyword">if</span> (j1  &lt;  j2) <span class="keyword">then</span> 
<a name="l04676"></a>04676                jc(kc) = j1 
<a name="l04677"></a>04677                c(kc) = a(ka) 
<a name="l04678"></a>04678                ka = ka+1 
<a name="l04679"></a>04679                kc = kc+1 
<a name="l04680"></a>04680             <span class="keyword">else</span> <span class="keyword">if</span> (j1  &gt;  j2) <span class="keyword">then</span> 
<a name="l04681"></a>04681                jc(kc) = j2 
<a name="l04682"></a>04682                c(kc) = s*b(kb) 
<a name="l04683"></a>04683                kb = kb+1 
<a name="l04684"></a>04684                kc = kc+1 
<a name="l04685"></a>04685             <span class="keyword">endif</span> 
<a name="l04686"></a>04686             <span class="keyword">if</span> (kc  &gt;  nzmax) goto 999 
<a name="l04687"></a>04687             goto 5 
<a name="l04688"></a>04688 <span class="comment">!                                                                       </span>
<a name="l04689"></a>04689 <span class="comment">!     end while loop                                                    </span>
<a name="l04690"></a>04690 <span class="comment">!                                                                       </span>
<a name="l04691"></a>04691          <span class="keyword">endif</span> 
<a name="l04692"></a>04692          ic(i+1) = kc 
<a name="l04693"></a>04693     6 continue 
<a name="l04694"></a>04694       return 
<a name="l04695"></a>04695   999 ierr = i 
<a name="l04696"></a>04696       return 
<a name="l04697"></a>04697 <span class="comment">!------------end-of-aplsb1 ---------------------------------------------</span>
<a name="l04698"></a>04698 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l04699"></a>04699 <span class="keyword">      end subroutine aplsb1</span>
<a name="l04700"></a>04700 
<a name="l04701"></a>04701 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l04702"></a>04702 <span class="comment">!      subroutine apmbt (nrow,ncol,job,a,ja,ia,b,jb,ib,                  &amp;</span>
<a name="l04703"></a>04703 <span class="comment">!     &amp;     c,jc,ic,nzmax,iw,ierr)                                       </span>
<a name="l04704"></a>04704 <span class="comment">!      real(wp) a(*), b(*), c(*) </span>
<a name="l04705"></a>04705 <span class="comment">!      integer ja(*),jb(*),jc(*),ia(nrow+1),ib(ncol+1),ic(*),iw(*) </span>
<a name="l04706"></a>04706 <span class="comment">!!-----------------------------------------------------------------------</span>
<a name="l04707"></a>04707 <span class="comment">!! performs the matrix sum  C = A + transp(B) or C = A - transp(B)       </span>
<a name="l04708"></a>04708 <span class="comment">!!-----------------------------------------------------------------------</span>
<a name="l04709"></a>04709 <span class="comment">!! on entry:                                                             </span>
<a name="l04710"></a>04710 <span class="comment">!! ---------                                                             </span>
<a name="l04711"></a>04711 <span class="comment">!! nrow        = integer. The row dimension of A and transp(B)           </span>
<a name="l04712"></a>04712 <span class="comment">!! ncol  = integer. The column dimension of A. Also the row              </span>
<a name="l04713"></a>04713 <span class="comment">!!                  dimension of B.                                      </span>
<a name="l04714"></a>04714 <span class="comment">!!                                                                       </span>
<a name="l04715"></a>04715 <span class="comment">!! job        = integer. if job = -1, apmbt will compute C= A - transp(B)</span>
<a name="l04716"></a>04716 <span class="comment">!!         (structure + values)                                          </span>
<a name="l04717"></a>04717 <span class="comment">!!         if (job  ==  1)  it will compute C=A+transp(A)                </span>
<a name="l04718"></a>04718 <span class="comment">!!         (structure+ values)                                           </span>
<a name="l04719"></a>04719 <span class="comment">!!         if (job  ==  0) it will compute the structure of              </span>
<a name="l04720"></a>04720 <span class="comment">!!         C= A+/-transp(B) only (ignoring all real values).             </span>
<a name="l04721"></a>04721 <span class="comment">!!         any other value of job will be treated as  job=1              </span>
<a name="l04722"></a>04722 <span class="comment">!! a,                                                                    </span>
<a name="l04723"></a>04723 <span class="comment">!! ja,                                                                   </span>
<a name="l04724"></a>04724 <span class="comment">!! ia    = Matrix A in compressed sparse row format.                     </span>
<a name="l04725"></a>04725 <span class="comment">!!                                                                       </span>
<a name="l04726"></a>04726 <span class="comment">!! b,                                                                    </span>
<a name="l04727"></a>04727 <span class="comment">!! jb,                                                                   </span>
<a name="l04728"></a>04728 <span class="comment">!! ib        =  Matrix B in compressed sparse row format.                </span>
<a name="l04729"></a>04729 <span class="comment">!!                                                                       </span>
<a name="l04730"></a>04730 <span class="comment">!! nzmax        = integer. The  length of the arrays c, jc, and ic.      </span>
<a name="l04731"></a>04731 <span class="comment">!!         amub will stop if the result matrix C  has a number           </span>
<a name="l04732"></a>04732 <span class="comment">!!         of elements that exceeds exceeds nzmax. See ierr.             </span>
<a name="l04733"></a>04733 <span class="comment">!!                                                                       </span>
<a name="l04734"></a>04734 <span class="comment">!! on return:                                                            </span>
<a name="l04735"></a>04735 <span class="comment">!!----------                                                             </span>
<a name="l04736"></a>04736 <span class="comment">!! c,                                                                    </span>
<a name="l04737"></a>04737 <span class="comment">!! jc,                                                                   </span>
<a name="l04738"></a>04738 <span class="comment">!! ic        = resulting matrix C in compressed sparse row format.       </span>
<a name="l04739"></a>04739 <span class="comment">!!                                                                       </span>
<a name="l04740"></a>04740 <span class="comment">!! ierr        = integer. serving as error message.                      </span>
<a name="l04741"></a>04741 <span class="comment">!!         ierr = 0 means normal return.                                 </span>
<a name="l04742"></a>04742 <span class="comment">!!         ierr = -1 means that nzmax was  &lt;  either the number of      </span>
<a name="l04743"></a>04743 <span class="comment">!!         nonzero elements of A or the number of nonzero elements in B. </span>
<a name="l04744"></a>04744 <span class="comment">!!         ierr  &gt;  0 means that amub stopped while computing the       </span>
<a name="l04745"></a>04745 <span class="comment">!!         i-th row  of C with i=ierr, because the number                </span>
<a name="l04746"></a>04746 <span class="comment">!!         of elements in C exceeds nzmax.                               </span>
<a name="l04747"></a>04747 <span class="comment">!!                                                                       </span>
<a name="l04748"></a>04748 <span class="comment">!! work arrays:                                                          </span>
<a name="l04749"></a>04749 <span class="comment">!!------------                                                           </span>
<a name="l04750"></a>04750 <span class="comment">!! iw        = integer work array of length at least max(ncol,nrow)      </span>
<a name="l04751"></a>04751 <span class="comment">!!                                                                       </span>
<a name="l04752"></a>04752 <span class="comment">!! Notes:                                                                </span>
<a name="l04753"></a>04753 <span class="comment">!!------- It is important to note that here all of three arrays c, ic,   </span>
<a name="l04754"></a>04754 <span class="comment">!!        and jc are assumed to be of length nnz(c). This is because     </span>
<a name="l04755"></a>04755 <span class="comment">!!        the matrix is internally converted in coordinate format.       </span>
<a name="l04756"></a>04756 <span class="comment">!!                                                                       </span>
<a name="l04757"></a>04757 <span class="comment">!!-----------------------------------------------------------------------</span>
<a name="l04758"></a>04758 <span class="comment">!      logical values </span>
<a name="l04759"></a>04759 <span class="comment">!      values = (job  /=  0) </span>
<a name="l04760"></a>04760 <span class="comment">!!                                                                       </span>
<a name="l04761"></a>04761 <span class="comment">!      ierr = 0 </span>
<a name="l04762"></a>04762 <span class="comment">!      do 1 j=1, ncol </span>
<a name="l04763"></a>04763 <span class="comment">!         iw(j) = 0 </span>
<a name="l04764"></a>04764 <span class="comment">!    1 continue </span>
<a name="l04765"></a>04765 <span class="comment">!!                                                                       </span>
<a name="l04766"></a>04766 <span class="comment">!      nnza = ia(nrow+1)-1 </span>
<a name="l04767"></a>04767 <span class="comment">!      nnzb = ib(ncol+1)-1 </span>
<a name="l04768"></a>04768 <span class="comment">!      len = nnzb </span>
<a name="l04769"></a>04769 <span class="comment">!      if (nzmax  &lt;  nnzb .or. nzmax  &lt;  nnza) then </span>
<a name="l04770"></a>04770 <span class="comment">!         ierr = -1 </span>
<a name="l04771"></a>04771 <span class="comment">!         return </span>
<a name="l04772"></a>04772 <span class="comment">!      endif </span>
<a name="l04773"></a>04773 <span class="comment">!!                                                                       </span>
<a name="l04774"></a>04774 <span class="comment">!! trasnpose matrix b into c                                             </span>
<a name="l04775"></a>04775 <span class="comment">!!                                                                       </span>
<a name="l04776"></a>04776 <span class="comment">!      ljob = 0 </span>
<a name="l04777"></a>04777 <span class="comment">!      if (values) ljob = 1 </span>
<a name="l04778"></a>04778 <span class="comment">!      ipos = 1 </span>
<a name="l04779"></a>04779 <span class="comment">!      call csrcsc (ncol,ljob,ipos,b,jb,ib,c,jc,ic) </span>
<a name="l04780"></a>04780 <span class="comment">!!-----------------------------------------------------------------------</span>
<a name="l04781"></a>04781 <span class="comment">!      if (job  ==  -1) then </span>
<a name="l04782"></a>04782 <span class="comment">!         do 2 k=1,len </span>
<a name="l04783"></a>04783 <span class="comment">!            c(k) = -c(k) </span>
<a name="l04784"></a>04784 <span class="comment">!    2    continue </span>
<a name="l04785"></a>04785 <span class="comment">!      endif </span>
<a name="l04786"></a>04786 <span class="comment">!!                                                                       </span>
<a name="l04787"></a>04787 <span class="comment">!!--------------- main loop -------------------------------------------- </span>
<a name="l04788"></a>04788 <span class="comment">!!                                                                       </span>
<a name="l04789"></a>04789 <span class="comment">!      do 500 ii=1, nrow </span>
<a name="l04790"></a>04790 <span class="comment">!         do 200 k = ic(ii),ic(ii+1)-1 </span>
<a name="l04791"></a>04791 <span class="comment">!            iw(jc(k)) = k </span>
<a name="l04792"></a>04792 <span class="comment">!  200    continue </span>
<a name="l04793"></a>04793 <span class="comment">!!-----------------------------------------------------------------------</span>
<a name="l04794"></a>04794 <span class="comment">!         do 300 ka = ia(ii), ia(ii+1)-1 </span>
<a name="l04795"></a>04795 <span class="comment">!            jcol = ja(ka) </span>
<a name="l04796"></a>04796 <span class="comment">!            jpos = iw(jcol) </span>
<a name="l04797"></a>04797 <span class="comment">!            if (jpos  ==  0) then </span>
<a name="l04798"></a>04798 <span class="comment">!!                                                                       </span>
<a name="l04799"></a>04799 <span class="comment">!!     if fill-in append in coordinate format to matrix.                 </span>
<a name="l04800"></a>04800 <span class="comment">!!                                                                       </span>
<a name="l04801"></a>04801 <span class="comment">!               len = len+1 </span>
<a name="l04802"></a>04802 <span class="comment">!               if (len  &gt;  nzmax) goto 999 </span>
<a name="l04803"></a>04803 <span class="comment">!               jc(len) = jcol </span>
<a name="l04804"></a>04804 <span class="comment">!                                                                        </span>
<a name="l04805"></a>04805 <span class="comment">!               ic(len) = ii </span>
<a name="l04806"></a>04806 <span class="comment">!               if (values) c(len)  = a(ka) </span>
<a name="l04807"></a>04807 <span class="comment">!            else </span>
<a name="l04808"></a>04808 <span class="comment">!!     else do addition.                                                 </span>
<a name="l04809"></a>04809 <span class="comment">!               if (values) c(jpos) = c(jpos) + a(ka) </span>
<a name="l04810"></a>04810 <span class="comment">!            endif </span>
<a name="l04811"></a>04811 <span class="comment">!  300    continue </span>
<a name="l04812"></a>04812 <span class="comment">!         do 301 k=ic(ii), ic(ii+1)-1 </span>
<a name="l04813"></a>04813 <span class="comment">!            iw(jc(k)) = 0 </span>
<a name="l04814"></a>04814 <span class="comment">!  301    continue </span>
<a name="l04815"></a>04815 <span class="comment">!  500 continue </span>
<a name="l04816"></a>04816 <span class="comment">!!                                                                       </span>
<a name="l04817"></a>04817 <span class="comment">!!     convert first part of matrix (without fill-ins) into coo format   </span>
<a name="l04818"></a>04818 <span class="comment">!!                                                                       </span>
<a name="l04819"></a>04819 <span class="comment">!      ljob = 2 </span>
<a name="l04820"></a>04820 <span class="comment">!      if (values) ljob = 3 </span>
<a name="l04821"></a>04821 <span class="comment">!      do 501 i=1, nrow+1 </span>
<a name="l04822"></a>04822 <span class="comment">!         iw(i) = ic(i) </span>
<a name="l04823"></a>04823 <span class="comment">!  501 continue </span>
<a name="l04824"></a>04824 <span class="comment">!      call csrcoo (nrow,ljob,nnzb,c,jc,iw,nnzb,c,ic,jc,ierr) </span>
<a name="l04825"></a>04825 <span class="comment">!!                                                                       </span>
<a name="l04826"></a>04826 <span class="comment">!!     convert the whole thing back to csr format.                       </span>
<a name="l04827"></a>04827 <span class="comment">!!                                                                       </span>
<a name="l04828"></a>04828 <span class="comment">!      ljob = 0 </span>
<a name="l04829"></a>04829 <span class="comment">!      if (values) ljob = 1 </span>
<a name="l04830"></a>04830 <span class="comment">!      call coicsr (nrow,len,ljob,c,jc,ic,iw) </span>
<a name="l04831"></a>04831 <span class="comment">!      return </span>
<a name="l04832"></a>04832 <span class="comment">!  999 ierr = ii </span>
<a name="l04833"></a>04833 <span class="comment">!      return </span>
<a name="l04834"></a>04834 <span class="comment">!!--------end-of-apmbt---------------------------------------------------</span>
<a name="l04835"></a>04835 <span class="comment">!!-----------------------------------------------------------------------</span>
<a name="l04836"></a>04836 <span class="comment">!      end subroutine apmbt</span>
<a name="l04837"></a>04837 <span class="comment">!</span>
<a name="l04838"></a>04838 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l04839"></a>04839 <span class="comment">!      subroutine aplsbt(nrow,ncol,a,ja,ia,s,b,jb,ib,                    &amp;</span>
<a name="l04840"></a>04840 <span class="comment">!     &amp;     c,jc,ic,nzmax,iw,ierr)                                       </span>
<a name="l04841"></a>04841 <span class="comment">!      real(wp) a(*), b(*), c(*), s </span>
<a name="l04842"></a>04842 <span class="comment">!      integer ja(*),jb(*),jc(*),ia(nrow+1),ib(ncol+1),ic(*),iw(*) </span>
<a name="l04843"></a>04843 <span class="comment">!!-----------------------------------------------------------------------</span>
<a name="l04844"></a>04844 <span class="comment">!! performs the matrix sum  C = A + transp(B).                           </span>
<a name="l04845"></a>04845 <span class="comment">!!-----------------------------------------------------------------------</span>
<a name="l04846"></a>04846 <span class="comment">!! on entry:                                                             </span>
<a name="l04847"></a>04847 <span class="comment">!! ---------                                                             </span>
<a name="l04848"></a>04848 <span class="comment">!! nrow        = integer. The row dimension of A and transp(B)           </span>
<a name="l04849"></a>04849 <span class="comment">!! ncol  = integer. The column dimension of A. Also the row              </span>
<a name="l04850"></a>04850 <span class="comment">!!                  dimension of B.                                      </span>
<a name="l04851"></a>04851 <span class="comment">!!                                                                       </span>
<a name="l04852"></a>04852 <span class="comment">!! a,                                                                    </span>
<a name="l04853"></a>04853 <span class="comment">!! ja,                                                                   </span>
<a name="l04854"></a>04854 <span class="comment">!! ia    = Matrix A in compressed sparse row format.                     </span>
<a name="l04855"></a>04855 <span class="comment">!!                                                                       </span>
<a name="l04856"></a>04856 <span class="comment">!! s        = real. scalar factor for B.                                 </span>
<a name="l04857"></a>04857 <span class="comment">!!                                                                       </span>
<a name="l04858"></a>04858 <span class="comment">!!                                                                       </span>
<a name="l04859"></a>04859 <span class="comment">!! b,                                                                    </span>
<a name="l04860"></a>04860 <span class="comment">!! jb,                                                                   </span>
<a name="l04861"></a>04861 <span class="comment">!! ib        =  Matrix B in compressed sparse row format.                </span>
<a name="l04862"></a>04862 <span class="comment">!!                                                                       </span>
<a name="l04863"></a>04863 <span class="comment">!! nzmax        = integer. The  length of the arrays c, jc, and ic.      </span>
<a name="l04864"></a>04864 <span class="comment">!!         amub will stop if the result matrix C  has a number           </span>
<a name="l04865"></a>04865 <span class="comment">!!         of elements that exceeds exceeds nzmax. See ierr.             </span>
<a name="l04866"></a>04866 <span class="comment">!!                                                                       </span>
<a name="l04867"></a>04867 <span class="comment">!! on return:                                                            </span>
<a name="l04868"></a>04868 <span class="comment">!!----------                                                             </span>
<a name="l04869"></a>04869 <span class="comment">!! c,                                                                    </span>
<a name="l04870"></a>04870 <span class="comment">!! jc,                                                                   </span>
<a name="l04871"></a>04871 <span class="comment">!! ic        = resulting matrix C in compressed sparse row format.       </span>
<a name="l04872"></a>04872 <span class="comment">!!                                                                       </span>
<a name="l04873"></a>04873 <span class="comment">!! ierr        = integer. serving as error message.                      </span>
<a name="l04874"></a>04874 <span class="comment">!!         ierr = 0 means normal return.                                 </span>
<a name="l04875"></a>04875 <span class="comment">!!         ierr = -1 means that nzmax was  &lt;  either the number of      </span>
<a name="l04876"></a>04876 <span class="comment">!!         nonzero elements of A or the number of nonzero elements in B. </span>
<a name="l04877"></a>04877 <span class="comment">!!         ierr  &gt;  0 means that amub stopped while computing the       </span>
<a name="l04878"></a>04878 <span class="comment">!!         i-th row  of C with i=ierr, because the number                </span>
<a name="l04879"></a>04879 <span class="comment">!!         of elements in C exceeds nzmax.                               </span>
<a name="l04880"></a>04880 <span class="comment">!!                                                                       </span>
<a name="l04881"></a>04881 <span class="comment">!! work arrays:                                                          </span>
<a name="l04882"></a>04882 <span class="comment">!!------------                                                           </span>
<a name="l04883"></a>04883 <span class="comment">!! iw        = integer work array of length at least max(nrow,ncol)      </span>
<a name="l04884"></a>04884 <span class="comment">!!                                                                       </span>
<a name="l04885"></a>04885 <span class="comment">!! Notes:                                                                </span>
<a name="l04886"></a>04886 <span class="comment">!!------- It is important to note that here all of three arrays c, ic,   </span>
<a name="l04887"></a>04887 <span class="comment">!!        and jc are assumed to be of length nnz(c). This is because     </span>
<a name="l04888"></a>04888 <span class="comment">!!        the matrix is internally converted in coordinate format.       </span>
<a name="l04889"></a>04889 <span class="comment">!!                                                                       </span>
<a name="l04890"></a>04890 <span class="comment">!!-----------------------------------------------------------------------</span>
<a name="l04891"></a>04891 <span class="comment">!      ierr = 0 </span>
<a name="l04892"></a>04892 <span class="comment">!      do 1 j=1, ncol </span>
<a name="l04893"></a>04893 <span class="comment">!         iw(j) = 0 </span>
<a name="l04894"></a>04894 <span class="comment">!    1 continue </span>
<a name="l04895"></a>04895 <span class="comment">!!                                                                       </span>
<a name="l04896"></a>04896 <span class="comment">!      nnza = ia(nrow+1)-1 </span>
<a name="l04897"></a>04897 <span class="comment">!      nnzb = ib(ncol+1)-1 </span>
<a name="l04898"></a>04898 <span class="comment">!      len = nnzb </span>
<a name="l04899"></a>04899 <span class="comment">!      if (nzmax  &lt;  nnzb .or. nzmax  &lt;  nnza) then </span>
<a name="l04900"></a>04900 <span class="comment">!         ierr = -1 </span>
<a name="l04901"></a>04901 <span class="comment">!         return </span>
<a name="l04902"></a>04902 <span class="comment">!      endif </span>
<a name="l04903"></a>04903 <span class="comment">!!                                                                       </span>
<a name="l04904"></a>04904 <span class="comment">!!     transpose matrix b into c                                         </span>
<a name="l04905"></a>04905 <span class="comment">!!                                                                       </span>
<a name="l04906"></a>04906 <span class="comment">!      ljob = 1 </span>
<a name="l04907"></a>04907 <span class="comment">!      ipos = 1 </span>
<a name="l04908"></a>04908 <span class="comment">!      call csrcsc (ncol,ljob,ipos,b,jb,ib,c,jc,ic) </span>
<a name="l04909"></a>04909 <span class="comment">!      do 2 k=1,len </span>
<a name="l04910"></a>04910 <span class="comment">!    2    c(k) = c(k)*s </span>
<a name="l04911"></a>04911 <span class="comment">!!                                                                       </span>
<a name="l04912"></a>04912 <span class="comment">!!     main loop. add rows from ii = 1 to nrow.                          </span>
<a name="l04913"></a>04913 <span class="comment">!!                                                                       </span>
<a name="l04914"></a>04914 <span class="comment">!         do 500 ii=1, nrow </span>
<a name="l04915"></a>04915 <span class="comment">!!     iw is used as a system to recognize whether there                 </span>
<a name="l04916"></a>04916 <span class="comment">!!     was a nonzero element in c.                                       </span>
<a name="l04917"></a>04917 <span class="comment">!            do 200 k = ic(ii),ic(ii+1)-1 </span>
<a name="l04918"></a>04918 <span class="comment">!               iw(jc(k)) = k </span>
<a name="l04919"></a>04919 <span class="comment">!  200       continue </span>
<a name="l04920"></a>04920 <span class="comment">!!                                                                       </span>
<a name="l04921"></a>04921 <span class="comment">!            do 300 ka = ia(ii), ia(ii+1)-1 </span>
<a name="l04922"></a>04922 <span class="comment">!               jcol = ja(ka) </span>
<a name="l04923"></a>04923 <span class="comment">!               jpos = iw(jcol) </span>
<a name="l04924"></a>04924 <span class="comment">!           if (jpos  ==  0) then </span>
<a name="l04925"></a>04925 <span class="comment">!!                                                                       </span>
<a name="l04926"></a>04926 <span class="comment">!!     if fill-in append in coordinate format to matrix.                 </span>
<a name="l04927"></a>04927 <span class="comment">!!                                                                       </span>
<a name="l04928"></a>04928 <span class="comment">!              len = len+1 </span>
<a name="l04929"></a>04929 <span class="comment">!              if (len  &gt;  nzmax) goto 999 </span>
<a name="l04930"></a>04930 <span class="comment">!              jc(len) = jcol </span>
<a name="l04931"></a>04931 <span class="comment">!              ic(len) = ii </span>
<a name="l04932"></a>04932 <span class="comment">!              c(len)  = a(ka) </span>
<a name="l04933"></a>04933 <span class="comment">!           else </span>
<a name="l04934"></a>04934 <span class="comment">!!     else do addition.                                                 </span>
<a name="l04935"></a>04935 <span class="comment">!              c(jpos) = c(jpos) + a(ka) </span>
<a name="l04936"></a>04936 <span class="comment">!           endif </span>
<a name="l04937"></a>04937 <span class="comment">!  300   continue </span>
<a name="l04938"></a>04938 <span class="comment">!        do 301 k=ic(ii), ic(ii+1)-1 </span>
<a name="l04939"></a>04939 <span class="comment">!           iw(jc(k)) = 0 </span>
<a name="l04940"></a>04940 <span class="comment">!  301   continue </span>
<a name="l04941"></a>04941 <span class="comment">!  500 continue </span>
<a name="l04942"></a>04942 <span class="comment">!!                                                                       </span>
<a name="l04943"></a>04943 <span class="comment">!!     convert first part of matrix (without fill-ins) into coo format   </span>
<a name="l04944"></a>04944 <span class="comment">!!                                                                       </span>
<a name="l04945"></a>04945 <span class="comment">!      ljob = 3 </span>
<a name="l04946"></a>04946 <span class="comment">!      do 501 i=1, nrow+1 </span>
<a name="l04947"></a>04947 <span class="comment">!         iw(i) = ic(i) </span>
<a name="l04948"></a>04948 <span class="comment">!  501 continue </span>
<a name="l04949"></a>04949 <span class="comment">!      call csrcoo (nrow,ljob,nnzb,c,jc,iw,nnzb,c,ic,jc,ierr) </span>
<a name="l04950"></a>04950 <span class="comment">!!                                                                       </span>
<a name="l04951"></a>04951 <span class="comment">!!     convert the whole thing back to csr format.                       </span>
<a name="l04952"></a>04952 <span class="comment">!!                                                                       </span>
<a name="l04953"></a>04953 <span class="comment">!      ljob = 1 </span>
<a name="l04954"></a>04954 <span class="comment">!      call coicsr (nrow,len,ljob,c,jc,ic,iw) </span>
<a name="l04955"></a>04955 <span class="comment">!      return </span>
<a name="l04956"></a>04956 <span class="comment">!  999 ierr = ii </span>
<a name="l04957"></a>04957 <span class="comment">!      return </span>
<a name="l04958"></a>04958 <span class="comment">!!--------end-of-aplsbt--------------------------------------------------</span>
<a name="l04959"></a>04959 <span class="comment">!!-----------------------------------------------------------------------</span>
<a name="l04960"></a>04960 <span class="comment">!      end subroutine aplsbt</span>
<a name="l04961"></a>04961 
<a name="l04962"></a>04962 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l04963"></a><a class="code" href="namespaceunary__mod.html#a428ee1d4e4ab14a12be914c401b90158">04963</a>       <span class="keyword">subroutine </span><a class="code" href="namespaceunary__mod.html#a428ee1d4e4ab14a12be914c401b90158">diamua</a> (nrow,job, a, ja, ia, diag, b, jb, ib) 
<a name="l04964"></a>04964       <span class="keywordtype">integer</span> nrow, job 
<a name="l04965"></a>04965       <span class="keywordtype">real(wp)</span> a(*), b(*), diag(nrow), scal 
<a name="l04966"></a>04966       <span class="keywordtype">integer</span> ja(*),jb(*), ia(nrow+1),ib(nrow+1) 
<a name="l04967"></a>04967 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l04968"></a>04968 <span class="comment">! performs the matrix by matrix product B = Diag * A  (in place)        </span>
<a name="l04969"></a>04969 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l04970"></a>04970 <span class="comment">! on entry:                                                             </span>
<a name="l04971"></a>04971 <span class="comment">! ---------                                                             </span>
<a name="l04972"></a>04972 <span class="comment">! nrow        = integer. The row dimension of A                         </span>
<a name="l04973"></a>04973 <span class="comment">!                                                                       </span>
<a name="l04974"></a>04974 <span class="comment">! job   = integer. job indicator. Job=0 means get array b only          </span>
<a name="l04975"></a>04975 <span class="comment">!         job = 1 means get b, and the integer arrays ib, jb.           </span>
<a name="l04976"></a>04976 <span class="comment">!                                                                       </span>
<a name="l04977"></a>04977 <span class="comment">! a,                                                                    </span>
<a name="l04978"></a>04978 <span class="comment">! ja,                                                                   </span>
<a name="l04979"></a>04979 <span class="comment">! ia   = Matrix A in compressed sparse row format.                      </span>
<a name="l04980"></a>04980 <span class="comment">!                                                                       </span>
<a name="l04981"></a>04981 <span class="comment">! diag = diagonal matrix stored as a vector dig(1:n)                    </span>
<a name="l04982"></a>04982 <span class="comment">!                                                                       </span>
<a name="l04983"></a>04983 <span class="comment">! on return:                                                            </span>
<a name="l04984"></a>04984 <span class="comment">!----------                                                             </span>
<a name="l04985"></a>04985 <span class="comment">!                                                                       </span>
<a name="l04986"></a>04986 <span class="comment">! b,                                                                    </span>
<a name="l04987"></a>04987 <span class="comment">! jb,                                                                   </span>
<a name="l04988"></a>04988 <span class="comment">! ib        = resulting matrix B in compressed sparse row sparse format.</span>
<a name="l04989"></a>04989 <span class="comment">!                                                                       </span>
<a name="l04990"></a>04990 <span class="comment">! Notes:                                                                </span>
<a name="l04991"></a>04991 <span class="comment">!-------                                                                </span>
<a name="l04992"></a>04992 <span class="comment">! 1)        The column dimension of A is not needed.                    </span>
<a name="l04993"></a>04993 <span class="comment">! 2)        algorithm in place (B can take the place of A).             </span>
<a name="l04994"></a>04994 <span class="comment">!           in this case use job=0.                                     </span>
<a name="l04995"></a>04995 <span class="comment">!-----------------------------------------------------------------      </span>
<a name="l04996"></a>04996       <span class="keywordtype">integer</span> ii, k, k1, k2
<a name="l04997"></a>04997       <span class="keyword">do</span> 1 ii=1,nrow 
<a name="l04998"></a>04998 <span class="comment">!                                                                       </span>
<a name="l04999"></a>04999 <span class="comment">!     normalize each row                                                </span>
<a name="l05000"></a>05000 <span class="comment">!                                                                       </span>
<a name="l05001"></a>05001          k1 = ia(ii) 
<a name="l05002"></a>05002          k2 = ia(ii+1)-1 
<a name="l05003"></a>05003          scal = diag(ii) 
<a name="l05004"></a>05004          <span class="keyword">do</span> 2 k=k1, k2 
<a name="l05005"></a>05005             b(k) = a(k)*scal 
<a name="l05006"></a>05006     2    continue 
<a name="l05007"></a>05007     1 continue 
<a name="l05008"></a>05008 <span class="comment">!                                                                       </span>
<a name="l05009"></a>05009       <span class="keyword">if</span> (job  ==  0) return 
<a name="l05010"></a>05010 <span class="comment">!                                                                       </span>
<a name="l05011"></a>05011       <span class="keyword">do</span> 3 ii=1, nrow+1 
<a name="l05012"></a>05012          ib(ii) = ia(ii) 
<a name="l05013"></a>05013     3 continue 
<a name="l05014"></a>05014       <span class="keyword">do</span> 31 k=ia(1), ia(nrow+1) -1 
<a name="l05015"></a>05015          jb(k) = ja(k) 
<a name="l05016"></a>05016    31 continue 
<a name="l05017"></a>05017 
<a name="l05018"></a>05018       return 
<a name="l05019"></a>05019 <span class="keyword">      end subroutine diamua</span>
<a name="l05020"></a>05020 
<a name="l05021"></a>05021 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l05022"></a><a class="code" href="namespaceunary__mod.html#a1fd7556350f3910e37b411bb32adcb26">05022</a>       <span class="keyword">subroutine </span><a class="code" href="namespaceunary__mod.html#a1fd7556350f3910e37b411bb32adcb26">amudia</a> (nrow,job, a, ja, ia, diag, b, jb, ib) 
<a name="l05023"></a>05023       <span class="keywordtype">integer</span> nrow, job
<a name="l05024"></a>05024       <span class="keywordtype">real(wp)</span> a(*), b(*), diag(nrow) 
<a name="l05025"></a>05025       <span class="keywordtype">integer</span> ja(*),jb(*), ia(nrow+1),ib(nrow+1)
<a name="l05026"></a>05026       
<a name="l05027"></a>05027 
<a name="l05028"></a>05028 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l05029"></a>05029 <span class="comment">! performs the matrix by matrix product B = A * Diag  (in place)        </span>
<a name="l05030"></a>05030 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l05031"></a>05031 <span class="comment">! on entry:                                                             </span>
<a name="l05032"></a>05032 <span class="comment">! ---------                                                             </span>
<a name="l05033"></a>05033 <span class="comment">! nrow        = integer. The row dimension of A                         </span>
<a name="l05034"></a>05034 <span class="comment">!                                                                       </span>
<a name="l05035"></a>05035 <span class="comment">! job   = integer. job indicator. Job=0 means get array b only          </span>
<a name="l05036"></a>05036 <span class="comment">!         job = 1 means get b, and the integer arrays ib, jb.           </span>
<a name="l05037"></a>05037 <span class="comment">!                                                                       </span>
<a name="l05038"></a>05038 <span class="comment">! a,                                                                    </span>
<a name="l05039"></a>05039 <span class="comment">! ja,                                                                   </span>
<a name="l05040"></a>05040 <span class="comment">! ia   = Matrix A in compressed sparse row format.                      </span>
<a name="l05041"></a>05041 <span class="comment">!                                                                       </span>
<a name="l05042"></a>05042 <span class="comment">! diag = diagonal matrix stored as a vector dig(1:n)                    </span>
<a name="l05043"></a>05043 <span class="comment">!                                                                       </span>
<a name="l05044"></a>05044 <span class="comment">! on return:                                                            </span>
<a name="l05045"></a>05045 <span class="comment">!----------                                                             </span>
<a name="l05046"></a>05046 <span class="comment">!                                                                       </span>
<a name="l05047"></a>05047 <span class="comment">! b,                                                                    </span>
<a name="l05048"></a>05048 <span class="comment">! jb,                                                                   </span>
<a name="l05049"></a>05049 <span class="comment">! ib        = resulting matrix B in compressed sparse row sparse format.</span>
<a name="l05050"></a>05050 <span class="comment">!                                                                       </span>
<a name="l05051"></a>05051 <span class="comment">! Notes:                                                                </span>
<a name="l05052"></a>05052 <span class="comment">!-------                                                                </span>
<a name="l05053"></a>05053 <span class="comment">! 1)        The column dimension of A is not needed.                    </span>
<a name="l05054"></a>05054 <span class="comment">! 2)        algorithm in place (B can take the place of A).             </span>
<a name="l05055"></a>05055 <span class="comment">!-----------------------------------------------------------------      </span>
<a name="l05056"></a>05056       <span class="keywordtype">integer</span> ii, k, k1, k2
<a name="l05057"></a>05057 
<a name="l05058"></a>05058       <span class="keyword">do</span> 1 ii=1,nrow 
<a name="l05059"></a>05059 <span class="comment">!                                                                       </span>
<a name="l05060"></a>05060 <span class="comment">!     scale each element                                                </span>
<a name="l05061"></a>05061 <span class="comment">!                                                                       </span>
<a name="l05062"></a>05062          k1 = ia(ii) 
<a name="l05063"></a>05063          k2 = ia(ii+1)-1 
<a name="l05064"></a>05064          <span class="keyword">do</span> 2 k=k1, k2 
<a name="l05065"></a>05065             b(k) = a(k)*diag(ja(k)) 
<a name="l05066"></a>05066     2    continue 
<a name="l05067"></a>05067     1 continue 
<a name="l05068"></a>05068 <span class="comment">!                                                                       </span>
<a name="l05069"></a>05069       <span class="keyword">if</span> (job  ==  0) return 
<a name="l05070"></a>05070 <span class="comment">!                                                                       </span>
<a name="l05071"></a>05071       <span class="keyword">do</span> 3 ii=1, nrow+1 
<a name="l05072"></a>05072          ib(ii) = ia(ii) 
<a name="l05073"></a>05073     3 continue 
<a name="l05074"></a>05074       <span class="keyword">do</span> 31 k=ia(1), ia(nrow+1) -1 
<a name="l05075"></a>05075          jb(k) = ja(k) 
<a name="l05076"></a>05076    31 continue 
<a name="l05077"></a>05077       return 
<a name="l05078"></a>05078 
<a name="l05079"></a>05079 <span class="keyword">      end subroutine amudia</span>
<a name="l05080"></a>05080 
<a name="l05081"></a>05081 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l05082"></a>05082 
<a name="l05083"></a><a class="code" href="namespaceunary__mod.html#a74f52765deb59280ca3f1b308a7a3bfb">05083</a>       <span class="keyword">subroutine </span><a class="code" href="namespaceunary__mod.html#a74f52765deb59280ca3f1b308a7a3bfb">aplsca</a> (nrow, a, ja, ia, scal,iw) 
<a name="l05084"></a>05084       <span class="keywordtype">integer</span> nrow
<a name="l05085"></a>05085       <span class="keywordtype">real(wp)</span> a(*), scal 
<a name="l05086"></a>05086       <span class="keywordtype">integer</span> ja(*), ia(nrow+1),iw(*) 
<a name="l05087"></a>05087 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l05088"></a>05088 <span class="comment">! Adds a scalar to the diagonal entries of a sparse matrix A :=A + s I  </span>
<a name="l05089"></a>05089 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l05090"></a>05090 <span class="comment">! on entry:                                                             </span>
<a name="l05091"></a>05091 <span class="comment">! ---------                                                             </span>
<a name="l05092"></a>05092 <span class="comment">! nrow        = integer. The row dimension of A                         </span>
<a name="l05093"></a>05093 <span class="comment">!                                                                       </span>
<a name="l05094"></a>05094 <span class="comment">! a,                                                                    </span>
<a name="l05095"></a>05095 <span class="comment">! ja,                                                                   </span>
<a name="l05096"></a>05096 <span class="comment">! ia    = Matrix A in compressed sparse row format.                     </span>
<a name="l05097"></a>05097 <span class="comment">!                                                                       </span>
<a name="l05098"></a>05098 <span class="comment">! scal  = real. scalar to add to the diagonal entries.                  </span>
<a name="l05099"></a>05099 <span class="comment">!                                                                       </span>
<a name="l05100"></a>05100 <span class="comment">! on return:                                                            </span>
<a name="l05101"></a>05101 <span class="comment">!----------                                                             </span>
<a name="l05102"></a>05102 <span class="comment">!                                                                       </span>
<a name="l05103"></a>05103 <span class="comment">! a,                                                                    </span>
<a name="l05104"></a>05104 <span class="comment">! ja,                                                                   </span>
<a name="l05105"></a>05105 <span class="comment">! ia        = matrix A with diagonal elements shifted (or created).     </span>
<a name="l05106"></a>05106 <span class="comment">!                                                                       </span>
<a name="l05107"></a>05107 <span class="comment">! iw    = integer work array of length n. On return iw will             </span>
<a name="l05108"></a>05108 <span class="comment">!         contain  the positions of the diagonal entries in the         </span>
<a name="l05109"></a>05109 <span class="comment">!         output matrix. (i.e., a(iw(k)), ja(iw(k)), k=1,...n,          </span>
<a name="l05110"></a>05110 <span class="comment">!         are the values/column indices of the diagonal elements        </span>
<a name="l05111"></a>05111 <span class="comment">!         of the output matrix. ).                                      </span>
<a name="l05112"></a>05112 <span class="comment">!                                                                       </span>
<a name="l05113"></a>05113 <span class="comment">! Notes:                                                                </span>
<a name="l05114"></a>05114 <span class="comment">!-------                                                                </span>
<a name="l05115"></a>05115 <span class="comment">!     The column dimension of A is not needed.                          </span>
<a name="l05116"></a>05116 <span class="comment">!     important: the matrix a may be expanded slightly to allow for     </span>
<a name="l05117"></a>05117 <span class="comment">!     additions of nonzero elements to previously nonexisting diagonals.</span>
<a name="l05118"></a>05118 <span class="comment">!     The is no checking as to whether there is enough space appended   </span>
<a name="l05119"></a>05119 <span class="comment">!     to the arrays a and ja. if not sure allow for n additional        </span>
<a name="l05120"></a>05120 <span class="comment">!     elemnts.                                                          </span>
<a name="l05121"></a>05121 <span class="comment">!     coded by Y. Saad. Latest version July, 19, 1990                   </span>
<a name="l05122"></a>05122 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l05123"></a>05123       <span class="keywordtype">logical</span> test
<a name="l05124"></a>05124       <span class="keywordtype">integer</span> icount, ii, j, k, k1, k2, ko
<a name="l05125"></a>05125 <span class="comment">!                                                                       </span>
<a name="l05126"></a>05126       call <a class="code" href="namespaceunary__mod.html#a26d9a8ea570451619e73d58120350141">diapos </a>(nrow,ja,ia,iw) 
<a name="l05127"></a>05127       icount = 0 
<a name="l05128"></a>05128       <span class="keyword">do</span> 1 j=1, nrow 
<a name="l05129"></a>05129          <span class="keyword">if</span> (iw(j)  ==  0) <span class="keyword">then</span> 
<a name="l05130"></a>05130             icount = icount+1 
<a name="l05131"></a>05131          <span class="keyword">else</span> 
<a name="l05132"></a>05132             a(iw(j)) = a(iw(j)) + scal 
<a name="l05133"></a>05133          <span class="keyword">endif</span> 
<a name="l05134"></a>05134     1 continue 
<a name="l05135"></a>05135 <span class="comment">!                                                                       </span>
<a name="l05136"></a>05136 <span class="comment">!     if no diagonal elements to insert in data structure return.       </span>
<a name="l05137"></a>05137 <span class="comment">!                                                                       </span>
<a name="l05138"></a>05138       <span class="keyword">if</span> (icount  ==  0) return 
<a name="l05139"></a>05139 <span class="comment">!                                                                       </span>
<a name="l05140"></a>05140 <span class="comment">! shift the nonzero elements if needed, to allow for created            </span>
<a name="l05141"></a>05141 <span class="comment">! diagonal elements.                                                    </span>
<a name="l05142"></a>05142 <span class="comment">!                                                                       </span>
<a name="l05143"></a>05143       ko = ia(nrow+1)+icount 
<a name="l05144"></a>05144 <span class="comment">!                                                                       </span>
<a name="l05145"></a>05145 <span class="comment">!     copy rows backward                                                </span>
<a name="l05146"></a>05146 <span class="comment">!                                                                       </span>
<a name="l05147"></a>05147       <span class="keyword">do</span> 5 ii=nrow, 1, -1 
<a name="l05148"></a>05148 <span class="comment">!                                                                       </span>
<a name="l05149"></a>05149 <span class="comment">!     go through  row ii                                                </span>
<a name="l05150"></a>05150 <span class="comment">!                                                                       </span>
<a name="l05151"></a>05151          k1 = ia(ii) 
<a name="l05152"></a>05152          k2 = ia(ii+1)-1 
<a name="l05153"></a>05153          ia(ii+1) = ko 
<a name="l05154"></a>05154          test = (iw(ii)  ==  0) 
<a name="l05155"></a>05155          <span class="keyword">do</span> 4 k = k2,k1,-1 
<a name="l05156"></a>05156             j = ja(k) 
<a name="l05157"></a>05157             <span class="keyword">if</span> (test .and. (j  &lt;  ii)) <span class="keyword">then</span> 
<a name="l05158"></a>05158                test = .false. 
<a name="l05159"></a>05159                ko = ko - 1 
<a name="l05160"></a>05160                a(ko) = scal 
<a name="l05161"></a>05161                ja(ko) = ii 
<a name="l05162"></a>05162                iw(ii) = ko 
<a name="l05163"></a>05163             <span class="keyword">endif</span> 
<a name="l05164"></a>05164             ko = ko-1 
<a name="l05165"></a>05165             a(ko) = a(k) 
<a name="l05166"></a>05166             ja(ko) = j 
<a name="l05167"></a>05167     4    continue 
<a name="l05168"></a>05168 <span class="comment">!     diagonal element has not been added yet.                          </span>
<a name="l05169"></a>05169          <span class="keyword">if</span> (test) <span class="keyword">then</span> 
<a name="l05170"></a>05170             ko = ko-1 
<a name="l05171"></a>05171             a(ko) = scal 
<a name="l05172"></a>05172             ja(ko) = ii 
<a name="l05173"></a>05173             iw(ii) = ko 
<a name="l05174"></a>05174          <span class="keyword">endif</span> 
<a name="l05175"></a>05175     5 continue 
<a name="l05176"></a>05176       ia(1) = ko 
<a name="l05177"></a>05177 
<a name="l05178"></a>05178       return 
<a name="l05179"></a>05179 <span class="keyword">      end subroutine aplsca</span>
<a name="l05180"></a>05180 
<a name="l05181"></a>05181 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l05182"></a>05182 
<a name="l05183"></a><a class="code" href="namespaceunary__mod.html#a9537a8dc0e600452caabc4812555c9fc">05183</a>       <span class="keyword">subroutine </span><a class="code" href="namespaceunary__mod.html#a9537a8dc0e600452caabc4812555c9fc">a_bl_pl_b_bl_scal</a>(nrow, nb, a, ja, ia, scal, iw) 
<a name="l05184"></a>05184 
<a name="l05185"></a>05185       <span class="keyword">implicit none</span>
<a name="l05186"></a>05186 
<a name="l05187"></a>05187       <span class="keywordtype">integer</span>,                         <span class="keywordtype">intent(in)</span>    :: nrow, nb
<a name="l05188"></a>05188       <span class="keywordtype">real(wp)</span>,                        <span class="keywordtype">intent(in)</span>    :: scal
<a name="l05189"></a>05189 
<a name="l05190"></a>05190       <span class="keywordtype">real(wp)</span>, <span class="keywordtype">dimension(nb,nb,*)</span>,    <span class="keywordtype">intent(inout)</span> ::  a
<a name="l05191"></a>05191 
<a name="l05192"></a>05192       <span class="keywordtype">integer</span>, <span class="keywordtype">dimension(nrow+1)</span>,      <span class="keywordtype">intent(inout)</span> :: ia
<a name="l05193"></a>05193       <span class="keywordtype">integer</span>, <span class="keywordtype">dimension(*)</span>,           <span class="keywordtype">intent(inout)</span> :: ja
<a name="l05194"></a>05194 
<a name="l05195"></a>05195       <span class="keywordtype">integer</span>, <span class="keywordtype">dimension(*)</span>,           <span class="keywordtype">intent(inout)</span> :: iw
<a name="l05196"></a>05196 
<a name="l05197"></a>05197       <span class="keywordtype">real(wp)</span>, <span class="keywordtype">dimension(nb,nb)                     </span>:: eye
<a name="l05198"></a>05198 
<a name="l05199"></a>05199       <span class="keywordtype">integer</span>          :: i,icount, ii,j,k,k1,k2,ko
<a name="l05200"></a>05200 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l05201"></a>05201 <span class="comment">! Adds a scalar to the diagonal entries of a sparse matrix A :=A + s I  </span>
<a name="l05202"></a>05202 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l05203"></a>05203 <span class="comment">! on entry:                                                             </span>
<a name="l05204"></a>05204 <span class="comment">! ---------                                                             </span>
<a name="l05205"></a>05205 <span class="comment">! nrow        = integer. The row dimension of A                         </span>
<a name="l05206"></a>05206 <span class="comment">!                                                                       </span>
<a name="l05207"></a>05207 <span class="comment">! a,                                                                    </span>
<a name="l05208"></a>05208 <span class="comment">! ja,                                                                   </span>
<a name="l05209"></a>05209 <span class="comment">! ia    = Matrix A in compressed sparse row format.                     </span>
<a name="l05210"></a>05210 <span class="comment">!                                                                       </span>
<a name="l05211"></a>05211 <span class="comment">! scal  = real. scalar to add to the diagonal entries.                  </span>
<a name="l05212"></a>05212 <span class="comment">!                                                                       </span>
<a name="l05213"></a>05213 <span class="comment">! on return:                                                            </span>
<a name="l05214"></a>05214 <span class="comment">!----------                                                             </span>
<a name="l05215"></a>05215 <span class="comment">!                                                                       </span>
<a name="l05216"></a>05216 <span class="comment">! a,                                                                    </span>
<a name="l05217"></a>05217 <span class="comment">! ja,                                                                   </span>
<a name="l05218"></a>05218 <span class="comment">! ia        = matrix A with diagonal elements shifted (or created).     </span>
<a name="l05219"></a>05219 <span class="comment">!                                                                       </span>
<a name="l05220"></a>05220 <span class="comment">! iw    = integer work array of length n. On return iw will             </span>
<a name="l05221"></a>05221 <span class="comment">!         contain  the positions of the diagonal entries in the         </span>
<a name="l05222"></a>05222 <span class="comment">!         output matrix. (i.e., a(iw(k)), ja(iw(k)), k=1,...n,          </span>
<a name="l05223"></a>05223 <span class="comment">!         are the values/column indices of the diagonal elements        </span>
<a name="l05224"></a>05224 <span class="comment">!         of the output matrix. ).                                      </span>
<a name="l05225"></a>05225 <span class="comment">!                                                                       </span>
<a name="l05226"></a>05226 <span class="comment">! Notes:                                                                </span>
<a name="l05227"></a>05227 <span class="comment">!-------                                                                </span>
<a name="l05228"></a>05228 <span class="comment">!     The column dimension of A is not needed.                          </span>
<a name="l05229"></a>05229 <span class="comment">!     important: the matrix a may be expanded slightly to allow for     </span>
<a name="l05230"></a>05230 <span class="comment">!     additions of nonzero elements to previously nonexisting diagonals.</span>
<a name="l05231"></a>05231 <span class="comment">!     The is no checking as to whether there is enough space appended   </span>
<a name="l05232"></a>05232 <span class="comment">!     to the arrays a and ja. if not sure allow for n additional        </span>
<a name="l05233"></a>05233 <span class="comment">!     elemnts.                                                          </span>
<a name="l05234"></a>05234 <span class="comment">!     coded by Y. Saad. Latest version July, 19, 1990                   </span>
<a name="l05235"></a>05235 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l05236"></a>05236       <span class="keywordtype">logical</span> test 
<a name="l05237"></a>05237 
<a name="l05238"></a>05238       eye = 0.0_wp
<a name="l05239"></a>05239       <span class="keyword">do</span> i = 1,nb
<a name="l05240"></a>05240         eye(i,i) = 1.0_wp
<a name="l05241"></a>05241       <span class="keyword">enddo</span>
<a name="l05242"></a>05242 <span class="comment">!                                                                 </span>
<a name="l05243"></a>05243       call <a class="code" href="namespaceunary__mod.html#a26d9a8ea570451619e73d58120350141">diapos </a>(nrow,ja,ia,iw) 
<a name="l05244"></a>05244       icount = 0 
<a name="l05245"></a>05245 
<a name="l05246"></a>05246       <span class="keyword">do</span> 1 j=1, nrow 
<a name="l05247"></a>05247          <span class="keyword">if</span> (iw(j)  ==  0) <span class="keyword">then</span> 
<a name="l05248"></a>05248             icount = icount+1 
<a name="l05249"></a>05249          <span class="keyword">else</span> 
<a name="l05250"></a>05250             a(:,:,iw(j)) = a(:,:,iw(j)) + scal * eye(:,:)
<a name="l05251"></a>05251          <span class="keyword">endif</span> 
<a name="l05252"></a>05252     1 continue 
<a name="l05253"></a>05253 <span class="comment">!                                                                       </span>
<a name="l05254"></a>05254 <span class="comment">!     if no diagonal elements to insert in data structure return.       </span>
<a name="l05255"></a>05255 <span class="comment">!                                                                       </span>
<a name="l05256"></a>05256       <span class="keyword">if</span> (icount  ==  0) return 
<a name="l05257"></a>05257 <span class="comment">!                                                                       </span>
<a name="l05258"></a>05258 <span class="comment">! shift the nonzero elements if needed, to allow for created            </span>
<a name="l05259"></a>05259 <span class="comment">! diagonal elements.                                                    </span>
<a name="l05260"></a>05260 <span class="comment">!                                                                       </span>
<a name="l05261"></a>05261       ko = ia(nrow+1)+icount 
<a name="l05262"></a>05262 <span class="comment">!                                                                       </span>
<a name="l05263"></a>05263 <span class="comment">!     copy rows backward                                                </span>
<a name="l05264"></a>05264 <span class="comment">!                                                                       </span>
<a name="l05265"></a>05265       <span class="keyword">do</span> 5 ii=nrow, 1, -1 
<a name="l05266"></a>05266 <span class="comment">!                                                                       </span>
<a name="l05267"></a>05267 <span class="comment">!     go through  row ii                                                </span>
<a name="l05268"></a>05268 <span class="comment">!                                                                       </span>
<a name="l05269"></a>05269          k1 = ia(ii) 
<a name="l05270"></a>05270          k2 = ia(ii+1)-1 
<a name="l05271"></a>05271          ia(ii+1) = ko 
<a name="l05272"></a>05272          test = (iw(ii)  ==  0) 
<a name="l05273"></a>05273          <span class="keyword">do</span> 4 k = k2,k1,-1 
<a name="l05274"></a>05274             j = ja(k) 
<a name="l05275"></a>05275             <span class="keyword">if</span> (test .and. (j  &lt;  ii)) <span class="keyword">then</span> 
<a name="l05276"></a>05276                test = .false. 
<a name="l05277"></a>05277                ko = ko - 1 
<a name="l05278"></a>05278                a(:,:,ko) = scal * eye(:,:)
<a name="l05279"></a>05279                ja(ko) = ii 
<a name="l05280"></a>05280                iw(ii) = ko 
<a name="l05281"></a>05281             <span class="keyword">endif</span> 
<a name="l05282"></a>05282             ko = ko-1 
<a name="l05283"></a>05283             a(:,:,ko) = a(:,:,k) 
<a name="l05284"></a>05284             ja(ko) = j 
<a name="l05285"></a>05285     4    continue 
<a name="l05286"></a>05286 <span class="comment">!     diagonal element has not been added yet.                          </span>
<a name="l05287"></a>05287          <span class="keyword">if</span> (test) <span class="keyword">then</span> 
<a name="l05288"></a>05288             ko = ko-1 
<a name="l05289"></a>05289             a(:,:,ko) = scal * eye(:,:)
<a name="l05290"></a>05290             ja(ko) = ii 
<a name="l05291"></a>05291             iw(ii) = ko 
<a name="l05292"></a>05292          <span class="keyword">endif</span> 
<a name="l05293"></a>05293     5 continue 
<a name="l05294"></a>05294       ia(1) = ko 
<a name="l05295"></a>05295 
<a name="l05296"></a>05296       return 
<a name="l05297"></a>05297 <span class="keyword">      end subroutine a_bl_pl_b_bl_scal</span>
<a name="l05298"></a>05298 
<a name="l05299"></a>05299 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l05300"></a>05300 
<a name="l05301"></a><a class="code" href="namespaceunary__mod.html#ad6619f9de5d3db24b25e89901c2adda7">05301</a>       <span class="keyword">subroutine </span><a class="code" href="namespaceunary__mod.html#ad6619f9de5d3db24b25e89901c2adda7">apldia</a> (nrow, job, a, ja, ia, diag, b, jb, ib, iw) 
<a name="l05302"></a>05302       <span class="keywordtype">integer</span> nrow
<a name="l05303"></a>05303       <span class="keywordtype">real(wp)</span> a(*), b(*), diag(nrow) 
<a name="l05304"></a>05304       <span class="keywordtype">integer</span> job,ja(*),jb(*), ia(nrow+1),ib(nrow+1), iw(*) 
<a name="l05305"></a>05305 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l05306"></a>05306 <span class="comment">! Adds a diagonal matrix to a general sparse matrix:  B = A + Diag      </span>
<a name="l05307"></a>05307 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l05308"></a>05308 <span class="comment">! on entry:                                                             </span>
<a name="l05309"></a>05309 <span class="comment">! ---------                                                             </span>
<a name="l05310"></a>05310 <span class="comment">! nrow  = integer. The row dimension of A                         </span>
<a name="l05311"></a>05311 <span class="comment">!                                                                       </span>
<a name="l05312"></a>05312 <span class="comment">! job   = integer. job indicator. Job=0 means get array b only          </span>
<a name="l05313"></a>05313 <span class="comment">!         (i.e. assume that a has already been copied into array b,     </span>
<a name="l05314"></a>05314 <span class="comment">!         or that algorithm is used in place. ) For all practical       </span>
<a name="l05315"></a>05315 <span class="comment">!         purposes enter job=0 for an in-place call and job=1 otherwise </span>
<a name="l05316"></a>05316 <span class="comment">!                                                                       </span>
<a name="l05317"></a>05317 <span class="comment">!         Note: in case there are missing diagonal elements in A,       </span>
<a name="l05318"></a>05318 <span class="comment">!         then the option job =0 will be ignored, since the algorithm   </span>
<a name="l05319"></a>05319 <span class="comment">!         must modify the data structure (i.e. jb, ib) in this          </span>
<a name="l05320"></a>05320 <span class="comment">!         situation.                                                    </span>
<a name="l05321"></a>05321 <span class="comment">!                                                                       </span>
<a name="l05322"></a>05322 <span class="comment">! a,                                                                    </span>
<a name="l05323"></a>05323 <span class="comment">! ja,                                                                   </span>
<a name="l05324"></a>05324 <span class="comment">! ia   = Matrix A in compressed sparse row format.                      </span>
<a name="l05325"></a>05325 <span class="comment">!                                                                       </span>
<a name="l05326"></a>05326 <span class="comment">! diag = diagonal matrix stored as a vector dig(1:n)                    </span>
<a name="l05327"></a>05327 <span class="comment">!                                                                       </span>
<a name="l05328"></a>05328 <span class="comment">! on return:                                                            </span>
<a name="l05329"></a>05329 <span class="comment">!----------                                                             </span>
<a name="l05330"></a>05330 <span class="comment">!                                                                       </span>
<a name="l05331"></a>05331 <span class="comment">! b,                                                                    </span>
<a name="l05332"></a>05332 <span class="comment">! jb,                                                                   </span>
<a name="l05333"></a>05333 <span class="comment">! ib        = resulting matrix B in compressed sparse row sparse format.</span>
<a name="l05334"></a>05334 <span class="comment">!                                                                       </span>
<a name="l05335"></a>05335 <span class="comment">!                                                                       </span>
<a name="l05336"></a>05336 <span class="comment">! iw    = integer work array of length n. On return iw will             </span>
<a name="l05337"></a>05337 <span class="comment">!         contain  the positions of the diagonal entries in the         </span>
<a name="l05338"></a>05338 <span class="comment">!         output matrix. (i.e., a(iw(k)), ja(iw(k)), k=1,...n,          </span>
<a name="l05339"></a>05339 <span class="comment">!         are the values/column indices of the diagonal elements        </span>
<a name="l05340"></a>05340 <span class="comment">!         of the output matrix. ).                                      </span>
<a name="l05341"></a>05341 <span class="comment">!                                                                       </span>
<a name="l05342"></a>05342 <span class="comment">! Notes:                                                                </span>
<a name="l05343"></a>05343 <span class="comment">!-------                                                                </span>
<a name="l05344"></a>05344 <span class="comment">! 1)        The column dimension of A is not needed.                    </span>
<a name="l05345"></a>05345 <span class="comment">! 2)        algorithm in place (b, jb, ib, can be the same as           </span>
<a name="l05346"></a>05346 <span class="comment">!           a, ja, ia, on entry). See comments for parameter job.       </span>
<a name="l05347"></a>05347 <span class="comment">!                                                                       </span>
<a name="l05348"></a>05348 <span class="comment">! coded by Y. Saad. Latest version July, 19, 1990                       </span>
<a name="l05349"></a>05349 <span class="comment">!-----------------------------------------------------------------      </span>
<a name="l05350"></a>05350       <span class="keywordtype">logical</span> test
<a name="l05351"></a>05351       <span class="keywordtype">integer</span> icount, ii, j, k, k1, k2, ko, nnz
<a name="l05352"></a>05352 <span class="comment">!                                                                       </span>
<a name="l05353"></a>05353 <span class="comment">!     copy integer arrays into b&apos;s data structure if required           </span>
<a name="l05354"></a>05354 <span class="comment">!                                                                       </span>
<a name="l05355"></a>05355       <span class="keyword">if</span> (job  /=  0) <span class="keyword">then</span> 
<a name="l05356"></a>05356          nnz = ia(nrow+1)-1 
<a name="l05357"></a>05357          <span class="keyword">do</span> 2  k=1, nnz 
<a name="l05358"></a>05358             jb(k) = ja(k) 
<a name="l05359"></a>05359             b(k)  = a(k) 
<a name="l05360"></a>05360     2    continue 
<a name="l05361"></a>05361          <span class="keyword">do</span> 3 k=1, nrow+1 
<a name="l05362"></a>05362             ib(k) = ia(k) 
<a name="l05363"></a>05363     3    continue 
<a name="l05364"></a>05364       <span class="keyword">endif</span> 
<a name="l05365"></a>05365                                                                         
<a name="l05366"></a>05366 <span class="comment">!     get positions of diagonal elements in data structure.             </span>
<a name="l05367"></a>05367                                                                         
<a name="l05368"></a>05368       call <a class="code" href="namespaceunary__mod.html#a26d9a8ea570451619e73d58120350141">diapos </a>(nrow,ja,ia,iw) 
<a name="l05369"></a>05369                                                                         
<a name="l05370"></a>05370 <span class="comment">!     count number of holes in diagonal and add diag(*) elements to     </span>
<a name="l05371"></a>05371 <span class="comment">!     valid diagonal entries.                                           </span>
<a name="l05372"></a>05372                                                                         
<a name="l05373"></a>05373       icount = 0 
<a name="l05374"></a>05374       <span class="keyword">do</span> 1 j=1, nrow 
<a name="l05375"></a>05375          <span class="keyword">if</span> (iw(j)  ==  0) <span class="keyword">then</span> 
<a name="l05376"></a>05376             icount = icount+1 
<a name="l05377"></a>05377          <span class="keyword">else</span> 
<a name="l05378"></a>05378             b(iw(j)) = a(iw(j)) + diag(j) 
<a name="l05379"></a>05379          <span class="keyword">endif</span> 
<a name="l05380"></a>05380     1 continue 
<a name="l05381"></a>05381                                                                        
<a name="l05382"></a>05382 <span class="comment">!     if no diagonal elements to insert return                          </span>
<a name="l05383"></a>05383                                                                         
<a name="l05384"></a>05384       <span class="keyword">if</span> (icount  ==  0) return 
<a name="l05385"></a>05385 <span class="comment">!                                                                       </span>
<a name="l05386"></a>05386 <span class="comment">!     shift the nonzero elements if needed, to allow for created        </span>
<a name="l05387"></a>05387 <span class="comment">!     diagonal elements.                                                </span>
<a name="l05388"></a>05388 <span class="comment">!                                                                       </span>
<a name="l05389"></a>05389       ko = ib(nrow+1)+icount 
<a name="l05390"></a>05390                                                                         
<a name="l05391"></a>05391 <span class="comment">!     copy rows backward                                                </span>
<a name="l05392"></a>05392       <span class="keyword">do</span> 5 ii=nrow, 1, -1 
<a name="l05393"></a>05393 <span class="comment">!        go through  row ii                                                </span>
<a name="l05394"></a>05394          k1 = ib(ii) 
<a name="l05395"></a>05395          k2 = ib(ii+1)-1 
<a name="l05396"></a>05396          ib(ii+1) = ko 
<a name="l05397"></a>05397          test = (iw(ii)  ==  0) 
<a name="l05398"></a>05398          <span class="keyword">do</span> 4 k = k2,k1,-1 
<a name="l05399"></a>05399             j = jb(k) 
<a name="l05400"></a>05400             <span class="keyword">if</span> (test .and. (j  &lt;  ii)) <span class="keyword">then</span> 
<a name="l05401"></a>05401                test = .false. 
<a name="l05402"></a>05402                ko = ko - 1 
<a name="l05403"></a>05403                b(ko) = diag(ii) 
<a name="l05404"></a>05404                jb(ko) = ii 
<a name="l05405"></a>05405                iw(ii) = ko 
<a name="l05406"></a>05406             <span class="keyword">endif</span> 
<a name="l05407"></a>05407             ko = ko-1 
<a name="l05408"></a>05408             b(ko) = a(k) 
<a name="l05409"></a>05409             jb(ko) = j 
<a name="l05410"></a>05410     4    continue 
<a name="l05411"></a>05411 <span class="comment">!     diagonal element has not been added yet.                          </span>
<a name="l05412"></a>05412          <span class="keyword">if</span> (test) <span class="keyword">then</span> 
<a name="l05413"></a>05413             ko = ko-1 
<a name="l05414"></a>05414             b(ko) =  diag(ii) 
<a name="l05415"></a>05415             jb(ko) = ii 
<a name="l05416"></a>05416             iw(ii) = ko 
<a name="l05417"></a>05417          <span class="keyword">endif</span> 
<a name="l05418"></a>05418     5 continue 
<a name="l05419"></a>05419       ib(1) = ko 
<a name="l05420"></a>05420 
<a name="l05421"></a>05421       return 
<a name="l05422"></a>05422 <span class="keyword">      end subroutine apldia</span>
<a name="l05423"></a>05423 
<a name="l05424"></a>05424 <span class="comment">!=============================================================================80</span>
<a name="l05425"></a>05425 
<a name="l05426"></a><a class="code" href="namespaceunary__mod.html#a8fb4d6fe6b909291d09e5633e46efba4">05426</a>       <span class="keyword">subroutine </span><a class="code" href="namespaceunary__mod.html#a8fb4d6fe6b909291d09e5633e46efba4">a_bl_pl_b_bl_diag</a>(nrow, nb, job, a, ja, ia, diag, b, jb, ib, iw) 
<a name="l05427"></a>05427 
<a name="l05428"></a>05428       <span class="keyword">implicit none</span>
<a name="l05429"></a>05429 
<a name="l05430"></a>05430       <span class="keywordtype">integer</span>,                         <span class="keywordtype">intent(in)</span>    :: nrow, nb, job
<a name="l05431"></a>05431       <span class="keywordtype">real(wp)</span>, <span class="keywordtype">dimension(nb,nb,*)</span>,    <span class="keywordtype">intent(in)</span>    ::  a
<a name="l05432"></a>05432       <span class="keywordtype">real(wp)</span>, <span class="keywordtype">dimension(nb,nb,nrow)</span>, <span class="keywordtype">intent(in)</span>    ::  diag
<a name="l05433"></a>05433 
<a name="l05434"></a>05434       <span class="keywordtype">real(wp)</span>, <span class="keywordtype">dimension(nb,nb,*)</span>,    <span class="keywordtype">intent(inout)</span> ::  b
<a name="l05435"></a>05435 
<a name="l05436"></a>05436       <span class="keywordtype">integer</span>, <span class="keywordtype">dimension(nrow+1)</span>,      <span class="keywordtype">intent(in)</span>    :: ia
<a name="l05437"></a>05437       <span class="keywordtype">integer</span>, <span class="keywordtype">dimension(*)</span>,           <span class="keywordtype">intent(in)</span>    :: ja
<a name="l05438"></a>05438 
<a name="l05439"></a>05439       <span class="keywordtype">integer</span>, <span class="keywordtype">dimension(nrow+1)</span>,      <span class="keywordtype">intent(inout)</span> :: ib
<a name="l05440"></a>05440       <span class="keywordtype">integer</span>, <span class="keywordtype">dimension(*)</span>,           <span class="keywordtype">intent(inout)</span> :: jb
<a name="l05441"></a>05441 
<a name="l05442"></a>05442       <span class="keywordtype">integer</span>, <span class="keywordtype">dimension(*)</span>,           <span class="keywordtype">intent(inout)</span> :: iw
<a name="l05443"></a>05443 
<a name="l05444"></a>05444       <span class="keywordtype">integer</span>              :: ii,j,k, icount, k1,k2,ko, nnz
<a name="l05445"></a>05445       <span class="keywordtype">logical</span> test 
<a name="l05446"></a>05446 
<a name="l05447"></a>05447 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l05448"></a>05448 <span class="comment">! Adds a diagonal matrix to a general sparse matrix:  B = A + Diag      </span>
<a name="l05449"></a>05449 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l05450"></a>05450 
<a name="l05451"></a>05451 <span class="comment">! on entry:                                                             </span>
<a name="l05452"></a>05452 <span class="comment">! ---------                                                             </span>
<a name="l05453"></a>05453 <span class="comment">! nrow  = integer. The row dimension of A                         </span>
<a name="l05454"></a>05454 <span class="comment">!                                                                       </span>
<a name="l05455"></a>05455 <span class="comment">! job   = integer. job indicator. Job=0 means get array b only          </span>
<a name="l05456"></a>05456 <span class="comment">!         (i.e. assume that a has already been copied into array b,     </span>
<a name="l05457"></a>05457 <span class="comment">!         or that algorithm is used in place. ) For all practical       </span>
<a name="l05458"></a>05458 <span class="comment">!         purposes enter job=0 for an in-place call and job=1 otherwise </span>
<a name="l05459"></a>05459 <span class="comment">!                                                                       </span>
<a name="l05460"></a>05460 <span class="comment">!         Note: in case there are missing diagonal elements in A,       </span>
<a name="l05461"></a>05461 <span class="comment">!         then the option job =0 will be ignored, since the algorithm   </span>
<a name="l05462"></a>05462 <span class="comment">!         must modify the data structure (i.e. jb, ib) in this          </span>
<a name="l05463"></a>05463 <span class="comment">!         situation.                                                    </span>
<a name="l05464"></a>05464 <span class="comment">!                                                                       </span>
<a name="l05465"></a>05465 <span class="comment">!  a,                                                                    </span>
<a name="l05466"></a>05466 <span class="comment">! ja,                                                                   </span>
<a name="l05467"></a>05467 <span class="comment">! ia   = Matrix A in compressed sparse row format.                      </span>
<a name="l05468"></a>05468 <span class="comment">!                                                                       </span>
<a name="l05469"></a>05469 <span class="comment">! diag = diagonal matrix stored as a vector dig(1:n)                    </span>
<a name="l05470"></a>05470 <span class="comment">!                                                                       </span>
<a name="l05471"></a>05471 <span class="comment">! on return:                                                            </span>
<a name="l05472"></a>05472 <span class="comment">!----------                                                             </span>
<a name="l05473"></a>05473 <span class="comment">!                                                                       </span>
<a name="l05474"></a>05474 <span class="comment">!  b,                                                                    </span>
<a name="l05475"></a>05475 <span class="comment">! jb,                                                                   </span>
<a name="l05476"></a>05476 <span class="comment">! ib        = resulting matrix B in compressed sparse row sparse format.</span>
<a name="l05477"></a>05477 <span class="comment">!                                                                       </span>
<a name="l05478"></a>05478 <span class="comment">!                                                                       </span>
<a name="l05479"></a>05479 <span class="comment">! iw    = integer work array of length n. On return iw will             </span>
<a name="l05480"></a>05480 <span class="comment">!         contain  the positions of the diagonal entries in the         </span>
<a name="l05481"></a>05481 <span class="comment">!         output matrix. (i.e., a(iw(k)), ja(iw(k)), k=1,...n,          </span>
<a name="l05482"></a>05482 <span class="comment">!         are the values/column indices of the diagonal elements        </span>
<a name="l05483"></a>05483 <span class="comment">!         of the output matrix. ).                                      </span>
<a name="l05484"></a>05484 <span class="comment">!                                                                       </span>
<a name="l05485"></a>05485 <span class="comment">! Notes:                                                                </span>
<a name="l05486"></a>05486 <span class="comment">!-------                                                                </span>
<a name="l05487"></a>05487 <span class="comment">! 1)        The column dimension of A is not needed.                    </span>
<a name="l05488"></a>05488 <span class="comment">! 2)        algorithm in place (b, jb, ib, can be the same as           </span>
<a name="l05489"></a>05489 <span class="comment">!           a, ja, ia, on entry). See comments for parameter job.       </span>
<a name="l05490"></a>05490 <span class="comment">!                                                                       </span>
<a name="l05491"></a>05491 <span class="comment">! coded by Y. Saad. Latest version July, 19, 1990                       </span>
<a name="l05492"></a>05492 <span class="comment">!-----------------------------------------------------------------      </span>
<a name="l05493"></a>05493 <span class="comment">!                                                                       </span>
<a name="l05494"></a>05494 <span class="comment">!     copy integer arrays into b&apos;s data structure if required           </span>
<a name="l05495"></a>05495 <span class="comment">!                                                                       </span>
<a name="l05496"></a>05496       <span class="keyword">if</span> (job  /=  0) <span class="keyword">then</span> 
<a name="l05497"></a>05497          nnz = ia(nrow+1)-1 
<a name="l05498"></a>05498          <span class="keyword">do</span> 2  k=1, nnz 
<a name="l05499"></a>05499             jb(k)      = ja(k) 
<a name="l05500"></a>05500              b(:,:,k)  = a(:,:,k) 
<a name="l05501"></a>05501     2    continue 
<a name="l05502"></a>05502          <span class="keyword">do</span> 3 k=1, nrow+1 
<a name="l05503"></a>05503             ib(k) = ia(k) 
<a name="l05504"></a>05504     3    continue 
<a name="l05505"></a>05505       <span class="keyword">endif</span> 
<a name="l05506"></a>05506                                                                         
<a name="l05507"></a>05507 <span class="comment">!     get positions of diagonal elements in data structure.             </span>
<a name="l05508"></a>05508                                                                         
<a name="l05509"></a>05509       call <a class="code" href="namespaceunary__mod.html#a26d9a8ea570451619e73d58120350141">diapos </a>(nrow,ja,ia,iw) 
<a name="l05510"></a>05510                                                                         
<a name="l05511"></a>05511 <span class="comment">!     count number of holes in diagonal and add diag(*) elements to     </span>
<a name="l05512"></a>05512 <span class="comment">!     valid diagonal entries.                                           </span>
<a name="l05513"></a>05513                                                                         
<a name="l05514"></a>05514       icount = 0 
<a name="l05515"></a>05515       <span class="keyword">do</span> 1 j=1, nrow 
<a name="l05516"></a>05516          <span class="keyword">if</span> (iw(j)  ==  0) <span class="keyword">then</span> 
<a name="l05517"></a>05517             icount = icount+1 
<a name="l05518"></a>05518          <span class="keyword">else</span> 
<a name="l05519"></a>05519             b(:,:,iw(j)) = a(:,:,iw(j)) + diag(:,:,j) 
<a name="l05520"></a>05520          <span class="keyword">endif</span> 
<a name="l05521"></a>05521     1 continue 
<a name="l05522"></a>05522                                                                        
<a name="l05523"></a>05523 <span class="comment">!     if no diagonal elements to insert return                          </span>
<a name="l05524"></a>05524                                                                         
<a name="l05525"></a>05525       <span class="keyword">if</span> (icount  ==  0) return 
<a name="l05526"></a>05526 <span class="comment">!                                                                       </span>
<a name="l05527"></a>05527 <span class="comment">!     shift the nonzero elements if needed, to allow for created        </span>
<a name="l05528"></a>05528 <span class="comment">!     diagonal elements.                                                </span>
<a name="l05529"></a>05529 <span class="comment">!                                                                       </span>
<a name="l05530"></a>05530       ko = ib(nrow+1)+icount 
<a name="l05531"></a>05531                                                                         
<a name="l05532"></a>05532 <span class="comment">!     copy rows backward                                                </span>
<a name="l05533"></a>05533       <span class="keyword">do</span> 5 ii=nrow, 1, -1 
<a name="l05534"></a>05534 <span class="comment">!        go through  row ii                                                </span>
<a name="l05535"></a>05535          k1 = ib(ii) 
<a name="l05536"></a>05536          k2 = ib(ii+1)-1 
<a name="l05537"></a>05537          ib(ii+1) = ko 
<a name="l05538"></a>05538          test = (iw(ii)  ==  0) 
<a name="l05539"></a>05539          <span class="keyword">do</span> 4 k = k2,k1,-1 
<a name="l05540"></a>05540             j = jb(k) 
<a name="l05541"></a>05541             <span class="keyword">if</span> (test .and. (j  &lt;  ii)) <span class="keyword">then</span> 
<a name="l05542"></a>05542                test = .false. 
<a name="l05543"></a>05543                ko = ko - 1 
<a name="l05544"></a>05544                b(:,:,ko) = diag(:,:,ii) 
<a name="l05545"></a>05545                jb(ko) = ii 
<a name="l05546"></a>05546                iw(ii) = ko 
<a name="l05547"></a>05547             <span class="keyword">endif</span> 
<a name="l05548"></a>05548             ko = ko-1 
<a name="l05549"></a>05549             b(:,:,ko) = a(:,:,k) 
<a name="l05550"></a>05550             jb(ko) = j 
<a name="l05551"></a>05551     4    continue 
<a name="l05552"></a>05552 <span class="comment">!     diagonal element has not been added yet.                          </span>
<a name="l05553"></a>05553          <span class="keyword">if</span> (test) <span class="keyword">then</span> 
<a name="l05554"></a>05554             ko = ko-1 
<a name="l05555"></a>05555             b(:,:,ko) =  diag(:,:,ii) 
<a name="l05556"></a>05556             jb(ko) = ii 
<a name="l05557"></a>05557             iw(ii) = ko 
<a name="l05558"></a>05558          <span class="keyword">endif</span> 
<a name="l05559"></a>05559     5 continue 
<a name="l05560"></a>05560       ib(1) = ko 
<a name="l05561"></a>05561 
<a name="l05562"></a>05562       return 
<a name="l05563"></a>05563 <span class="keyword">      end subroutine a_bl_pl_b_bl_diag</span>
<a name="l05564"></a>05564 
<a name="l05565"></a>05565 <span class="comment">!=============================================================================80</span>
<a name="l05566"></a>05566  
<a name="l05567"></a><a class="code" href="namespaceunary__mod.html#a5b877deded46fda45f8822143bea7d7b">05567</a>       <span class="keyword">subroutine </span><a class="code" href="namespaceunary__mod.html#a5b877deded46fda45f8822143bea7d7b">qsortd</a>(x,ind,n)
<a name="l05568"></a>05568 
<a name="l05569"></a>05569 <span class="comment">!       Code converted using TO_F90 by Alan Miller</span>
<a name="l05570"></a>05570 <span class="comment">!       Date: 2002-12-18  Time: 11:55:47</span>
<a name="l05571"></a>05571 
<a name="l05572"></a>05572       <span class="keywordtype">real(wp)</span>, <span class="keywordtype">INTENT(IN)</span>    :: x(:)
<a name="l05573"></a>05573       <span class="keywordtype">INTEGER</span>,  <span class="keywordtype">INTENT(OUT)</span>   :: ind(:)
<a name="l05574"></a>05574       <span class="keywordtype">INTEGER</span>,  <span class="keywordtype">INTENT(IN)</span>    :: n
<a name="l05575"></a>05575 
<a name="l05576"></a>05576 <span class="comment">!***************************************************************************</span>
<a name="l05577"></a>05577 
<a name="l05578"></a>05578 <span class="comment">!                                                         ROBERT RENKA</span>
<a name="l05579"></a>05579 <span class="comment">!                                                 OAK RIDGE NATL. LAB.</span>
<a name="l05580"></a>05580 
<a name="l05581"></a>05581 <span class="comment">!   THIS SUBROUTINE USES AN ORDER N*LOG(N) QUICK SORT TO SORT A REAL(wp)</span>
<a name="l05582"></a>05582 <span class="comment">! ARRAY X INTO INCREASING ORDER.  THE ALGORITHM IS AS FOLLOWS.  IND IS</span>
<a name="l05583"></a>05583 <span class="comment">! INITIALIZED TO THE ORDERED SEQUENCE OF INDICES 1,...,N, AND ALL INTERCHANGES</span>
<a name="l05584"></a>05584 <span class="comment">! ARE APPLIED TO IND.  X IS DIVIDED INTO TWO PORTIONS BY PICKING A CENTRAL</span>
<a name="l05585"></a>05585 <span class="comment">! ELEMENT T.  THE FIRST AND LAST ELEMENTS ARE COMPARED WITH T, AND</span>
<a name="l05586"></a>05586 <span class="comment">! INTERCHANGES ARE APPLIED AS NECESSARY SO THAT THE THREE VALUES ARE IN</span>
<a name="l05587"></a>05587 <span class="comment">! ASCENDING ORDER.  INTERCHANGES ARE THEN APPLIED SO THAT ALL ELEMENTS</span>
<a name="l05588"></a>05588 <span class="comment">! GREATER THAN T ARE IN THE UPPER PORTION OF THE ARRAY AND ALL ELEMENTS</span>
<a name="l05589"></a>05589 <span class="comment">! LESS THAN T ARE IN THE LOWER PORTION.  THE UPPER AND LOWER INDICES OF ONE</span>
<a name="l05590"></a>05590 <span class="comment">! OF THE PORTIONS ARE SAVED IN LOCAL ARRAYS, AND THE PROCESS IS REPEATED</span>
<a name="l05591"></a>05591 <span class="comment">! ITERATIVELY ON THE OTHER PORTION.  WHEN A PORTION IS COMPLETELY SORTED,</span>
<a name="l05592"></a>05592 <span class="comment">! THE PROCESS BEGINS AGAIN BY RETRIEVING THE INDICES BOUNDING ANOTHER</span>
<a name="l05593"></a>05593 <span class="comment">! UNSORTED PORTION.</span>
<a name="l05594"></a>05594 
<a name="l05595"></a>05595 <span class="comment">! INPUT PARAMETERS -   N - LENGTH OF THE ARRAY X.</span>
<a name="l05596"></a>05596 
<a name="l05597"></a>05597 <span class="comment">!                      X - VECTOR OF LENGTH N TO BE SORTED.</span>
<a name="l05598"></a>05598 
<a name="l05599"></a>05599 <span class="comment">!                    IND - VECTOR OF LENGTH &gt;= N.</span>
<a name="l05600"></a>05600 
<a name="l05601"></a>05601 <span class="comment">! N AND X ARE NOT ALTERED BY THIS ROUTINE.</span>
<a name="l05602"></a>05602 
<a name="l05603"></a>05603 <span class="comment">! OUTPUT PARAMETER - IND - SEQUENCE OF INDICES 1,...,N PERMUTED IN THE SAME</span>
<a name="l05604"></a>05604 <span class="comment">!                          FASHION AS X WOULD BE.  THUS, THE ORDERING ON</span>
<a name="l05605"></a>05605 <span class="comment">!                          X IS DEFINED BY Y(I) = X(IND(I)).</span>
<a name="l05606"></a>05606 
<a name="l05607"></a>05607 <span class="comment">!*********************************************************************</span>
<a name="l05608"></a>05608 
<a name="l05609"></a>05609 <span class="comment">! NOTE -- IU AND IL MUST BE DIMENSIONED &gt;= LOG(N) WHERE LOG HAS BASE 2.</span>
<a name="l05610"></a>05610 
<a name="l05611"></a>05611 <span class="comment">!*********************************************************************</span>
<a name="l05612"></a>05612 
<a name="l05613"></a>05613       <span class="keywordtype">INTEGER</span>     :: iu(21), il(21)
<a name="l05614"></a>05614       <span class="keywordtype">INTEGER</span>     :: m, i, j, k, l, ij, it, itt, indx
<a name="l05615"></a>05615       <span class="keywordtype">REAL</span>        :: r
<a name="l05616"></a>05616       <span class="keywordtype">REAL(wp)    </span>:: t
<a name="l05617"></a>05617 
<a name="l05618"></a>05618 <span class="comment">! LOCAL PARAMETERS -</span>
<a name="l05619"></a>05619 
<a name="l05620"></a>05620 <span class="comment">! IU,IL =  TEMPORARY STORAGE FOR THE UPPER AND LOWER</span>
<a name="l05621"></a>05621 <span class="comment">!            INDICES OF PORTIONS OF THE ARRAY X</span>
<a name="l05622"></a>05622 <span class="comment">! M =      INDEX FOR IU AND IL</span>
<a name="l05623"></a>05623 <span class="comment">! I,J =    LOWER AND UPPER INDICES OF A PORTION OF X</span>
<a name="l05624"></a>05624 <span class="comment">! K,L =    INDICES IN THE RANGE I,...,J</span>
<a name="l05625"></a>05625 <span class="comment">! IJ =     RANDOMLY CHOSEN INDEX BETWEEN I AND J</span>
<a name="l05626"></a>05626 <span class="comment">! IT,ITT = TEMPORARY STORAGE FOR INTERCHANGES IN IND</span>
<a name="l05627"></a>05627 <span class="comment">! INDX =   TEMPORARY INDEX FOR X</span>
<a name="l05628"></a>05628 <span class="comment">! R =      PSEUDO RANDOM NUMBER FOR GENERATING IJ</span>
<a name="l05629"></a>05629 <span class="comment">! T =      CENTRAL ELEMENT OF X</span>
<a name="l05630"></a>05630 
<a name="l05631"></a>05631       <span class="keyword">IF</span> (n &lt;= 0) RETURN
<a name="l05632"></a>05632 
<a name="l05633"></a>05633 <span class="comment">! INITIALIZE IND, M, I, J, AND R</span>
<a name="l05634"></a>05634 
<a name="l05635"></a>05635       <span class="keyword">DO</span>  i = 1, n
<a name="l05636"></a>05636         ind(i) = i
<a name="l05637"></a>05637       <span class="keyword">END DO</span>
<a name="l05638"></a>05638       m = 1
<a name="l05639"></a>05639       i = 1
<a name="l05640"></a>05640       j = n
<a name="l05641"></a>05641       r = .375
<a name="l05642"></a>05642 
<a name="l05643"></a>05643 <span class="comment">! TOP OF LOOP</span>
<a name="l05644"></a>05644 
<a name="l05645"></a>05645       20 <span class="keyword">IF</span> (i &gt;= j) GO TO 70
<a name="l05646"></a>05646       <span class="keyword">IF</span> (r &lt;= .5898437) <span class="keyword">THEN</span>
<a name="l05647"></a>05647         r = r + .0390625
<a name="l05648"></a>05648       <span class="keyword">ELSE</span>
<a name="l05649"></a>05649         r = r - .21875
<a name="l05650"></a>05650       <span class="keyword">END IF</span>
<a name="l05651"></a>05651 
<a name="l05652"></a>05652 <span class="comment">! INITIALIZE K</span>
<a name="l05653"></a>05653 
<a name="l05654"></a>05654       30 k = i
<a name="l05655"></a>05655 
<a name="l05656"></a>05656 <span class="comment">! SELECT A CENTRAL ELEMENT OF X AND SAVE IT IN T</span>
<a name="l05657"></a>05657 
<a name="l05658"></a>05658       ij = i + r*(j-i)
<a name="l05659"></a>05659       it = ind(ij)
<a name="l05660"></a>05660       t = x(it)
<a name="l05661"></a>05661 
<a name="l05662"></a>05662 <span class="comment">! IF THE FIRST ELEMENT OF THE ARRAY IS GREATER THAN T,</span>
<a name="l05663"></a>05663 <span class="comment">!   INTERCHANGE IT WITH T</span>
<a name="l05664"></a>05664 
<a name="l05665"></a>05665       indx = ind(i)
<a name="l05666"></a>05666       <span class="keyword">IF</span> (x(indx) &gt; t) <span class="keyword">THEN</span>
<a name="l05667"></a>05667         ind(ij) = indx
<a name="l05668"></a>05668         ind(i) = it
<a name="l05669"></a>05669         it = indx
<a name="l05670"></a>05670         t = x(it)
<a name="l05671"></a>05671       <span class="keyword">END IF</span>
<a name="l05672"></a>05672 
<a name="l05673"></a>05673 <span class="comment">! INITIALIZE L</span>
<a name="l05674"></a>05674 
<a name="l05675"></a>05675       l = j
<a name="l05676"></a>05676 
<a name="l05677"></a>05677 <span class="comment">! IF THE LAST ELEMENT OF THE ARRAY IS LESS THAN T,</span>
<a name="l05678"></a>05678 <span class="comment">!   INTERCHANGE IT WITH T</span>
<a name="l05679"></a>05679 
<a name="l05680"></a>05680       indx = ind(j)
<a name="l05681"></a>05681       <span class="keyword">IF</span> (x(indx) &gt;= t) GO TO 50
<a name="l05682"></a>05682       ind(ij) = indx
<a name="l05683"></a>05683       ind(j) = it
<a name="l05684"></a>05684       it = indx
<a name="l05685"></a>05685       t = x(it)
<a name="l05686"></a>05686 
<a name="l05687"></a>05687 <span class="comment">! IF THE FIRST ELEMENT OF THE ARRAY IS GREATER THAN T,</span>
<a name="l05688"></a>05688 <span class="comment">!   INTERCHANGE IT WITH T</span>
<a name="l05689"></a>05689 
<a name="l05690"></a>05690       indx = ind(i)
<a name="l05691"></a>05691       <span class="keyword">IF</span> (x(indx) &lt;= t) GO TO 50
<a name="l05692"></a>05692       ind(ij) = indx
<a name="l05693"></a>05693       ind(i) = it
<a name="l05694"></a>05694       it = indx
<a name="l05695"></a>05695       t = x(it)
<a name="l05696"></a>05696       GO TO 50
<a name="l05697"></a>05697 
<a name="l05698"></a>05698 <span class="comment">! INTERCHANGE ELEMENTS K AND L</span>
<a name="l05699"></a>05699 
<a name="l05700"></a>05700       40 itt = ind(l)
<a name="l05701"></a>05701       ind(l) = ind(k)
<a name="l05702"></a>05702       ind(k) = itt
<a name="l05703"></a>05703 
<a name="l05704"></a>05704 <span class="comment">! FIND AN ELEMENT IN THE UPPER PART OF THE ARRAY WHICH IS</span>
<a name="l05705"></a>05705 <span class="comment">!   NOT LARGER THAN T</span>
<a name="l05706"></a>05706 
<a name="l05707"></a>05707       50 l = l - 1
<a name="l05708"></a>05708       indx = ind(l)
<a name="l05709"></a>05709       <span class="keyword">IF</span> (x(indx) &gt; t) GO TO 50
<a name="l05710"></a>05710 
<a name="l05711"></a>05711 <span class="comment">! FIND AN ELEMENT IN THE LOWER PART OF THE ARRAY WHCIH IS NOT SMALLER THAN T</span>
<a name="l05712"></a>05712 
<a name="l05713"></a>05713       60 k = k + 1
<a name="l05714"></a>05714       indx = ind(k)
<a name="l05715"></a>05715       <span class="keyword">IF</span> (x(indx) &lt; t) GO TO 60
<a name="l05716"></a>05716 
<a name="l05717"></a>05717 <span class="comment">! IF K &lt;= L, INTERCHANGE ELEMENTS K AND L</span>
<a name="l05718"></a>05718 
<a name="l05719"></a>05719       <span class="keyword">IF</span> (k &lt;= l) GO TO 40
<a name="l05720"></a>05720 
<a name="l05721"></a>05721 <span class="comment">! SAVE THE UPPER AND LOWER SUBSCRIPTS OF THE PORTION OF THE</span>
<a name="l05722"></a>05722 <span class="comment">!   ARRAY YET TO BE SORTED</span>
<a name="l05723"></a>05723 
<a name="l05724"></a>05724       <span class="keyword">IF</span> (l-i &gt; j-k) <span class="keyword">THEN</span>
<a name="l05725"></a>05725         il(m) = i
<a name="l05726"></a>05726         iu(m) = l
<a name="l05727"></a>05727         i = k
<a name="l05728"></a>05728         m = m + 1
<a name="l05729"></a>05729         GO TO 80
<a name="l05730"></a>05730       <span class="keyword">END IF</span>
<a name="l05731"></a>05731 
<a name="l05732"></a>05732       il(m) = k
<a name="l05733"></a>05733       iu(m) = j
<a name="l05734"></a>05734       j = l
<a name="l05735"></a>05735       m = m + 1
<a name="l05736"></a>05736       GO TO 80
<a name="l05737"></a>05737 
<a name="l05738"></a>05738 <span class="comment">! BEGIN AGAIN ON ANOTHER UNSORTED PORTION OF THE ARRAY</span>
<a name="l05739"></a>05739 
<a name="l05740"></a>05740       70 m = m - 1
<a name="l05741"></a>05741       <span class="keyword">IF</span> (m == 0) RETURN
<a name="l05742"></a>05742       i = il(m)
<a name="l05743"></a>05743       j = iu(m)
<a name="l05744"></a>05744 
<a name="l05745"></a>05745       80 <span class="keyword">IF</span> (j-i &gt;= 11) GO TO 30
<a name="l05746"></a>05746       <span class="keyword">IF</span> (i == 1) GO TO 20
<a name="l05747"></a>05747       i = i - 1
<a name="l05748"></a>05748 
<a name="l05749"></a>05749 <span class="comment">! SORT ELEMENTS I+1,...,J.  NOTE THAT 1 &lt;= I &lt; J AND J-I &lt; 11.</span>
<a name="l05750"></a>05750 
<a name="l05751"></a>05751       90 i = i + 1
<a name="l05752"></a>05752       <span class="keyword">IF</span> (i == j) GO TO 70
<a name="l05753"></a>05753       indx = ind(i+1)
<a name="l05754"></a>05754       t = x(indx)
<a name="l05755"></a>05755       it = indx
<a name="l05756"></a>05756       indx = ind(i)
<a name="l05757"></a>05757       <span class="keyword">IF</span> (x(indx) &lt;= t) GO TO 90
<a name="l05758"></a>05758       k = i
<a name="l05759"></a>05759 
<a name="l05760"></a>05760       100 ind(k+1) = ind(k)
<a name="l05761"></a>05761       k = k - 1
<a name="l05762"></a>05762       indx = ind(k)
<a name="l05763"></a>05763       <span class="keyword">IF</span> (t &lt; x(indx)) GO TO 100
<a name="l05764"></a>05764 
<a name="l05765"></a>05765       ind(k+1) = it
<a name="l05766"></a>05766       GO TO 90
<a name="l05767"></a>05767 <span class="keyword">      end subroutine qsortd</span>
<a name="l05768"></a>05768 
<a name="l05769"></a>05769 <span class="comment">!=============================================================================80</span>
<a name="l05770"></a>05770  
<a name="l05771"></a><a class="code" href="namespaceunary__mod.html#ae02751d696fa87052f8e17891ef1f010">05771</a>       <span class="keyword">subroutine </span><a class="code" href="namespaceunary__mod.html#ae02751d696fa87052f8e17891ef1f010">qsorti</a>(IX,ind,n)
<a name="l05772"></a>05772 
<a name="l05773"></a>05773 <span class="comment">!       Code converted using TO_F90 by Alan Miller</span>
<a name="l05774"></a>05774 <span class="comment">!       Date: 2002-12-18  Time: 11:55:47</span>
<a name="l05775"></a>05775 
<a name="l05776"></a>05776       <span class="keywordtype">Integer</span>,  <span class="keywordtype">INTENT(IN)</span>    :: IX(:)
<a name="l05777"></a>05777       <span class="keywordtype">INTEGER</span>,  <span class="keywordtype">INTENT(OUT)</span>   :: ind(:)
<a name="l05778"></a>05778       <span class="keywordtype">INTEGER</span>,  <span class="keywordtype">INTENT(IN)</span>    :: n
<a name="l05779"></a>05779 
<a name="l05780"></a>05780 <span class="comment">!***************************************************************************</span>
<a name="l05781"></a>05781 
<a name="l05782"></a>05782 <span class="comment">!                                                         ROBERT RENKA</span>
<a name="l05783"></a>05783 <span class="comment">!                                                 OAK RIDGE NATL. LAB.</span>
<a name="l05784"></a>05784 
<a name="l05785"></a>05785 <span class="comment">!   THIS SUBROUTINE USES AN ORDER N*LOG(N) QUICK SORT TO SORT A REAL(wp)</span>
<a name="l05786"></a>05786 <span class="comment">! ARRAY X INTO INCREASING ORDER.  THE ALGORITHM IS AS FOLLOWS.  IND IS</span>
<a name="l05787"></a>05787 <span class="comment">! INITIALIZED TO THE ORDERED SEQUENCE OF INDICES 1,...,N, AND ALL INTERCHANGES</span>
<a name="l05788"></a>05788 <span class="comment">! ARE APPLIED TO IND.  X IS DIVIDED INTO TWO PORTIONS BY PICKING A CENTRAL</span>
<a name="l05789"></a>05789 <span class="comment">! ELEMENT T.  THE FIRST AND LAST ELEMENTS ARE COMPARED WITH T, AND</span>
<a name="l05790"></a>05790 <span class="comment">! INTERCHANGES ARE APPLIED AS NECESSARY SO THAT THE THREE VALUES ARE IN</span>
<a name="l05791"></a>05791 <span class="comment">! ASCENDING ORDER.  INTERCHANGES ARE THEN APPLIED SO THAT ALL ELEMENTS</span>
<a name="l05792"></a>05792 <span class="comment">! GREATER THAN T ARE IN THE UPPER PORTION OF THE ARRAY AND ALL ELEMENTS</span>
<a name="l05793"></a>05793 <span class="comment">! LESS THAN T ARE IN THE LOWER PORTION.  THE UPPER AND LOWER INDICES OF ONE</span>
<a name="l05794"></a>05794 <span class="comment">! OF THE PORTIONS ARE SAVED IN LOCAL ARRAYS, AND THE PROCESS IS REPEATED</span>
<a name="l05795"></a>05795 <span class="comment">! ITERATIVELY ON THE OTHER PORTION.  WHEN A PORTION IS COMPLETELY SORTED,</span>
<a name="l05796"></a>05796 <span class="comment">! THE PROCESS BEGINS AGAIN BY RETRIEVING THE INDICES BOUNDING ANOTHER</span>
<a name="l05797"></a>05797 <span class="comment">! UNSORTED PORTION.</span>
<a name="l05798"></a>05798 
<a name="l05799"></a>05799 <span class="comment">! INPUT PARAMETERS -   N - LENGTH OF THE ARRAY X.</span>
<a name="l05800"></a>05800 
<a name="l05801"></a>05801 <span class="comment">!                      X - VECTOR OF LENGTH N TO BE SORTED.</span>
<a name="l05802"></a>05802 
<a name="l05803"></a>05803 <span class="comment">!                    IND - VECTOR OF LENGTH &gt;= N.</span>
<a name="l05804"></a>05804 
<a name="l05805"></a>05805 <span class="comment">! N AND X ARE NOT ALTERED BY THIS ROUTINE.</span>
<a name="l05806"></a>05806 
<a name="l05807"></a>05807 <span class="comment">! OUTPUT PARAMETER - IND - SEQUENCE OF INDICES 1,...,N PERMUTED IN THE SAME</span>
<a name="l05808"></a>05808 <span class="comment">!                          FASHION AS X WOULD BE.  THUS, THE ORDERING ON</span>
<a name="l05809"></a>05809 <span class="comment">!                          X IS DEFINED BY Y(I) = X(IND(I)).</span>
<a name="l05810"></a>05810 
<a name="l05811"></a>05811 <span class="comment">!*********************************************************************</span>
<a name="l05812"></a>05812 
<a name="l05813"></a>05813 <span class="comment">! NOTE -- IU AND IL MUST BE DIMENSIONED &gt;= LOG(N) WHERE LOG HAS BASE 2.</span>
<a name="l05814"></a>05814 
<a name="l05815"></a>05815 <span class="comment">!*********************************************************************</span>
<a name="l05816"></a>05816 
<a name="l05817"></a>05817       <span class="keywordtype">INTEGER</span>     :: iu(21), il(21)
<a name="l05818"></a>05818       <span class="keywordtype">INTEGER</span>     :: m, i, j, k, l, ij, it, itt, indx
<a name="l05819"></a>05819       <span class="keywordtype">REAL</span>        :: r
<a name="l05820"></a>05820 
<a name="l05821"></a>05821       <span class="keywordtype">integer</span>     :: t
<a name="l05822"></a>05822 
<a name="l05823"></a>05823 <span class="comment">! LOCAL PARAMETERS -</span>
<a name="l05824"></a>05824 
<a name="l05825"></a>05825 <span class="comment">! IU,IL =  TEMPORARY STORAGE FOR THE UPPER AND LOWER</span>
<a name="l05826"></a>05826 <span class="comment">!            INDICES OF PORTIONS OF THE ARRAY X</span>
<a name="l05827"></a>05827 <span class="comment">! M =      INDEX FOR IU AND IL</span>
<a name="l05828"></a>05828 <span class="comment">! I,J =    LOWER AND UPPER INDICES OF A PORTION OF X</span>
<a name="l05829"></a>05829 <span class="comment">! K,L =    INDICES IN THE RANGE I,...,J</span>
<a name="l05830"></a>05830 <span class="comment">! IJ =     RANDOMLY CHOSEN INDEX BETWEEN I AND J</span>
<a name="l05831"></a>05831 <span class="comment">! IT,ITT = TEMPORARY STORAGE FOR INTERCHANGES IN IND</span>
<a name="l05832"></a>05832 <span class="comment">! INDX =   TEMPORARY INDEX FOR X</span>
<a name="l05833"></a>05833 <span class="comment">! R =      PSEUDO RANDOM NUMBER FOR GENERATING IJ</span>
<a name="l05834"></a>05834 <span class="comment">! T =      CENTRAL ELEMENT OF X</span>
<a name="l05835"></a>05835 
<a name="l05836"></a>05836       <span class="keyword">IF</span> (n &lt;= 0) RETURN
<a name="l05837"></a>05837 
<a name="l05838"></a>05838 <span class="comment">! INITIALIZE IND, M, I, J, AND R</span>
<a name="l05839"></a>05839 
<a name="l05840"></a>05840       <span class="keyword">DO</span>  i = 1, n
<a name="l05841"></a>05841         ind(i) = i
<a name="l05842"></a>05842       <span class="keyword">END DO</span>
<a name="l05843"></a>05843       m = 1
<a name="l05844"></a>05844       i = 1
<a name="l05845"></a>05845       j = n
<a name="l05846"></a>05846       r = .375
<a name="l05847"></a>05847 
<a name="l05848"></a>05848 <span class="comment">! TOP OF LOOP</span>
<a name="l05849"></a>05849 
<a name="l05850"></a>05850       20 <span class="keyword">IF</span> (i &gt;= j) GO TO 70
<a name="l05851"></a>05851       <span class="keyword">IF</span> (r &lt;= .5898437) <span class="keyword">THEN</span>
<a name="l05852"></a>05852         r = r + .0390625
<a name="l05853"></a>05853       <span class="keyword">ELSE</span>
<a name="l05854"></a>05854         r = r - .21875
<a name="l05855"></a>05855       <span class="keyword">END IF</span>
<a name="l05856"></a>05856 
<a name="l05857"></a>05857 <span class="comment">! INITIALIZE K</span>
<a name="l05858"></a>05858 
<a name="l05859"></a>05859       30 k = i
<a name="l05860"></a>05860 
<a name="l05861"></a>05861 <span class="comment">! SELECT A CENTRAL ELEMENT OF X AND SAVE IT IN T</span>
<a name="l05862"></a>05862 
<a name="l05863"></a>05863       ij = i + r*(j-i)
<a name="l05864"></a>05864       it = ind(ij)
<a name="l05865"></a>05865       t = IX(it)
<a name="l05866"></a>05866 
<a name="l05867"></a>05867 <span class="comment">! IF THE FIRST ELEMENT OF THE ARRAY IS GREATER THAN T,</span>
<a name="l05868"></a>05868 <span class="comment">!   INTERCHANGE IT WITH T</span>
<a name="l05869"></a>05869 
<a name="l05870"></a>05870       indx = ind(i)
<a name="l05871"></a>05871       <span class="keyword">IF</span> (IX(indx) &gt; t) <span class="keyword">THEN</span>
<a name="l05872"></a>05872         ind(ij) = indx
<a name="l05873"></a>05873         ind(i) = it
<a name="l05874"></a>05874         it = indx
<a name="l05875"></a>05875         t = IX(it)
<a name="l05876"></a>05876       <span class="keyword">END IF</span>
<a name="l05877"></a>05877 
<a name="l05878"></a>05878 <span class="comment">! INITIALIZE L</span>
<a name="l05879"></a>05879 
<a name="l05880"></a>05880       l = j
<a name="l05881"></a>05881 
<a name="l05882"></a>05882 <span class="comment">! IF THE LAST ELEMENT OF THE ARRAY IS LESS THAN T,</span>
<a name="l05883"></a>05883 <span class="comment">!   INTERCHANGE IT WITH T</span>
<a name="l05884"></a>05884 
<a name="l05885"></a>05885       indx = ind(j)
<a name="l05886"></a>05886       <span class="keyword">IF</span> (IX(indx) &gt;= t) GO TO 50
<a name="l05887"></a>05887       ind(ij) = indx
<a name="l05888"></a>05888       ind(j) = it
<a name="l05889"></a>05889       it = indx
<a name="l05890"></a>05890       t = IX(it)
<a name="l05891"></a>05891 
<a name="l05892"></a>05892 <span class="comment">! IF THE FIRST ELEMENT OF THE ARRAY IS GREATER THAN T,</span>
<a name="l05893"></a>05893 <span class="comment">!   INTERCHANGE IT WITH T</span>
<a name="l05894"></a>05894 
<a name="l05895"></a>05895       indx = ind(i)
<a name="l05896"></a>05896       <span class="keyword">IF</span> (IX(indx) &lt;= t) GO TO 50
<a name="l05897"></a>05897       ind(ij) = indx
<a name="l05898"></a>05898       ind(i) = it
<a name="l05899"></a>05899       it = indx
<a name="l05900"></a>05900       t = IX(it)
<a name="l05901"></a>05901       GO TO 50
<a name="l05902"></a>05902 
<a name="l05903"></a>05903 <span class="comment">! INTERCHANGE ELEMENTS K AND L</span>
<a name="l05904"></a>05904 
<a name="l05905"></a>05905       40 itt = ind(l)
<a name="l05906"></a>05906       ind(l) = ind(k)
<a name="l05907"></a>05907       ind(k) = itt
<a name="l05908"></a>05908 
<a name="l05909"></a>05909 <span class="comment">! FIND AN ELEMENT IN THE UPPER PART OF THE ARRAY WHICH IS</span>
<a name="l05910"></a>05910 <span class="comment">!   NOT LARGER THAN T</span>
<a name="l05911"></a>05911 
<a name="l05912"></a>05912       50 l = l - 1
<a name="l05913"></a>05913       indx = ind(l)
<a name="l05914"></a>05914       <span class="keyword">IF</span> (IX(indx) &gt; t) GO TO 50
<a name="l05915"></a>05915 
<a name="l05916"></a>05916 <span class="comment">! FIND AN ELEMENT IN THE LOWER PART OF THE ARRAY WHCIH IS NOT SMALLER THAN T</span>
<a name="l05917"></a>05917 
<a name="l05918"></a>05918       60 k = k + 1
<a name="l05919"></a>05919       indx = ind(k)
<a name="l05920"></a>05920       <span class="keyword">IF</span> (IX(indx) &lt; t) GO TO 60
<a name="l05921"></a>05921 
<a name="l05922"></a>05922 <span class="comment">! IF K &lt;= L, INTERCHANGE ELEMENTS K AND L</span>
<a name="l05923"></a>05923 
<a name="l05924"></a>05924       <span class="keyword">IF</span> (k &lt;= l) GO TO 40
<a name="l05925"></a>05925 
<a name="l05926"></a>05926 <span class="comment">! SAVE THE UPPER AND LOWER SUBSCRIPTS OF THE PORTION OF THE</span>
<a name="l05927"></a>05927 <span class="comment">!   ARRAY YET TO BE SORTED</span>
<a name="l05928"></a>05928 
<a name="l05929"></a>05929       <span class="keyword">IF</span> (l-i &gt; j-k) <span class="keyword">THEN</span>
<a name="l05930"></a>05930         il(m) = i
<a name="l05931"></a>05931         iu(m) = l
<a name="l05932"></a>05932         i = k
<a name="l05933"></a>05933         m = m + 1
<a name="l05934"></a>05934         GO TO 80
<a name="l05935"></a>05935       <span class="keyword">END IF</span>
<a name="l05936"></a>05936 
<a name="l05937"></a>05937       il(m) = k
<a name="l05938"></a>05938       iu(m) = j
<a name="l05939"></a>05939       j = l
<a name="l05940"></a>05940       m = m + 1
<a name="l05941"></a>05941       GO TO 80
<a name="l05942"></a>05942 
<a name="l05943"></a>05943 <span class="comment">! BEGIN AGAIN ON ANOTHER UNSORTED PORTION OF THE ARRAY</span>
<a name="l05944"></a>05944 
<a name="l05945"></a>05945       70 m = m - 1
<a name="l05946"></a>05946       <span class="keyword">IF</span> (m == 0) RETURN
<a name="l05947"></a>05947       i = il(m)
<a name="l05948"></a>05948       j = iu(m)
<a name="l05949"></a>05949 
<a name="l05950"></a>05950       80 <span class="keyword">IF</span> (j-i &gt;= 11) GO TO 30
<a name="l05951"></a>05951       <span class="keyword">IF</span> (i == 1) GO TO 20
<a name="l05952"></a>05952       i = i - 1
<a name="l05953"></a>05953 
<a name="l05954"></a>05954 <span class="comment">! SORT ELEMENTS I+1,...,J.  NOTE THAT 1 &lt;= I &lt; J AND J-I &lt; 11.</span>
<a name="l05955"></a>05955 
<a name="l05956"></a>05956       90 i = i + 1
<a name="l05957"></a>05957       <span class="keyword">IF</span> (i == j) GO TO 70
<a name="l05958"></a>05958       indx = ind(i+1)
<a name="l05959"></a>05959       t = IX(indx)
<a name="l05960"></a>05960       it = indx
<a name="l05961"></a>05961       indx = ind(i)
<a name="l05962"></a>05962       <span class="keyword">IF</span> (IX(indx) &lt;= t) GO TO 90
<a name="l05963"></a>05963       k = i
<a name="l05964"></a>05964 
<a name="l05965"></a>05965       100 ind(k+1) = ind(k)
<a name="l05966"></a>05966       k = k - 1
<a name="l05967"></a>05967       indx = ind(k)
<a name="l05968"></a>05968       <span class="keyword">IF</span> (t &lt; IX(indx)) GO TO 100
<a name="l05969"></a>05969 
<a name="l05970"></a>05970       ind(k+1) = it
<a name="l05971"></a>05971       GO TO 90
<a name="l05972"></a>05972 <span class="keyword">      end subroutine qsorti</span>
<a name="l05973"></a>05973 
<a name="l05974"></a>05974 <span class="comment">!=============================================================================80</span>
<a name="l05975"></a>05975 
<a name="l05976"></a><a class="code" href="namespaceunary__mod.html#aed31e503e8bd81c771b97208a362d988">05976</a>   <span class="keyword">subroutine </span><a class="code" href="namespaceunary__mod.html#aed31e503e8bd81c771b97208a362d988">csrcsc</a> ( n, job, ipos, a, ja, ia, ao, jao, iao )
<a name="l05977"></a>05977    
<a name="l05978"></a>05978   <span class="comment">!*****************************************************************************80</span>
<a name="l05979"></a>05979   <span class="comment">!</span>
<a name="l05980"></a>05980   <span class="comment">!! CSRCSC converts Compressed Sparse Row to Compressed Sparse Column.</span>
<a name="l05981"></a>05981   <span class="comment">!</span>
<a name="l05982"></a>05982   <span class="comment">!  Discussion:</span>
<a name="l05983"></a>05983   <span class="comment">!</span>
<a name="l05984"></a>05984   <span class="comment">!    This is essentially a transposition operation.  </span>
<a name="l05985"></a>05985   <span class="comment">!</span>
<a name="l05986"></a>05986   <span class="comment">!    It is NOT an in-place algorithm.</span>
<a name="l05987"></a>05987   <span class="comment">!</span>
<a name="l05988"></a>05988   <span class="comment">!    This routine transposes a matrix stored in a, ja, ia format.</span>
<a name="l05989"></a>05989   <span class="comment">!</span>
<a name="l05990"></a>05990   <span class="comment">!  Modified:</span>
<a name="l05991"></a>05991   <span class="comment">!</span>
<a name="l05992"></a>05992   <span class="comment">!    07 January 2004</span>
<a name="l05993"></a>05993   <span class="comment">!</span>
<a name="l05994"></a>05994   <span class="comment">!  Author:</span>
<a name="l05995"></a>05995   <span class="comment">!</span>
<a name="l05996"></a>05996   <span class="comment">!    Youcef Saad</span>
<a name="l05997"></a>05997   <span class="comment">!</span>
<a name="l05998"></a>05998   <span class="comment">!  Parameters:</span>
<a name="l05999"></a>05999   <span class="comment">!</span>
<a name="l06000"></a>06000   <span class="comment">!    Input, integer ( kind = 4 ) N, the order of the matrix.</span>
<a name="l06001"></a>06001   <span class="comment">!</span>
<a name="l06002"></a>06002   <span class="comment">!    Input, integer ( kind = 4 ) JOB, indicates whether or not to fill the values of the</span>
<a name="l06003"></a>06003   <span class="comment">!    matrix AO or only the pattern (IA, and JA).  Enter 1 for yes.</span>
<a name="l06004"></a>06004   <span class="comment">!</span>
<a name="l06005"></a>06005   <span class="comment">! ipos  = starting position in ao, jao of the transposed matrix.</span>
<a name="l06006"></a>06006   <span class="comment">!         the iao array takes this into account (thus iao(1) is set to ipos.)</span>
<a name="l06007"></a>06007   <span class="comment">!         Note: this may be useful if one needs to append the data structure</span>
<a name="l06008"></a>06008   <span class="comment">!         of the transpose to that of A. In this case use</span>
<a name="l06009"></a>06009   <span class="comment">!                call csrcsc (n,1,n+2,a,ja,ia,a,ja,ia(n+2))</span>
<a name="l06010"></a>06010   <span class="comment">!        for any other normal usage, enter ipos=1.</span>
<a name="l06011"></a>06011   <span class="comment">!</span>
<a name="l06012"></a>06012   <span class="comment">!    Input, real A(*), integer ( kind = 4 ) JA(*), IA(N+1), the matrix in CSR</span>
<a name="l06013"></a>06013   <span class="comment">!    Compressed Sparse Row format.</span>
<a name="l06014"></a>06014   <span class="comment">!</span>
<a name="l06015"></a>06015   <span class="comment">!    Output, real AO(*), JAO(*), IAO(N+1), the matrix in CSC</span>
<a name="l06016"></a>06016   <span class="comment">!    Compressed Sparse Column format.</span>
<a name="l06017"></a>06017   <span class="comment">!</span>
<a name="l06018"></a>06018     <span class="keyword">implicit none</span>
<a name="l06019"></a>06019 
<a name="l06020"></a>06020     <span class="keywordtype">integer</span> :: n
<a name="l06021"></a>06021 
<a name="l06022"></a>06022     <span class="keywordtype">real (wp)</span> a(*)
<a name="l06023"></a>06023     <span class="keywordtype">real (wp)</span> ao(*)
<a name="l06024"></a>06024     <span class="keywordtype">integer</span> :: i
<a name="l06025"></a>06025     <span class="keywordtype">integer</span> :: ia(n+1)
<a name="l06026"></a>06026     <span class="keywordtype">integer</span> :: iao(n+1)
<a name="l06027"></a>06027     <span class="keywordtype">integer</span> :: ipos
<a name="l06028"></a>06028     <span class="keywordtype">integer</span> :: j
<a name="l06029"></a>06029     <span class="keywordtype">integer</span> :: ja(*)
<a name="l06030"></a>06030     <span class="keywordtype">integer</span> :: jao(*)
<a name="l06031"></a>06031     <span class="keywordtype">integer</span> :: job
<a name="l06032"></a>06032     <span class="keywordtype">integer</span> :: k
<a name="l06033"></a>06033     <span class="keywordtype">integer</span> :: next
<a name="l06034"></a>06034   <span class="comment">!</span>
<a name="l06035"></a>06035   <span class="comment">!  Compute lengths of rows of A&apos;.</span>
<a name="l06036"></a>06036   <span class="comment">!</span>
<a name="l06037"></a>06037     iao(1:n+1) = 0
<a name="l06038"></a>06038 
<a name="l06039"></a>06039     <span class="keyword">do</span> i = 1, n
<a name="l06040"></a>06040       <span class="keyword">do</span> k = ia(i), ia(i+1)-1
<a name="l06041"></a>06041         j = ja(k) + 1
<a name="l06042"></a>06042         iao(j) = iao(j) + 1
<a name="l06043"></a>06043       <span class="keyword">end do</span>
<a name="l06044"></a>06044     <span class="keyword">end do</span>
<a name="l06045"></a>06045   <span class="comment">!</span>
<a name="l06046"></a>06046   <span class="comment">!  Compute pointers from lengths.</span>
<a name="l06047"></a>06047   <span class="comment">!</span>
<a name="l06048"></a>06048     iao(1) = ipos
<a name="l06049"></a>06049     <span class="keyword">do</span> i = 1, n
<a name="l06050"></a>06050       iao(i+1) = iao(i) + iao(i+1)
<a name="l06051"></a>06051     <span class="keyword">end do</span>
<a name="l06052"></a>06052   <span class="comment">!</span>
<a name="l06053"></a>06053   <span class="comment">!  Do the actual copying.</span>
<a name="l06054"></a>06054   <span class="comment">!</span>
<a name="l06055"></a>06055     <span class="keyword">do</span> i = 1, n
<a name="l06056"></a>06056       <span class="keyword">do</span> k = ia(i), ia(i+1)-1
<a name="l06057"></a>06057         j = ja(k)
<a name="l06058"></a>06058         next = iao(j)
<a name="l06059"></a>06059         <span class="keyword">if</span> ( job == 1 ) <span class="keyword">then</span>
<a name="l06060"></a>06060           ao(next) = a(k)
<a name="l06061"></a>06061         <span class="keyword">end if</span>
<a name="l06062"></a>06062         jao(next) = i
<a name="l06063"></a>06063         iao(j) = next + 1
<a name="l06064"></a>06064       <span class="keyword">end do</span>
<a name="l06065"></a>06065     <span class="keyword">end do</span>
<a name="l06066"></a>06066   <span class="comment">!</span>
<a name="l06067"></a>06067   <span class="comment">!  Reshift IAO and leave.</span>
<a name="l06068"></a>06068   <span class="comment">!</span>
<a name="l06069"></a>06069     <span class="keyword">do</span> i = n, 1, -1
<a name="l06070"></a>06070       iao(i+1) = iao(i)
<a name="l06071"></a>06071     <span class="keyword">end do</span>
<a name="l06072"></a>06072     iao(1) = ipos
<a name="l06073"></a>06073 
<a name="l06074"></a>06074     return
<a name="l06075"></a>06075 <span class="keyword">  end subroutine csrcsc</span>
<a name="l06076"></a>06076 
<a name="l06077"></a>06077   <span class="comment">!============================================================================</span>
<a name="l06078"></a>06078 
<a name="l06079"></a>06079   <span class="comment">!============================================================================</span>
<a name="l06080"></a>06080   
<a name="l06081"></a><a class="code" href="namespaceunary__mod.html#a6cc85f63470c7997e46581e91f0a21df">06081</a>   <span class="keyword">subroutine </span><a class="code" href="namespaceunary__mod.html#a6cc85f63470c7997e46581e91f0a21df">csort_block</a> ( block_size, n, a, ja, ia, iwork, values )
<a name="l06082"></a>06082 
<a name="l06083"></a>06083   <span class="comment">!*****************************************************************************80</span>
<a name="l06084"></a>06084   <span class="comment">!</span>
<a name="l06085"></a>06085   <span class="comment">!! CSORT_BLOCK sorts the elements of a CSR matrix.</span>
<a name="l06086"></a>06086   <span class="comment">!</span>
<a name="l06087"></a>06087   <span class="comment">!  Discussion:</span>
<a name="l06088"></a>06088   <span class="comment">!</span>
<a name="l06089"></a>06089   <span class="comment">!    This routine sorts the elements of a CSR matrix (stored in Compressed</span>
<a name="l06090"></a>06090   <span class="comment">!    Sparse Row Format) in increasing order of their column indices within</span>
<a name="l06091"></a>06091   <span class="comment">!    each row. It uses a form of bucket sort with a cost of O(nnz) where</span>
<a name="l06092"></a>06092   <span class="comment">!    nnz = number of nonzero elements.</span>
<a name="l06093"></a>06093   <span class="comment">!</span>
<a name="l06094"></a>06094   <span class="comment">!    Requires an integer ( kind = 4 ) work array of size length 2*nnz.</span>
<a name="l06095"></a>06095   <span class="comment">!</span>
<a name="l06096"></a>06096   <span class="comment">!  Modified:</span>
<a name="l06097"></a>06097   <span class="comment">!</span>
<a name="l06098"></a>06098   <span class="comment">!    07 January 2004</span>
<a name="l06099"></a>06099   <span class="comment">!</span>
<a name="l06100"></a>06100   <span class="comment">!  Author:</span>
<a name="l06101"></a>06101   <span class="comment">!</span>
<a name="l06102"></a>06102   <span class="comment">!    Youcef Saad</span>
<a name="l06103"></a>06103   <span class="comment">!</span>
<a name="l06104"></a>06104   <span class="comment">!  Parameters:</span>
<a name="l06105"></a>06105   <span class="comment">!</span>
<a name="l06106"></a>06106   <span class="comment">!    Input, integer ( kind = 4 ) N, the row dimension of the matrix.</span>
<a name="l06107"></a>06107   <span class="comment">!</span>
<a name="l06108"></a>06108   <span class="comment">!    Input, real A(*), integer ( kind = 4 ) JA(*), IA(N+1), the matrix in CSR</span>
<a name="l06109"></a>06109   <span class="comment">!    Compressed Sparse Row format.</span>
<a name="l06110"></a>06110   <span class="comment">!</span>
<a name="l06111"></a>06111   <span class="comment">! iwork = integer ( kind = 4 ) work array of length max ( n+1, 2*nnz )</span>
<a name="l06112"></a>06112   <span class="comment">!         where nnz = 2* (ia(n+1)-ia(1))  ) .</span>
<a name="l06113"></a>06113   <span class="comment">!</span>
<a name="l06114"></a>06114   <span class="comment">! values= logical indicating whether or not the real values a(*) must</span>
<a name="l06115"></a>06115   <span class="comment">!         also be permuted. if (.not. values) then the array a is not</span>
<a name="l06116"></a>06116   <span class="comment">!         touched by csort and can be a dummy array.</span>
<a name="l06117"></a>06117   <span class="comment">!</span>
<a name="l06118"></a>06118   <span class="comment">! on return:</span>
<a name="l06119"></a>06119   <span class="comment">!</span>
<a name="l06120"></a>06120   <span class="comment">! the matrix stored in the structure a, ja, ia is permuted in such a</span>
<a name="l06121"></a>06121   <span class="comment">! way that the column indices are in increasing order within each row.</span>
<a name="l06122"></a>06122   <span class="comment">! iwork(1:nnz) contains the permutation used  to rearrange the elements.</span>
<a name="l06123"></a>06123   <span class="comment">!</span>
<a name="l06124"></a>06124     <span class="keyword">implicit none</span>
<a name="l06125"></a>06125 
<a name="l06126"></a>06126     <span class="keywordtype">integer</span> ::  n
<a name="l06127"></a>06127 
<a name="l06128"></a>06128     <span class="keywordtype">integer</span> :: block_size
<a name="l06129"></a>06129     <span class="keywordtype">real(wp) </span>:: a(block_size,block_size,*)
<a name="l06130"></a>06130     <span class="keywordtype">integer</span> :: i
<a name="l06131"></a>06131     <span class="keywordtype">integer</span> :: ia(n+1)
<a name="l06132"></a>06132     <span class="keywordtype">integer</span> :: ifirst
<a name="l06133"></a>06133     <span class="keywordtype">integer</span> :: irow
<a name="l06134"></a>06134     <span class="keywordtype">integer</span> :: iwork(*)
<a name="l06135"></a>06135     <span class="keywordtype">integer</span> :: j
<a name="l06136"></a>06136     <span class="keywordtype">integer</span> :: ja(*)
<a name="l06137"></a>06137     <span class="keywordtype">integer</span> :: k
<a name="l06138"></a>06138     <span class="keywordtype">integer</span> :: ko
<a name="l06139"></a>06139     <span class="keywordtype">integer</span> :: next
<a name="l06140"></a>06140     <span class="keywordtype">integer</span> :: nnz
<a name="l06141"></a>06141     <span class="keywordtype">logical</span> :: values
<a name="l06142"></a>06142   <span class="comment">!</span>
<a name="l06143"></a>06143   <span class="comment">!  Count the number of elements in each column.</span>
<a name="l06144"></a>06144   <span class="comment">!</span>
<a name="l06145"></a>06145     iwork(1:n+1) = 0
<a name="l06146"></a>06146 
<a name="l06147"></a>06147     <span class="keyword">do</span> i = 1, n
<a name="l06148"></a>06148        <span class="keyword">do</span> k = ia(i), ia(i+1)-1
<a name="l06149"></a>06149           j = ja(k) + 1
<a name="l06150"></a>06150           iwork(j) = iwork(j) + 1
<a name="l06151"></a>06151        <span class="keyword">end do</span>
<a name="l06152"></a>06152     <span class="keyword">end do</span>
<a name="l06153"></a>06153   <span class="comment">!</span>
<a name="l06154"></a>06154   <span class="comment">!  Compute pointers from lengths.</span>
<a name="l06155"></a>06155   <span class="comment">!</span>
<a name="l06156"></a>06156     iwork(1) = 1
<a name="l06157"></a>06157 
<a name="l06158"></a>06158     <span class="keyword">do</span> i = 1, n
<a name="l06159"></a>06159        iwork(i+1) = iwork(i) + iwork(i+1)
<a name="l06160"></a>06160     <span class="keyword">end do</span>
<a name="l06161"></a>06161   <span class="comment">!</span>
<a name="l06162"></a>06162   <span class="comment">!  Get the positions of the nonzero elements in order of columns.</span>
<a name="l06163"></a>06163   <span class="comment">!</span>
<a name="l06164"></a>06164     ifirst = ia(1)
<a name="l06165"></a>06165     nnz = ia(n+1)-ifirst
<a name="l06166"></a>06166 
<a name="l06167"></a>06167     <span class="keyword">do</span> i = 1, n
<a name="l06168"></a>06168       <span class="keyword">do</span> k = ia(i), ia(i+1)-1
<a name="l06169"></a>06169         j = ja(k)
<a name="l06170"></a>06170         next = iwork(j)
<a name="l06171"></a>06171         iwork(nnz+next) = k
<a name="l06172"></a>06172         iwork(j) = next + 1
<a name="l06173"></a>06173       <span class="keyword">end do</span>
<a name="l06174"></a>06174     <span class="keyword">end do</span>
<a name="l06175"></a>06175   <span class="comment">!</span>
<a name="l06176"></a>06176   <span class="comment">!  Convert to coordinate format.</span>
<a name="l06177"></a>06177   <span class="comment">!</span>
<a name="l06178"></a>06178     <span class="keyword">do</span> i = 1, n
<a name="l06179"></a>06179       <span class="keyword">do</span> k = ia(i), ia(i+1)-1
<a name="l06180"></a>06180         iwork(k) = i
<a name="l06181"></a>06181       <span class="keyword">end do</span>
<a name="l06182"></a>06182     <span class="keyword">end do</span>
<a name="l06183"></a>06183   <span class="comment">!</span>
<a name="l06184"></a>06184   <span class="comment">!  Loop to find permutation: for each element find the correct</span>
<a name="l06185"></a>06185   <span class="comment">!  position in (sorted) arrays A, JA.  Record this in IWORK.</span>
<a name="l06186"></a>06186   <span class="comment">!</span>
<a name="l06187"></a>06187     <span class="keyword">do</span> k = 1, nnz
<a name="l06188"></a>06188        ko = iwork(nnz+k)
<a name="l06189"></a>06189        irow = iwork(ko)
<a name="l06190"></a>06190        next = ia(irow)
<a name="l06191"></a>06191   <span class="comment">!</span>
<a name="l06192"></a>06192   <span class="comment">!  The current element should go in next position in row. IWORK</span>
<a name="l06193"></a>06193   <span class="comment">!  records this position.</span>
<a name="l06194"></a>06194   <span class="comment">!</span>
<a name="l06195"></a>06195        iwork(ko) = next
<a name="l06196"></a>06196        ia(irow) = next + 1
<a name="l06197"></a>06197     <span class="keyword">end do</span>
<a name="l06198"></a>06198   <span class="comment">!</span>
<a name="l06199"></a>06199   <span class="comment">!  Perform an in-place permutation of the arrays.</span>
<a name="l06200"></a>06200   <span class="comment">!</span>
<a name="l06201"></a>06201        call <a class="code" href="namespaceunary__mod.html#a221b5873142df92fafad6f87e778f736">ivperm </a>( nnz, ja(ifirst), iwork )
<a name="l06202"></a>06202 
<a name="l06203"></a>06203        <span class="keyword">if</span> ( values ) <span class="keyword">then</span>
<a name="l06204"></a>06204          call <a class="code" href="namespaceunary__mod.html#a3d4e47d2b214ba02e8c2935596e0565e">dvperm_block </a>( block_size, nnz, a(:,:,ifirst), iwork )
<a name="l06205"></a>06205        <span class="keyword">end if</span>
<a name="l06206"></a>06206   <span class="comment">!</span>
<a name="l06207"></a>06207   <span class="comment">!  Reshift the pointers of the original matrix back.</span>
<a name="l06208"></a>06208   <span class="comment">!</span>
<a name="l06209"></a>06209     <span class="keyword">do</span> i = n, 1, -1
<a name="l06210"></a>06210       ia(i+1) = ia(i)
<a name="l06211"></a>06211     <span class="keyword">end do</span>
<a name="l06212"></a>06212 
<a name="l06213"></a>06213     ia(1) = ifirst
<a name="l06214"></a>06214 
<a name="l06215"></a>06215     return
<a name="l06216"></a>06216 <span class="keyword">  end subroutine csort_block</span>
<a name="l06217"></a>06217 
<a name="l06218"></a>06218   <span class="comment">!============================================================================</span>
<a name="l06219"></a>06219 
<a name="l06220"></a>06220   <span class="comment">!============================================================================</span>
<a name="l06221"></a>06221   
<a name="l06222"></a><a class="code" href="namespaceunary__mod.html#a3d4e47d2b214ba02e8c2935596e0565e">06222</a>   <span class="keyword">subroutine </span><a class="code" href="namespaceunary__mod.html#a3d4e47d2b214ba02e8c2935596e0565e">dvperm_block</a> ( block_size, n, x, perm )
<a name="l06223"></a>06223 
<a name="l06224"></a>06224   <span class="comment">!*****************************************************************************80</span>
<a name="l06225"></a>06225   <span class="comment">!</span>
<a name="l06226"></a>06226   <span class="comment">!! DVPERM performs an in-place permutation of a real vector.</span>
<a name="l06227"></a>06227   <span class="comment">!</span>
<a name="l06228"></a>06228   <span class="comment">!  Discussion:</span>
<a name="l06229"></a>06229   <span class="comment">!</span>
<a name="l06230"></a>06230   <span class="comment">!    This routine permutes a real vector X using a permutation PERM.</span>
<a name="l06231"></a>06231   <span class="comment">!</span>
<a name="l06232"></a>06232   <span class="comment">!    On return, the vector X satisfies,</span>
<a name="l06233"></a>06233   <span class="comment">!</span>
<a name="l06234"></a>06234   <span class="comment">!      x(perm(j)) :== x(j), j = 1,2,.., n</span>
<a name="l06235"></a>06235   <span class="comment">!</span>
<a name="l06236"></a>06236   <span class="comment">!  Modified:</span>
<a name="l06237"></a>06237   <span class="comment">!</span>
<a name="l06238"></a>06238   <span class="comment">!    07 January 2004</span>
<a name="l06239"></a>06239   <span class="comment">!</span>
<a name="l06240"></a>06240   <span class="comment">!  Author:</span>
<a name="l06241"></a>06241   <span class="comment">!</span>
<a name="l06242"></a>06242   <span class="comment">!    Youcef Saad</span>
<a name="l06243"></a>06243   <span class="comment">!</span>
<a name="l06244"></a>06244   <span class="comment">!  Parameters:</span>
<a name="l06245"></a>06245   <span class="comment">!</span>
<a name="l06246"></a>06246   <span class="comment">!    Input, integer ( kind = 4 ) N, the length of X.</span>
<a name="l06247"></a>06247   <span class="comment">!</span>
<a name="l06248"></a>06248   <span class="comment">!    Input/output, real X(N), the vector to be permuted.</span>
<a name="l06249"></a>06249   <span class="comment">!</span>
<a name="l06250"></a>06250   <span class="comment">!    Input, integer ( kind = 4 ) PERM(N), the permutation.</span>
<a name="l06251"></a>06251   <span class="comment">!</span>
<a name="l06252"></a>06252     <span class="keyword">implicit none</span>
<a name="l06253"></a>06253 
<a name="l06254"></a>06254     <span class="keywordtype">integer</span> :: block_size
<a name="l06255"></a>06255     <span class="keywordtype">integer</span> :: n
<a name="l06256"></a>06256 
<a name="l06257"></a>06257     <span class="keywordtype">integer</span> :: ii
<a name="l06258"></a>06258     <span class="keywordtype">integer</span> :: init
<a name="l06259"></a>06259     <span class="keywordtype">integer</span> :: k
<a name="l06260"></a>06260     <span class="keywordtype">integer</span> :: next
<a name="l06261"></a>06261     <span class="keywordtype">integer</span> :: perm(n)
<a name="l06262"></a>06262     <span class="keywordtype">real(wp)</span>, <span class="keywordtype">dimension(block_size,block_size) </span>:: tmp
<a name="l06263"></a>06263     <span class="keywordtype">real(wp)</span>, <span class="keywordtype">dimension(block_size,block_size) </span>:: tmp1
<a name="l06264"></a>06264     <span class="keywordtype">real(wp)</span>, <span class="keywordtype">dimension(block_size,block_size,n) </span>:: x
<a name="l06265"></a>06265 
<a name="l06266"></a>06266     init = 1
<a name="l06267"></a>06267     tmp = x(:,:,init)
<a name="l06268"></a>06268     ii = perm(init)
<a name="l06269"></a>06269     perm(init)= -perm(init)
<a name="l06270"></a>06270     k = 0
<a name="l06271"></a>06271   <span class="comment">!</span>
<a name="l06272"></a>06272   <span class="comment">!  The main loop.</span>
<a name="l06273"></a>06273   <span class="comment">!</span>
<a name="l06274"></a>06274    6  continue
<a name="l06275"></a>06275 
<a name="l06276"></a>06276      k = k + 1
<a name="l06277"></a>06277   <span class="comment">!</span>
<a name="l06278"></a>06278   <span class="comment">!  Save the chased element.</span>
<a name="l06279"></a>06279   <span class="comment">!</span>
<a name="l06280"></a>06280     tmp1 = x(:,:,ii)
<a name="l06281"></a>06281     x(:,:,ii) = tmp
<a name="l06282"></a>06282     next = perm(ii)
<a name="l06283"></a>06283 
<a name="l06284"></a>06284     <span class="keyword">if</span> ( next &lt; 0 ) <span class="keyword">then</span>
<a name="l06285"></a>06285       go to 65
<a name="l06286"></a>06286     <span class="keyword">end if</span>
<a name="l06287"></a>06287   <span class="comment">!</span>
<a name="l06288"></a>06288   <span class="comment">!  Test for end.</span>
<a name="l06289"></a>06289   <span class="comment">!</span>
<a name="l06290"></a>06290     <span class="keyword">if</span> ( n &lt; k ) <span class="keyword">then</span>
<a name="l06291"></a>06291       perm(1:n) = -perm(1:n)
<a name="l06292"></a>06292       return
<a name="l06293"></a>06293     <span class="keyword">end if</span>
<a name="l06294"></a>06294 
<a name="l06295"></a>06295     tmp = tmp1
<a name="l06296"></a>06296     perm(ii) = -perm(ii)
<a name="l06297"></a>06297     ii = next
<a name="l06298"></a>06298   <span class="comment">!</span>
<a name="l06299"></a>06299   <span class="comment">!  End of the loop.</span>
<a name="l06300"></a>06300   <span class="comment">!</span>
<a name="l06301"></a>06301     go to 6
<a name="l06302"></a>06302   <span class="comment">!</span>
<a name="l06303"></a>06303   <span class="comment">!  Reinitialize cycle.</span>
<a name="l06304"></a>06304   <span class="comment">!</span>
<a name="l06305"></a>06305    65   continue
<a name="l06306"></a>06306 
<a name="l06307"></a>06307     init = init + 1
<a name="l06308"></a>06308 
<a name="l06309"></a>06309     <span class="keyword">if</span> ( n &lt; init ) <span class="keyword">then</span> 
<a name="l06310"></a>06310       perm(1:n) = -perm(1:n)
<a name="l06311"></a>06311       return
<a name="l06312"></a>06312     <span class="keyword">end if</span>
<a name="l06313"></a>06313 
<a name="l06314"></a>06314     <span class="keyword">if</span> ( perm(init) &lt; 0 ) <span class="keyword">then</span>
<a name="l06315"></a>06315       go to 65
<a name="l06316"></a>06316     <span class="keyword">end if</span>
<a name="l06317"></a>06317 
<a name="l06318"></a>06318     tmp = x(:,:,init)
<a name="l06319"></a>06319     ii = perm(init)
<a name="l06320"></a>06320     perm(init) = -perm(init)
<a name="l06321"></a>06321     go to 6
<a name="l06322"></a>06322 
<a name="l06323"></a>06323 <span class="keyword">  end subroutine dvperm_block</span>
<a name="l06324"></a>06324 
<a name="l06325"></a>06325   <span class="comment">!============================================================================</span>
<a name="l06326"></a>06326 
<a name="l06327"></a><a class="code" href="namespaceunary__mod.html#a6b2c0545bcff15945e07b7d8cd2e6dc8">06327</a>   <span class="keyword">subroutine </span><a class="code" href="namespaceunary__mod.html#a6b2c0545bcff15945e07b7d8cd2e6dc8">a_bl_mu_x</a>(block_size,n_row_blocks,x,y,a,ja,ia) 
<a name="l06328"></a>06328     <span class="keywordtype">integer</span> :: n_row_blocks, block_size
<a name="l06329"></a>06329     <span class="keywordtype">real(wp) </span>:: x(block_size*n_row_blocks),y(block_size*n_row_blocks), 
<a name="l06330"></a>06330        a(block_size,block_size,*) 
<a name="l06331"></a>06331     <span class="keywordtype">integer</span> :: ja(*), ia(*)
<a name="l06332"></a>06332 
<a name="l06333"></a>06333     <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l06334"></a>06334     <span class="comment">!         A block sparse row times a vector</span>
<a name="l06335"></a>06335     <span class="comment">!----------------------------------------------------------------------- </span>
<a name="l06336"></a>06336     <span class="comment">! multiplies a matrix by a vector using the dot product form</span>
<a name="l06337"></a>06337     <span class="comment">! Matrix A is stored in block compressed sparse row storage.</span>
<a name="l06338"></a>06338     <span class="comment">!</span>
<a name="l06339"></a>06339     <span class="comment">! on entry:</span>
<a name="l06340"></a>06340     <span class="comment">!----------</span>
<a name="l06341"></a>06341     <span class="comment">! n_row_blocks = row block dimension of A</span>
<a name="l06342"></a>06342     <span class="comment">! x     = real array of length equal to the block column dimension of</span>
<a name="l06343"></a>06343     <span class="comment">!         the A matrix.</span>
<a name="l06344"></a>06344     <span class="comment">! a, ja,</span>
<a name="l06345"></a>06345     <span class="comment">!    ia = input matrix in block compressed sparse row format.</span>
<a name="l06346"></a>06346     <span class="comment">!</span>
<a name="l06347"></a>06347     <span class="comment">! on return:</span>
<a name="l06348"></a>06348     <span class="comment">!-----------</span>
<a name="l06349"></a>06349     <span class="comment">! y     = real array of length n, containing the product y=Ax</span>
<a name="l06350"></a>06350     <span class="comment">!</span>
<a name="l06351"></a>06351     <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l06352"></a>06352     
<a name="l06353"></a>06353     <span class="keywordtype">real(wp) </span>:: tmp
<a name="l06354"></a>06354     <span class="keywordtype">integer</span> :: i_row_block, i_column_block, i_row, i_column, cnt 
<a name="l06355"></a>06355 
<a name="l06356"></a>06356     cnt = 1
<a name="l06357"></a>06357 
<a name="l06358"></a>06358     <span class="keyword">do</span> i_row_block = 1, n_row_blocks
<a name="l06359"></a>06359       <span class="keyword">do</span> i_column_block = ia(i_row_block), ia(i_row_block+1)-1
<a name="l06360"></a>06360         <span class="keyword">do</span> i_row = 1, block_size
<a name="l06361"></a>06361           tmp = 0.0
<a name="l06362"></a>06362           <span class="keyword">do</span> i_column = 1, block_size
<a name="l06363"></a>06363             tmp = tmp + a(i_row,i_column,cnt)* &amp;
<a name="l06364"></a>06364               &amp; x((ja(i_column_block)-1)*block_size + i_column)
<a name="l06365"></a>06365           <span class="keyword">enddo</span>
<a name="l06366"></a>06366           y(i_row + (i_row_block-1)*block_size) = &amp;
<a name="l06367"></a>06367             &amp; y(i_row + (i_row_block-1)*block_size) + tmp
<a name="l06368"></a>06368         <span class="keyword">enddo</span>
<a name="l06369"></a>06369         cnt = cnt + 1
<a name="l06370"></a>06370       <span class="keyword">enddo</span>
<a name="l06371"></a>06371     <span class="keyword">enddo</span>
<a name="l06372"></a>06372     
<a name="l06373"></a>06373  
<a name="l06374"></a>06374 <span class="keyword">  end subroutine a_bl_mu_x</span>
<a name="l06375"></a>06375   
<a name="l06376"></a>06376   <span class="comment">!============================================================================</span>
<a name="l06377"></a>06377 
<a name="l06378"></a>06378 
<a name="l06379"></a>06379 <span class="keyword">end module unary_mod</span>
</pre></div></div>
<hr size="1"/><address style="text-align: right;"><small>Generated on 5 Aug 2016 for Doxygen Fortran Example by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>

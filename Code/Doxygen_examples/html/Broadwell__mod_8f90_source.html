<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Doxygen Fortran Example: Broadwell_mod.f90 Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="namespaces.html"><span>Modules</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
<h1>Broadwell_mod.f90</h1><a href="Broadwell__mod_8f90.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">!******************************************************************************</span>
<a name="l00002"></a>00002 <span class="comment">! Module containing routines to describe Broadwell&apos;s linear system in &quot;ON A </span>
<a name="l00003"></a>00003 <span class="comment">! CLASS OF UNIFORMLY ACCURATE IMEX RUNGEâ€“KUTTA SCHEMES AND APPLICATIONS TO </span>
<a name="l00004"></a>00004 <span class="comment">! HYPERBOLIC SYSTEMS WITH RELAXATION&quot; pg 11, equations 31a/b</span>
<a name="l00005"></a>00005 <span class="comment">!******************************************************************************</span>
<a name="l00006"></a>00006 <span class="comment">! REQUIRED FILES:</span>
<a name="l00007"></a>00007 <span class="comment">! PRECISION_VARS.F90            *DEFINES PRECISION FOR ALL VARIABLES</span>
<a name="l00008"></a>00008 <span class="comment">! SBP_COEF_MODULE.F90           *DEFINES CSR OPERATORS </span>
<a name="l00009"></a>00009 <span class="comment">! JACOBIAN_CSR_MOD.F90          *ALLOCATE AND STORE CSR JACOBIAN VARIABLES</span>
<a name="l00010"></a>00010 <span class="comment">! UNARY_MOD.F90                 *PERFORMS SPARSE MATRIX OPERATIONS</span>
<a name="l00011"></a>00011 <span class="comment">! MATVEC_MODULE.F90             *PERFORMS SPARSE MATRIX*VECTOR OPERATIONS</span>
<a name="l00012"></a>00012 <span class="comment">!******************************************************************************</span>
<a name="l00013"></a><a class="code" href="namespaceBroadwell__Mod.html">00013</a>       <span class="keyword">module</span> Broadwell_Mod 
<a name="l00014"></a>00014 
<a name="l00015"></a>00015       use <span class="keywordflow">precision_vars</span>, only: wp,two,pi
<a name="l00016"></a>00016 
<a name="l00017"></a>00017       implicit none; <span class="keywordtype">save</span> 
<a name="l00018"></a>00018   
<a name="l00019"></a>00019       <span class="keywordtype">private</span>
<a name="l00020"></a>00020       <span class="keywordtype">public</span>  :: <a class="code" href="namespaceBroadwell__Mod.html#abe06eb50d19f469c475430f9f02b2069">Broadwell</a>
<a name="l00021"></a>00021 
<a name="l00022"></a>00022 <span class="comment">!--------------------------------VARIABLES-------------------------------------         </span>
<a name="l00023"></a><a class="code" href="namespaceBroadwell__Mod.html#a34c57be9c77282eb5996427453a6e929">00023</a>       <span class="keywordtype">integer</span>,  <span class="keywordtype">parameter</span> :: nx   =  32 
<a name="l00024"></a><a class="code" href="namespaceBroadwell__Mod.html#aab1aec26293b3c36201093f2cddd26b0">00024</a>       <span class="keywordtype">integer</span>,  <span class="keywordtype">parameter</span> :: neq  =   3 
<a name="l00025"></a>00025 
<a name="l00026"></a><a class="code" href="namespaceBroadwell__Mod.html#af1f487ccf1fabc9c22e9cd7f9d211924">00026</a>       <span class="keywordtype">integer</span>,  <span class="keywordtype">parameter</span> :: vecl = nx * neq
<a name="l00027"></a>00027 
<a name="l00028"></a><a class="code" href="namespaceBroadwell__Mod.html#ae5a4e1a799a729a9bc010b8e427f6047">00028</a>       <span class="keywordtype">real(wp)</span>, <span class="keywordtype">parameter</span> :: xL   = -10.0_wp
<a name="l00029"></a><a class="code" href="namespaceBroadwell__Mod.html#adc87760a7ca35d723ca6d15fe12c3a8d">00029</a>       <span class="keywordtype">real(wp)</span>, <span class="keywordtype">parameter</span> :: xR   = +10.0_wp      
<a name="l00030"></a><a class="code" href="namespaceBroadwell__Mod.html#adc9a7f71bddd61ca964fb6a749ca38a4">00030</a>       <span class="keywordtype">real(wp)</span>, <span class="keywordtype">parameter</span> :: a_u1 = + 0.3_wp
<a name="l00031"></a><a class="code" href="namespaceBroadwell__Mod.html#a00c88973a02feacad9068d9a01448867">00031</a>       <span class="keywordtype">real(wp)</span>, <span class="keywordtype">parameter</span> :: a_u2 = + 0.1_wp
<a name="l00032"></a>00032    
<a name="l00033"></a><a class="code" href="namespaceBroadwell__Mod.html#a019206a884f781fd32a26e9ebcb4706f">00033</a>       <span class="keywordtype">real(wp)</span>, <span class="keywordtype">dimension(nx)     </span>:: x      
<a name="l00034"></a><a class="code" href="namespaceBroadwell__Mod.html#a7853a2c51b45878dc2ed979648d2225d">00034</a>       <span class="keywordtype">real(wp)                    </span>:: dx
<a name="l00035"></a>00035 
<a name="l00036"></a><a class="code" href="namespaceBroadwell__Mod.html#afd7159749c621aa0fc1a67a35ccbd0a9">00036</a>       <span class="keywordtype">integer</span>,  <span class="keywordtype">dimension(vecl+1) </span>:: iSource_p,iDeriv_comb_p,iwrk_Jac
<a name="l00037"></a><a class="code" href="namespaceBroadwell__Mod.html#a62fb9b8712a7d9d6ba4a99ac1dfe076f">00037</a>       <span class="keywordtype">integer</span>,  <span class="keywordtype">dimension(4*vecl) </span>:: jDeriv_comb_p
<a name="l00038"></a><a class="code" href="namespaceBroadwell__Mod.html#a263807e83bd23d9e62be9bfa62204bf7">00038</a>       <span class="keywordtype">integer</span>,  <span class="keywordtype">dimension(5*vecl) </span>:: jwrk_Jac
<a name="l00039"></a><a class="code" href="namespaceBroadwell__Mod.html#a50afc63c6b61d81f068e3af645b1689f">00039</a>       <span class="keywordtype">integer</span>,  <span class="keywordtype">dimension(vecl)   </span>:: jSource_p
<a name="l00040"></a>00040 
<a name="l00041"></a><a class="code" href="namespaceBroadwell__Mod.html#a4e04639bcc8248e232ad3ba53e7ef45b">00041</a>       <span class="keywordtype">real(wp)</span>, <span class="keywordtype">dimension(4*vecl) </span>::  Deriv_comb_p
<a name="l00042"></a><a class="code" href="namespaceBroadwell__Mod.html#a23cd953f1d4fa11ff282d7ca089ed0fd">00042</a>       <span class="keywordtype">real(wp)</span>, <span class="keywordtype">dimension(5*vecl) </span>:: wrk_Jac
<a name="l00043"></a>00043       
<a name="l00044"></a><a class="code" href="namespaceBroadwell__Mod.html#a3d2b47dd8bee1eaa002164d3db5a251b">00044</a>       <span class="keywordtype">real(wp)</span>, <span class="keywordtype">dimension(vecl)   </span>::  Source_p
<a name="l00045"></a><a class="code" href="namespaceBroadwell__Mod.html#ad271b068871e137bf25ee1e1b063ee50">00045</a>       <span class="keywordtype">logical</span> :: update_RHS,update_Jac
<a name="l00046"></a>00046 <span class="comment">!------------------------------------------------------------------------------      </span>
<a name="l00047"></a>00047       <span class="keyword">contains</span>    
<a name="l00048"></a>00048 <span class="comment">!==============================================================================</span>
<a name="l00049"></a>00049 <span class="comment">!******************************************************************************</span>
<a name="l00050"></a>00050 <span class="comment">! Subroutine to Initialize, calculate the RHS, and calculate the Jacobian</span>
<a name="l00051"></a>00051 <span class="comment">! of the Burgers problem </span>
<a name="l00052"></a>00052 <span class="comment">!******************************************************************************</span>
<a name="l00053"></a>00053 <span class="comment">! REQUIRED FILES:</span>
<a name="l00054"></a>00054 <span class="comment">! PRECISION_VARS.F90        *DEFINES PRECISION FOR ALL VARIABLES</span>
<a name="l00055"></a>00055 <span class="comment">! CONTROL_VARIABLES.F90     *CONTAINS VARIABLES AND ALLOCATION ROUTINES</span>
<a name="l00056"></a>00056 <span class="comment">!******************************************************************************</span>
<a name="l00057"></a>00057 
<a name="l00058"></a><a class="code" href="namespaceBroadwell__Mod.html#abe06eb50d19f469c475430f9f02b2069">00058</a>       <span class="keyword">subroutine </span><a class="code" href="namespaceBroadwell__Mod.html#abe06eb50d19f469c475430f9f02b2069">Broadwell</a>(nveclen,ep,dt,tfinal,iDT,resE_vec,resI_vec,akk)
<a name="l00059"></a>00059 
<a name="l00060"></a>00060       use <span class="keywordflow">control_variables</span>, only: temporal_splitting,probname,Jac_case, &amp;
<a name="l00061"></a>00061      &amp;                             tol,dt_error_tol,uvec,uexact,programstep
<a name="l00062"></a>00062       use <span class="keywordflow">SBP_Coef_Module</span>,   only: Define_CSR_Operators,D1_per
<a name="l00063"></a>00063       use <span class="keywordflow">unary_mod</span>,         only: aplb
<a name="l00064"></a>00064       use <span class="keywordflow">Jacobian_CSR_Mod</span>,  only: Allocate_Jac_CSR_Storage
<a name="l00065"></a>00065 
<a name="l00066"></a>00066 <span class="comment">!-----------------------VARIABLES----------------------------------------------</span>
<a name="l00067"></a>00067       <span class="comment">!INIT vars     </span>
<a name="l00068"></a>00068       <span class="keywordtype">real(wp)</span>, <span class="keywordtype">intent(in   )</span> :: ep
<a name="l00069"></a>00069       <span class="keywordtype">real(wp)</span>, <span class="keywordtype">intent(inout)</span> :: dt
<a name="l00070"></a>00070       <span class="keywordtype">integer</span>,  <span class="keywordtype">intent(  out)</span> :: nveclen
<a name="l00071"></a>00071       <span class="keywordtype">real(wp)</span>, <span class="keywordtype">intent(  out)</span> :: tfinal
<a name="l00072"></a>00072       <span class="keywordtype">integer</span>,  <span class="keywordtype">intent(in   )</span> :: iDT
<a name="l00073"></a>00073       
<a name="l00074"></a>00074       <span class="comment">!RHS vars</span>
<a name="l00075"></a>00075       <span class="keywordtype">real(wp)</span>, <span class="keywordtype">dimension(vecl)</span>, <span class="keywordtype">intent(  out)</span> :: resE_vec,resI_vec
<a name="l00076"></a>00076       <span class="keywordtype">real(wp)</span>, <span class="keywordtype">dimension(vecl)                </span>:: dudt_D1,dudt_Source
<a name="l00077"></a>00077       
<a name="l00078"></a>00078       <span class="comment">!Jacob vars</span>
<a name="l00079"></a>00079       <span class="keywordtype">real(wp)</span>, <span class="keywordtype">intent(in   )</span>  :: akk
<a name="l00080"></a>00080       <span class="keywordtype">integer</span>                  :: nnz_Jac,ierr=0
<a name="l00081"></a>00081       <span class="keywordtype">integer</span>, <span class="keywordtype">dimension(vecl) </span>:: iw
<a name="l00082"></a>00082 <span class="comment">!------------------------------------------------------------------------------   </span>
<a name="l00083"></a>00083       
<a name="l00084"></a>00084       Program_Step_Select: <span class="keyword">select</span> <span class="keyword">case</span>(programstep)
<a name="l00085"></a>00085         <span class="comment">!**Pre-initialization. Get problem name, vector length and grid**</span>
<a name="l00086"></a>00086         <span class="keyword">case</span>(<span class="stringliteral">&apos;INITIALIZE_PROBLEM_INFORMATION&apos;</span>)
<a name="l00087"></a>00087           nveclen = <a class="code" href="namespaceBroadwell__Mod.html#af1f487ccf1fabc9c22e9cd7f9d211924">vecl</a>
<a name="l00088"></a>00088           <a class="code" href="namespacecontrol__variables.html#ab4dc4a4fa46d7037bf7d9aaa1ab3e81c">probname</a>=<span class="stringliteral">&apos;Broadwell&apos;</span>     
<a name="l00089"></a>00089           <a class="code" href="namespacecontrol__variables.html#a291e2e72b0a3f05b05ea09624acb6878">Jac_case</a>=<span class="stringliteral">&apos;SPARSE&apos;</span>
<a name="l00090"></a>00090           tol=1.0e-12_wp  
<a name="l00091"></a>00091           dt_error_tol=5.0e-14_wp
<a name="l00092"></a>00092           call <a class="code" href="namespaceBroadwell__Mod.html#a3c14aa4a4be918fe822aa5b6777c73f8">grid</a>()           
<a name="l00093"></a>00093 
<a name="l00094"></a>00094         <span class="comment">!**Initialization of problem information**        </span>
<a name="l00095"></a>00095         <span class="keyword">case</span>(<span class="stringliteral">&apos;SET_INITIAL_CONDITIONS&apos;</span>)
<a name="l00096"></a>00096           
<a name="l00097"></a>00097           <span class="comment">!Update=true for Jac/RHS updates</span>
<a name="l00098"></a>00098           <a class="code" href="namespaceBroadwell__Mod.html#ad271b068871e137bf25ee1e1b063ee50">update_RHS</a>=.true.; <a class="code" href="namespaceBroadwell__Mod.html#ad7e158076badecf057c1d8c109c13730">update_Jac</a>=.true. <span class="comment">!reset every new epsilon/dt</span>
<a name="l00099"></a>00099           
<a name="l00100"></a>00100           <span class="comment">!Allocate derivative operators</span>
<a name="l00101"></a>00101           <span class="keyword">if</span>(.not. <span class="keyword">allocated</span>(<a class="code" href="namespaceSBP__Coef__Module.html#ad13cceaecd47b583a1073a31379c5574">D1_per</a>))call <a class="code" href="namespaceSBP__Coef__Module.html#a2a470b5ce579d35823d5a3b0cdfc0d25">Define_CSR_Operators</a>(<a class="code" href="namespaceBroadwell__Mod.html#a34c57be9c77282eb5996427453a6e929">nx</a>,<a class="code" href="namespaceBroadwell__Mod.html#a7853a2c51b45878dc2ed979648d2225d">dx</a>)   
<a name="l00102"></a>00102           
<a name="l00103"></a>00103           <span class="comment">!Time information</span>
<a name="l00104"></a>00104           tfinal = 0.2_wp  <span class="comment">! final time   </span>
<a name="l00105"></a>00105           choose_dt: <span class="keyword">select</span> <span class="keyword">case</span>(temporal_splitting)
<a name="l00106"></a>00106             <span class="keyword">case</span>(<span class="stringliteral">&apos;EXPLICIT&apos;</span>); dt = 0.000025_wp*0.1_wp/10**((iDT-1)/20.0_wp) <span class="comment">! explicit timestep</span>
<a name="l00107"></a>00107             <span class="keyword">case</span> default    ; dt = 0.2_wp/10**((iDT-1)/20.0_wp)             <span class="comment">! implicit timestep      </span>
<a name="l00108"></a>00108           <span class="keyword">end select</span> choose_dt
<a name="l00109"></a>00109           
<a name="l00110"></a>00110           <span class="comment">! Set IC&apos;s</span>
<a name="l00111"></a>00111           uvec(1:<a class="code" href="namespaceBroadwell__Mod.html#af1f487ccf1fabc9c22e9cd7f9d211924">vecl</a>:2)=sin(<a class="code" href="namespaceprecision__vars.html#aa062b339d028cb99bfdf249224f77661">two</a>*<a class="code" href="namespaceprecision__vars.html#a5d3c9e506d81adeae20c38194ab26030">pi</a>*<a class="code" href="namespaceBroadwell__Mod.html#a019206a884f781fd32a26e9ebcb4706f">x</a>(:))
<a name="l00112"></a>00112           uvec(2:<a class="code" href="namespaceBroadwell__Mod.html#af1f487ccf1fabc9c22e9cd7f9d211924">vecl</a>:2)=a*sin(<a class="code" href="namespaceprecision__vars.html#aa062b339d028cb99bfdf249224f77661">two</a>*<a class="code" href="namespaceprecision__vars.html#a5d3c9e506d81adeae20c38194ab26030">pi</a>*<a class="code" href="namespaceBroadwell__Mod.html#a019206a884f781fd32a26e9ebcb4706f">x</a>(:))+ep*(a**2-1)*<a class="code" href="namespaceprecision__vars.html#aa062b339d028cb99bfdf249224f77661">two</a>*<a class="code" href="namespaceprecision__vars.html#a5d3c9e506d81adeae20c38194ab26030">pi</a>*cos(<a class="code" href="namespaceprecision__vars.html#aa062b339d028cb99bfdf249224f77661">two</a>*<a class="code" href="namespaceprecision__vars.html#a5d3c9e506d81adeae20c38194ab26030">pi</a>*<a class="code" href="namespaceBroadwell__Mod.html#a019206a884f781fd32a26e9ebcb4706f">x</a>(:))
<a name="l00113"></a>00113          
<a name="l00114"></a>00114           <span class="comment">!set exact solution at tfinal</span>
<a name="l00115"></a>00115           call <a class="code" href="namespaceBroadwell__Mod.html#a305f6492e91365fe99539a13143e5de8">exact_Broadwell</a>(uexact,ep) 
<a name="l00116"></a>00116               
<a name="l00117"></a>00117         <span class="keyword">case</span>(<span class="stringliteral">&apos;BUILD_RHS&apos;</span>)
<a name="l00118"></a>00118           call <a class="code" href="namespaceBroadwell__Mod.html#a85fdddaf981ee96612834c55a03022b1">Broadwell_dUdt</a>(uvec,dudt_D1,dudt_Source,ep)        
<a name="l00119"></a>00119           choose_RHS_type: <span class="keyword">select</span> <span class="keyword">case</span> (Temporal_Splitting)       
<a name="l00120"></a>00120             <span class="keyword">case</span>(<span class="stringliteral">&apos;EXPLICIT&apos;</span>)
<a name="l00121"></a>00121               resE_vec(:)=dt*(dudt_D1(:)+dudt_Source(:))
<a name="l00122"></a>00122               resI_vec(:)=0.0_wp                   
<a name="l00123"></a>00123             <span class="keyword">case</span>(<span class="stringliteral">&apos;IMPLICIT&apos;</span>)
<a name="l00124"></a>00124               resE_vec(:)=0.0_wp
<a name="l00125"></a>00125               resI_vec(:)=dt*(dudt_D1(:)+dudt_Source(:))
<a name="l00126"></a>00126             <span class="keyword">case</span>(<span class="stringliteral">&apos;IMEX&apos;</span>)
<a name="l00127"></a>00127               resE_vec(:)=dt*dudt_D1(:)
<a name="l00128"></a>00128               resI_vec(:)=dt*dudt_Source(:)
<a name="l00129"></a>00129           <span class="keyword">end select</span> choose_RHS_type
<a name="l00130"></a>00130           <a class="code" href="namespaceBroadwell__Mod.html#ad271b068871e137bf25ee1e1b063ee50">update_RHS</a>=.false. <span class="comment">!no need to update RHS until next epsilon</span>
<a name="l00131"></a>00131           
<a name="l00132"></a>00132         <span class="keyword">case</span>(<span class="stringliteral">&apos;BUILD_JACOBIAN&apos;</span>)
<a name="l00133"></a>00133           choose_Jac_type: <span class="keyword">select</span> <span class="keyword">case</span>(temporal_splitting)
<a name="l00134"></a>00134             <span class="keyword">case</span>(<span class="stringliteral">&apos;IMPLICIT&apos;</span>)
<a name="l00135"></a>00135               <span class="keyword">if</span> (<a class="code" href="namespaceBroadwell__Mod.html#ad7e158076badecf057c1d8c109c13730">update_Jac</a>) <span class="keyword">then</span>
<a name="l00136"></a>00136                 nnz_Jac=5*<a class="code" href="namespaceBroadwell__Mod.html#af1f487ccf1fabc9c22e9cd7f9d211924">vecl</a>+<a class="code" href="namespaceBroadwell__Mod.html#a34c57be9c77282eb5996427453a6e929">nx</a>
<a name="l00137"></a>00137                 call <a class="code" href="namespaceJacobian__CSR__Mod.html#ab251b185ad5d74ee771ea99d2a7f3935">Allocate_Jac_CSR_Storage</a>(<a class="code" href="namespaceBroadwell__Mod.html#af1f487ccf1fabc9c22e9cd7f9d211924">vecl</a>,nnz_Jac)
<a name="l00138"></a>00138              
<a name="l00139"></a>00139                 call <a class="code" href="namespaceunary__mod.html#ad0d8a19e91684be702bb07ef7fe3a59c">aplb</a>(<a class="code" href="namespaceBroadwell__Mod.html#af1f487ccf1fabc9c22e9cd7f9d211924">vecl</a>,<a class="code" href="namespaceBroadwell__Mod.html#af1f487ccf1fabc9c22e9cd7f9d211924">vecl</a>,1,<a class="code" href="namespaceBroadwell__Mod.html#a3d2b47dd8bee1eaa002164d3db5a251b">Source_p</a>,<a class="code" href="namespaceBroadwell__Mod.html#a50afc63c6b61d81f068e3af645b1689f">jSource_p</a>,<a class="code" href="namespaceBroadwell__Mod.html#adfefa5f4d8e267caee8f9bed5c8ad9ef">iSource_p</a>,    &amp;
<a name="l00140"></a>00140      &amp;                    <a class="code" href="namespaceBroadwell__Mod.html#a4e04639bcc8248e232ad3ba53e7ef45b">Deriv_comb_p</a>,<a class="code" href="namespaceBroadwell__Mod.html#a62fb9b8712a7d9d6ba4a99ac1dfe076f">jDeriv_comb_p</a>,<a class="code" href="namespaceBroadwell__Mod.html#afb14c9a85d1e73f89e7ac485557e8199">iDeriv_comb_p</a>,    &amp;
<a name="l00141"></a>00141      &amp;                    <a class="code" href="namespaceBroadwell__Mod.html#a23cd953f1d4fa11ff282d7ca089ed0fd">wrk_Jac</a>,<a class="code" href="namespaceBroadwell__Mod.html#a263807e83bd23d9e62be9bfa62204bf7">jwrk_Jac</a>,<a class="code" href="namespaceBroadwell__Mod.html#afd7159749c621aa0fc1a67a35ccbd0a9">iwrk_Jac</a>,5*<a class="code" href="namespaceBroadwell__Mod.html#af1f487ccf1fabc9c22e9cd7f9d211924">vecl</a>,iw,ierr) 
<a name="l00142"></a>00142                 <span class="keyword">if</span> (ierr/=0) then; print*,<span class="stringliteral">&apos;Build Jac ierr=&apos;</span>,ierr; stop; <span class="keyword">endif</span> 
<a name="l00143"></a>00143               <span class="keyword">endif</span>
<a name="l00144"></a>00144               call <a class="code" href="namespaceBroadwell__Mod.html#ac336181a366db7be1115eb2c9297348d">Broadwell_Jac</a>(dt,akk,<a class="code" href="namespaceBroadwell__Mod.html#a23cd953f1d4fa11ff282d7ca089ed0fd">wrk_Jac</a>,<a class="code" href="namespaceBroadwell__Mod.html#a263807e83bd23d9e62be9bfa62204bf7">jwrk_Jac</a>,<a class="code" href="namespaceBroadwell__Mod.html#afd7159749c621aa0fc1a67a35ccbd0a9">iwrk_Jac</a>)       
<a name="l00145"></a>00145                         
<a name="l00146"></a>00146             <span class="keyword">case</span>(<span class="stringliteral">&apos;IMEX&apos;</span>)
<a name="l00147"></a>00147               nnz_Jac=<a class="code" href="namespaceBroadwell__Mod.html#af1f487ccf1fabc9c22e9cd7f9d211924">vecl</a>+<a class="code" href="namespaceBroadwell__Mod.html#a34c57be9c77282eb5996427453a6e929">nx</a>
<a name="l00148"></a>00148               call <a class="code" href="namespaceJacobian__CSR__Mod.html#ab251b185ad5d74ee771ea99d2a7f3935">Allocate_Jac_CSR_Storage</a>(<a class="code" href="namespaceBroadwell__Mod.html#af1f487ccf1fabc9c22e9cd7f9d211924">vecl</a>,nnz_Jac)
<a name="l00149"></a>00149               call <a class="code" href="namespaceBroadwell__Mod.html#ac336181a366db7be1115eb2c9297348d">Broadwell_Jac</a>(dt,akk,<a class="code" href="namespaceBroadwell__Mod.html#a3d2b47dd8bee1eaa002164d3db5a251b">Source_p</a>,<a class="code" href="namespaceBroadwell__Mod.html#a50afc63c6b61d81f068e3af645b1689f">jSource_p</a>,<a class="code" href="namespaceBroadwell__Mod.html#adfefa5f4d8e267caee8f9bed5c8ad9ef">iSource_p</a>)
<a name="l00150"></a>00150               
<a name="l00151"></a>00151           <span class="keyword">end select</span> choose_Jac_type
<a name="l00152"></a>00152           <a class="code" href="namespaceBroadwell__Mod.html#ad7e158076badecf057c1d8c109c13730">update_Jac</a>=.false.  <span class="comment">!no need to update matrix that forms Jacobian until next epsilon/dt</span>
<a name="l00153"></a>00153           
<a name="l00154"></a>00154       <span class="keyword">end select</span> Program_Step_Select     
<a name="l00155"></a>00155 <span class="keyword">      end subroutine Broadwell</span>
<a name="l00156"></a>00156 <span class="comment">!==============================================================================</span>
<a name="l00157"></a>00157 <span class="comment">!==============================================================================</span>
<a name="l00158"></a>00158 <span class="comment">!==============================================================================</span>
<a name="l00159"></a>00159 <span class="comment">! PRODUCES GRID</span>
<a name="l00160"></a><a class="code" href="namespaceBroadwell__Mod.html#a3c14aa4a4be918fe822aa5b6777c73f8">00160</a>       <span class="keyword">subroutine </span><a class="code" href="namespaceBroadwell__Mod.html#a3c14aa4a4be918fe822aa5b6777c73f8">grid</a>()
<a name="l00161"></a>00161       <span class="keywordtype">integer</span> :: i
<a name="l00162"></a>00162       
<a name="l00163"></a>00163       <span class="keyword">do</span> i=1,<a class="code" href="namespaceBroadwell__Mod.html#af1f487ccf1fabc9c22e9cd7f9d211924">vecl</a>/2
<a name="l00164"></a>00164         <a class="code" href="namespaceBroadwell__Mod.html#a019206a884f781fd32a26e9ebcb4706f">x</a>(i)= <a class="code" href="namespaceBroadwell__Mod.html#ae5a4e1a799a729a9bc010b8e427f6047">xL</a> + (<a class="code" href="namespaceBroadwell__Mod.html#adc87760a7ca35d723ca6d15fe12c3a8d">xR</a>-<a class="code" href="namespaceBroadwell__Mod.html#ae5a4e1a799a729a9bc010b8e427f6047">xL</a>)*(i-1.0_wp)/(<a class="code" href="namespaceBroadwell__Mod.html#a34c57be9c77282eb5996427453a6e929">nx</a>)
<a name="l00165"></a>00165       <span class="keyword">enddo</span>
<a name="l00166"></a>00166       
<a name="l00167"></a>00167       <a class="code" href="namespaceBroadwell__Mod.html#a7853a2c51b45878dc2ed979648d2225d">dx</a>=<a class="code" href="namespaceBroadwell__Mod.html#a019206a884f781fd32a26e9ebcb4706f">x</a>(2)-<a class="code" href="namespaceBroadwell__Mod.html#a019206a884f781fd32a26e9ebcb4706f">x</a>(1)
<a name="l00168"></a>00168 
<a name="l00169"></a>00169 <span class="keyword">      end subroutine grid</span>
<a name="l00170"></a>00170 <span class="comment">!==============================================================================</span>
<a name="l00171"></a>00171 <span class="comment">! RETURNS VECTOR WITH EXACT SOLUTION</span>
<a name="l00172"></a><a class="code" href="namespaceBroadwell__Mod.html#a305f6492e91365fe99539a13143e5de8">00172</a>       <span class="keyword">subroutine </span><a class="code" href="namespaceBroadwell__Mod.html#a305f6492e91365fe99539a13143e5de8">exact_Broadwell</a>(u,eps)
<a name="l00173"></a>00173 
<a name="l00174"></a>00174       <span class="keywordtype">real(wp)</span>,                  <span class="keywordtype">intent(in   )</span> :: eps
<a name="l00175"></a>00175       <span class="keywordtype">real(wp)</span>, <span class="keywordtype">dimension(vecl)</span>, <span class="keywordtype">intent(  out)</span> :: u
<a name="l00176"></a>00176 
<a name="l00177"></a>00177       <span class="keywordtype">integer</span>                                  :: i
<a name="l00178"></a>00178       <span class="keywordtype">real(wp)</span>, <span class="keywordtype">dimension(81,vecl+1) </span>:: ExactTot
<a name="l00179"></a>00179       <span class="keywordtype">real(wp) </span>:: diff
<a name="l00180"></a>00180 
<a name="l00181"></a>00181       u(:)=0.0_wp
<a name="l00182"></a>00182       
<a name="l00183"></a>00183       <span class="comment">!**Exact Solution** </span>
<a name="l00184"></a>00184       <span class="keyword">open</span>(unit=39,file=<span class="stringliteral">&apos;exact.Broadwell_256.data&apos;</span>)
<a name="l00185"></a>00185       rewind(39)
<a name="l00186"></a>00186       <span class="keyword">do</span> i=1,81
<a name="l00187"></a>00187         <span class="keyword">read</span>(39,*)ExactTot(i,1:<a class="code" href="namespaceBroadwell__Mod.html#af1f487ccf1fabc9c22e9cd7f9d211924">vecl</a>)
<a name="l00188"></a>00188         ExactTot(i,<a class="code" href="namespaceBroadwell__Mod.html#af1f487ccf1fabc9c22e9cd7f9d211924">vecl</a>+1) = 1.0_wp/10**((i-1)/(10.0_wp))  <span class="comment">!  used for 81 values of ep</span>
<a name="l00189"></a>00189       <span class="keyword">enddo</span>
<a name="l00190"></a>00190       <span class="keyword">do</span> i=1,81
<a name="l00191"></a>00191         diff = abs(ExactTot(i,<a class="code" href="namespaceBroadwell__Mod.html#af1f487ccf1fabc9c22e9cd7f9d211924">vecl</a>+1) - eps)
<a name="l00192"></a>00192         <span class="keyword">if</span>(diff &lt;= 1.0e-10_wp)<span class="keyword">then</span>
<a name="l00193"></a>00193           u(:) = ExactTot(i,:<a class="code" href="namespaceBroadwell__Mod.html#af1f487ccf1fabc9c22e9cd7f9d211924">vecl</a>)
<a name="l00194"></a>00194           exit
<a name="l00195"></a>00195         <span class="keyword">endif</span>
<a name="l00196"></a>00196       <span class="keyword">enddo</span>
<a name="l00197"></a>00197 
<a name="l00198"></a>00198 <span class="keyword">      end subroutine exact_Broadwell</span>
<a name="l00199"></a>00199 
<a name="l00200"></a>00200 <span class="comment">!==============================================================================</span>
<a name="l00201"></a>00201 <span class="comment">! DEFINES RHS </span>
<a name="l00202"></a><a class="code" href="namespaceBroadwell__Mod.html#a85fdddaf981ee96612834c55a03022b1">00202</a>       <span class="keyword">subroutine </span><a class="code" href="namespaceBroadwell__Mod.html#a85fdddaf981ee96612834c55a03022b1">Broadwell_dUdt</a>(u,dudt_D1,eps)
<a name="l00203"></a>00203       
<a name="l00204"></a>00204       use <span class="keywordflow">SBP_Coef_Module</span>, only: D1_per,jD1_per,iD1_per
<a name="l00205"></a>00205       use <span class="keywordflow">matvec_module</span>,   only: amux
<a name="l00206"></a>00206 
<a name="l00207"></a>00207       <span class="keywordtype">real(wp)</span>, <span class="keywordtype">dimension(vecl)</span>, <span class="keywordtype">intent(in   )</span> :: u
<a name="l00208"></a>00208       <span class="keywordtype">real(wp)</span>, <span class="keywordtype">dimension(vecl)</span>, <span class="keywordtype">intent(  out)</span> :: dudt_D1
<a name="l00209"></a>00209       <span class="keywordtype">real(wp)</span>,                  <span class="keywordtype">intent(in   )</span> :: eps
<a name="l00210"></a>00210            
<a name="l00211"></a>00211       <span class="keywordtype">real(wp)</span>, <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">allocatable</span> :: t1
<a name="l00212"></a>00212 
<a name="l00213"></a>00213       <span class="keywordtype">real(wp)                            </span>:: epsI
<a name="l00214"></a>00214 
<a name="l00215"></a>00215       <span class="keyword">allocate</span>(t1(<a class="code" href="namespaceBroadwell__Mod.html#a34c57be9c77282eb5996427453a6e929">nx</a>)) ; t1(:) = 0.0_wp ;
<a name="l00216"></a>00216 
<a name="l00217"></a>00217       epsI  = 1.0_wp / eps
<a name="l00218"></a>00218 <span class="comment">!------------------------------------------------------------------------------     </span>
<a name="l00219"></a>00219       <span class="keyword">if</span> (<a class="code" href="namespaceBroadwell__Mod.html#ad271b068871e137bf25ee1e1b063ee50">update_RHS</a>) <span class="keyword">then</span>
<a name="l00220"></a>00220         
<a name="l00221"></a>00221          <span class="comment">! d (u2) / dx</span>
<a name="l00222"></a>00222          call <a class="code" href="namespacematvec__module.html#a1f3669ca263f13c00625724a4add11ea">amux</a>(<a class="code" href="namespaceBroadwell__Mod.html#a34c57be9c77282eb5996427453a6e929">nx</a>,u(1*<a class="code" href="namespaceBroadwell__Mod.html#a34c57be9c77282eb5996427453a6e929">nx</a>+1:2*<a class="code" href="namespaceBroadwell__Mod.html#a34c57be9c77282eb5996427453a6e929">nx</a>),t1,<a class="code" href="namespaceSBP__Coef__Module.html#ad13cceaecd47b583a1073a31379c5574">D1_per</a>,<a class="code" href="namespaceSBP__Coef__Module.html#a257ba3136887f7b61d2b30c476f7f5d9">jD1_per</a>,<a class="code" href="namespaceSBP__Coef__Module.html#aee75987a58a3553015d1a40c74a484d8">iD1_per</a>)
<a name="l00223"></a>00223          dudt_D1(     1:  <a class="code" href="namespaceBroadwell__Mod.html#a34c57be9c77282eb5996427453a6e929">nx</a>) = -t1
<a name="l00224"></a>00224          dudt_D1(2*<a class="code" href="namespaceBroadwell__Mod.html#a34c57be9c77282eb5996427453a6e929">nx</a>+1:3*<a class="code" href="namespaceBroadwell__Mod.html#a34c57be9c77282eb5996427453a6e929">nx</a>) = -t1
<a name="l00225"></a>00225 
<a name="l00226"></a>00226          <span class="comment">! d (u3) / dx</span>
<a name="l00227"></a>00227          call <a class="code" href="namespacematvec__module.html#a1f3669ca263f13c00625724a4add11ea">amux</a>(<a class="code" href="namespaceBroadwell__Mod.html#a34c57be9c77282eb5996427453a6e929">nx</a>,u(2*<a class="code" href="namespaceBroadwell__Mod.html#a34c57be9c77282eb5996427453a6e929">nx</a>+1:3*<a class="code" href="namespaceBroadwell__Mod.html#a34c57be9c77282eb5996427453a6e929">nx</a>),t1,<a class="code" href="namespaceSBP__Coef__Module.html#ad13cceaecd47b583a1073a31379c5574">D1_per</a>,<a class="code" href="namespaceSBP__Coef__Module.html#a257ba3136887f7b61d2b30c476f7f5d9">jD1_per</a>,<a class="code" href="namespaceSBP__Coef__Module.html#aee75987a58a3553015d1a40c74a484d8">iD1_per</a>)
<a name="l00228"></a>00228          dudt_D1(1*<a class="code" href="namespaceBroadwell__Mod.html#a34c57be9c77282eb5996427453a6e929">nx</a>+1:2*<a class="code" href="namespaceBroadwell__Mod.html#a34c57be9c77282eb5996427453a6e929">nx</a>) = -t1
<a name="l00229"></a>00229 
<a name="l00230"></a>00230          dudt_D1(2*<a class="code" href="namespaceBroadwell__Mod.html#a34c57be9c77282eb5996427453a6e929">nx</a>+1:3*<a class="code" href="namespaceBroadwell__Mod.html#a34c57be9c77282eb5996427453a6e929">nx</a>) = dudt_D1(2*<a class="code" href="namespaceBroadwell__Mod.html#a34c57be9c77282eb5996427453a6e929">nx</a>+1:3*<a class="code" href="namespaceBroadwell__Mod.html#a34c57be9c77282eb5996427453a6e929">nx</a>) +        epsI * ( &amp;
<a name="l00231"></a>00231                               +        u(0*<a class="code" href="namespaceBroadwell__Mod.html#a34c57be9c77282eb5996427453a6e929">nx</a>+1:1*<a class="code" href="namespaceBroadwell__Mod.html#a34c57be9c77282eb5996427453a6e929">nx</a>)*u(0*<a class="code" href="namespaceBroadwell__Mod.html#a34c57be9c77282eb5996427453a6e929">nx</a>+1:1*<a class="code" href="namespaceBroadwell__Mod.html#a34c57be9c77282eb5996427453a6e929">nx</a>)   &amp;
<a name="l00232"></a>00232                               +        u(1*<a class="code" href="namespaceBroadwell__Mod.html#a34c57be9c77282eb5996427453a6e929">nx</a>+1:2*<a class="code" href="namespaceBroadwell__Mod.html#a34c57be9c77282eb5996427453a6e929">nx</a>)*u(1*<a class="code" href="namespaceBroadwell__Mod.html#a34c57be9c77282eb5996427453a6e929">nx</a>+1:2*<a class="code" href="namespaceBroadwell__Mod.html#a34c57be9c77282eb5996427453a6e929">nx</a>)   &amp;
<a name="l00233"></a>00233                               - 2.0_wp*u(0*<a class="code" href="namespaceBroadwell__Mod.html#a34c57be9c77282eb5996427453a6e929">nx</a>+1:1*<a class="code" href="namespaceBroadwell__Mod.html#a34c57be9c77282eb5996427453a6e929">nx</a>)*u(2*<a class="code" href="namespaceBroadwell__Mod.html#a34c57be9c77282eb5996427453a6e929">nx</a>+1:3*<a class="code" href="namespaceBroadwell__Mod.html#a34c57be9c77282eb5996427453a6e929">nx</a>) )
<a name="l00234"></a>00234 
<a name="l00235"></a>00235       <span class="keyword">endif</span>
<a name="l00236"></a>00236 
<a name="l00237"></a>00237       <span class="keyword">deallocate</span>(t1)
<a name="l00238"></a>00238       
<a name="l00239"></a>00239 <span class="keyword">      end subroutine Broadwell_dUdt</span>
<a name="l00240"></a>00240 
<a name="l00241"></a>00241 <span class="comment">!==============================================================================</span>
<a name="l00242"></a>00242 
<a name="l00243"></a><a class="code" href="namespaceBroadwell__Mod.html#ac336181a366db7be1115eb2c9297348d">00243</a>       <span class="keyword">subroutine </span><a class="code" href="namespaceBroadwell__Mod.html#ac336181a366db7be1115eb2c9297348d">Broadwell_Jac</a>(dt,akk,a,ja,ia)
<a name="l00244"></a>00244       
<a name="l00245"></a>00245       use <span class="keywordflow">unary_mod</span>,         only: aplsca
<a name="l00246"></a>00246       use <span class="keywordflow">Jacobian_CSR_Mod</span>,  only: iaJac, jaJac,  aJac
<a name="l00247"></a>00247      
<a name="l00248"></a>00248       <span class="keywordtype">real(wp)</span>,                  <span class="keywordtype">intent(in)</span> :: dt,akk
<a name="l00249"></a>00249       <span class="keywordtype">real(wp)</span>, <span class="keywordtype">dimension(:)</span>,    <span class="keywordtype">intent(in)</span> :: a
<a name="l00250"></a>00250       <span class="keywordtype">integer</span>,  <span class="keywordtype">dimension(:)</span>,    <span class="keywordtype">intent(in)</span> :: ja,ia
<a name="l00251"></a>00251       
<a name="l00252"></a>00252       <span class="keywordtype">integer</span>,  <span class="keywordtype">dimension(vecl)             </span>:: iw
<a name="l00253"></a>00253       <span class="keywordtype">real(wp)</span>, dimension(size(a)+vecl/2)   :: wrk
<a name="l00254"></a>00254       <span class="keywordtype">integer</span>,  dimension(size(a)+vecl/2)   :: jwrk
<a name="l00255"></a>00255       <span class="keywordtype">integer</span>,  <span class="keywordtype">dimension(vecl+1)           </span>:: iwrk      
<a name="l00256"></a>00256       
<a name="l00257"></a>00257       <span class="keywordtype">integer</span>                               :: nnz
<a name="l00258"></a>00258 
<a name="l00259"></a>00259       nnz = <span class="keyword">size</span>(a)
<a name="l00260"></a>00260       
<a name="l00261"></a>00261       wrk(:nnz)=-akk*dt*a(:)   
<a name="l00262"></a>00262       wrk(nnz+1:)=0.0_wp
<a name="l00263"></a>00263       jwrk(:nnz)=ja(:)
<a name="l00264"></a>00264       jwrk(nnz+1:)=0
<a name="l00265"></a>00265       iwrk(:)=ia(:)
<a name="l00266"></a>00266 
<a name="l00267"></a>00267       call <a class="code" href="namespaceunary__mod.html#a74f52765deb59280ca3f1b308a7a3bfb">aplsca</a>(vecl,wrk,jwrk,iwrk,1.0_wp,iw)      
<a name="l00268"></a>00268 
<a name="l00269"></a>00269       <a class="code" href="namespaceJacobian__CSR__Mod.html#a94d69662ef031c9f945e105441d48c02">iaJac</a>=iwrk
<a name="l00270"></a>00270       <a class="code" href="namespaceJacobian__CSR__Mod.html#a5926dc41c54f00cbd2cc669cc175665b">jaJac</a>=jwrk
<a name="l00271"></a>00271       <a class="code" href="namespaceJacobian__CSR__Mod.html#a7f4fdf9a3cd9df4f89b43e74e69f16e5">aJac</a> = wrk
<a name="l00272"></a>00272       
<a name="l00273"></a>00273 <span class="keyword">      end subroutine Broadwell_Jac      </span>
<a name="l00274"></a>00274 
<a name="l00275"></a>00275 <span class="comment">!==============================================================================</span>
<a name="l00276"></a>00276 
<a name="l00277"></a>00277 <span class="keyword">      end module Broadwell_mod</span>
</pre></div></div>
<hr size="1"/><address style="text-align: right;"><small>Generated on 2 Aug 2016 for Doxygen Fortran Example by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>

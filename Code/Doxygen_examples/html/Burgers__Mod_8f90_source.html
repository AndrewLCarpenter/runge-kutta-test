<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Doxygen Fortran Example: Burgers_Mod.f90 Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="namespaces.html"><span>Modules</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
<h1>Burgers_Mod.f90</h1><a href="Burgers__Mod_8f90.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">!*****************************************************************************</span>
<a name="l00002"></a>00002 <span class="comment">! Module containing routines to describe Burger&apos;s equation </span>
<a name="l00003"></a>00003 <span class="comment">!******************************************************************************</span>
<a name="l00004"></a>00004 <span class="comment">! REQUIRED FILES:</span>
<a name="l00005"></a>00005 <span class="comment">! PRECISION_VARS.F90            *DEFINES PRECISION FOR ALL VARIABLES</span>
<a name="l00006"></a>00006 <span class="comment">! SBP_COEF_MODULE.F90           *DEFINES CSR OPERATORS </span>
<a name="l00007"></a>00007 <span class="comment">! UNARY_MOD.F90                 *PERFORMS SPARSE MATRIX OPERATIONS</span>
<a name="l00008"></a>00008 <span class="comment">! MATVEC_MODULE.F90             *PERFORMS SPARSE MATRIX*VECTOR OPERATIONS</span>
<a name="l00009"></a>00009 <span class="comment">!******************************************************************************</span>
<a name="l00010"></a>00010 
<a name="l00011"></a><a class="code" href="namespaceBurgers__Module.html">00011</a>       <span class="keyword">module</span> Burgers_Module 
<a name="l00012"></a>00012 
<a name="l00013"></a>00013       use <span class="keywordflow">precision_vars</span>, only: third, half, twothird, wp
<a name="l00014"></a>00014 
<a name="l00015"></a>00015       implicit none; <span class="keywordtype">save</span>
<a name="l00016"></a>00016   
<a name="l00017"></a>00017       <span class="keywordtype">private</span>
<a name="l00018"></a>00018       <span class="keywordtype">public</span>    ::  <a class="code" href="namespaceBurgers__Module.html#a5cba412f3e39c8512e93efdc2446e25d">Burgers</a>
<a name="l00019"></a>00019 
<a name="l00020"></a>00020 <span class="comment">!--------------------------------VARIABLES-------------------------------------         </span>
<a name="l00021"></a><a class="code" href="namespaceBurgers__Module.html#a721b9254b2dbb3aa24c9a0b1f7ee082e">00021</a>       <span class="keywordtype">real(wp)  </span>:: dx
<a name="l00022"></a><a class="code" href="namespaceBurgers__Module.html#ad865b6f7c220d53a24122b1f46fdd1a5">00022</a>       <span class="keywordtype">character(120)</span>,         <span class="keywordtype">parameter</span> :: exact_solution = <span class="stringliteral">&apos;tanh&apos;</span>
<a name="l00023"></a>00023 <span class="comment">!      character(120),         parameter :: exact_solution = &apos;Olver&apos;</span>
<a name="l00024"></a><a class="code" href="namespaceBurgers__Module.html#abd609c63d730e2ee4f004b1c74764b42">00024</a>       <span class="keywordtype">real(wp)</span>,               <span class="keywordtype">parameter</span> :: sig0 = -1.0_wp
<a name="l00025"></a><a class="code" href="namespaceBurgers__Module.html#a52251cd24c24635e831aa0054218f1ca">00025</a>       <span class="keywordtype">real(wp)</span>,               <span class="keywordtype">parameter</span> :: sig1 = +1.0_wp
<a name="l00026"></a>00026       
<a name="l00027"></a><a class="code" href="namespaceBurgers__Module.html#a215ef24996393d87dd1fe9e871adfb39">00027</a>       <span class="keywordtype">integer</span>,  <span class="keywordtype">parameter</span>    :: vecl=128    
<a name="l00028"></a><a class="code" href="namespaceBurgers__Module.html#aa3f11280a04e936db41d3f0e0e9eaa2d">00028</a>       <span class="keywordtype">real(wp)</span>, <span class="keywordtype">dimension(vecl) </span>:: x      
<a name="l00029"></a><a class="code" href="namespaceBurgers__Module.html#aae653dbce78cfc4ab135487f99d9b56c">00029</a>       <span class="keywordtype">real(wp)</span>, <span class="keywordtype">parameter</span> :: xL=0.0_wp,xR=1.0_wp
<a name="l00030"></a>00030 
<a name="l00031"></a><a class="code" href="namespaceBurgers__Module.html#a3fe1aa4370fa811497b7abdcfaebc95f">00031</a>       <span class="keywordtype">real(wp)</span>, <span class="keywordtype">dimension(4)</span>, <span class="keywordtype">parameter</span> :: d1vec0= (/-24.0_wp/17.0_wp,  
<a name="l00032"></a>00032                                                     +59.0_wp/34.0_wp,  &amp;
<a name="l00033"></a>00033                                                      -4.0_wp/17.0_wp,  &amp;
<a name="l00034"></a>00034                                                      -3.0_wp/34.0_wp/)
<a name="l00035"></a>00035                                                                       
<a name="l00036"></a><a class="code" href="namespaceBurgers__Module.html#a6dddd73e466796f8ea8f6fa0ccb0d9cd">00036</a>       <span class="keywordtype">real(wp)</span>, <span class="keywordtype">dimension(4)</span>, <span class="keywordtype">parameter</span> :: d1vec1= (/+ 3.0_wp/34.0_wp,  
<a name="l00037"></a>00037                                                     + 4.0_wp/17.0_wp,  &amp;
<a name="l00038"></a>00038                                                     -59.0_wp/34.0_wp,  &amp;
<a name="l00039"></a>00039                                                     +24.0_wp/17.0_wp/)
<a name="l00040"></a>00040 <span class="comment">!------------------------------------------------------------------------------      </span>
<a name="l00041"></a>00041       <span class="keyword">contains</span>    
<a name="l00042"></a>00042 <span class="comment">!==============================================================================</span>
<a name="l00043"></a>00043 <span class="comment">!******************************************************************************</span>
<a name="l00044"></a>00044 <span class="comment">! Subroutine to Initialize, calculate the RHS, and calculate the Jacobian</span>
<a name="l00045"></a>00045 <span class="comment">! of the Burgers problem </span>
<a name="l00046"></a>00046 <span class="comment">!******************************************************************************</span>
<a name="l00047"></a>00047 <span class="comment">! REQUIRED FILES:</span>
<a name="l00048"></a>00048 <span class="comment">! PRECISION_VARS.F90        *DEFINES PRECISION FOR ALL VARIABLES</span>
<a name="l00049"></a>00049 <span class="comment">! CONTROL_VARIABLES.F90     *CONTAINS VARIABLES AND ALLOCATION ROUTINES</span>
<a name="l00050"></a>00050 <span class="comment">! BURGERS_MOD.F90           *CONTAINS ROUTINES TO BUILD BURGER</span>
<a name="l00051"></a>00051 <span class="comment">! JACOBIAN_CSR_MOD.F90      *CONTAINS CSR JACOBIAN VARIABLES</span>
<a name="l00052"></a>00052 <span class="comment">!******************************************************************************</span>
<a name="l00053"></a>00053 
<a name="l00054"></a><a class="code" href="namespaceBurgers__Module.html#a5cba412f3e39c8512e93efdc2446e25d">00054</a>       <span class="keyword">subroutine </span><a class="code" href="namespaceBurgers__Module.html#a5cba412f3e39c8512e93efdc2446e25d">Burgers</a>(nveclen,ep,dt,tfinal,iDT,time,resE_vec,resI_vec,akk)
<a name="l00055"></a>00055 
<a name="l00056"></a>00056       use <span class="keywordflow">control_variables</span>, only: temporal_splitting,probname,Jac_case, &amp;
<a name="l00057"></a>00057      &amp;                             tol,dt_error_tol,uvec,uexact,programstep
<a name="l00058"></a>00058       use <span class="keywordflow">SBP_Coef_Module</span>,   only: Define_CSR_Operators,nnz_D2,D1
<a name="l00059"></a>00059       use <span class="keywordflow">Jacobian_CSR_Mod</span>,  only: Allocate_Jac_CSR_Storage
<a name="l00060"></a>00060 
<a name="l00061"></a>00061 <span class="comment">!-----------------------VARIABLES----------------------------------------------</span>
<a name="l00062"></a>00062       <span class="comment">!INIT vars     </span>
<a name="l00063"></a>00063       <span class="keywordtype">real(wp)</span>, <span class="keywordtype">intent(in   )</span> :: ep
<a name="l00064"></a>00064       <span class="keywordtype">real(wp)</span>, <span class="keywordtype">intent(inout)</span> :: dt
<a name="l00065"></a>00065       <span class="keywordtype">integer</span>,  <span class="keywordtype">intent(  out)</span> :: nveclen
<a name="l00066"></a>00066       <span class="keywordtype">real(wp)</span>, <span class="keywordtype">intent(  out)</span> :: tfinal
<a name="l00067"></a>00067       <span class="keywordtype">real(wp)</span>, <span class="keywordtype">intent(in   )</span> :: time
<a name="l00068"></a>00068       <span class="keywordtype">integer</span>,  <span class="keywordtype">intent(in   )</span> :: iDT
<a name="l00069"></a>00069 
<a name="l00070"></a>00070       <span class="keywordtype">real(wp)                </span>:: tinitial
<a name="l00071"></a>00071       
<a name="l00072"></a>00072       <span class="comment">!RHS vars</span>
<a name="l00073"></a>00073       <span class="keywordtype">real(wp)</span>, <span class="keywordtype">dimension(vecl)</span>, <span class="keywordtype">intent(  out)</span> :: resE_vec,resI_vec
<a name="l00074"></a>00074       
<a name="l00075"></a>00075       <span class="comment">!Jacob vars</span>
<a name="l00076"></a>00076       <span class="keywordtype">real(wp)</span>, <span class="keywordtype">intent(in   )</span> :: akk
<a name="l00077"></a>00077 <span class="comment">!------------------------------------------------------------------------------</span>
<a name="l00078"></a>00078       
<a name="l00079"></a>00079       Program_Step_Select: <span class="keyword">select</span> <span class="keyword">case</span>(programstep)
<a name="l00080"></a>00080         <span class="comment">!**Pre-initialization. Get problem name, vector length and grid**</span>
<a name="l00081"></a>00081         <span class="keyword">case</span>(<span class="stringliteral">&apos;INITIALIZE_PROBLEM_INFORMATION&apos;</span>)
<a name="l00082"></a>00082           nveclen = <a class="code" href="namespaceBurgers__Module.html#a215ef24996393d87dd1fe9e871adfb39">vecl</a>
<a name="l00083"></a>00083           <a class="code" href="namespacecontrol__variables.html#ab4dc4a4fa46d7037bf7d9aaa1ab3e81c">probname</a>=<span class="stringliteral">&apos;Burgers  &apos;</span>     
<a name="l00084"></a>00084           tol=1.0e-12_wp  
<a name="l00085"></a>00085           dt_error_tol=5.0e-14_wp
<a name="l00086"></a>00086           jac_case=<span class="stringliteral">&apos;SPARSE&apos;</span>
<a name="l00087"></a>00087           call <a class="code" href="namespaceBurgers__Module.html#a05050595f90dc1320029c0498d90c912">grid</a>()           
<a name="l00088"></a>00088  
<a name="l00089"></a>00089         <span class="comment">!**Initialization of problem information**        </span>
<a name="l00090"></a>00090         <span class="keyword">case</span>(<span class="stringliteral">&apos;SET_INITIAL_CONDITIONS&apos;</span>)
<a name="l00091"></a>00091 
<a name="l00092"></a>00092           <span class="comment">!Allocate derivative operators</span>
<a name="l00093"></a>00093           <span class="keyword">if</span>(.not. <span class="keyword">allocated</span>(<a class="code" href="namespaceSBP__Coef__Module.html#a1adae037837113781655b270e471ba68">D1</a>)) call <a class="code" href="namespaceSBP__Coef__Module.html#a2a470b5ce579d35823d5a3b0cdfc0d25">Define_CSR_Operators</a>(<a class="code" href="namespaceBurgers__Module.html#a215ef24996393d87dd1fe9e871adfb39">vecl</a>,<a class="code" href="namespaceBurgers__Module.html#a721b9254b2dbb3aa24c9a0b1f7ee082e">dx</a>)   
<a name="l00094"></a>00094 
<a name="l00095"></a>00095           <span class="comment">!Time information</span>
<a name="l00096"></a>00096           tinitial=0.0_wp  <span class="comment">! initial time</span>
<a name="l00097"></a>00097           tfinal = 0.5_wp  <span class="comment">! final time    </span>
<a name="l00098"></a>00098           choose_dt: <span class="keyword">select</span> <span class="keyword">case</span>(temporal_splitting)       
<a name="l00099"></a>00099             <span class="keyword">case</span>(<span class="stringliteral">&apos;EXPLICIT&apos;</span>); dt = 0.00005_wp*0.1_wp/10**((iDT-1)/20.0_wp) <span class="comment">! timestep  explicit </span>
<a name="l00100"></a>00100             <span class="keyword">case</span> default    ; dt = 0.05_wp*0.1_wp/10**((iDT-1)/20.0_wp)    <span class="comment">! timestep  implcit</span>
<a name="l00101"></a>00101           <span class="keyword">end select</span> choose_dt
<a name="l00102"></a>00102           
<a name="l00103"></a>00103           call <a class="code" href="namespaceBurgers__Module.html#ae498d49ba36c572b1569e8b29c72c456">exact_Burg</a>(uvec,ep,tinitial) <span class="comment">!set initial conditions   </span>
<a name="l00104"></a>00104           call <a class="code" href="namespaceBurgers__Module.html#ae498d49ba36c572b1569e8b29c72c456">exact_Burg</a>(uexact,ep,tfinal) <span class="comment">!set exact solution at tfinal</span>
<a name="l00105"></a>00105                 
<a name="l00106"></a>00106         <span class="keyword">case</span>(<span class="stringliteral">&apos;BUILD_RHS&apos;</span>)
<a name="l00107"></a>00107           choose_RHS_type: <span class="keyword">select</span> <span class="keyword">case</span> (Temporal_Splitting)   
<a name="l00108"></a>00108             <span class="keyword">case</span>(<span class="stringliteral">&apos;EXPLICIT&apos;</span>)
<a name="l00109"></a>00109               call <a class="code" href="namespaceBurgers__Module.html#ac013299b934015fbfb64d3e5b5d2da01">Burgers_dUdt</a>(uvec,resE_vec,time,ep,dt)
<a name="l00110"></a>00110               resI_vec(:)=0.0_wp
<a name="l00111"></a>00111             <span class="keyword">case</span>(<span class="stringliteral">&apos;IMPLICIT&apos;</span>) <span class="comment">! For fully implicit schemes</span>
<a name="l00112"></a>00112               call <a class="code" href="namespaceBurgers__Module.html#ac013299b934015fbfb64d3e5b5d2da01">Burgers_dUdt</a>(uvec,resI_vec,time,ep,dt)
<a name="l00113"></a>00113               resE_vec(:)=0.0_wp
<a name="l00114"></a>00114           <span class="keyword">end select</span> choose_RHS_type
<a name="l00115"></a>00115        
<a name="l00116"></a>00116         <span class="keyword">case</span>(<span class="stringliteral">&apos;BUILD_JACOBIAN&apos;</span>)
<a name="l00117"></a>00117           choose_Jac_type: <span class="keyword">select</span> <span class="keyword">case</span>(temporal_splitting)
<a name="l00118"></a>00118             <span class="keyword">case</span>(<span class="stringliteral">&apos;IMPLICIT&apos;</span>) <span class="comment">! For fully implicit schemes</span>
<a name="l00119"></a>00119               call <a class="code" href="namespaceJacobian__CSR__Mod.html#ab251b185ad5d74ee771ea99d2a7f3935">Allocate_Jac_CSR_Storage</a>(<a class="code" href="namespaceBurgers__Module.html#a215ef24996393d87dd1fe9e871adfb39">vecl</a>,<a class="code" href="namespaceSBP__Coef__Module.html#ad3838223107366b3e9051bbded8066b9">nnz_D2</a>)
<a name="l00120"></a>00120               call <a class="code" href="namespaceBurgers__Module.html#a0dcbbd2d7003c284000e6deaef417691">Build_Jac</a>(uvec,ep,dt,akk,time)          
<a name="l00121"></a>00121           <span class="keyword">end select</span> choose_Jac_type
<a name="l00122"></a>00122         
<a name="l00123"></a>00123       <span class="keyword">end select</span> Program_Step_select
<a name="l00124"></a>00124 <span class="keyword">      end subroutine Burgers</span>
<a name="l00125"></a>00125 <span class="comment">!==============================================================================</span>
<a name="l00126"></a>00126 <span class="comment">!==============================================================================</span>
<a name="l00127"></a>00127 <span class="comment">!==============================================================================</span>
<a name="l00128"></a>00128 <span class="comment">! PRODUCES GRID</span>
<a name="l00129"></a><a class="code" href="namespaceBurgers__Module.html#a05050595f90dc1320029c0498d90c912">00129</a>       <span class="keyword">subroutine </span><a class="code" href="namespaceBurgers__Module.html#a05050595f90dc1320029c0498d90c912">grid</a>()
<a name="l00130"></a>00130       <span class="keywordtype">integer</span> :: i
<a name="l00131"></a>00131       
<a name="l00132"></a>00132       <span class="keyword">do</span> i=1,<a class="code" href="namespaceBurgers__Module.html#a215ef24996393d87dd1fe9e871adfb39">vecl</a>
<a name="l00133"></a>00133         <a class="code" href="namespaceBurgers__Module.html#aa3f11280a04e936db41d3f0e0e9eaa2d">x</a>(i)= <a class="code" href="namespaceBurgers__Module.html#aad3d58f173ecb78a3c4c76598c5ccd39">xL</a> + (<a class="code" href="namespaceBurgers__Module.html#aae653dbce78cfc4ab135487f99d9b56c">xR</a>-<a class="code" href="namespaceBurgers__Module.html#aad3d58f173ecb78a3c4c76598c5ccd39">xL</a>)*(i-1.0_wp)/(<a class="code" href="namespaceBurgers__Module.html#a215ef24996393d87dd1fe9e871adfb39">vecl</a>-1.0_wp)
<a name="l00134"></a>00134       <span class="keyword">enddo</span>
<a name="l00135"></a>00135       
<a name="l00136"></a>00136       <a class="code" href="namespaceBurgers__Module.html#a721b9254b2dbb3aa24c9a0b1f7ee082e">dx</a>=<a class="code" href="namespaceBurgers__Module.html#aa3f11280a04e936db41d3f0e0e9eaa2d">x</a>(2)-<a class="code" href="namespaceBurgers__Module.html#aa3f11280a04e936db41d3f0e0e9eaa2d">x</a>(1)
<a name="l00137"></a>00137 
<a name="l00138"></a>00138 <span class="keyword">      end subroutine grid</span>
<a name="l00139"></a>00139 <span class="comment">!==============================================================================</span>
<a name="l00140"></a>00140 <span class="comment">! RETURNS VECTOR WITH EXACT SOLUTION</span>
<a name="l00141"></a><a class="code" href="namespaceBurgers__Module.html#ae498d49ba36c572b1569e8b29c72c456">00141</a>       <span class="keyword">subroutine </span><a class="code" href="namespaceBurgers__Module.html#ae498d49ba36c572b1569e8b29c72c456">exact_Burg</a>(u,eps,time)
<a name="l00142"></a>00142 
<a name="l00143"></a>00143       <span class="keywordtype">real(wp)</span>,                  <span class="keywordtype">intent(in   )</span> :: eps,time
<a name="l00144"></a>00144       <span class="keywordtype">real(wp)</span>, <span class="keywordtype">dimension(vecl)</span>, <span class="keywordtype">intent(  out)</span> :: u
<a name="l00145"></a>00145       <span class="keywordtype">integer</span>                                  :: i
<a name="l00146"></a>00146 
<a name="l00147"></a>00147       <span class="keyword">do</span> i = 1,<a class="code" href="namespaceBurgers__Module.html#a215ef24996393d87dd1fe9e871adfb39">vecl</a>
<a name="l00148"></a>00148         u(i) =  <a class="code" href="namespaceBurgers__Module.html#aebdabe89201bab6f3db0a27bcc76ca48">NL_Burg_exactsolution</a>(<a class="code" href="namespaceBurgers__Module.html#aa3f11280a04e936db41d3f0e0e9eaa2d">x</a>(i),time,eps)
<a name="l00149"></a>00149       <span class="keyword">enddo</span>
<a name="l00150"></a>00150 
<a name="l00151"></a>00151 <span class="keyword">      end subroutine exact_Burg</span>
<a name="l00152"></a>00152 <span class="comment">!==============================================================================</span>
<a name="l00153"></a>00153 <span class="comment">! DEFINES RHS </span>
<a name="l00154"></a><a class="code" href="namespaceBurgers__Module.html#ac013299b934015fbfb64d3e5b5d2da01">00154</a>       <span class="keyword">subroutine </span><a class="code" href="namespaceBurgers__Module.html#ac013299b934015fbfb64d3e5b5d2da01">Burgers_dUdt</a>(u,dudt,time,eps,dt)
<a name="l00155"></a>00155       
<a name="l00156"></a>00156       use <span class="keywordflow">SBP_Coef_Module</span>, only: Pinv,D1,D2,jD1,jD2,iD1,iD2 
<a name="l00157"></a>00157       use <span class="keywordflow">matvec_module</span>,   only: amux
<a name="l00158"></a>00158 
<a name="l00159"></a>00159       <span class="keywordtype">real(wp)</span>, <span class="keywordtype">dimension(vecl)</span>, <span class="keywordtype">intent(in   )</span> ::  u
<a name="l00160"></a>00160       <span class="keywordtype">real(wp)</span>, <span class="keywordtype">dimension(vecl)</span>, <span class="keywordtype">intent(  out)</span> :: dudt
<a name="l00161"></a>00161       <span class="keywordtype">real(wp)</span>,                  <span class="keywordtype">intent(in   )</span> :: time, eps, dt
<a name="l00162"></a>00162 
<a name="l00163"></a>00163       <span class="keywordtype">real(wp)</span>, <span class="keywordtype">dimension(vecl)                </span>:: f, df, dfv, gsat, wrk    
<a name="l00164"></a>00164       <span class="keywordtype">real(wp)                                 </span>:: uL,uR,du0,du1,a0,a1,g0,g1
<a name="l00165"></a>00165       
<a name="l00166"></a>00166       gsat = 0.0_wp ; df  = 0.0_wp ; dfv = 0.0_wp ;
<a name="l00167"></a>00167 
<a name="l00168"></a>00168 <span class="comment">!--------------------------FLUX------------------------------------------------</span>
<a name="l00169"></a>00169       <span class="comment">!     Canonical splitting for Inviscid flux in Burgers eqn</span>
<a name="l00170"></a>00170       <span class="comment">!     f(u)_x = 2/3 (u u/2)_x + 1/3 u u_x</span>
<a name="l00171"></a>00171 
<a name="l00172"></a>00172       f(:) = <a class="code" href="namespaceprecision__vars.html#a9a0842cca04cbdde9d64aeff4c1ff15d">half</a>*u(:)*u(:)
<a name="l00173"></a>00173       call <a class="code" href="namespacematvec__module.html#a1f3669ca263f13c00625724a4add11ea">amux</a>(<a class="code" href="namespaceBurgers__Module.html#a215ef24996393d87dd1fe9e871adfb39">vecl</a>,f,wrk,<a class="code" href="namespaceSBP__Coef__Module.html#a1adae037837113781655b270e471ba68">D1</a>,<a class="code" href="namespaceSBP__Coef__Module.html#a88980715f10265d5c8d1a4ed267a60ab">jD1</a>,<a class="code" href="namespaceSBP__Coef__Module.html#a59352f918ff4deadfe38916683618337">iD1</a>)
<a name="l00174"></a>00174 
<a name="l00175"></a>00175       df(:) = df(:) + <a class="code" href="namespaceprecision__vars.html#a77ab4d52a6e403189e25e850eaba0428">twothird</a>*wrk(:)
<a name="l00176"></a>00176 
<a name="l00177"></a>00177       call <a class="code" href="namespacematvec__module.html#a1f3669ca263f13c00625724a4add11ea">amux</a>(<a class="code" href="namespaceBurgers__Module.html#a215ef24996393d87dd1fe9e871adfb39">vecl</a>,u,wrk,<a class="code" href="namespaceSBP__Coef__Module.html#a1adae037837113781655b270e471ba68">D1</a>,<a class="code" href="namespaceSBP__Coef__Module.html#a88980715f10265d5c8d1a4ed267a60ab">jD1</a>,<a class="code" href="namespaceSBP__Coef__Module.html#a59352f918ff4deadfe38916683618337">iD1</a>)
<a name="l00178"></a>00178       df(:) = df(:) + <a class="code" href="namespaceprecision__vars.html#ac0a1f3fc2540521ef56e077387800e0a">third</a>*u(:)*wrk(:)
<a name="l00179"></a>00179 
<a name="l00180"></a>00180       <span class="comment">!  Viscous Flux in Burgers eqn</span>
<a name="l00181"></a>00181 
<a name="l00182"></a>00182       call <a class="code" href="namespacematvec__module.html#a1f3669ca263f13c00625724a4add11ea">amux</a>(<a class="code" href="namespaceBurgers__Module.html#a215ef24996393d87dd1fe9e871adfb39">vecl</a>,u,dfv,<a class="code" href="namespaceSBP__Coef__Module.html#a3f2cc5f7fad0e332d815a65f500fd6ca">D2</a>,<a class="code" href="namespaceSBP__Coef__Module.html#a83634f53cf0308ca3aff67b8f1ba2683">jD2</a>,<a class="code" href="namespaceSBP__Coef__Module.html#a925a2e3cb8ac90d224a58b2d5ca2abf4">iD2</a>)
<a name="l00183"></a>00183 
<a name="l00184"></a>00184 <span class="comment">!--------------Inflow Boundary Condition---------------------------------------</span>
<a name="l00185"></a>00185 
<a name="l00186"></a>00186       uR = u(1)
<a name="l00187"></a>00187 
<a name="l00188"></a>00188       a0 = <a class="code" href="namespaceprecision__vars.html#ac0a1f3fc2540521ef56e077387800e0a">third</a>*(uR + sqrt(uR**2+1.0e-28_wp))    <span class="comment">!a0 = third*(uR + abs(uR))</span>
<a name="l00189"></a>00189       g0 = a0 * <a class="code" href="namespaceBurgers__Module.html#aebdabe89201bab6f3db0a27bcc76ca48">NL_Burg_exactsolution</a>(<a class="code" href="namespaceBurgers__Module.html#aa3f11280a04e936db41d3f0e0e9eaa2d">x</a>(1),time,eps)                &amp;
<a name="l00190"></a>00190          - eps* <a class="code" href="namespaceBurgers__Module.html#a8958a13ffdbdca8d384c2a8a4008bc2e">NL_Burg_exact_derivative</a>(<a class="code" href="namespaceBurgers__Module.html#aa3f11280a04e936db41d3f0e0e9eaa2d">x</a>(1),time,eps)
<a name="l00191"></a>00191 
<a name="l00192"></a>00192       du0 = dot_product(<a class="code" href="namespaceBurgers__Module.html#a3fe1aa4370fa811497b7abdcfaebc95f">d1vec0</a>(1:4),u(1:4)) / <a class="code" href="namespaceBurgers__Module.html#a721b9254b2dbb3aa24c9a0b1f7ee082e">dx</a>
<a name="l00193"></a>00193 
<a name="l00194"></a>00194       gsat(1) = gsat(1) + <a class="code" href="namespaceBurgers__Module.html#abd609c63d730e2ee4f004b1c74764b42">sig0</a> * <a class="code" href="namespaceSBP__Coef__Module.html#aae84c8b8ccfc4af6b9622f138494e4d9">Pinv</a>(1) * (a0*uR - eps*du0 - g0) 
<a name="l00195"></a>00195 
<a name="l00196"></a>00196 <span class="comment">!---------------Outflow Boundary Condition-------------------------------------</span>
<a name="l00197"></a>00197 
<a name="l00198"></a>00198       uL = u(<a class="code" href="namespaceBurgers__Module.html#a215ef24996393d87dd1fe9e871adfb39">vecl</a>)
<a name="l00199"></a>00199 
<a name="l00200"></a>00200       a1 = <a class="code" href="namespaceprecision__vars.html#ac0a1f3fc2540521ef56e077387800e0a">third</a>*(uL - sqrt(uL**2+1.0e-28_wp)) <span class="comment">!a1 = third*(uL - abs(uL))</span>
<a name="l00201"></a>00201       g1 = a1 * <a class="code" href="namespaceBurgers__Module.html#aebdabe89201bab6f3db0a27bcc76ca48">NL_Burg_exactsolution</a>(<a class="code" href="namespaceBurgers__Module.html#aa3f11280a04e936db41d3f0e0e9eaa2d">x</a>(<a class="code" href="namespaceBurgers__Module.html#a215ef24996393d87dd1fe9e871adfb39">vecl</a>),time,eps)                &amp;
<a name="l00202"></a>00202          - eps* <a class="code" href="namespaceBurgers__Module.html#a8958a13ffdbdca8d384c2a8a4008bc2e">NL_Burg_exact_derivative</a>(<a class="code" href="namespaceBurgers__Module.html#aa3f11280a04e936db41d3f0e0e9eaa2d">x</a>(<a class="code" href="namespaceBurgers__Module.html#a215ef24996393d87dd1fe9e871adfb39">vecl</a>),time,eps)
<a name="l00203"></a>00203       du1 = dot_product(<a class="code" href="namespaceBurgers__Module.html#a6dddd73e466796f8ea8f6fa0ccb0d9cd">d1vec1</a>(1:4),u(<a class="code" href="namespaceBurgers__Module.html#a215ef24996393d87dd1fe9e871adfb39">vecl</a>-3:<a class="code" href="namespaceBurgers__Module.html#a215ef24996393d87dd1fe9e871adfb39">vecl</a>)) / <a class="code" href="namespaceBurgers__Module.html#a721b9254b2dbb3aa24c9a0b1f7ee082e">dx</a>
<a name="l00204"></a>00204 
<a name="l00205"></a>00205       gsat(<a class="code" href="namespaceBurgers__Module.html#a215ef24996393d87dd1fe9e871adfb39">vecl</a>) = gsat(<a class="code" href="namespaceBurgers__Module.html#a215ef24996393d87dd1fe9e871adfb39">vecl</a>) + <a class="code" href="namespaceBurgers__Module.html#a52251cd24c24635e831aa0054218f1ca">sig1</a> * <a class="code" href="namespaceSBP__Coef__Module.html#aae84c8b8ccfc4af6b9622f138494e4d9">Pinv</a>(<a class="code" href="namespaceBurgers__Module.html#a215ef24996393d87dd1fe9e871adfb39">vecl</a>) * (a1*uL-eps*du1-g1)
<a name="l00206"></a>00206 
<a name="l00207"></a>00207 <span class="comment">!--------------------Sum all terms---------------------------------------------</span>
<a name="l00208"></a>00208 
<a name="l00209"></a>00209       dudt(:) = dt*(eps*dfv(:) - df(:) + gsat(:))
<a name="l00210"></a>00210 
<a name="l00211"></a>00211 <span class="keyword">      end subroutine Burgers_dUdt</span>
<a name="l00212"></a>00212       
<a name="l00213"></a>00213 <span class="comment">!==============================================================================</span>
<a name="l00214"></a>00214 <span class="comment">! CREATES JACOBIAN</span>
<a name="l00215"></a><a class="code" href="namespaceBurgers__Module.html#a0dcbbd2d7003c284000e6deaef417691">00215</a>       <span class="keyword">subroutine </span><a class="code" href="namespaceBurgers__Module.html#a0dcbbd2d7003c284000e6deaef417691">Build_Jac</a>(u,eps,dt,akk,time)
<a name="l00216"></a>00216 
<a name="l00217"></a>00217       use <span class="keywordflow">SBP_Coef_Module</span>,  only: Pinv,D1,D2,jD1,jD2,iD1,iD2       
<a name="l00218"></a>00218       use <span class="keywordflow">matvec_module</span>,    only: amux
<a name="l00219"></a>00219       use <span class="keywordflow">unary_mod</span>,        only: aplb,aplsca,amudia,diamua,apldia
<a name="l00220"></a>00220       use <span class="keywordflow">Jacobian_CSR_Mod</span>, only: iaJac,jaJac,aJac
<a name="l00221"></a>00221       
<a name="l00222"></a>00222       <span class="keywordtype">real(wp)</span>, <span class="keywordtype">dimension(vecl)</span>, <span class="keywordtype">intent(in)</span> :: u
<a name="l00223"></a>00223       <span class="keywordtype">real(wp)</span>,                  <span class="keywordtype">intent(in)</span> :: eps,dt,akk,time    
<a name="l00224"></a>00224         
<a name="l00225"></a>00225       <span class="keywordtype">integer</span>,  dimension(size(iaJac))  :: iwrk1,iwrk2,iwrk3,iJac
<a name="l00226"></a>00226       <span class="keywordtype">integer</span>,  dimension(size(jaJac))  :: jwrk1,jwrk2,jwrk3,jJac
<a name="l00227"></a>00227       <span class="keywordtype">real(wp)</span>, dimension(size( aJac))  :: wrk1,wrk2,wrk3,Jac,wrk4,eps_d2      
<a name="l00228"></a>00228       
<a name="l00229"></a>00229       <span class="keywordtype">integer</span>,  <span class="keywordtype">dimension(vecl)  </span>:: iw
<a name="l00230"></a>00230       <span class="keywordtype">real(wp)</span>, <span class="keywordtype">dimension(vecl)  </span>:: diag
<a name="l00231"></a>00231       <span class="keywordtype">integer</span>,  <span class="keywordtype">dimension(2)     </span>:: ierr
<a name="l00232"></a>00232       <span class="keywordtype">real(wp)                   </span>:: uL,a1_d,uR,a0_d,a0,a1
<a name="l00233"></a>00233       <span class="keywordtype">integer</span>                    :: nnz_max
<a name="l00234"></a>00234 <span class="comment">!------------------------------------------------------------------------------ </span>
<a name="l00235"></a>00235       nnz_max=<span class="keyword">size</span>(aJac)
<a name="l00236"></a>00236      
<a name="l00237"></a>00237 
<a name="l00238"></a>00238 <span class="comment">!---------------------dgsat/dt-------------------------------------------------</span>
<a name="l00239"></a>00239       uL=u(<a class="code" href="namespaceBurgers__Module.html#a215ef24996393d87dd1fe9e871adfb39">vecl</a>)
<a name="l00240"></a>00240       a1 = <a class="code" href="namespaceprecision__vars.html#ac0a1f3fc2540521ef56e077387800e0a">third</a>*(uL - sqrt(uL**2+1.0e-28_wp))
<a name="l00241"></a>00241       a1_d=<a class="code" href="namespaceprecision__vars.html#ac0a1f3fc2540521ef56e077387800e0a">third</a>*(1-uL/sqrt(uL**2+1.0e-28_wp))
<a name="l00242"></a>00242    
<a name="l00243"></a>00243       uR=u(1)
<a name="l00244"></a>00244       a0 = <a class="code" href="namespaceprecision__vars.html#ac0a1f3fc2540521ef56e077387800e0a">third</a>*(uR + sqrt(uR**2+1.0e-28_wp))
<a name="l00245"></a>00245       a0_d=<a class="code" href="namespaceprecision__vars.html#ac0a1f3fc2540521ef56e077387800e0a">third</a>*(1+uR/sqrt(uR**2+1.0e-28_wp))
<a name="l00246"></a>00246 
<a name="l00247"></a>00247 <span class="comment">!******Steps to make xjac******</span>
<a name="l00248"></a>00248 <span class="comment">!       jac=eps*d2-2/3*d1*u-1/3*u*d1-1/3*diag(d1*u)+dgsat/du</span>
<a name="l00249"></a>00249 <span class="comment">!1      wrk1=-2/3*d1*u</span>
<a name="l00250"></a>00250 <span class="comment">!2      wrk2=-1/3*u*d1</span>
<a name="l00251"></a>00251 <span class="comment">!3      wrk3=wrk1+wrk2</span>
<a name="l00252"></a>00252 <span class="comment">!4      eps_d2=eps*d2</span>
<a name="l00253"></a>00253 <span class="comment">!5      jac=eps_d2+wrk3-1/3*diag(d1*u)+dgsat/du</span>
<a name="l00254"></a>00254 <span class="comment">!6      wrk4=-akk*dt*jac</span>
<a name="l00255"></a>00255 <span class="comment">!</span>
<a name="l00256"></a>00256 <span class="comment">!       xjac=I-akk*dt*jac=-akk*dt*jac+(1)*I</span>
<a name="l00257"></a>00257 <span class="comment">!7      xjac=wrk4+(1)*I</span>
<a name="l00258"></a>00258 <span class="comment">! </span>
<a name="l00259"></a>00259 <span class="comment">!8      xjac-&gt; wrk4, iJac, jJac</span>
<a name="l00260"></a>00260 <span class="comment">!******************************</span>
<a name="l00261"></a>00261 <span class="comment">! --------------Make xjac -----------------------------------------------------</span>
<a name="l00262"></a>00262       call <a class="code" href="namespaceunary__mod.html#a1fd7556350f3910e37b411bb32adcb26">amudia</a>(<a class="code" href="namespaceBurgers__Module.html#a215ef24996393d87dd1fe9e871adfb39">vecl</a>,1,<a class="code" href="namespaceSBP__Coef__Module.html#a1adae037837113781655b270e471ba68">D1</a>,<a class="code" href="namespaceSBP__Coef__Module.html#a88980715f10265d5c8d1a4ed267a60ab">jD1</a>,<a class="code" href="namespaceSBP__Coef__Module.html#a59352f918ff4deadfe38916683618337">iD1</a>,u,wrk1,jwrk1,iwrk1)                   <span class="comment">!1</span>
<a name="l00263"></a>00263       wrk1(:)=-<a class="code" href="namespaceprecision__vars.html#a77ab4d52a6e403189e25e850eaba0428">twothird</a>*wrk1(:)                                              <span class="comment">!1</span>
<a name="l00264"></a>00264       
<a name="l00265"></a>00265       call <a class="code" href="namespaceunary__mod.html#a428ee1d4e4ab14a12be914c401b90158">diamua</a>(<a class="code" href="namespaceBurgers__Module.html#a215ef24996393d87dd1fe9e871adfb39">vecl</a>,1,<a class="code" href="namespaceSBP__Coef__Module.html#a1adae037837113781655b270e471ba68">D1</a>,<a class="code" href="namespaceSBP__Coef__Module.html#a88980715f10265d5c8d1a4ed267a60ab">jD1</a>,<a class="code" href="namespaceSBP__Coef__Module.html#a59352f918ff4deadfe38916683618337">iD1</a>,u,wrk2,jwrk2,iwrk2)                   <span class="comment">!2</span>
<a name="l00266"></a>00266       wrk2(:)=-<a class="code" href="namespaceprecision__vars.html#ac0a1f3fc2540521ef56e077387800e0a">third</a>*wrk2(:)                                                 <span class="comment">!2</span>
<a name="l00267"></a>00267       
<a name="l00268"></a>00268       call <a class="code" href="namespaceunary__mod.html#ad0d8a19e91684be702bb07ef7fe3a59c">aplb</a>(<a class="code" href="namespaceBurgers__Module.html#a215ef24996393d87dd1fe9e871adfb39">vecl</a>,<a class="code" href="namespaceBurgers__Module.html#a215ef24996393d87dd1fe9e871adfb39">vecl</a>,1,wrk1,jwrk1,iwrk1,wrk2,jwrk2,iwrk2,wrk3,&amp;   <span class="comment">!3</span>
<a name="l00269"></a>00269      &amp;          jwrk3,iwrk3,nnz_max,iw,ierr(1))                               <span class="comment">!3</span>
<a name="l00270"></a>00270 
<a name="l00271"></a>00271       eps_d2=eps*<a class="code" href="namespaceSBP__Coef__Module.html#a3f2cc5f7fad0e332d815a65f500fd6ca">D2</a>(:)                                                       <span class="comment">!4</span>
<a name="l00272"></a>00272       call <a class="code" href="namespaceunary__mod.html#ad0d8a19e91684be702bb07ef7fe3a59c">aplb</a>(<a class="code" href="namespaceBurgers__Module.html#a215ef24996393d87dd1fe9e871adfb39">vecl</a>,<a class="code" href="namespaceBurgers__Module.html#a215ef24996393d87dd1fe9e871adfb39">vecl</a>,1,eps_d2,<a class="code" href="namespaceSBP__Coef__Module.html#a83634f53cf0308ca3aff67b8f1ba2683">jD2</a>,<a class="code" href="namespaceSBP__Coef__Module.html#a925a2e3cb8ac90d224a58b2d5ca2abf4">iD2</a>,wrk3,jwrk3,iwrk3,Jac,&amp;     <span class="comment">!5a</span>
<a name="l00273"></a>00273      &amp;          jJac,iJac,nnz_max,iw,ierr(2))                                <span class="comment">!5a</span>
<a name="l00274"></a>00274 
<a name="l00275"></a>00275       call <a class="code" href="namespacematvec__module.html#a1f3669ca263f13c00625724a4add11ea">amux</a>(<a class="code" href="namespaceBurgers__Module.html#a215ef24996393d87dd1fe9e871adfb39">vecl</a>,-<a class="code" href="namespaceprecision__vars.html#ac0a1f3fc2540521ef56e077387800e0a">third</a>*u,diag,<a class="code" href="namespaceSBP__Coef__Module.html#a1adae037837113781655b270e471ba68">D1</a>,<a class="code" href="namespaceSBP__Coef__Module.html#a88980715f10265d5c8d1a4ed267a60ab">jD1</a>,<a class="code" href="namespaceSBP__Coef__Module.html#a59352f918ff4deadfe38916683618337">iD1</a>) <span class="comment">!First-derivative of u vec!5b</span>
<a name="l00276"></a>00276       call <a class="code" href="namespaceunary__mod.html#ad6619f9de5d3db24b25e89901c2adda7">apldia</a>(<a class="code" href="namespaceBurgers__Module.html#a215ef24996393d87dd1fe9e871adfb39">vecl</a>,0,Jac,jJac,iJac,diag,Jac,jJac,iJac,iw)            <span class="comment">!5b</span>
<a name="l00277"></a>00277 
<a name="l00278"></a>00278      <span class="comment">! R - 5c</span>
<a name="l00279"></a>00279       Jac(1)=Jac(1)+<a class="code" href="namespaceBurgers__Module.html#abd609c63d730e2ee4f004b1c74764b42">sig0</a>*<a class="code" href="namespaceSBP__Coef__Module.html#aae84c8b8ccfc4af6b9622f138494e4d9">Pinv</a>(1)*(a0+a0_d*(uR- &amp;
<a name="l00280"></a>00280      &amp;       <a class="code" href="namespaceBurgers__Module.html#aebdabe89201bab6f3db0a27bcc76ca48">NL_Burg_exactsolution</a>(<a class="code" href="namespaceBurgers__Module.html#aa3f11280a04e936db41d3f0e0e9eaa2d">x</a>(1),time,eps))) 
<a name="l00281"></a>00281       Jac(1:4)=Jac(1:4)+<a class="code" href="namespaceBurgers__Module.html#abd609c63d730e2ee4f004b1c74764b42">sig0</a>*<a class="code" href="namespaceSBP__Coef__Module.html#aae84c8b8ccfc4af6b9622f138494e4d9">Pinv</a>(1)*(-eps)*<a class="code" href="namespaceBurgers__Module.html#a3fe1aa4370fa811497b7abdcfaebc95f">d1vec0</a>(:)/<a class="code" href="namespaceBurgers__Module.html#a721b9254b2dbb3aa24c9a0b1f7ee082e">dx</a>
<a name="l00282"></a>00282       
<a name="l00283"></a>00283       <span class="comment">! L - 5c</span>
<a name="l00284"></a>00284       Jac(nnz_max)=Jac(nnz_max)+<a class="code" href="namespaceBurgers__Module.html#a52251cd24c24635e831aa0054218f1ca">sig1</a>*<a class="code" href="namespaceSBP__Coef__Module.html#aae84c8b8ccfc4af6b9622f138494e4d9">Pinv</a>(<a class="code" href="namespaceBurgers__Module.html#a215ef24996393d87dd1fe9e871adfb39">vecl</a>)*(a1+a1_d*(uL- &amp;
<a name="l00285"></a>00285      &amp;            <a class="code" href="namespaceBurgers__Module.html#aebdabe89201bab6f3db0a27bcc76ca48">NL_Burg_exactsolution</a>(<a class="code" href="namespaceBurgers__Module.html#aa3f11280a04e936db41d3f0e0e9eaa2d">x</a>(<a class="code" href="namespaceBurgers__Module.html#a215ef24996393d87dd1fe9e871adfb39">vecl</a>),time,eps))) 
<a name="l00286"></a>00286       Jac(nnz_max-3:nnz_max)=Jac(nnz_max-3:nnz_max)+ &amp;
<a name="l00287"></a>00287      &amp;                     <a class="code" href="namespaceBurgers__Module.html#a52251cd24c24635e831aa0054218f1ca">sig1</a>*<a class="code" href="namespaceSBP__Coef__Module.html#aae84c8b8ccfc4af6b9622f138494e4d9">Pinv</a>(<a class="code" href="namespaceBurgers__Module.html#a215ef24996393d87dd1fe9e871adfb39">vecl</a>)*(-eps)*<a class="code" href="namespaceBurgers__Module.html#a6dddd73e466796f8ea8f6fa0ccb0d9cd">d1vec1</a>(:)/<a class="code" href="namespaceBurgers__Module.html#a721b9254b2dbb3aa24c9a0b1f7ee082e">dx</a>
<a name="l00288"></a>00288      
<a name="l00289"></a>00289       wrk4=-akk*dt*Jac                                                       <span class="comment">!6</span>
<a name="l00290"></a>00290       call <a class="code" href="namespaceunary__mod.html#a74f52765deb59280ca3f1b308a7a3bfb">aplsca</a>(<a class="code" href="namespaceBurgers__Module.html#a215ef24996393d87dd1fe9e871adfb39">vecl</a>,wrk4,jJac,iJac,1.0_wp,iw)                          <span class="comment">!7</span>
<a name="l00291"></a>00291 
<a name="l00292"></a>00292       <span class="comment">!8</span>
<a name="l00293"></a>00293       iaJac=iJac
<a name="l00294"></a>00294       jaJac=jJac
<a name="l00295"></a>00295       aJac=wrk4
<a name="l00296"></a>00296 <span class="comment">!-----------------------------------------------------------------------------  </span>
<a name="l00297"></a>00297       <span class="keyword">if</span> (sum(ierr)/=0) <span class="keyword">then</span> <span class="comment">! Catch errors</span>
<a name="l00298"></a>00298         print*,<span class="stringliteral">&apos;Error building Jacobian&apos;</span>
<a name="l00299"></a>00299         stop
<a name="l00300"></a>00300       <span class="keyword">endif</span>
<a name="l00301"></a>00301    
<a name="l00302"></a>00302 <span class="keyword">      end subroutine Build_Jac</span>
<a name="l00303"></a>00303       
<a name="l00304"></a>00304 <span class="comment">!==============================================================================</span>
<a name="l00305"></a>00305 <span class="comment">! </span>
<a name="l00306"></a>00306 <span class="comment">!!      subroutine error(u,time,eps,dt)</span>
<a name="l00307"></a>00307 <span class="comment">!!</span>
<a name="l00308"></a>00308 <span class="comment">!!      use SBP_Coef_Module, only: Pmat</span>
<a name="l00309"></a>00309 <span class="comment">!!</span>
<a name="l00310"></a>00310 <span class="comment">!!      real(wp),                     intent(in   ) :: time, eps, dt</span>
<a name="l00311"></a>00311 <span class="comment">!!      real(wp), dimension(vecl), intent(inout) :: u</span>
<a name="l00312"></a>00312 <span class="comment">!!</span>
<a name="l00313"></a>00313 <span class="comment">!!      integer                                    :: i</span>
<a name="l00314"></a>00314 <span class="comment">!!      real(wp)                                   :: errL2,errLinf,wrk,psum</span>
<a name="l00315"></a>00315 <span class="comment">!!</span>
<a name="l00316"></a>00316 <span class="comment">!!!     calculate the rms residual over the domain                        </span>
<a name="l00317"></a>00317 <span class="comment">!!</span>
<a name="l00318"></a>00318 <span class="comment">!!      psum    = 0.0_wp</span>
<a name="l00319"></a>00319 <span class="comment">!!      errL2   = 0.0_wp</span>
<a name="l00320"></a>00320 <span class="comment">!!      errLinf = 0.0_wp</span>
<a name="l00321"></a>00321 <span class="comment">!!      do i=1,vecl</span>
<a name="l00322"></a>00322 <span class="comment">!!              wrk = abs(u(i) - NL_Burg_exactsolution(x(i),time,eps))</span>
<a name="l00323"></a>00323 <span class="comment">!!            errL2 =  errL2 +  pmat(i)*wrk * wrk</span>
<a name="l00324"></a>00324 <span class="comment">!!          errLinf =  max(errLinf,wrk)</span>
<a name="l00325"></a>00325 <span class="comment">!!             psum = psum + pmat(i)</span>
<a name="l00326"></a>00326 <span class="comment">!!      enddo</span>
<a name="l00327"></a>00327 <span class="comment">!!      errL2  = ( sqrt(errL2/vecl/psum) )</span>
<a name="l00328"></a>00328 <span class="comment">!!      errLinf= ( errLinf)</span>
<a name="l00329"></a>00329 <span class="comment">!!!!      write( *,89)ixd-1,errL2,errLinf</span>
<a name="l00330"></a>00330 <span class="comment">!!   89 format(&apos;P=&apos;,I4,&apos; ,,  L2&apos;,e18.10,&apos; ,,  Linf&apos;,e18.10,&apos; ,,&apos;)</span>
<a name="l00331"></a>00331 <span class="comment">!!</span>
<a name="l00332"></a>00332 <span class="comment">!!      end subroutine error</span>
<a name="l00333"></a>00333 <span class="comment">!==============================================================================</span>
<a name="l00334"></a>00334 <span class="comment">!</span>
<a name="l00335"></a>00335 <span class="comment">!!      subroutine plot(punit,u,time,eps)</span>
<a name="l00336"></a>00336 <span class="comment">!!</span>
<a name="l00337"></a>00337 <span class="comment">!!      integer,                      intent(in   ) :: punit</span>
<a name="l00338"></a>00338 <span class="comment">!!      real(wp),                     intent(in   ) :: time, eps</span>
<a name="l00339"></a>00339 <span class="comment">!!      real(wp), dimension(vecl), intent(inout) :: u</span>
<a name="l00340"></a>00340 <span class="comment">!!</span>
<a name="l00341"></a>00341 <span class="comment">!!      integer                                    :: i</span>
<a name="l00342"></a>00342 <span class="comment">!!      real(wp)                                   :: wrk,err</span>
<a name="l00343"></a>00343 <span class="comment">!!</span>
<a name="l00344"></a>00344 <span class="comment">!!!     write to plotter file                                             </span>
<a name="l00345"></a>00345 <span class="comment">!!      do i=1,vecl</span>
<a name="l00346"></a>00346 <span class="comment">!!        wrk = NL_Burg_exactsolution(x(i),time,eps)</span>
<a name="l00347"></a>00347 <span class="comment">!!        err = ( abs( wrk - u(i) ) + 1.0e-15 )</span>
<a name="l00348"></a>00348 <span class="comment">!!        write(punit,2)x(i),wrk,u(i),err</span>
<a name="l00349"></a>00349 <span class="comment">!!      enddo</span>
<a name="l00350"></a>00350 <span class="comment">!!    2 format(4(1x,e15.7))</span>
<a name="l00351"></a>00351 <span class="comment">!!</span>
<a name="l00352"></a>00352 <span class="comment">!!      end subroutine plot</span>
<a name="l00353"></a>00353 <span class="comment">!==============================================================================</span>
<a name="l00354"></a>00354 <span class="comment">! DEFINES EXACT SOLUTION FOR PARTICULAR x AND t VALUE</span>
<a name="l00355"></a><a class="code" href="namespaceBurgers__Module.html#aebdabe89201bab6f3db0a27bcc76ca48">00355</a>       <span class="keyword">function </span><a class="code" href="namespaceBurgers__Module.html#aebdabe89201bab6f3db0a27bcc76ca48">NL_Burg_exactsolution</a>(xin,tin,eps)
<a name="l00356"></a>00356 
<a name="l00357"></a>00357       <span class="keywordtype">real(wp)</span>, <span class="keywordtype">intent(in)</span> :: xin, tin, eps
<a name="l00358"></a>00358       <span class="keywordtype">real(wp)</span>, <span class="keywordtype">parameter</span>  ::  a = -0.40_wp, b = 1.0_wp , d = +0.50_wp
<a name="l00359"></a>00359       <span class="keywordtype">real(wp)             </span>::  c = (a+b)/2
<a name="l00360"></a>00360 
<a name="l00361"></a>00361       <span class="keywordtype">real(wp) </span>:: NL_Burg_exactsolution
<a name="l00362"></a>00362       <span class="keywordtype">real(wp) </span>:: t1,t2, x0
<a name="l00363"></a>00363 
<a name="l00364"></a>00364       <span class="keyword">select</span> <span class="keyword">case</span> (<a class="code" href="namespaceBurgers__Module.html#ad865b6f7c220d53a24122b1f46fdd1a5">exact_solution</a>)
<a name="l00365"></a>00365         <span class="keyword">case</span>(<span class="stringliteral">&apos;Olver&apos;</span>)         <span class="comment">!          pp. 1190   Peter J. Olver</span>
<a name="l00366"></a>00366 
<a name="l00367"></a>00367           t1  = (xin - c*tin - d )
<a name="l00368"></a>00368           t2  = exp((b-a)*t1/(2.0_wp*eps))
<a name="l00369"></a>00369 
<a name="l00370"></a>00370           NL_Burg_exactsolution = (a * t2  + b ) / (1.0_wp * t2 + 1.0_wp)
<a name="l00371"></a>00371 
<a name="l00372"></a>00372         <span class="keyword">case</span>(<span class="stringliteral">&apos;tanh&apos;</span>)
<a name="l00373"></a>00373 
<a name="l00374"></a>00374           x0 =  0.1_wp
<a name="l00375"></a>00375           NL_Burg_exactsolution = 1.1_wp - tanh(0.5_wp*(xin-1.1_wp*tin-x0)/eps)
<a name="l00376"></a>00376 
<a name="l00377"></a>00377       <span class="keyword">end select</span>
<a name="l00378"></a>00378 
<a name="l00379"></a>00379 <span class="keyword">      end function NL_Burg_exactsolution</span>
<a name="l00380"></a>00380 <span class="comment">!==============================================================================</span>
<a name="l00381"></a>00381 <span class="comment">! DEFINES EXACT DERIVATIVE FOR PARTICULAR x AND t VALUE</span>
<a name="l00382"></a><a class="code" href="namespaceBurgers__Module.html#a8958a13ffdbdca8d384c2a8a4008bc2e">00382</a>       <span class="keyword">function </span><a class="code" href="namespaceBurgers__Module.html#a8958a13ffdbdca8d384c2a8a4008bc2e">NL_Burg_exact_derivative</a>(xin,tin,eps)
<a name="l00383"></a>00383 
<a name="l00384"></a>00384        <span class="keywordtype">real(wp)</span>, <span class="keywordtype">intent(in)</span> :: xin, tin, eps
<a name="l00385"></a>00385        <span class="keywordtype">real(wp)</span>, <span class="keywordtype">parameter</span>  ::  a = -0.40_wp, b = 1.0_wp , d = +0.50_wp
<a name="l00386"></a>00386        <span class="keywordtype">real(wp)             </span>::  c = (a+b)/2
<a name="l00387"></a>00387 
<a name="l00388"></a>00388        <span class="keywordtype">real(wp) </span>:: NL_Burg_exact_derivative
<a name="l00389"></a>00389        <span class="keywordtype">real(wp) </span>:: t1,t2,t3, x0
<a name="l00390"></a>00390 
<a name="l00391"></a>00391        <span class="keyword">select</span> <span class="keyword">case</span> (<a class="code" href="namespaceBurgers__Module.html#ad865b6f7c220d53a24122b1f46fdd1a5">exact_solution</a>)
<a name="l00392"></a>00392          <span class="keyword">case</span>(<span class="stringliteral">&apos;Olver&apos;</span>)         <span class="comment">!          pp. 1190   Peter J. Olver</span>
<a name="l00393"></a>00393 
<a name="l00394"></a>00394            t1  = (xin - c*tin - d )
<a name="l00395"></a>00395            t2  = ((a - b)*t1)/(4.0_wp*eps)
<a name="l00396"></a>00396            t3  = 2.0_wp / (exp(t2)+exp(-t2))
<a name="l00397"></a>00397 
<a name="l00398"></a>00398            NL_Burg_exact_derivative =  -((a - b)**2* t3**2) /(8.0_wp*eps)
<a name="l00399"></a>00399 
<a name="l00400"></a>00400          <span class="keyword">case</span>(<span class="stringliteral">&apos;tanh&apos;</span>)
<a name="l00401"></a>00401 
<a name="l00402"></a>00402            x0 =  0.1_wp
<a name="l00403"></a>00403            NL_Burg_exact_derivative =  -1.0_wp/cosh((-1.1_wp*tin+xin-x0)/ &amp;
<a name="l00404"></a>00404      &amp;                                 (2.0_wp*eps))**2 / (2.0_wp * eps)
<a name="l00405"></a>00405 
<a name="l00406"></a>00406        <span class="keyword">end select</span>
<a name="l00407"></a>00407 
<a name="l00408"></a>00408 <span class="keyword">      end function NL_Burg_exact_derivative</span>
<a name="l00409"></a>00409 <span class="comment">!==============================================================================</span>
<a name="l00410"></a>00410 <span class="keyword">      end module Burgers_Module</span>
</pre></div></div>
<hr size="1"/><address style="text-align: right;"><small>Generated on 25 Jul 2016 for Doxygen Fortran Example by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
